
<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:16px/1.5 sans-serif;font:16px}.img-with-caption{font-size:15px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:justify;text-justify:inter-word}#post-content{max-width:800px}#post-title{margin-bottom:1px;background-color:#eee;border:1px solid #999;display:block;padding:8px;width:max-content;font-size:40px;margin-right:40px;margin-bottom:5px}#profile_pic{float:right;margin:0 0 1em 1em}#main-title{line-height:1em;font-size:x-large;margin-bottom:.31em}h1{line-height:1em;font-size:30px;margin-bottom:.31em}h2{margin-bottom:1px;font-size:22px}h3{font-size:15px;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .project-updated{font-size:6px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-width:100%}table{margin:30 auto 30 auto;padding:10px;text-align:left;border:1px solid #000;max-width:100%}td{padding:10px;text-align:left;font-size:15}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:50%;height:50px}figure{font-size:20}@media (max-width:1100px){.post{width:100%}table{width:100%}}.video-container{position:relative;width:100%;padding-bottom:56.25%}.video{position:absolute;top:0;left:0;width:100%;height:100%;border:0}.frame{height:300px;width:100%;white-space:nowrap;text-align:center;margin:1em 0}.helper{display:inline-block;height:100%;vertical-align:middle}.present_img{background:#3a6f9a;vertical-align:middle;max-height:300}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Version 0.4 of board; debugging 999 sensor behavior</title>
    <meta name="description" content="New, simplified sensor circuit; trying to fix the low-temp sensor behavior.">
    <meta property="og:title" content="Version 0.4 of board; debugging 999 sensor behavior" />
    <!--<meta property="og:url" content="https://www.example.com/webpage/" /> -->
    <meta property="og:description" content="New, simplified sensor circuit; trying to fix the low-temp sensor behavior." />
    <meta property="og:image" content="/img/placeholder.png" />
    <link rel="image_src" href="/img/placeholder.png"> 
  </head>
  <body>

    <div id='post-content'>

  <h3><a href="/">Edge Collective</a></h3>
    <h1>Version 0.4 of board; debugging 999 sensor behavior</h1>
    <i>New, simplified sensor circuit; trying to fix the low-temp sensor behavior.</i>
<hr>
        <!-- <h1>Version 0.4 of board; debugging 999 sensor behavior</h1> -->

  
  <h1>Mon Nov 18 12:10:48 PM EST 2024</h1>
<p>Update:  ver 0.4 board seems to work well ...</p>
<p>There are periodic errors on the depth sensor -- reading an 'error' -- when sending via satellite on battery (ie waking up periodically).  Haven't been able to reproduce when plugged in.  Going to try to insert a delay after starting up uart on depth sensor in case that's the issue.  In parallel might try to design version of board that has an extra linear regulator for 3V line in case insufficient current on startup is an issue.</p>
<h1>Mon Nov 18 06:40:46 PM EST 2024</h1>
<p>Testing new uart code.  Another source of 'error' might've been the code for reading from the uart -- I think the earlier version wouldn't immediately return the depth once a reasonable depth was reported</p>
<p>Q: if we do get any 999 values, i wonder if we can re-query?</p>
<h1>Tue Nov 19 12:17:18 PM EST 2024</h1>
<p>Looks like things are pretty solid ... using 'second_test.py' in sweet-p firmware version 4a</p>
<p><img src="/img/ojofeliz/regular_pings.png" alt=""></p>
<h1>Fri 20 Dec 2024 05:31:22 PM EST</h1>
<p>Recent experiment indicated that the problem is not with the battery, but with the sensor.</p>
<p>On a very cold morning, the system starting reading '999'.  When I swapped in a 'warm' battery, it still read '999'.</p>
<p>Seems that the sensor itself doesn't do well in the cold.</p>
<p>So, new plan:</p>
<ul>
<li>we'll always try to send whatever data we get, goofy or not, at 5 AM and 1 PM</li>
<li>if we ever get goofy data, afterwards we'll keep trying every 30 minutes to get 'good' data until we get a good reading we can send</li>
</ul>
<p>so, when sending ...</p>
<p>now we need to start recording the value of what was sent ...</p>
<p>if last reading was '999' or '-1', and the current value isn't either of those, then should send</p>
<p>okay -- attempting this with code ver 0.4.5</p>
<h1>Tue 24 Dec 2024 10:25:56 AM EST</h1>
<p><img src="/img/ojofeliz/gn_experiment_dec_24_2024_distance.png" alt=""></p>
<p><img src="/img/ojofeliz/gn_experiment_dec_24_2024_temperature.png" alt=""></p>
<p><img src="/img/ojofeliz/gn_experiment_dec_24_2024_battery_volts.png" alt=""></p>
<p>Explanation of figure above:</p>
<p>Code was implemented so that the system would, if receiving a '999' value from the sensor, look for the first 'good' sensor value and send it, whether or not a next value was schedule for sending.</p>
<p>Indeed, this approach seemed to work at temperatures at which the system failed; the code seemed to work.</p>
<p>However:  we see above that the sensor stopped sending good values at a certain point.  Why?</p>
<ul>
<li>It could be that the sensor is still 'frozen', and hasn't been able to warm up yet</li>
<li>It could be that the battery is too low</li>
<li>It could be that the battery is too cold</li>
<li>It could be that the microcontroller has entered some odd state, so that measuring the sensor on wakeup yields a bad value</li>
</ul>
<p>I also have noted recently that the sensor seems to be in a 'brownout' fast blinking purple neo pixel state when I open the enclosure</p>
<p>I have also noticed that that micro code seems to freeze / stop during a satellite send attempt, so that the micro never turns itself off</p>
<p>-- update:  actually, the timer chip was not 'on' in this case, so it seems that it wasn't a 'micro doesn't turn itself off' issue.</p>
<p>In the above data, I opened the enclosure, saw that the sensor was in a 'brownout' state.  I pressed the timer chip 'wakeup' button.  This booted up the system, and the first value to be sent was a good value.</p>
<p>It seems that 'brownout' despite the timer chip being off (its green led was off) is possible because the satellite modem retains power in the capacitor.  Is there a way to change this in the circuit, so that the micro stays fully off?</p>
<p>I think this rules out the sensor being an issue on its own.  It might be that if the micro starts up in an odd state, the initial sensor reading is a goofy one.</p>
<p>So: not sure why we brownout; it's probably not a terrible thing, in terms of battery; especially if it's getting its power from the satellite modem.</p>
<p>But it seems that this is impacting the initial sensor reading.</p>
<p>Maybe there's a way to 'reset' the sensor ... or at least read several times from it to attempt to get a non-999 value?</p>
<p>Next steps:  reread the sensor data sheet, see if there's some code setup that can read from the sensor to get a good value.</p>
<p>Maxbotix datasheet on triggering the sensor, here: <a href="https://maxbotix.com/pages/controlling-a-maxsonar-sensor">https://maxbotix.com/pages/controlling-a-maxsonar-sensor</a></p>
<p>Currently I may have the satellite modem 3V line connected -- which may be the way that the micro is getting 'back powered' ... need to check ... if it's not necessary, remove!</p>
<p><a href="https://docs.groundcontrol.com/iot/rockblock">rockblock knowledgebase</a></p>
<p>note: someone was able to solve their timer issue by adding a 100nF cap between DONE and GROUND -- see <a href="https://forums.adafruit.com/viewtopic.php?t=139674">here</a></p>
<p><a href="https://maxbotix.com/pages/xl-tanksensor-wr-datasheet">tank sensor datasheet</a></p>
<h1>Tue 24 Dec 2024 12:52:39 PM EST</h1>
<p>update:  ver 0.4.6 of the firmware implements a 'trigger' on the sensor using pin D12 ... testing now</p>


    </div>
  </body>
</html>

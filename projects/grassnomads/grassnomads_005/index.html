
<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:16px/1.5 sans-serif;font:16px;width:80%}.img-with-caption{font-size:15px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:justify;text-justify:inter-word}#post-content{max-width:800px}#post-title{margin-bottom:1px;background-color:#eee;border:1px solid #999;display:block;padding:8px;width:max-content;font-size:40px;margin-right:40px;margin-bottom:5px}#profile_pic{float:right;margin:0 0 1em 1em}#main-title{line-height:1em;font-size:x-large;margin-bottom:.31em}h1{line-height:1em;font-size:30px;margin-bottom:.31em}h2{margin-bottom:1px;font-size:22px}h3{font-size:15px;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .project-updated{font-size:6px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:15}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:50%;height:50px}figure{font-size:20}@media (max-width:1100px){.post{width:100%}table{width:100%}}.video-container{position:relative;width:100%;padding-bottom:56.25%}.video{position:absolute;top:0;left:0;width:100%;height:100%;border:0}.frame{height:300px;width:100%;white-space:nowrap;text-align:center;margin:1em 0}.helper{display:inline-block;height:100%;vertical-align:middle}.present_img{background:#3a6f9a;vertical-align:middle;max-height:300}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Stress testing the initial system</title>
    <meta name="description" content="Testing the satellite system over a period of a few days; collecting statistics on battery consumption (and learning which statistics to collect).">
    <meta property="og:title" content="Stress testing the initial system" />
    <!--<meta property="og:url" content="https://www.example.com/webpage/" /> -->
    <meta property="og:description" content="Testing the satellite system over a period of a few days; collecting statistics on battery consumption (and learning which statistics to collect)." />
    <meta property="og:image" content="/img/ojofeliz/twintowers.jpeg" />
    <link rel="image_src" href="/img/ojofeliz/twintowers.jpeg"> 
  </head>
  <body>

    <div id='post-content'>

  <h3><a href="/">Edge Collective</a></h3>
    <h1>Stress testing the initial system.</h1>
    <i>Testing the satellite system over a period of a few days; collecting statistics on battery consumption (and learning which statistics to collect)..</i>
<hr>
        <!-- <h1>Stress testing the initial system</h1> -->

  
  <h2>Base station notes</h2>
<p>Might want to add a TPL5111 to the 'EN' pin on the base station, to reset it every X hours</p>
<h2>Satellite modem</h2>
<p>NOTE: can't just 'plug in' the satellite modem to the sweet-p board as-is ...</p>
<h1>Tue Jun 27 03:55:52 PM EDT 2023</h1>
<p>Getting some sort of odd 'every-other' error when trying to talk to satellite modem ...</p>
<p>Going to try a simple experiment ...</p>
<p>1.83 = 53063/max_count*3.3</p>
<p>NOTE: seems as though D5's state is somehow correlated with the pins I'm using for satellite RX / TX (D11 / D12) ... so that when I try to access the satellite via those UART pins, D5 is sufficiently triggered that it ends up registering as a 'DONE' signal on the TPL5110.  I don't know if this is internal to the ESP32-S2 Feather, or part of my board circuitry.  But, I switched the 'DONE' pin to A3 (which also seems somewhat isolated on my board), and it now works.</p>
<h1>Tue Jun 27 09:52:46 PM EDT 2023</h1>
<p>Looks like the system is working!</p>
<p><a href="http://bayou.pvos.org/data/pb87ap97vgrr?plot_param=aux_3&amp;limit=175">http://bayou.pvos.org/data/pb87ap97vgrr?plot_param=aux_3&amp;limit=175</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/ojofeliz/sat_sleep_post_sat.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig A. Average sleep current after satellite use was approx 750 uA. With a longer time interval it likely would've decayed further.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/ojofeliz/sat_sleep_post_radio.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig B. Average sleep current after radio-only use was approx 200 uA.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/ojofeliz/sat_sleep_overnight_a.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig C.  First sequence beginning satellite messaging overnight -- message received as #185 -- only 1 attempt needed.</td>
</tr>
</tbody>
</table>
<h1>Thu Jun 29 12:45:04 PM EDT 2023</h1>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/ojofeliz/satellite_sendcount.png"><img src="/img/ojofeliz/satellite_sendcount.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig D.  Satellite sendcount over a period of roughly 24 hours.</td>
</tr>
</tbody>
</table>
<h1>Thu Jun 29 03:49:28 PM EDT 2023</h1>
<p>For some reason, A0 doesn't seem to like being an analog input (perhaps it's only useful as a DAC?)  So I'm now measuring the battery using A3, and using A0 to pull the DONE pin.  (Note: the analog pins seem to be un-(less?) affected by the strange 'digital correlations' in the digital GPIO pins which seemed to trigger an unwanted 'DONE' signal when D11 and D12 were used for satellite UART and D5 was used on DONE. Using A0 or A3 for DONE seems to avoid this problem.</p>
<p>Latest code is here: <a href="https://github.com/edgecollective/sweet-p/tree/bc4e251bbd9090e02c6a386bdda4b48e4447549b/firmware/board_ver_0.2/v7.0">https://github.com/edgecollective/sweet-p/tree/bc4e251bbd9090e02c6a386bdda4b48e4447549b/firmware/board_ver_0.2/v7.0</a></p>
<h1>Thu Jun 29 04:04:59 PM EDT 2023</h1>
<p><img src="/img/ojofeliz/sat_power_sequence.png" alt=""></p>
<p>Fig E. Power profile of 8 sequential satellite retries</p>
<p>Question: would it be better to simply wait until later to send the satellite message?</p>
<p>Perhaps let's try it outside first.</p>
<h1>Fri Jun 30 10:42:47 AM EDT 2023</h1>
<p><img src="/img/ojofeliz/sat_send_count.png" alt=""></p>
<p>Fig F.  Number of satellite transmission attempts required over time. Looks like it might indeed be useful to restrict the number of attempts to three or four, then retry the next session.  Will collect more statistics today and then see if we can improve the power consumption pattern.</p>
<p>Figure F. was generated via: <a href="http://bayou.pvos.org/data/pb87ap97vgrr?plot_param=aux_3&amp;limit=350">http://bayou.pvos.org/data/pb87ap97vgrr?plot_param=aux_3&amp;limit=350</a></p>
<p>&quot;sat_sender_measure_punt.py&quot; is the code for attempting to send via satellite, and 'punting' to next round if we've reached 'max_sat_send_tries' and haven't been able to send.</p>
<p>Code I'm testing out is here: <a href="https://github.com/edgecollective/sweet-p/tree/d2a499934004627b3723d4745dc70efc7eabc711/firmware/board_ver_0.2/v7.0">https://github.com/edgecollective/sweet-p/tree/d2a499934004627b3723d4745dc70efc7eabc711/firmware/board_ver_0.2/v7.0</a></p>
<p>Going to see if I can collect some statistics on average current consumption for various modes of satellite transmission / sleep.</p>
<p>e.g.:</p>
<p><img src="/img/ojofeliz/sat_current_experiment_a.png" alt=""></p>
<p>Fig G.  Average system current when attempting to send seven times. Total duration was about 4 minutes, at an average current of 120 mA.</p>
<p>We can use the data from this experiment to estimate the average current over a 24 hour period for various patterns of satellite transmission.  Can take indoor transmission as likely worst case.  Need also to find a way to estimate recharge rate of solar panel -- perhaps can use current monitor.</p>
<p><img src="/img/ojofeliz/sat_current_experiment_b.png" alt=""></p>
<p>Fig H.  Ave system current of 125 mA, session of 3.5 minutes, took 6 tries.</p>
<p><img src="/img/ojofeliz/lora_wakeup.png" alt=""></p>
<p>Fig I.  Ave system current of 41 mA, session of 12 seconds, to do lora wakeup and shutdown.</p>
<p><img src="/img/ojofeliz/sat_long_attempt.png" alt=""></p>
<p>Fig J.  Approx 10 satellite send attempts; ave system current of 143 mA; 6 minutes duration.</p>
<h1>Tue Jul  4 10:59:49 PM EDT 2023</h1>
<p><img src="/img/ojofeliz/battery_behavior_fourth.png" alt=""></p>
<p>Fig K. Battery behavior over the fourth of july</p>
<p><img src="/img/ojofeliz/sat_send_stats_fourth.png" alt=""></p>
<p>Fig L.  Satellite send tries over the same period as in Fig K.</p>
<h1>Wed Jul  5 12:59:37 PM EDT 2023</h1>
<p><img src="/img/ojofeliz/aux_3_fifth.png" alt=""></p>
<p>Fig M.  Send stats for July 5th</p>
<p><img src="/img/ojofeliz/battery_fifth.png" alt=""></p>
<p>Fig N.  Battery stats for July 5th</p>
<p>Can see correlation in sending attempts and battery drain.</p>
<p>Can also see that if simply wait another 8 or 16 minutes, satellite conditions are much more favorable.</p>
<p>Conclusion:  if you can't get it in 2 or 3 tries, maybe wait at least 30 minutes ...</p>
<p>... and that might be what we do anyway if we start transmitting at lower frequencies ...</p>
<h1>Sat Jul  8 09:34:45 PM EDT 2023</h1>
<p>I've been sending every 10 'send index counts'.  Below, I've switched between an algorithm where my max sat send attempt count was 3, and then I would reattempt, to one where, if I hit that max count, I decremented the 'send index' by 3. The idea was that the system would wait another three sleep intervals before trying to send again, and that then perhaps the satellite network conditions would be more favorable.</p>
<p>My impression is that it's not yet working very well -- if I've implemented it properly, it seems that a count of '3' is usually too small to send.  I might return to allowing a count of 10.<br>
<img src="/img/ojofeliz/two_sat_algorithms.png" alt=""></p>
<p>Fig O.</p>
<p><img src="/img/ojofeliz/two_sat_algorithms_stats.png" alt=""></p>
<p>Fig P.</p>
<p><img src="/img/ojofeliz/two_sat_algorithms_batt.png" alt=""></p>
<p>Fig Q.</p>


    </div>
  </body>
</html>



<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:60%;text-align:left}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>
        <h1>Vale da Lama Greenhouse Monitoring</h1>

  
  <h2>TODO</h2>
<ul>
<li>Make a mill-able PCB design in Eagle CAD for Lucio to mill [X]</li>
<li>Make a manfuacture-able PCB design in KiCAD to send to that company in Germany</li>
<li>Review: contact of company in Germany</li>
<li>test timer chip with Heltec ESP32</li>
<li>figure out how to load code remotely to Feather and to ESP32 via Pi</li>
<li>set up data repository online</li>
<li>display sensor data on a map</li>
</ul>
<p>Need designs for:</p>
<ul>
<li>the remote node (Feather + sensors)</li>
<li>the gateway node (Heltec ESP32 + LoRa + timer chip + BME280)</li>
</ul>
<h2>Overview</h2>
<p><a href="#version_4_assembly">Assembly Guide for Version 4</a>.</p>
<p><a href="https://youtu.be/LljqFv8GzxA">Video explanation</a> of the current status as of Oct 07 2020  ..</p>
<h2>AM2315 and 'new' i2c on Feather M0</h2>
<p>Issue: we designed a <a href="https://github.com/edgecollective/valedalama-greenhouse-remote">breakout board</a> (in Eagle CAD) to be milled in Portugal by <a href="">Lucio</a>; but the original intent was for a different, non-i2c sensor; the one we're using now is an i2c sensor (the <a href="https://www.adafruit.com/product/1293">AM2315</a>, and requires:</p>
<ul>
<li>10K pullups on both signal lines</li>
<li>that the signal lines be used as i2c lines, which isn't standard for the Feather M0 firmware.</li>
</ul>
<h2>References</h2>
<h3>I2C</h3>
<ul>
<li>
<p><a href="https://learn.adafruit.com/using-atsamd21-sercom-to-add-more-spi-i2c-serial-ports/creating-a-new-wire">Creating a new I2c interface on the M0 -- Adafruit</a></p>
</li>
<li>
<p><a href="https://learn.sparkfun.com/tutorials/adding-more-sercom-ports-for-samd-boards/all">Creating a new I2C interface on the M0 -- Sparkfun</a></p>
</li>
</ul>
<p>Ah -- update -- can't reassign the pins because of the 'pad constraint', see the section <a href="https://learn.adafruit.com/using-atsamd21-sercom-to-add-more-spi-i2c-serial-ports/creating-a-new-wire#ok-so-lets-make-a-new-i2c-sercom-already-1603458-14">here</a>.</p>
<h3>AM2315</h3>
<ul>
<li><a href="https://github.com/adafruit/Adafruit_AM2315">Adafruit AM2315 library</a>.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/feather_m0_lora.jpg"> <img src="/img/valedalama/feather_m0_lora.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Adafruit Feather M0 LoRa (for pin reference).</td>
</tr>
</tbody>
</table>
<h2>FAB Farm</h2>
<p><a href="https://www.google.com/maps?q=37.160365,-8.774516&amp;shorturl=1">Location</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/fabfarm.png"> <img src="/img/valedalama/fabfarm.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Lucio's FAB Farm.</td>
</tr>
</tbody>
</table>
<h2>Feather BME280 data export from server</h2>
<p>One can grab CSV data from the Valedalama server like thus:</p>
<blockquote>
<p><code>http://64.227.0.108:8100/api/csv?limit=1000</code></p>
</blockquote>
<p>where the 'limit=N' parameter gives the 'most recent N values'.</p>
<p>A snapshot of all of the historical data from &quot;Valedalama BME280 Feather&quot; from the earliest collection date (July 10 2020) up through Oct 10 2020 can be downloaded <a href="/data/historical_bme280_as_of_10_oct_2020.csv">here</a>.</p>
<h2>Board Designs</h2>
<h3>Remote</h3>
<h4>Remote Version 4: Eagle CAD</h4>
<p>Design files are <a href="https://github.com/edgecollective/valedalama-greenhouse-remote">here</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_schematic.png"> <img src="/img/valedalama/remote_v4_schematic.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote schematic, version 4.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_board.png"> <img src="/img/valedalama/remote_v4_board.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 4.</td>
</tr>
</tbody>
</table>
<h4>Remote Version 5 in KiCAD:</h4>
<p>Repo is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/remote/v5">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/3d_render.png"> <img src="/img/valedalama/3d_render.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 5.</td>
</tr>
</tbody>
</table>
<hr>
<h3><a name="version_4_assembly"></a>Assembly Guide for Remote Node Version 4</h3>
<p>(Update OCT 30 2020)</p>
<p>Lucio has milled both Version 3 and Version 4 of the remote node.  Current focus is on assembly of Version 4 (design files <a href="https://github.com/edgecollective/valedalama-greenhouse-remote/blob/master/pcb/ver4/remote_v4_board.png">here</a>.</p>
<p>For reference, Version 4 board design looks like this:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_board.png"> <img src="/img/valedalama/remote_v4_board.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 4.</td>
</tr>
</tbody>
</table>
<p>It is a 'mother board' for a Feather M0 LoRa microcontroller.</p>
<p>The remote board version 4 requires:</p>
<ul>
<li>A 1x12 and a 1x16 0.1&quot; / 2.54mm female header, to hold the Feather in place.</li>
<li>Note: the Feather also requires 1x12 and 1x16 2.54mm male headers soldered to it, as well as an antenna (a straight wire, or a helical one). I think this is already done.</li>
<li>A 4-position 5mm spacing screw terminal (typically, a pair of 2-position screw terminals)</li>
<li>A 3-position 5mm screw terminal</li>
<li>A 2-position 5mm screw terminal</li>
<li>3 resistors (all of them 10K, or all of them 4.7K).</li>
</ul>
<p>It is obvious from the footprints on the board which of the above go where :)</p>
<p>Note: the ESP32 device only requires that the accompanying antenna that came with the baord be plugged into it (it's a bit fiddly, but no soldering required).</p>
<hr>
<p>2020 Nov 10</p>
<p><img src="/img/valedalama/v5_success.png" alt=""></p>
<p>The associated <a href="">version 5 kicad pcb file</a> is easy to upload to <a href="aisler.net">Aisler</a> (German PCB producer) -- about $25 euros for 3 PCBs, 3-5 day turnaround:</p>
<p><img src="/img/valedalama/aisler_v5.png" alt=""></p>
<hr>
<p>2020 Nov 11</p>
<p>Lucio's setup, with his milled board:</p>
<p><img src="/img/valedalama/lucio_setup.jpeg" alt=""></p>
<p>Sensor working with the feather:</p>
<p><img src="/img/valedalama/feather_working.jpeg" alt=""></p>
<p>Data flowing through to Bayou:</p>
<p><img src="/img/valedalama/bayou_data.png" alt=""></p>
<hr>
<p>2020 Nov 14</p>
<p>Next steps:</p>
<ul>
<li>Modify Bayou to allow for inputing date ranges</li>
<li>Figure out reflashing of boards from command line via Pi</li>
<li>Figure out setting wifi credentials (and OTA firmware) on ESP via bluetooth</li>
<li>NRF52 bluetooth OTA firmware update in Arduino possible? If so maybe switch to NRF52 feather</li>
<li>List the remote board and the esp32 gateway combo -- make a breakout board for the Heltec</li>
</ul>
<p>Can offer ...</p>
<p>Remote:</p>
<ul>
<li>Mothbot</li>
<li>Feather motherboard (add power input 12V or higher)</li>
</ul>
<p>Gateway</p>
<ul>
<li>Heltec</li>
<li>Heltec + motherboard (with timer chip)</li>
<li>Quahog (advantage of power input 12V or higher)</li>
</ul>
<p>Database:</p>
<ul>
<li>FarmOS</li>
<li>Bayou</li>
</ul>
<p>So -- all off-the-shelf, o r fully custom.
Along with guides for all of this.</p>
<h3>OTA for the remote node?</h3>
<p>NRF52 OTA programming link (weather buoy project) <a href="https://opensourceoceanweatherbuoy.wordpress.com/2018/03/11/nrf52-program-sketches-over-the-air/">here</a></p>
<h3>Features to add in REV_C</h3>
<ul>
<li>Heltec wifi connection debug on display</li>
<li>Easy way to set up wifi &amp; bayou on Heltec -- via bluetooth, or via 'router setup' / wifi</li>
<li>Remote node should send status message whether or not the sensors worked</li>
</ul>
<h3>TODO</h3>
<ul>
<li>Change Feather send frequency to every 10 minutes</li>
<li>Change the radio frequency to 868 to match Walt's order</li>
</ul>
<hr>
<p>2020 Nov 17</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/temp_valedalama.png"> <img src="/img/valedalama/temp_valedalama.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Data coming in from first deploymend of milled board version of the remote node.</td>
</tr>
</tbody>
</table>
<p>bayou_longer.png</p>
<h3>Server</h3>
<p>Pagination strategies with pouchdb -- useful for setting up the server, <a href="https://pouchdb.com/2014/04/14/pagination-strategies-with-pouchdb.html">here</a></p>
<h3>Humidity sensor issue?</h3>
<p>Looks like the Humidity tends to get pegged ...</p>
<p><img src="/img/valedalama/humidity_issue.png" alt=""></p>
<h3>Date Conversion formula in Excel</h3>
<p>Example is [here[(https://docs.google.com/spreadsheets/d/1yDYKKenBeMRpYumavZ4Df_dnJOKyFEXB-Inp_YYGFdY/edit?usp=sharing).</p>


    </div>
  </body>
</html>

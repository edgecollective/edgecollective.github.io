

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:60%;text-align:left}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>
        <h1>Inexpensive Heltec WiFi + LoRa Gateway Setup</h1>

  
  <h2>Arduino IDE Setup</h2>
<p>Board Manager URL for ESP32:</p>
<p><code>https://dl.espressif.com/dl/package_esp32_index.json</code></p>
<p>Board Manager URL for Feather M0 LoRa:</p>
<p><code>https://adafruit.github.io/arduino-board-index/package_adafruit_index.json</code></p>
<h2>Guides</h2>
<p><a href="https://robotzero.one/heltec-wifi-kit-32/">Robotzero</a></p>
<p>Basically need to just load this config file in 'Additional Board Manager URLs' field in Preferences in Arduino IDE:</p>
<p><code>https://dl.espressif.com/dl/package_esp32_index.json</code></p>
<p>Then can select Heltec WiFi Lora (V2) (the board we're using).</p>
<p>WiFi scan worked.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/heltec/wifi_scan.png"> <img src="/img/heltec/wifi_scan.png" alt="wifi scan"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Initial wifi scan test.</td>
</tr>
</tbody>
</table>
<h2>Display Library</h2>
<p><a href="https://github.com/olikraus/u8g2">U8g2 library</a> for Arduino covers a wide range of common displays.</p>
<p><a href="https://gist.github.com/dwblair/d74bb01fbd3514ffd6b5eb5d9b66ab88">Test code</a> that will scan wifi and display the results on the screen.</p>
<h2>Main Heltec Documentation</h2>
<p><a href="https://heltec.org/project/wifi-lora-32/">Heltec Wifi Lora 32</a></p>
<h2>Coding and Setup Debugging ...</h2>
<p><a href="https://www.instructables.com/id/Introduction-to-ESP32-WiFi-LoRa/">Instructable</a> that has a nice set of diagrams of pinouts</p>
<p><a href="https://github.com/HelTecAutomation/Heltec_ESP32">Heltec Library</a></p>
<p><a href="https://github.com/Heltec-Aaron-Lee/WiFi_Kit_series">Main github reference for Heltec devices -- includes KiCad file for device</a></p>
<p><a href="http://community.heltec.cn/t/heltec-wifi-lora-32-v2-send-receive/160">Heltec WiFi LoRa send / receive</a></p>
<p><a href="http://community.heltec.cn/t/ping-pong-test-between-cubecell-dev-board-and-wifi-lora-32-v2/508/7">Heltec syncword issue</a></p>
<p><a href="https://robotzero.one/heltec-wifi-lora-32/">Robot Zero One LoRa receiver demo</a></p>
<p>They suggest using <a href="https://github.com/sandeepmistry/arduino-LoRa">this LoRa library</a>.</p>
<h2>Working LoRa Example</h2>
<p>Follow <a href="https://robotzero.one/heltec-wifi-lora-32/">Robot Zero One LoRa receiver demo</a>;</p>
<p>use <a href="https://github.com/sandeepmistry/arduino-LoRa">this LoRa library</a>;</p>
<p>And <a href="https://gist.github.com/dwblair/cfe9bfb895d4ad72d88ed91fb76ded47">this example</a>.</p>
<p><strong>Receive and display</strong>. Can get it posted on the display using <a href="https://gist.github.com/dwblair/9da853fb274c184f89f3f14123b9e032">this example</a> with <a href="https://github.com/olikraus/u8g2">U8g2 display library</a> -- basically works.</p>
<h2>Radiohead Example</h2>
<p><a href="https://gist.github.com/dwblair/e6626567ff14cec6e29db35b8eb985ed">Basic RFM95 Receive</a> code for Heltec.  Works.</p>
<h2>Low Power sleep</h2>
<p><a href="https://github.com/Heltec-Aaron-Lee/WiFi_Kit_series/issues/6">Discussion of entering low power sleep mode</a></p>
<h2>HTTP GET AND POST</h2>
<p>Tutorial <a href="https://randomnerdtutorials.com/esp32-http-get-post-arduino/">here</a>.</p>
<p>Working code to do basic JSON post to FarmOS <a href="https://gist.github.com/dwblair/c1411750491ef2120d01ca661dbcd747">here</a>.</p>
<p>ArduinoJSON SerializeJSON <a href="https://arduinojson.org/v6/api/json/serializejson/">documentation</a>.</p>
<h2>HTTP JSON POST TO FARMOS</h2>
<p>Using loop-updated variables, code is <a href="https://gist.github.com/dwblair/731c806170a11bfc536c32d126559495">here</a>.</p>
<h2>HELTEC WIFI LORA POST TO FARMOS</h2>
<p>Using dummy variables, not yet parsing incoming radio, code is <a href="https://gist.github.com/dwblair/895fdbe3cbb5f5f1c43025230a8a5f10">here</a></p>
<h2>Github Repo</h2>
<p>Feather sends JSON data; Heltec receives, parses, posts to FarmOS; code is <a href="https://github.com/edgecollective/heltec-32-lora-v2-farmos/tree/master/ver1">here</a>.</p>
<h2>1-wire temp sensor on remote</h2>
<p><a href="https://lastminuteengineers.com/ds18b20-arduino-tutorial/">Tutorial</a></p>
<h2>Sleep Modes for ESP32</h2>
<p>Some nice notes <a href="https://lastminuteengineers.com/esp32-sleep-modes-power-consumption/#:~:text=ESP32%20Sleep%20mode%20is%20a,it%20to%20retain%20its%20data.">here</a></p>
<p>Deep sleep <a href="https://lastminuteengineers.com/esp32-deep-sleep-wakeup-sources/">example code</a></p>
<p>Able to get about 2 mA in deep sleep using Heltec. ...</p>
<p>.. then turned off lora radio and got 1 mA.</p>
<p>gist of the code to do this is <a href="https://gist.github.com/dwblair/5bd69024c8536780fa1e3bf835f1d8fb">here</a></p>
<p>Further discussion of low power modes <a href="https://www.reddit.com/r/esp32/comments/gx8fxk/hibernatepower_off/">here</a>.</p>
<h2>ESP32 Data logging</h2>
<p><a href="https://randomnerdtutorials.com/esp32-data-logging-temperature-to-microsd-card/">Nice tutorial here</a></p>
<h2>Single-channel gateway guides</h2>
<p><a href="https://github.com/things4u/ESP-1ch-Gateway">Using ESP8266</a></p>
<p><a href="https://learn.sparkfun.com/tutorials/esp32-lora-1-ch-gateway-lorawan-and-the-things-network/all">From Sparkfun</a></p>
<p><a href="https://appcodelabs.com/introduction-to-iot-building-a-budget-single-channel-lora-gateway">Appcodelabs using MQTT</a></p>
<p><a href="https://www.cnx-software.com/2018/08/21/how-to-make-cheap-single-channel-gateway-lora-esp32-board/">From CNX Software</a> -- looks like they use dozens of nodes here.</p>
<h3>Heltec Deep Sleep</h3>
<p>Thread <a href="http://community.heltec.cn/t/wifi-lora-32-v2-deep-sleep-low-power-test/101">here</a>.</p>
<h3>Heltec OTA updates</h3>
<p>Lastminuteengineer description using Arduino IDE is <a href="https://lastminuteengineers.com/esp32-ota-updates-arduino-ide/">here</a>.</p>
<p>Using the web, <a href="https://lastminuteengineers.com/esp32-ota-web-updater-arduino-ide/">here</a>.</p>
<p>Espressif github example of web-based OTA <a href="https://github.com/espressif/esp-idf/tree/master/examples/system/ota">here</a>.</p>
<p>Modified example worked nicely, code is <a href="https://github.com/edgecollective/heltec-ota">here</a></p>
<p>Login page:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/heltec/heltec_login.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Initial login page to ESP32.</td>
</tr>
</tbody>
</table>
<p>And it works!</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/heltec/ota_progress.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Progress after uploading.</td>
</tr>
</tbody>
</table>


    </div>
  </body>
</html>



<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:60%;text-align:left}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>
        <h1>Greenhouse Monitoring, &#39;Full Stack&#39;</h1>

  
  <p>(((Status: DRAFT)))</p>
<hr>
<h2>Overview</h2>
<p>Here we're going to be describing how to set up a basic 'Greenhouse Monitoring' system, which consists of three main parts:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/greenhouse_stack.png"> <img src="/img/valedalama/greenhouse_stack.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Overview of the flow of data in this system.</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Remote Node</strong> -- consisting of a microcontroller + sensor, that captures a signal (e.g. temperature) and relays this data via low-power radio to a wifi gateway</li>
<li><strong>Gateway</strong> -- which relays this incoming sensor data to a server</li>
<li><strong>Server</strong> -- a server which receives data from the gateway and stores it in a database.</li>
</ul>
<h2>Materials / software used in this example</h2>
<ul>
<li><strong>Remote Node</strong>: A <a href="https://www.adafruit.com/product/3178">Feather M0 LoRa</a>, an <a href="https://www.adafruit.com/product/1293">AM2315 Temp + Humidity sensor</a>, and a <a href="https://oshpark.com/shared_projects/vQ5JTv0Z">PVOS 'Lama' Board Ver 5</a>.</li>
<li><strong>Gateway</strong>: A <a href="https://heltec.org/project/wifi-lora-32/">'Heltec Wifi-LoRa 32 v2'</a>.</li>
<li><strong>Server</strong>: the Bayou cooperative sensor data platform.</li>
</ul>
<hr>
<h2>Table of Contents</h2>
<ol>
<li><a href="#server">Setting up the <strong>Server</strong></a></li>
<li><a href="#micro">Setting up the <strong>Remote Node</strong></a></li>
<li><a href="#gateway">Setting up the <strong>Gateway</strong></a></li>
</ol>
<hr>
<h2><a name="micro"></a> 1. Server setup</h2>
<p><img src="/img/valedalama/stack_server.png" alt="figA2"></p>
<p>We will be covering two different server options:</p>
<ul>
<li><strong>FarmOS</strong> (an open source farm data management system); and</li>
<li><strong>Bayou</strong> (an open source sensor data cooperative).</li>
</ul>
<h3>FarmOS</h3>
<p>You can watch a short video (~ 3 min) on setting up a FarmOS sensor feed <a href="https://youtu.be/arGErKKODrU">here</a>.</p>
<p>The process will generate a public key + private key pair, and indicate a URL to which you can post sensor data via JSON (See &quot;Sensor Configuration&quot;: &quot;Developer Information&quot;).  The URL format looks like this:</p>
<pre><code>https://edgecollective.farmos.net/farm/sensor/listener/[public key]?private_key=[private key]
</code></pre>
<p>For example, a typical URL with the keys actually inserted looks like this:</p>
<pre><code>https://edgecollective.farmos.net/farm/sensor/listener/0ce692a8fd8474137839535dd7997a28?private_key=ba0c7dbfd4321b3abaa7851457dc12ef
</code></pre>
<p>Find this URL (with the keys inserted) for your sensor feed, and take note of it (keep the relevant FarmOS browser tab open, or copy-paste this URL into a text file.) It will be used in the  <a href="#gateway">Gateway Setup</a> section below.</p>
<h3>Bayou</h3>
<p>You can watch a short video on setting up a <a href="http://159.65.226.222:3000/">Bayou</a> sensor feed <a href="https://youtu.be/EKZA-AtDYO0">here</a>.</p>
<p>The basic steps are:</p>
<ul>
<li>visit <a href="http://159.65.226.222:3000/">Bayou</a> (you can get a login via word-of-mouth), and fill in the forms for 'Create a data feed'.</li>
</ul>
<p>This will generate a <strong>public key</strong> and a <strong>private key</strong>.</p>
<ul>
<li>take note of these; you will use them in your gateway configuration file in the <a href="#gateway">Gateway Setup</a> step below.</li>
</ul>
<hr>
<h2><a name="micro"></a> 2. Remote Node setup</h2>
<p><img src="/img/valedalama/stack_node.png" alt="figA2"></p>
<p>In our example setup for this guide, the Remote node consists of:</p>
<ul>
<li><strong>Sensor</strong>: an AM2315 Temperature and Humidity Sensor</li>
<li><strong>Microcontroller</strong>: a Feather M0 LoRa</li>
<li><strong>Additional Hardware</strong>: a PVOS Greenhouse Motherboard Version 4</li>
</ul>
<h3>Wiring things up</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/am2315.jpg"> <img src="/img/valedalama/am2315.jpg" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AM2315 temp and humidity sensor, as <a href="https://www.adafruit.com/product/1293">listed on Adafruit</a>.</td>
</tr>
</tbody>
</table>
<p>The <a href="https://www.adafruit.com/product/1293">AM2315</a> is an i2c sensor -- which means that it has the following wires:</p>
<ul>
<li>VCC / 3.3V  (Red)</li>
<li>GND (Black)</li>
<li>SCL (White)</li>
<li>SDA (Yellow)</li>
</ul>
<p>These wires should connect to the relevant screw terminal inputs on the &quot;Version 4 Motherboard&quot;, as depicted here:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_board.png"> <img src="/img/valedalama/remote_v4_board.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 4.</td>
</tr>
</tbody>
</table>
<p>The Feather M0 LoRa should be plugged into the relevant headers on the mothboard, as well.</p>
<p>Note that all resistors (4.7K or 10K) should also be soldered to the board.</p>
<h3>Sensor Test</h3>
<p>[feather + am2315 TODO]</p>
<h3>Radio Setup</h3>
<p>[feather + am2315 + lora radio]</p>
<hr>
<h2>3. Gateway setup</h2>
<p><img src="/img/valedalama/stack_gateway.png" alt="figA2"></p>
<p>You can purchase a Heltec Wifi-Lora 32 v2 <a href="https://www.amazon.com/MakerFocus-Development-Bluetooth-0-96inch-Display/dp/B076MSLFC9/ref=asc_df_B076MSLFC9/?tag=hyprod-20&amp;linkCode=df0&amp;hvadid=312824707815&amp;hvpos=&amp;hvnetw=g&amp;hvrand=4477519221563307865&amp;hvpone=&amp;hvptwo=&amp;hvqmt=&amp;hvdev=c&amp;hvdvcmdl=&amp;hvlocint=&amp;hvlocphy=9002000&amp;hvtargid=pla-570414542843&amp;psc=1">here</a>.</p>
<p>Sample code for esp32-lora gateway is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/gateway/heltec_wifi_lora_bayou_farmos">here</a></p>
<p>Example of data posted <a href="http://159.65.226.222:3000/drives/1a142aee9702045f3049325318f14fab10d24ce3e0c8a387d092759c0594ba5e">here</a></p>


    </div>
  </body>
</html>

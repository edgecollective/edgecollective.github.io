

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:80%;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>
        <h1>P2P / DIY Server</h1>

  
  <p>Repo is <a href="https://gitlab.com/dwblair/p2p-farm-server">here</a>.</p>
<p>A useful associted 'PUT' script is <a href="https://gist.github.com/dwblair/4cfbcc993fafcd4d984058ae730ee342">here</a></p>
<h2>ESP32 --&gt; Server</h2>
<p>Adding headers to esp32 explanation <a href="https://techtutorialsx.com/2018/01/03/esp32-arduino-basic-authentication/">here</a></p>
<p>Making a PUT request <a href="https://techtutorialsx.com/2019/01/07/esp32-arduino-http-put-request/">here</a>.</p>
<p>Using ArduinoJSON with HTTPClient <a href="https://arduinojson.org/v6/how-to/use-arduinojson-with-httpclient/">here</a>.</p>
<p>Creating nested json objects in ArduinoJSON <a href="https://arduinojson.org/v5/faq/how-to-create-complex-nested-objects/">here</a>.</p>
<h2>Work Log</h2>
<hr>
<p>21 OCT 2020</p>
<p>Fixed sqlite3 missing module.</p>
<p>Got an ESP32 to post data via JSON, <a href="https://github.com/edgecollective/esp32-p2p-farm/tree/main/test_put_json">here</a>.</p>
<hr>
<p>23 OCT 2020</p>
<p>Trying to use <a href="https://github.com/fastify/fastify-basic-auth">this fastify basic auth module</a> as part of the codebase.</p>
<p>... implemented!</p>
<hr>
<p>24 OCT 2020</p>
<p>Some next steps:</p>
<ul>
<li>Make a video explanation of the idea.</li>
<li>Work out the storage math, and the economics of storage space.</li>
<li>This might provide a motivation for using the hyper protocol!</li>
<li>Put demo code on the site for using Python, and ESP32, CircuitPy, curl to upload data.</li>
<li>Put it at EC subdomain, or something separate.</li>
<li>Add CSV export</li>
<li>Add JSON export (already there mostly)</li>
<li>Add simple graphing</li>
<li>Add simple metrics (size of file, timespan of datafile, num datapoints)</li>
<li>Add human-readable timestamp (at least e.g. in CSV export)</li>
</ul>
<hr>
<p>25 OCT 2020</p>
<p>Making a python PUT script.</p>
<p>Reference on python requests <a href="https://requests.readthedocs.io/en/master/user/authentication/">here</a>.</p>
<p>Setting the authorization header in curl <a href="https://stackoverflow.com/questions/3044315/how-to-set-the-authorization-header-using-curl">here</a>.</p>
<p>Issue: when using basic auth in current basicAuth branch, it is putting the username password authentication method on top of <em>every</em> request -- need to do it just for the home page.</p>
<p>Guide to using basic auth <a href="https://github.com/fastify/fastify-basic-auth">here</a>.</p>
<p>Combining fastify static with fastify basic auth <a href="https://github.com/fastify/help/issues/190">here</a>.</p>
<p>Using multiple authentication options with fastify <a href="https://github.com/fastify/fastify-auth#usage">here</a></p>
<p>addhook onresponse by route <a href="https://github.com/fastify/fastify/issues/1828">here</a></p>
<p>fastify and mongodb <a href="https://www.fastify.io/docs/v3.4.x/Getting-Started/">here</a></p>
<p>Might just need to find a way to serve up web page from directly in fastify, using basicAuthFix branch</p>
<p>Nice <a href="https://www.fastify.io/docs/v3.4.x/Getting-Started/">getting started with fastify</a> document.</p>
<p>Currently the action is in 'main.js' ...</p>
<p>Looks like there is a way to addHook to specific routes <a href="https://github.com/fastify/fastify/blob/master/docs/Hooks.md#onroute">here</a></p>
<p>latest idea:  keep basicAuth branch as-is, but use multiple authentication methods in 'PUT' script</p>
<p>'ctrl shift i' will insert timestamp in VS Code given installation of an extension <a href="https://stackoverflow.com/questions/38780057/how-to-insert-current-date-time-in-vscode#:~:text=To%20insert%20current%20date%20and,Insert%20DateTime%20then%20press%20Enter%20.&amp;text=By%20default%20you%20don't%20have%20to%20set%20anything.">here</a></p>
<p>Adding multiple authorization headers via postman <a href="https://stackoverflow.com/questions/29282578/multiple-http-authorization-headers">here</a></p>
<p>Combining multiple authorizations via curl <a href="https://stackoverflow.com/questions/22229996/basic-http-and-bearer-token-authentication">here</a></p>
<p>Setting multiple headers in curl -- useful! -- <a href="https://www.shellhacks.com/curl-add-header-multiple-headers-authorization/">here</a></p>
<p>issues:</p>
<ol>
<li>can't use multiple authorization schemes, in particular not if one of them is Basic Auth</li>
<li>not sure how to combine basic auth with fastify-static</li>
</ol>
<p>interesting angle mentioned in <a href="https://stackoverflow.com/questions/64201513/transform-response-of-fastify-static-served-files">&quot;Transform response of fastify-static served files&quot;</a>, which led to fastify <a href="https://github.com/fastify/point-of-view">point-of-view templates idea</a>.</p>
<p>Ah -- I think I've got it working with the basicAuth branch, now!</p>
<hr>
<p>2020-11-29 08:51:40</p>
<p>Adding authentication to NodeJS, <a href="https://www.youtube.com/watch?v=Ud5xKCYQTjM">here</a></p>
<p>Using Auth0 and Fastify <a href="https://medium.com/better-programming/how-to-add-authentication-to-your-fastify-rest-api-using-auth0-cddc7eacc90">here</a> -- ah, blocked --</p>
<p>But there's a repo, <a href="https://github.com/nearform/fastify-auth0-verify">here</a>.</p>
<hr>
<p>2020-11-29 16:43:16</p>
<p><a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">Jupyter dashboard</a> via voila -- <a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">gallery of examples</a></p>
<p>gesis notebooks, <a href="https://notebooks.gesis.org/">here</a></p>
<p>guide to voila, <a href="https://analyticsindiamag.com/complete-guide-to-voila-to-turn-a-jupyter-notebook-into-a-standalone-web-application/">here</a></p>
<p>Dashboarding options in Jupyter discussed <a href="https://medium.com/informatics-lab/jupyter-dashboarding-some-thoughts-on-voila-panel-and-dash-b84df9c9482f">here</a></p>
<p>User authentication with nodejs and passport <a href="https://www.freecodecamp.org/news/learn-how-to-handle-authentication-with-node-using-passport-js-4a56ed18e81e/">here</a></p>
<p>Rolling your own authentication, <a href="https://developer.okta.com/blog/2019/10/03/painless-node-authentication">here</a>.</p>
<p>React and Auth0 ...</p>
<ul>
<li><a href="https://www.smashingmagazine.com/2020/11/authenticating-react-apps-auth0/">Third party guide here</a>
and</li>
<li><a href="https://auth0.com/blog/complete-guide-to-react-user-authentication/">Auth0 guide here</a></li>
</ul>
<hr>
<p>2020-12-05 14:21:37</p>
<h2>Node + Express + Postgresql</h2>
<p><a href="https://blog.logrocket.com/getting-started-with-postgres-in-your-react-app/">react + node + express + postgresql</a> -- short tutorial</p>
<p><a href="https://bezkoder.com/react-node-express-postgresql/">react + node + express + postgresql</a> -- thorough tutorial</p>
<p><a href="https://expressjs.com/en/guide/database-integration.html#postgresql">express + postgresql</a> -- from node guide</p>
<p><a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">Creating a web application in your home with a Raspberry Pi, Express and PostgreSQL</a> -- this looks like a great place to begin!</p>
<p><a href="https://medium.com/@timtamimi/getting-started-with-authentication-in-node-js-with-passport-and-postgresql-2219664b568c">Getting started with authentication in Node.js with Passport and PostgresQL</a></p>
<p><a href="https://sequelize.org/">Sequelize</a> -- JSON that creates a database table</p>
<p><a href="https://stackoverflow.com/questions/43436755/best-way-to-save-data-that-keeps-coming-every-1-second-to-postgres-using-node-js">suggestion to use multi-row inserts to save time</a></p>
<p><a href="https://mherman.org/blog/designing-a-restful-api-with-node-and-postgres/">designing a restful api with node and postgres</a></p>
<p><a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">ahhh -- part of a great series that seems to do all the things!  including graphing!</a> -- the series is <a href="https://rike.dev/2019/02/11/smart-home-setup-to-track-indoor-temperatures-and-humidity-with-sensors-raspberry-pi-mqtt-node-js-vue-js-and-chart-js">here</a></p>
<p><a href="https://www.mathworks.com/help/thingspeak/choose-between-rest-and-mqtt.html#:~:text=REST%20is%20a%20representational%20state,can%20be%20secured%20with%20SSL.">using mqtt vs REST</a></p>
<hr>
<p>2020-12-05 20:47:42</p>
<p>following tutorial <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a>, putting in Documents/able</p>
<blockquote>
<p>sudo apt-get install postgresql</p>
</blockquote>
<p>psuser
psps</p>
<blockquote>
<p>sensor2=# INSERT INTO users (username, password) VALUES ('user1', 'bubbles');</p>
</blockquote>
<blockquote>
<p>INSERT INTO sensors (name) values ('NodeMCU  ESP32');</p>
</blockquote>
<hr>
<p>2020-12-15 08:53:18</p>
<p><a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">Building a simple API with Nodejs, Expressjs, PostgreSQL DB, and JWT - 3</a></p>
<p><a href="https://blog.logrocket.com/setting-up-a-restful-api-with-node-js-and-postgresql-d96d6fc892d8/">node + postgresql -- nice tutorial</a></p>
<p><a href="https://itnext.io/building-restful-api-with-node-js-express-js-and-postgresql-the-right-way-b2e718ad1c66">node + postgresql + jwt</a></p>
<hr>
<p>2020-12-15 15:12:26</p>
<p>Begin here:</p>
<ul>
<li><a href="https://bezkoder.com/node-express-sequelize-postgresql/">CRUD</a></li>
</ul>
<p>then add security here:</p>
<ul>
<li><a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">adding jwt</a></li>
</ul>
<p>Update: actually, begin with second tutorial ...</p>
<p>Installing postgresql on ubuntu <a href="https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart">here</a></p>
<p>React + node + express + mongo w/ login page <a href="https://bezkoder.com/react-node-mongodb-auth/">here</a></p>
<hr>
<p>2020-12-15 15:53:43</p>
<p>Okay, here's the real deal:</p>
<p><a href="https://bezkoder.com/node-express-sequelize-postgresql/">Node.js Express &amp; PostgreSQL: CRUD Rest APIs example with Sequelize</a></p>
<p>Prior exapmel:</p>
<p>node, express, postgresql using sequelize <a href="https://medium.com/codingtown/node-express-and-postgresql-using-sequelize-in-ubuntu-18-04-3-lts-bc8d2cde3796">here</a></p>
<p>Wow, really simple example <a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">here</a></p>
<p>postgres and ubuntu tutorial <a href="https://itsfoss.com/install-postgresql-ubuntu/">here</a></p>
<hr>
<p>2020-12-15 17:12:48</p>
<p>nodejs express mongodb jwt <a href="https://www.npmjs.com/package/node-express-mongodb-jwt-rest-api-skeleton">here</a></p>
<hr>
<p>2020-12-16 11:26:24</p>
<p>as another approach w/ node + postgres, trying out <a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">this tutorial</a></p>
<p>Nice intro tutorial on nodejs and postgres <a href="https://stackabuse.com/using-postgresql-with-nodejs-and-node-postgres/">here</a></p>
<p>try out the github code <a href="https://github.com/jkasun/sa-node-postgres">here</a></p>
<p>worked.</p>
<p>New homework!  This is the thing to try:</p>
<p>&quot;creating a web application in your home using nodes, rpi, express, postgresql&quot; -- <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<p>NOTE:  'createdb -0 username dbname' should have -O instead of -0</p>
<p>Associated github repo is <a href="https://github.com/RhettTrickett/habitat">here</a></p>
<p>Grand. And then can add users / JWT with something like <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">this post</a></p>
<p>The first post for that series is <a href="https://www.codementor.io/@olawalealadeusi896/building-simple-api-with-es6-krn8xx3k6">here</a></p>
<p>Full code for the latter is <a href="https://github.com/olawalejarvis/reflection_app_server">here</a></p>
<p>And perhaps this shows how to combine the above with a front end -- <a href="https://bezkoder.com/react-express-authentication-jwt/">here</a></p>
<h3>Good example!</h3>
<p>The following pairing of backend and frontend seems to work as a baseline structure. Running both, they even find one another on the proper ports.</p>
<h4>Backend w/ node + express + postgresql + JWT</h4>
<p>Tutorial <a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">here</a> with associated code on github <a href="https://github.com/bezkoder/node-js-jwt-authentication-postgresql">here</a></p>
<h4>Frontend</h4>
<p>React front end <a href="https://bezkoder.com/react-jwt-auth/">here</a>, with github repo <a href="https://github.com/bezkoder/react-jwt-auth">here</a></p>
<h2>Node + Express + Postgres + Sequelize</h2>
<p>Tutorial <a href="https://www.robinwieruch.de/postgres-express-setup-tutorial">here</a>.  Nice explanation.</p>
<p>Another nice tutorial <a href="https://www.djamware.com/post/5b56a6cc80aca707dd4f65a9/nodejs-expressjs-sequelizejs-and-postgresql-restful-api">here</a>, with associated code on github <a href="https://github.com/didinj/node-express-postgresql-sequelize.git">here</a></p>
<p>Ahhhh, really nice tutorial on using sequelize, <a href="https://blog.echobind.com/a-guide-for-restful-apis-with-node-sequelize-postgres-63636d026d5d">here</a></p>
<hr>
<p>2020-12-16 13:31:56</p>
<p>using quasar, vue, and chartjs <a href="https://rike.dev/2019/02/11/display-smart-home-data-in-a-quasar-vue-js-and-chart-js-powered-web-application">here</a></p>
<hr>
<h2>Key links</h2>
<p>https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize#toc-sequelize-setup</p>
<p>https://bezkoder.com/node-js-jwt-authentication-postgresql/</p>
<p>https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-and-postgresql-db-masuu56t7</p>
<hr>
<p>2020-12-17 08:04:23</p>
<p>arg for postgresql for iot <a href="https://blog.timescale.com/blog/choose-postgresql-for-iot-19688efc60ca/">here</a></p>
<hr>
<h3>(HICCUP IN NOTES FLOW)</h3>
<hr>
<p>2020-12-15 17:31:58</p>
<p><a href="https://www.digitaljunky.io/make-your-own-data-platform-for-the-internet-of-things-using-node-js-and-express-js/">make your own iot data platform</a></p>
<p>mern stack <a href="https://www.digitalocean.com/community/tutorials/getting-started-with-the-mern-stack">here</a></p>
<p>mean stack jwt <a href="https://www.youtube.com/watch?v=T8qepiTbJi4">here</a></p>
<p>MERN full stack <a href="https://github.com/praveenscience/JWT-MERN-FullStack">here</a></p>
<p>ooooooh this is good MERN! <a href="https://github.com/praveenscience/JWT-MERN-FullStack">here</a></p>
<p>another good example <a href="https://github.com/vishalnagda1/mern-jwt-auth">here</a></p>
<p>this worked!</p>
<p>https://github.com/vishalnagda1/mern-jwt-auth</p>
<p>broader tutorial on MERN <a href="https://codingthesmartway.com/the-mern-stack-tutorial-building-a-react-crud-application-from-start-to-finish-part-1/">here</a></p>
<p>MERN CRUD app tutorial <a href="https://github.com/SinghDigamber/react-mernstack-crud">here</a></p>
<p>this looks like a nice example, using postgres -- <a href="https://github.com/adrach/starter-postgres-express-react">here</a></p>
<hr>
<p>MERN:</p>
<p>okay so this tutorial lets you create student records and view them -- <a href="https://github.com/SinghDigamber/react-mernstack-crud">here</a></p>
<p>whereas <a href="https://github.com/vishalnagda1/mern-jwt-auth">this tutorial</a> does user login stuff.</p>
<hr>
<p>2020-12-15 20:59:54</p>
<p>this pair of server (node + mongo + jwt) + client (angular) worked:</p>
<ul>
<li>server <a href="https://jasonwatmore.com/post/2020/06/17/nodejs-mongodb-api-jwt-authentication-with-refresh-tokens">tutorial</a> and <a href="https://github.com/cornflourblue/node-mongo-jwt-refresh-tokens-api">code</a></li>
<li>client <a href="https://github.com/cornflourblue/angular-9-jwt-refresh-tokens">tutorial</a> and <a href="https://github.com/cornflourblue/angular-9-jwt-refresh-tokens">code</a></li>
</ul>
<p>reading about fastify <a href="https://medium.com/@tarusharora/how-to-build-a-node-js-api-with-fastify-mongodb-docker-and-postman-f1ffab912ece">here</a></p>
<hr>
<p>2020-12-16 09:25:10</p>
<p>this might be my starting place -- node express postgresql ubuntu <a href="https://medium.com/codingtown/node-express-and-postgresql-using-sequelize-in-ubuntu-18-04-3-lts-bc8d2cde3796">here</a></p>
<p>also see post <a href="https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize">here</a></p>
<p>doing this in ~/Documents/postgres-express-react-node-tutorial</p>
<p>notes on postgres and user auth <a href="https://stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist">here</a></p>
<p>used this technique to change postgres password to 'i8buddha':
linked <a href="https://serverfault.com/questions/110154/whats-the-default-superuser-username-password-for-postgres-after-a-new-install">here</a></p>
<p>sequelize import is not a function' -- https://stackoverflow.com/questions/62917111/sequelize-import-is-not-a-function</p>
<p>associated github repo is <a href="https://github.com/waiyaki/postgres-express-node-tutorial">here</a></p>
<hr>
<p>2020-12-16 10:16:16</p>
<p>In the end, a nice codebase for postgres express and node is <a href="https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize#toc-sequelize-setup">here</a>.  Note that this blog post is based on an earlier blog post by Michael Herman, <a href="https://mherman.org/blog/node-postgres-sequelize/">here</a>.</p>
<p>with the github repo <a href="https://github.com/waiyaki/postgres-express-node-tutorial">here</a></p>
<p>used this technique to change postgres password to 'i8buddha':
linked <a href="https://serverfault.com/questions/110154/whats-the-default-superuser-username-password-for-postgres-after-a-new-install">here</a></p>
<p>which needed to be changed in server/config/config.json as per:</p>
<p>{
&quot;development&quot;: {
&quot;username&quot;: &quot;postgres&quot;,
&quot;password&quot;: &quot;i8buddha&quot;,
&quot;database&quot;: &quot;todos-dev&quot;,
&quot;host&quot;: &quot;127.0.0.1&quot;,
&quot;port&quot;: 5432,
&quot;dialect&quot;: &quot;postgres&quot;
},
&quot;test&quot;: {
&quot;username&quot;: &quot;postgres&quot;,
&quot;password&quot;: &quot;i8buddha&quot;,
&quot;database&quot;: &quot;todos-test&quot;,
&quot;host&quot;: &quot;127.0.0.1&quot;,
&quot;port&quot;: 5432,
&quot;dialect&quot;: &quot;postgres&quot;
}
}</p>
<p>this was the only change needed in the github repo above.</p>
<p>clone, then install with npm install, and run with npm run start:dev</p>
<p>result: working todo api w/ sequelize.</p>
<hr>
<p>2020-12-16 11:26:24</p>
<p>as another approach w/ node + postgres, trying out <a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">this tutorial</a></p>
<p>Nice intro tutorial on nodejs and postgres <a href="https://stackabuse.com/using-postgresql-with-nodejs-and-node-postgres/">here</a></p>
<p>try out the github code <a href="https://github.com/jkasun/sa-node-postgres">here</a></p>
<p>worked.</p>
<p>New homework!  This is the thing to try:</p>
<p>&quot;creating a web application in your home using nodes, rpi, express, postgresql&quot; -- <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<p>NOTE:  'createdb -0 username dbname' should have -O instead of -0</p>
<p>Associated github repo is <a href="https://github.com/RhettTrickett/habitat">here</a></p>
<p>Grand. And then can add users / JWT with something like <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">this post</a></p>
<p>The first post for that series is <a href="https://www.codementor.io/@olawalealadeusi896/building-simple-api-with-es6-krn8xx3k6">here</a></p>
<p>Full code for the latter is <a href="https://github.com/olawalejarvis/reflection_app_server">here</a></p>
<p>And perhaps this shows how to combine the above with a front end -- <a href="https://bezkoder.com/react-express-authentication-jwt/">here</a></p>
<h3>Good example!</h3>
<p>The following pairing of backend and frontend seems to work as a baseline structure. Running both, they even find one another on the proper ports.</p>
<h4>Backend w/ node + express + postgresql + JWT</h4>
<p>Tutorial <a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">here</a> with associated code on github <a href="https://github.com/bezkoder/node-js-jwt-authentication-postgresql">here</a></p>
<h4>Frontend</h4>
<p>React front end <a href="https://bezkoder.com/react-jwt-auth/">here</a>, with github repo <a href="https://github.com/bezkoder/react-jwt-auth">here</a></p>
<h2>Node + Express + Postgres + Sequelize</h2>
<p>Tutorial <a href="https://www.robinwieruch.de/postgres-express-setup-tutorial">here</a>.  Nice explanation.</p>
<p>Another nice tutorial <a href="https://www.djamware.com/post/5b56a6cc80aca707dd4f65a9/nodejs-expressjs-sequelizejs-and-postgresql-restful-api">here</a>, with associated code on github <a href="https://github.com/didinj/node-express-postgresql-sequelize.git">here</a></p>
<p>Ahhhh, really nice tutorial on using sequelize, <a href="https://blog.echobind.com/a-guide-for-restful-apis-with-node-sequelize-postgres-63636d026d5d">here</a></p>
<hr>
<p>2020-12-16 13:02:19</p>
<p>ingesting real time data w/ nodejs and timescale db <a href="https://stephanefrechette.dev/posts/ingest-real-time-streaming-data-for-time-series-analysis/">here</a></p>
<p>rike in berlin <a href="https://dev.to/frankanka">here</a></p>
<p>getting a csv download from nodejs <a href="https://dev.to/frankanka/get-a-csv-download-out-of-postgresql-or-lowdb-database-on-node-js-45k2">here</a></p>
<p>rike -- project -- maybe she'd help with corona -- <a href="https://rike.dev/">here</a></p>
<hr>
<p>multiple users and reflections <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">here</a></p>
<p>this is a meaty post <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-and-postgresql-db-masuu56t7">here</a></p>
<h2>Key links</h2>
<p>https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize#toc-sequelize-setup</p>
<p>https://bezkoder.com/node-js-jwt-authentication-postgresql/</p>
<p>https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-and-postgresql-db-masuu56t7</p>
<p>this adds content to the node + express + postgres + sequelize <a href="https://bezkoder.com/node-express-sequelize-postgresql/">here</a> w/ associated github repo <a href="https://github.com/bezkoder/node-express-sequelize-postgresql">here</a></p>
<p>follow this first!<br>
and see if you can make it appropriate for sensors ...</p>
<p>and maybe if you can do a front end for it ...
looks like they do have a front end in React example at the end <a href="https://bezkoder.com/react-node-express-postgresql/">here</a> -- w/ associated github repo <a href="https://github.com/bezkoder/react-crud-web-api">here</a></p>
<p>NOTE: have changed default port to something other than 8080, should go back to that ...</p>
<p>so, plan of attack:</p>
<ol>
<li>return to that <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">.bio tutorial</a> on sensors, and see how they set up the tables.  use that as an inspiration for how to create the postgresql table structure.</li>
<li>figure out best next thing to implement above; 'todo' or 'tutorials' examples; with or without jwt</li>
<li>add jwt + users using the other tutorial.</li>
</ol>
<p>postgres tutorial <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04">here</a></p>
<pre><code>sudo -i -u postgres
</code></pre>
<p>psql</p>
<p>\q</p>
<hr>
<p>2020-12-16 21:08:14</p>
<p>next steps:</p>
<ul>
<li>try to 'sequelize' the .bio example above, in order to understand how sequelize works ...</li>
<li>send sensor data to it</li>
<li>build it out like the 'tutorials' codebase that was associated with a react frontend</li>
<li>find a way to add JWT</li>
</ul>
<p>latest running code experimented with was <a href="node-js-jwt-authentication-postgresql">here</a>.</p>
<p>going to experiment with the '.bio' code asap.</p>
<p><a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">.bio tutorial</a></p>
<p>creating new tables</p>
<p>CREATE TABLE users (
user_id SERIAL PRIMARY KEY,
username VARCHAR(50),
password VARCHAR(255),
is_admin BOOLEAN DEFAULT FALSE
);</p>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
private_key VARCHAR(255)
);</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
celcius FLOAT,
humidity FLOAT,
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);</p>
<p>INSERT INTO users (username, password) VALUES ('bob', 'jones');</p>
<p>INSERT INTO feeds (name) values ('NodeMCU  ESP32');</p>
<p>checking string status <a href="https://stackoverflow.com/questions/60117067/javascript-regex-how-to-check-if-a-string-only-contains-letters-numbers-dash">here</a></p>
<hr>
<p>2020-12-17 20:03:39</p>
<p>newfeed branch is <a href="https://github.com/edgecollective/habitat/pull/new/newfeed">here</a></p>
<p>going to try for csv next using tutorial <a href="https://dev.to/frankanka/get-a-csv-download-out-of-postgresql-or-lowdb-database-on-node-js-45k2">here</a></p>
<p>another tutorial on exporting csv w/ node and express <a href="https://kb.objectrocket.com/postgresql/postgresql-export-csv-with-node-959">here</a></p>
<p>nice bezcoder tutorial <a href="https://bezkoder.com/node-js-export-postgresql-csv-file/">here</a></p>
<hr>
<p>2020-12-17 22:09:41</p>
<p>'heltec' is the latest branch.  accepts data from a heltec; includes firmware.</p>
<p><img src="/img/alt_server/feed_data.png" alt=""></p>
<p>Server code is <a href="https://github.com/edgecollective/habitat/tree/heltec">here</a>; firmware is in 'firmware' directory.</p>
<hr>
<p>2020-12-18 16:23:00</p>
<p>ah, interesting code snippet:</p>
<p>// https://github.com/auth0/express-jwt
// Secure &quot;protected&quot; endpoints with JWT middleware
app.use('/protected', jwtMiddleware({
secret: SECRET_TOKEN, // Use the same token that we used to sign the JWT above
// Let's allow our clients to provide the token in a variety of ways
getToken: function (req) {
if (req.headers.authorization &amp;&amp; req.headers.authorization.split(' ')[0] === 'Bearer') { // Authorization: Bearer g1jipjgi1ifjioj
// Handle token presented as a Bearer token in the Authorization header
return req.headers.authorization.split(' ')[1];
} else if (req.query &amp;&amp; req.query.token) {
// Handle token presented as URI param
return req.query.token;
} else if (req.cookies &amp;&amp; req.cookies.token) {
// Handle token presented as a cookie parameter
return req.cookies.token;
}
// If we return null, we couldn't find a token.
// In this case, the JWT middleware will return a 401 (unauthorized) to the client for this request
return null;
}
}));</p>
<p>// A simple protected route for demo purposes
app.get('/protected/data', function (req, res) {
console.log(req.user); // =&gt; { _id: &lt;S</p>
<hr>
<p>2020-12-18 16:26:03</p>
<p><a href="https://www.toptal.com/nodejs/secure-rest-api-in-nodejs">Secure Rest api in nodejs</a></p>
<p><a href="https://stormpath.com/blog/express-sample-api-key-management">using OAuth</a></p>
<p><a href="https://github.com/arkerone/api-key-auth#readme">node api key</a></p>
<p>api keys <a href="https://dev.to/nagarjun/best-practices-to-generate-and-store-api-keys-using-nodejs-534d">here</a></p>
<p>nice tutorial on development of the stack <a href="https://www.robinwieruch.de/node-express-server-rest-api">here</a></p>
<p>very nice tutorial on postgres + express dev <a href="https://www.robinwieruch.de/postgres-express-setup-tutorial/">here</a></p>
<p>basic passport api key <a href="http://www.passportjs.org/packages/passport-headerapikey/">here</a></p>
<p>passport and nestjs integration <a href="https://medium.com/@Dee_Mayoor/apikey-authentication-for-nestjs-using-passport-js-6db467fc31f7">here</a></p>
<p>this looks like a good strategy <a href="https://blog.risingstack.com/node-hero-node-js-authentication-passport-js/">here</a></p>
<p>nice strategy for token authentication and whatnot <a href="https://gist.github.com/laurenfazah/f9343ae8577999d301334fc68179b485">here</a></p>
<p>--</p>
<p>bezcode node + postgresql + express + react <a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">here</a></p>
<hr>
<p>2020-12-19 11:35:42</p>
<p>inserting html form data into postgresql using nodejs <a href="https://stackoverflow.com/questions/63618597/insert-html-form-data-into-heroku-postgresql-database-using-node-js">here</a></p>
<hr>
<p>2021-01-08 15:34:05</p>
<p>capturing form data with nodejs and express <a href="https://stackoverflow.com/questions/15568851/node-js-how-to-send-data-from-html-to-express">here</a></p>
<p>working with forms in express <a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/forms">here</a></p>
<h2>Forms example #1</h2>
<p>even better version, with working code, <a href="https://www.sitepoint.com/forms-file-uploads-security-node-express/">here</a></p>
<p>github repo <a href="https://github.com/sitepoint-editors/node-forms">here</a></p>
<hr>
<p>2021-01-08 15:57:43</p>
<p>This is the code to use and modify for habitat, <a href="https://github.com/dwblair/node-forms/tree/finished">here</a>, when trying to get forms up and running.</p>
<p>Next step is to get habitat up and running -- the 'heltec' code -- which will likely require reconnecting / reconfiguring the postgres database ...</p>
<hr>
<p>2021-01-08 19:32:35</p>
<h2>Forms exmaple with SQLITE3</h2>
<p><img src="/img/alt-server/adding_a_feed.png" alt=""></p>
<p><a href="https://medium.com/swlh/read-html-form-data-using-get-and-post-method-in-node-js-8d2c7880adbf">Read HTML Form Data Using GET and POST Method in Node.js</a></p>
<p>forking their example <a href="https://github.com/dwblair/crudApp_htmlForm">here</a></p>
<p>issue with sqlite3 -- covered <a href="https://github.com/jansmolders86/mediacenterjs/issues/191">here</a></p>
<p>seems that <a href="https://github.com/jansmolders86/mediacenterjs/issues/191#issuecomment-202340822">this approach</a> worked, i.e.:</p>
<blockquote>
<p>npm install -g node-pre-gyp
npm install sqlite3 --save-dev</p>
</blockquote>
<hr>
<p>2021-01-09 16:40:05</p>
<p>Capturing which button was pressed in form submit <a href="https://stackoverflow.com/questions/2066162/how-can-i-get-the-button-that-caused-the-submit-from-the-form-submit-event">here</a></p>
<p>Got basic forms working in the 'form' branch:</p>
<p><a href="https://github.com/edgecollective/habitat/tree/form">https://github.com/edgecollective/habitat/tree/form</a></p>
<p>Going to try templates next. Also:</p>
<p>understandin gnodejs express templating engines</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/nodejs-express-template-engines">digitalocean</a></li>
</ul>
<hr>
<p>2021-01-09 17:44:55</p>
<p>Got basic templating working: <a href="https://github.com/edgecollective/habitat/tree/template">https://github.com/edgecollective/habitat/tree/template</a></p>
<p>TODOS:</p>
<ul>
<li>need to extract and show 'feed ID' (via POSTGRESQL commands) to user when creating new feed (currently only show name and private key)</li>
<li>might want option of generating a hash for the feed id, rather than a simple incremented integer</li>
<li>need to handle case where the requested feed ID doesn't exist (will require looking up in database)</li>
<li>render a landing page for a new data feed that explains private key, allows for downloading the key id and private key, shows an example CURL, and links to online arduino examples.</li>
</ul>
<p>Going to need to figure out how to create a new table, and new fields.  Follow tutorial by Trickett (habitat creator) <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<hr>
<p>2021-01-10 10:57:12</p>
<p>setting up postgresql server ... creating tables ...</p>
<ul>
<li>install postgresql <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04">here</a></li>
</ul>
<p>then follow instructions <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<blockquote>
<p>sudo -i -u postgres
psql</p>
</blockquote>
<p>can exit via \q</p>
<p>CREATE TABLE users (
user_id SERIAL PRIMARY KEY,
username VARCHAR(50),
password VARCHAR(255),
is_admin BOOLEAN DEFAULT FALSE
);</p>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255)
);</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,<br>
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);</p>
<p>INSERT INTO users (username, password) VALUES ('bob', 'jones');</p>
<p>INSERT INTO feeds (name) values ('NodeMCU  ESP32');</p>
<p>pcat999</p>
<p>how to handle: relation does not exist -- <a href="https://stackoverflow.com/questions/19941922/error-relation-does-not-exist">here</a></p>
<hr>
<p>2021-01-10 12:09:36</p>
<p>update: relation didn't exist b/c hadn't created the tables in the proper database.</p>
<p>PORT=3000
DB_NAME=hab1
DB_USER=postgres
DB_PASSWORD=pcat999
DB_HOST=localhost
DB_PORT=5432</p>
<hr>
<p>2021-01-10 12:30:59</p>
<p>Created a 'feed creation' landing page in the 'createfeed-landing' branch of habitat on github.com/edgecollective</p>
<hr>
<p>2021-01-10 12:48:01</p>
<p>using serial primary keys postgresql <a href="https://www.postgresqltutorial.com/postgresql-serial/">here</a></p>
<p>postgresql random primary key <a href="https://stackoverflow.com/questions/20890129/postgresql-random-primary-key">here</a></p>
<p>unique identifier in your postgresql database <a href="https://itnext.io/how-to-have-unique-identifier-in-your-postgresql-database-using-primary-key-and-foreign-key-9d2ddd4efce2">here</a></p>
<p>advice here is not to use the public key as the unique identifier -- <a href="https://dba.stackexchange.com/questions/94203/random-unguessable-primary-key-which-preserves-correct-order">here</a></p>
<hr>
<p>2021-01-11 11:06:05</p>
<p>error handling in express <a href="https://expressjs.com/en/guide/error-h">here</a></p>
<p>TODO: refactor things based on the suggestions in that post.</p>
<p>in particular:</p>
<pre><code>app.get('/user/:id', async function (req, res, next) {
  var user = await getUserById(req.params.id)
  res.send(user)
})
</code></pre>
<hr>
<p>2021-01-11 11:16:08</p>
<p>notes on api keys:</p>
<p>nice article <a href="https://stoplight.io/blog/api-keys-best-practices-to-authenticate-apis/">here</a></p>
<p>carto's policy <a href="https://carto.com/developers/auth-api/guides/how-to-send-API-Keys/">here</a></p>
<p>maybe should now have authorization key in the header.  should just be a matter of checking on the &quot;POST&quot; ... getting a header.  can implement it after this round.</p>
<hr>
<p>2021-01-11 11:25:41</p>
<p>changing name of table in postgres</p>
<pre><code>ALTER TABLE table_name 
RENAME COLUMN column_name TO new_column_name;
</code></pre>
<p>tests:</p>
<ul>
<li>case of incoming JSON matter? (likely yes) -- YES</li>
<li>case of postgres request matter? (likely no)</li>
<li>what if we don't send all the params?</li>
</ul>
<hr>
<p>2021-01-11 12:23:53</p>
<p>writing an async function <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">here</a></p>
<p>guide to async programming <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await">here</a></p>
<hr>
<p>2021-01-11 12:32:41</p>
<p>'use-pubkey' is the latest branch.</p>
<p>using 'async await' in express <a href="https://zellwk.com/blog/async-await-express/">here</a></p>
<p>and: definition of 'async / await' <a href="https://zellwk.com/blog/async-await">here</a></p>
<p>w/ postgresql <a href="https://stackoverflow.com/questions/53910835/using-async-await-with-node-postgres">here</a></p>
<p>started to use promises ...</p>
<p>even better now would be to create a 'getFeedPrivateKey() function and use that in postNewMeasurement()</p>
<hr>
<p>2021-01-11 17:13:28</p>
<p>have now started some 'async' code in branch 'async'. that's the latest working branch.</p>
<p>TODO:  the 'new feed' api should return JSON; the page we land on after creating a new feed in the form should leverage that api.</p>
<hr>
<p>2021-01-11 17:25:43</p>
<p>beginner's guide to pug <a href="https://www.sitepoint.com/a-beginners-guide-to-pug/">here</a></p>
<p>cami -- simon's kid</p>
<hr>
<p>2021-01-12 19:02:12</p>
<p>instructions for setting up postgres for habitat on digitalocean</p>
<p>install postgres</p>
<pre><code>sudo apt update
sudo apt install postgresql postgresql-contrib
</code></pre>
<blockquote>
<p>sudo -i -u postgres
createdb bay1
psql
\c bay1</p>
</blockquote>
<p>then:</p>
<p>CREATE TABLE users (
user_id SERIAL PRIMARY KEY,
username VARCHAR(50),
password VARCHAR(255),
is_admin BOOLEAN DEFAULT FALSE
);</p>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255)
);</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,<br>
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);</p>
<p>check that all is well:</p>
<blockquote>
<p>\dt</p>
</blockquote>
<p>change the user password:</p>
<blockquote>
<p>ALTER USER postgres WITH PASSWORD 'pcat999'</p>
</blockquote>
<blockquote>
<p>\q
exit</p>
</blockquote>
<p>see better guide <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<p>need to make sure .env file is proper:</p>
<p>PORT=3000
DB_NAME=hab1
DB_USER=postgres
DB_PASSWORD=pcat999
DB_HOST=localhost
DB_PORT=5432</p>
<p>key guide <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04">here</a>
for deploying nodejs server on digitalocean.</p>
<p>has section for adding additional apps on other ports!</p>
<p>setting up nginx on digitalocean guide <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04">here</a></p>
<p>how to set up a firewall on ubuntu <a href="https://www.digitalocean.com/community/tutorials/how-to-setup-a-firewall-with-ufw-on-an-ubuntu-and-debian-cloud-server">here</a></p>
<hr>
<p>2021-01-13 08:05:11</p>
<p>Its creation was motivated by recent work (e.g. by <a href="https://www.medrxiv.org/content/10.1101/2020.06.15.20132027v2">Jimenez et al.</a>) indicating that monitoring indoor CO2 levels can (in some contexts) help to assess the risk of airborne SARS-CoV-2 transmission.</p>
<hr>
<p>2021-01-13 11:59:26</p>
<p>html to jade thing <a href="https://html2jade.org/">here</a></p>
<hr>
<p>2021-01-13 19:20:23</p>
<p>Interesting way to do a drop-down menu via Pug, here:</p>
<p>div(class=&quot;choices&quot;)
h2
p I'm voting for:
select(class=&quot;form-control&quot;)
option 1
option 2
option 3
option 4
option 5</p>
<hr>
<p>2021-01-14 08:49:52</p>
<p>good example of chart setup here: <a href="view-source:https://www.chartjs.org/samples/latest/charts/line/basic.html">view-source:https://www.chartjs.org/samples/latest/charts/line/basic.html</a></p>
<p>Reference for p2p-farm-server chartjs setup <a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/fixhop/public/js/drive.js">here</a></p>
<p>perhaps-useful chartjs formatting <a href="https://embed.plnkr.co/JOI1fpgWIS0lvTeLUxUp/">here</a></p>
<hr>
<p>2021-01-21 11:20:38</p>
<p>Structure for a basic todo list app here: <a href="https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c">https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c</a></p>
<p>Associated code on github here: <a href="https://github.com/chisom5/nodejs-todoList">https://github.com/chisom5/nodejs-todoList</a></p>
<p>Idea:</p>
<ul>
<li>Make a similar system to Bayou</li>
<li>Each 'map' has an associated image file, a list of feeds, feed locations</li>
<li>So everything is indexed by the map, instead of the feed.  The map gets a 'mapkey' and a 'writekey'</li>
<li>Once you have a mapkey, you can add new feeds to the map, and change the map's metadata</li>
</ul>
<p>Idea: add nodemon for auto restart of bayou while developing</p>
<p>Using React-like library 'Riot' here: <a href="https://hub.packtpub.com/simple-todo-list-web-application-nodejs-express-and-riot/">https://hub.packtpub.com/simple-todo-list-web-application-nodejs-express-and-riot/</a>, with associated code here: <a href="https://github.com/revington/riot-express-todo-list">https://github.com/revington/riot-express-todo-list}</a></p>
<p>Drawing a grid on a canvas here <a href="https://codereview.stackexchange.com/questions/114702/drawing-a-grid-on-canvas">https://codereview.stackexchange.com/questions/114702/drawing-a-grid-on-canvas</a></p>
<p>postgres tutorial again here: <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372</a></p>
<hr>
<p>2021-01-21 11:38:40</p>
<p>Simpler todo app approach here -- these are the elements I think I need -- <a href="https://medium.com/@atingenkay/creating-a-todo-app-with-node-js-express-8fa51f39b16f">https://medium.com/@atingenkay/creating-a-todo-app-with-node-js-express-8fa51f39b16f</a></p>
<p>And on github: <a href="https://github.com/missating/nodejs-todo">https://github.com/missating/nodejs-todo</a></p>
<p>Okay -- TODO: redo that last repo, using pug.
Then create feedmaps -- the equiv of bayou but by pulling in new feeds from various sources.  depending on the type of feed, can have various functionality.  so, add a 'feed type' variable -- e.g. bayou-co2 is one such type.</p>
<hr>
<p>2021-01-21 12:10:58</p>
<p>Iteration in pug here: <a href="https://pugjs.org/language/iteration.html">https://pugjs.org/language/iteration.html</a></p>
<hr>
<p>2021-01-21 12:42:26</p>
<p>feed-map can now display a simple list of feeds here: <a href="https://github.com/edgecollective/feed-map/commit/4d3a522ba01f0bae15721fe0420100dcf76fd1a8">https://github.com/edgecollective/feed-map/commit/4d3a522ba01f0bae15721fe0420100dcf76fd1a8</a></p>
<p><img src="/img/alt-server/feemap1.png" alt=""></p>
<hr>
<p>2021-01-21 17:22:56</p>
<p>Creating dynamic ides in a loop with pug here <a href="https://www.dev-tips-and-tricks.com/create-dynamic-ids-in-a-loop-with-pug-jade">https://www.dev-tips-and-tricks.com/create-dynamic-ids-in-a-loop-with-pug-jade</a></p>
<p>Update: this commit shows the basic functionality!</p>
<p><a href="https://github.com/edgecollective/feed-map/commit/765a9eec9b101e0e507075ec3b0e6aae8b9fec3b">https://github.com/edgecollective/feed-map/commit/765a9eec9b101e0e507075ec3b0e6aae8b9fec3b</a></p>
<p><img src="/img/alt-server/feedmap1.png" alt=""></p>
<p>Added nicer formatting:</p>
<p><img src="/img/alt-server/feedmap2.png" alt=""></p>
<p>Associated git commit is here: <a href="https://github.com/edgecollective/feed-map/commit/6f449c02024013035f1d42cd264505fb0066018e">https://github.com/edgecollective/feed-map/commit/6f449c02024013035f1d42cd264505fb0066018e</a></p>
<hr>
<p>2021-01-21 18:28:59</p>
<p>Nice reference for doing the map, via p2p-server code, here:</p>
<p><a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html">https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html</a></p>
<hr>
<p>2021-01-21 18:39:13</p>
<p>Got image map working!  at this commit -- <a href="https://github.com/edgecollective/feed-map/commit/72e90916c5bf5b21d748a5e4e54451f93a25c654">https://github.com/edgecollective/feed-map/commit/72e90916c5bf5b21d748a5e4e54451f93a25c654</a></p>
<hr>
<p>2021-01-21 18:46:53</p>
<p>Got markers working! commit -- <a href="https://github.com/edgecollective/feed-map/commit/2e4281fc405246c231ce817b35ee4f99f7d9b80c">https://github.com/edgecollective/feed-map/commit/2e4281fc405246c231ce817b35ee4f99f7d9b80c</a></p>
<hr>
<p>2021-01-21 19:01:20</p>
<p>More formatting tweaks -- <a href="https://github.com/edgecollective/feed-map/commit/2b81f2f1154ddf1e6ffa11d2d5cd1b8ecb0260ce">https://github.com/edgecollective/feed-map/commit/2b81f2f1154ddf1e6ffa11d2d5cd1b8ecb0260ce</a></p>
<p><img src="/img/alt-server/feedmap3.png" alt=""></p>
<hr>
<p>2021-01-22 11:16:31</p>
<p>Created a 'checkbox' functionality, and also have charts graphed separately, in this commit and branch: <a href="https://github.com/edgecollective/feed-map/commit/e75252d43b287c398a6e82fa02e1599dfe307711">https://github.com/edgecollective/feed-map/commit/e75252d43b287c398a6e82fa02e1599dfe307711</a></p>
<p><img src="/img/alt-server/exploded.png" alt=""></p>
<hr>
<p>2021-01-22 14:14:58</p>
<p>Note: this is the nodejs-todo app I built feedmap upon, which has a nice 'delete note' functionality: <a href="https://github.com/missating/nodejs-todo">https://github.com/missating/nodejs-todo</a></p>
<p>This code might be useful re: deleting items in postgres: <a href="https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c">https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c</a></p>
<p>Here's a nice guide on using knex -- <a href="https://medium.com/@tobie.tsuzuki/getting-started-with-node-js-express-and-knex-5640f595df98">https://medium.com/@tobie.tsuzuki/getting-started-with-node-js-express-and-knex-5640f595df98</a></p>
<p>Interesting post on sequelize vs knex vs objection.js here: <a href="https://stackoverflow.com/questions/56028287/how-is-node-js-knex-similar-different-to-sequelize">https://stackoverflow.com/questions/56028287/how-is-node-js-knex-similar-different-to-sequelize</a></p>
<p>And an interesting link here: <a href="https://www.jakso.me/blog/objection-to-orm-hatred">https://www.jakso.me/blog/objection-to-orm-hatred</a> -- looks like objection.js might be a great idea.</p>
<hr>
<p>2021-01-22 14:31:57</p>
<p>Overlay line on chart.js <a href="https://stackoverflow.com/questions/28076525/overlay-line-on-chart-js-graph">https://stackoverflow.com/questions/28076525/overlay-line-on-chart-js-graph</a></p>
<hr>
<p>2021-01-22 14:43:27</p>
<p>Good example of chartjs datasets: <a href="https://tobiasahlin.com/blog/chartjs-charts-to-get-you-started/#2-line-chart">https://tobiasahlin.com/blog/chartjs-charts-to-get-you-started/#2-line-chart</a></p>
<hr>
<p>2021-01-22 18:34:46</p>
<p>Now plotting multiple co2 plots!  at this commit: <a href="https://github.com/edgecollective/feed-map/commit/91adae48079a21fcf9fcc286ccd85a7ac2a68e91">https://github.com/edgecollective/feed-map/commit/91adae48079a21fcf9fcc286ccd85a7ac2a68e91</a></p>
<p><img src="/img/alt-server/feedmap4.png" alt=""></p>
<hr>
<p>2021-01-22 18:42:23</p>
<p>Hosting via google drive here: <a href="https://stackoverflow.com/questions/10311092/displaying-files-e-g-images-stored-in-google-drive-on-a-website">https://stackoverflow.com/questions/10311092/displaying-files-e-g-images-stored-in-google-drive-on-a-website</a></p>
<hr>
<p>2021-01-22 18:56:25</p>
<p>Add asylum map:</p>
<p><img src="/img/alt-server/feedmap_asylum.png" alt=""></p>
<p>git commit: <a href="https://github.com/edgecollective/feed-map/commit/fce79dc266a8ee5696a7da75c2a7177722128f80">https://github.com/edgecollective/feed-map/commit/fce79dc266a8ee5696a7da75c2a7177722128f80</a></p>
<hr>
<p>2021-01-23 10:15:25</p>
<p>Revisiting my own documentation / repo for a minimal node + sqlite endpoint here <a href="https://github.com/edgecollective/nodejs-sqlite-endpoint">https://github.com/edgecollective/nodejs-sqlite-endpoint</a></p>
<hr>
<p>2021-01-23 15:38:16</p>
<p>Good tutorial for sqlite3: <a href="https://www.sqlitetutorial.net/sqlite-nodejs/query/">https://www.sqlitetutorial.net/sqlite-nodejs/query/</a></p>
<hr>
<p>2021-01-23 15:52:07</p>
<p>Using sqlite3 with async await here: <a href="https://www.scriptol.com/sql/sqlite-async-await.php">https://www.scriptol.com/sql/sqlite-async-await.php</a></p>
<hr>
<p>2021-01-23 16:12:29</p>
<p>Switching back to postgres:</p>
<p>Installing postgres:</p>
<pre><code>sudo apt update
sudo apt install postgresql postgresql-contrib
</code></pre>
<p>Then:</p>
<pre><code>sudo -i -u postgres
createdb feedmap1;
psql feedmap1
</code></pre>
<p>then:</p>
<pre><code>CREATE TABLE feedmaps(
    feedmap_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255),
    private_key VARCHAR(255),
    map_url VARCHAR(255)
);

CREATE TABLE feeds(
    id SERIAL PRIMARY KEY,
    feedmap_id INT,
    feed_base_url VARCHAR(255),
    feed_public_key VARCHAR(255),
    added TIMESTAMP DEFAULT NOW(),
    CONSTRAINT feedmap
        FOREIGN KEY(feedmap_id)
            REFERENCES feedmaps(feedmap_id)
);
</code></pre>
<hr>
<p>2021-01-23 22:14:02</p>
<p>New branch -- postgres -- mimics features of Bayou-CO2.</p>
<p>Basic working setup here: <a href="https://github.com/edgecollective/feed-map/commit/6dd02a33311bcdbaed57a3bdf54b0070a342d6a1">https://github.com/edgecollective/feed-map/commit/6dd02a33311bcdbaed57a3bdf54b0070a342d6a1</a></p>
<p><img src="/img/alt-server/feedmap_manage.png" alt=""></p>
<p>Notes:</p>
<ul>
<li>Can do similar forms to 'create' and 'manage' a feedmap; to 'manage', need to enter pubkey and privkey -- can follow format of bayou-CO2 ...</li>
</ul>
<p>Flow:</p>
<ul>
<li>Create a feedmap</li>
<li>Then, you get sent to the 'manage' page.</li>
<li>You can also get to the 'manage' page by entering a pubkey and privkey for a feed.</li>
<li>Perhaps there is a 'manage' button on the feed landing page, which then prompts for a privatekey, then takes you to the 'manage' page.</li>
<li>Would be nice to be able to change the map, and modify the feeds; but at first, okay if it's 'throwaway' and you need to start over ...</li>
</ul>
<hr>
<p>2021-01-26 14:53:50</p>
<p>Adding x,y coord display over image, here: <a href="https://stackoverflow.com/questions/7414984/how-could-i-display-x-y-coordinates-on-image-in-real-time-to-the-user-when-the">https://stackoverflow.com/questions/7414984/how-could-i-display-x-y-coordinates-on-image-in-real-time-to-the-user-when-the</a></p>
<hr>
<p>2021-01-26 20:59:05</p>
<p>Getting close w/ feedmaps! <a href="https://gitlab.com/p-v-o-s/co2/feedmap/-/commit/15b5d91c469c17b3fbbd03ba5ab6b6eaf0b70869">https://gitlab.com/p-v-o-s/co2/feedmap/-/commit/15b5d91c469c17b3fbbd03ba5ab6b6eaf0b70869</a></p>
<p><img src="/img/alt-server/manage_feeds.png" alt=""></p>
<p>The issue now is that we need to add &quot;shortname&quot; and &quot;coords&quot; to each feed listed in the feedmap database.<br>
Need to modify the database.</p>
<p>Also: need to remove &quot;name&quot; from the bayou-co2. Perhaps just use the first few chars as the &quot;name&quot;.</p>
<hr>
<p>2021-01-27 11:14:20</p>
<p><img src="/img/alt-server/manage_feeds_c.png" alt=""></p>
<hr>
<p>2021-01-27 19:55:39</p>
<p>Feedmap hacking:
<a href="http://192.168.1.163:4006/feedmap/manage/7a66feb586010296bb03fc01967a89ac7b1f9b41388db6ff/1f79e0a2d7159495e9be3cb545c83911147035130a2b9fba">http://192.168.1.163:4006/feedmap/manage/7a66feb586010296bb03fc01967a89ac7b1f9b41388db6ff/1f79e0a2d7159495e9be3cb545c83911147035130a2b9fba</a></p>
<hr>
<p>2021-01-29 22:14:01</p>
<h1>Setting up postgres on the Pi</h1>
<h2>Installing</h2>
<blockquote>
<p>sudo apt update
sudo apt install postgresql postgresql-contrib</p>
</blockquote>
<h2>Creating DB</h2>
<blockquote>
<p>sudo -i -u postgres
postgres@raspberrypi:~$ createdb hab1
postgres@raspberrypi:~$ psql hab1</p>
</blockquote>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255)
;</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,<br>
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
;</p>
<p>(exit psql and postgres with &quot;exit&quot; )</p>
<h2>Changing password</h2>
<blockquote>
<p>sudo -i -u postgres
psql
postgres=# ALTER USER postgres WITH PASSWORD 'pcat999'</p>
</blockquote>
<hr>
<p>2021-02-04 09:23:33</p>
<p>&quot;Part 1: Create an application using PostgreSQL, Express, React and Node.js stack&quot;</p>
<p><a href="https://medium.com/javascript-in-plain-english/create-a-fullstack-banking-application-using-react-e8c96d74cd39">https://medium.com/javascript-in-plain-english/create-a-fullstack-banking-application-using-react-e8c96d74cd39</a></p>
<hr>
<p>2021-02-07 11:54:58</p>
<p>DATA STRUCTURE REDESIGN NOTES:</p>
<p>Here's a slight database redesign (I think I can do this in a day or so) that, based on your investigations thus far, might improve usability.</p>
<p>A 'gaggle' consists of the data feeds coming from a wifi-lora gateway, plus up to 8 remote nodes that are associated with it.</p>
<p>Node IDs are fixed on the remote nodes using hardware switches that admit of 8 possible states.</p>
<p>Each node ID will always get the same 'color' in the graph; i.e. Node 0 is 'blue', Node 1 is 'red'.</p>
<p>Instead of creating individual 'feeds' on Bayou, you will now create 'gaggles'.  You'll get a pub + priv key pair, which goes into that gaggles' gateway node's configuration file (&quot;config.h&quot;).</p>
<p>We now also introduce the concept of &quot;local lora group ID&quot; -- a short, random key of 3 chars, which the gateway and lora nodes both share, independent of the gaggle pub + priv key.</p>
<p>Gateways only process lora data from their own &quot;lora group&quot;, rejecting any other lora info coming in.  (This avoids lora conflicts at Library HQ, when setting up multiple 'gaggles').</p>
<p>When you want to switch a gateway to a new gaggle, you create a new gaggle on Bayou, and reprogram the gateway with the new gaggle pub_key and priv_key, but you keep the lora group_key ... so that you don't need to reprogram the associated lora nodes at all.</p>
<hr>
<p>In other words, the setup sequence is:</p>
<ol>
<li>Create a new 'gaggle' on Bayou, giving you a new gaggle pub_key and priv_key pair.</li>
<li>Choose a local 'lora group' shortkey to identify your local lora network.</li>
<li>Program the gaggle pub_key and priv_key, as well as the lora group key, into the gateway.</li>
<li>Program the lora group key into all of the remote nodes.</li>
<li>Set the 'hardware switches' on the remote nodes to indicate which node number they are on the network.</li>
</ol>
<p>If you want to create a new gaggle, you just create a new gaggle on Bayou, and reprogram the gateway with the new gaggle pub_key and priv_key, but keep the lora group key the same.  That way the remote nodes don't need to be reprogrammed.</p>
<p>Each remote node, on boot, 'measures' its local hardware node ID number.  When it broadcasts, it sends its lora group key and its node ID along with its sensor data.</p>
<p>The gateway only listens for lora messages from lora nodes within its lora group.  When it receives a lora message from its group, it sends it along to Bayou.</p>
<hr>
<p>So the gateway config file will look like:</p>
<p>const char <em>SSID = &quot;pvosPi&quot;;
const char <em>WiFiPassword = &quot;12345678&quot;;
const char</em> bayou_base_url = &quot;192.168.4.1:3000/co2/data&quot;;
const char</em> gaggle_pub_key = &quot;62be3698ed7917a7da588750de28d0ac2030c1c12a5c1c6d&quot;;
const char* gaggle_priv_key = &quot;f02d003674065fb2e9199bf39d602532324fdc1d5a041ab4&quot;;
char char* lora_groupkey = &quot;a1c&quot;;
const int interval_sec = 10;
const int forcePPM = 400;</p>
<p>And the remote config files (all identical to one another, but specific to this lora group) will look like:</p>
<p>char char* lora_group_key = &quot;a1c&quot;;
const int interval_sec = 10;
const int forcePPM = 400;</p>
<pre><code>sudo -i -u postgres
createdb feedmap1;
psql feedmap1
</code></pre>
<p>then:</p>
<pre><code>CREATE TABLE feeds(
    gaggle_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255),
    private_key VARCHAR(255)
);

CREATE TABLE feeds(
    id SERIAL PRIMARY KEY,
    gaggle_id INT,
    node_id INT,
    added TIMESTAMP DEFAULT NOW(),
    CONSTRAINT gaggle
        FOREIGN KEY(gaggle_id)
            REFERENCES gaggles(gaggle_id)
);


CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT, 
log VARCHAR(255),   
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
 FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
;

</code></pre>
<p>Retrying ...</p>
<pre><code>CREATE TABLE feeds(
    gaggle_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255),
    private_key VARCHAR(255)
);

CREATE TABLE feeds(
    id SERIAL PRIMARY KEY,
    gaggle_id INT,
    node_id INT,
    added TIMESTAMP DEFAULT NOW(),
    CONSTRAINT gaggle
        FOREIGN KEY(gaggle_id)
            REFERENCES gaggles(gaggle_id)
);


CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT, 
log VARCHAR(255),   
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
 FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
;

</code></pre>
<pre><code>CREATE TABLE feeds(
    feed_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255),
    private_key VARCHAR(255)
;

CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,    
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
 FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
;
</code></pre>
<hr>
<p>2021-02-07 18:11:34</p>
<p>Nano ID here: <a href="https://medium.com/javascript-in-plain-english/you-might-not-need-uuid-v4-for-generating-random-identifiers-89e8a28a7d77">https://medium.com/javascript-in-plain-english/you-might-not-need-uuid-v4-for-generating-random-identifiers-89e8a28a7d77</a></p>
<p>short uuid -- <a href="https://www.npmjs.com/package/short-uuid">https://www.npmjs.com/package/short-uuid</a></p>
<p><a href="https://gist.github.com/6174/6062387">https://gist.github.com/6174/6062387</a> -- generate random string in short and fast way</p>
<p>nice collection of resources <a href="https://www.xspdf.com/resolution/59806960.html">here</a></p>
<p>short unique id <a href="https://shortunique.id/">here</a></p>
<p>this seems v good! https://shortunique.id/</p>
<p>https://betterexplained.com/articles/the-quick-guide-to-guids/</p>
<p>user-facing unique uuids -- https://dev.to/yeo_alexandra/creating-user-facing-short-unique-ids-what-are-the-options-8mn</p>
<p>generate a unique short id here: https://gnugat.github.io/2018/06/15/short-identifier.html</p>
<p>oooh this is a pretty good argument: https://neilmadden.blog/2018/08/30/moving-away-from-uuids/</p>
<p>good list of unique id thingies: https://github.com/grantcarthew/awesome-unique-id</p>
<p>nanoid -- https://github.com/ai/nanoid/</p>
<p>https://stackoverflow.com/questions/54338808/how-to-generate-unique-numeric-short-id-in-nodejs</p>
<p>good reading here: https://stackoverflow.com/questions/6248666/how-to-generate-short-uid-like-ax4j9z-in-js</p>
<p>looks like using nanoid w/ 11 characters would be the thing!</p>
<p>https://zelark.github.io/nano-id-cc/</p>
<hr>
<p>using the unique constraint: https://www.postgresqltutorial.com/postgresql-unique-constraint/</p>
<p>using indexes: https://www.postgresql.org/docs/9.1/indexes-intro.html</p>
<hr>
<p>2021-02-08 09:11:55</p>
<p>back to basics ...</p>
<h2>Creating DB</h2>
<pre><code>sudo -i -u postgres
postgres@raspberrypi:~$ createdb hab3
postgres@raspberrypi:~$ psql hab3


CREATE TABLE feeds(
    feed_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255) UNIQUE,
    private_key VARCHAR(255) 
);

CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,
log VARCHAR(255),    
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
 FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);

</code></pre>
<hr>
<p>2021-02-08 09:35:02</p>
<p>installing nano-id:  <a href="https://github.com/ai/nanoid">https://github.com/ai/nanoid</a></p>
<p>ah, here's an async approach:</p>
<p><a href="https://stackoverflow.com/questions/49938266/how-to-return-values-from-async-functions-using-async-await-from-function">https://stackoverflow.com/questions/49938266/how-to-return-values-from-async-functions-using-async-await-from-function</a></p>
<p>deleting rows in the table!</p>
<p>https://www.postgresqltutorial.com/postgresql-delete/</p>
<p>with some condition here: <a href="https://stackoverflow.com/questions/5170546/how-do-i-delete-a-fixed-number-of-rows-with-sorting-in-postgresql">https://stackoverflow.com/questions/5170546/how-do-i-delete-a-fixed-number-of-rows-with-sorting-in-postgresql</a></p>
<hr>
<p>2021-02-08 13:52:07</p>
<p>Shortened keys, and added ability to delete a feed of historical data!</p>
<hr>
<p>2021-02-08 15:15:31</p>
<p>adding feedmaps2</p>
<pre><code>CREATE TABLE feedmaps(
    feedmap_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255) UNIQUE,
    private_key VARCHAR(255),
    map_url VARCHAR(255)
);

CREATE TABLE feeds(
    id SERIAL PRIMARY KEY,
    feedmap_id INT,
    feed_base_url VARCHAR(255),
    feed_public_key VARCHAR(255),
    added TIMESTAMP DEFAULT NOW(),
    CONSTRAINT feedmap
        FOREIGN KEY(feedmap_id)
            REFERENCES feedmaps(feedmap_id)
);
</code></pre>
<hr>
<p>okay, latest to play with is here:</p>
<p>http://192.168.1.163:4000/feedmap/manage/bda90e5b319c2e8b15e882ca950e7baf96bc362366828283/5693cc45409f6d89adc293489e1154f0430c7d723ccb2a05</p>
<hr>
<p>2021-02-08 21:02:13</p>
<p><img src="/img/co2/colors.png" alt=""></p>
<hr>
<p>2021-02-09 12:27:25</p>
<p>Setting up a nodejs server for production <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04</a></p>
<hr>
<p>2021-02-09 12:30:29</p>
<p>Additional entry points via nginx here: <a href="https://snapshooter.io/blog/how-to-run-nodejs-server-with-nginx">https://snapshooter.io/blog/how-to-run-nodejs-server-with-nginx</a></p>
<hr>
<p>2021-02-09 13:03:10</p>
<p>setting up server with nodejs</p>
<p>first added an A record for 'subdomain' at pvos, pointing to IP address of new droplet.</p>
<p>then on new droplet:</p>
<p>ufw: <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04</a></p>
<p>setting up nodejs for production <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-20-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-20-04</a></p>
<p>generating a new ssh key <a href="https://docs.gitlab.com/ee/ssh/README.html#generate-an-ssh-key-pair">https://docs.gitlab.com/ee/ssh/README.html#generate-an-ssh-key-pair</a></p>
<p>set up pm2</p>
<p>set up nginx <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04">https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04</a></p>
<p>after running nginx, i basically just tweaked the default</p>
<pre><code>sudo vi /etc/nginx/sites-available/default
</code></pre>
<pre><code>server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                #try_files $uri $uri/ =404;
                proxy_pass http://localhost:4000;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
                proxy_cache_bypass $http_upgrade;
        }

        # pass PHP scripts to FastCGI server
        #
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}
</code></pre>
<hr>
<p>2021-02-09 15:03:51</p>
<p>working demo here <a href="https://gitlab.com/p-v-o-s/co2/feedmap/-/tree/4698789d79c3dd6b9c3a8fa88651ba4909c66e9d">https://gitlab.com/p-v-o-s/co2/feedmap/-/tree/4698789d79c3dd6b9c3a8fa88651ba4909c66e9d</a></p>
<hr>
<p>2021-02-10 16:03:05</p>
<p>Fixing nodemon issue with stepping on ports here: <a href="https://stackoverflow.com/questions/58605392/port-3000-is-already-in-use-nodemon-app-crashed-waiting-for-file-changes-bef">https://stackoverflow.com/questions/58605392/port-3000-is-already-in-use-nodemon-app-crashed-waiting-for-file-changes-bef</a></p>
<hr>
<p>2021-02-10 16:12:22</p>
<p>Handling failed errors with fetch: <a href="https://www.tjvantoll.com/2015/09/13/fetch-and-errors/">https://www.tjvantoll.com/2015/09/13/fetch-and-errors/</a></p>
<hr>
<p>2021-02-10 21:22:55</p>
<p>demo of bayou-co2 and feedmap here: [https://youtu.be/_9c5-HOngBk]</p>
<p>bayou-co2 <a href="https://gitlab.com/p-v-o-s/co2/bayou-co2/-/tree/447cbeb5de42ec6b3ae5e7b3521c207624cda6e8">https://gitlab.com/p-v-o-s/co2/bayou-co2/-/tree/447cbeb5de42ec6b3ae5e7b3521c207624cda6e8</a></p>
<p>feedmap <a href="https://gitlab.com/p-v-o-s/co2/feedmap/-/tree/af0e1aa0e82fd80de31a9945e44d263c092ecc40">https://gitlab.com/p-v-o-s/co2/feedmap/-/tree/af0e1aa0e82fd80de31a9945e44d263c092ecc40</a></p>
<hr>
<p>2021-02-11 12:15:10</p>
<p>creating a .ico image <a href="https://graphicdesign.stackexchange.com/questions/77359/how-to-convert-a-square-svg-to-all-size-ico">https://graphicdesign.stackexchange.com/questions/77359/how-to-convert-a-square-svg-to-all-size-ico</a></p>
<hr>
<p>2021-02-18 13:25:49</p>
<pre><code>sudo -i -u postgres
postgres@raspberrypi:~$ createdb feedmap3
postgres@raspberrypi:~$ psql feedmap3

CREATE TABLE feedmaps(
    feedmap_id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    public_key VARCHAR(255) UNIQUE,
    private_key VARCHAR(255),
    map_url VARCHAR(255)
);

CREATE TABLE feeds(
    id SERIAL PRIMARY KEY,
    feedmap_id INT,
    feed_base_url VARCHAR(255),
    feed_public_key VARCHAR(255),
    feed_nickname VARCHAR(255),
    added TIMESTAMP DEFAULT NOW(),
    CONSTRAINT feedmap
        FOREIGN KEY(feedmap_id)
            REFERENCES feedmaps(feedmap_id)
);
</code></pre>
<p>artisan's feeds</p>
<p>b2srm27dragm	red	CSV | JSON
ertvughsgqzs	blue	CSV | JSON
jdwktcu9xt5c	green	CSV | JSON
t8uic9wh4q82	purple</p>
<p>feedmap is: 104.248.54.245
bayou is:</p>


    </div>
  </body>
</html>



<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:80%;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>
        <h1>DIY CO2 Monitoring</h1>

  
  <h2>Background</h2>
<p>The following is a development notebook for constructing a DIY CO2 monitor.</p>
<h2>Table of contents</h2>
<p>More or less random bookmarks into the notes file, for reference:</p>
<ul>
<li><a href="#feather">Feather Hookup Guide for K30</a></li>
<li><a href="#gatewaysetup">Description of remote node + gateway setup</a>.</li>
<li><a href="#jimenez">Peng and Jimenez paper on CO2 and COVID infection probability</a></li>
<li><a href="#rev_a_build">Rev_A build of Feather-based SCD30 board</a></li>
<li><a href="#calibration">Thoughts on calibration as of 24 NOV 2020</a></li>
<li><a href="#nov25">Nov 25 update</a></li>
<li><a href="#mic_experiment">Initial Microphone Experiment Nov 28</a></li>
<li><a href="#compare_scd30">Comparing two SCD30 sensors</a></li>
</ul>
<hr>
<p>2020 SEPT 29</p>
<h2>Experiments with K30 from CO2METER.com</h2>
<p><a href="https://www.co2meter.com/products/k-30-co2-sensor-module">Online description of K30</a></p>
<p><a href="http://co2meters.com/Documentation/Datasheets/DS_SE_0118_CM_0024_Revised9%20(1).pdf">K30 Datasheet</a></p>
<p>Needs 5V power minimum (actually, looks like it's best run at 6-9V); meanwhile, <strong>Logic levels for the UART are at 3.3V</strong>.</p>
<p>Useful info on logic levels / etc from the datasheet:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/logic_levels.png"> <img src="/img/co2/logic_levels.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Table 1 from the <a href="http://co2meters.com/Documentation/Datasheets/DS_SE_0118_CM_0024_Revised9%20(1).pdf">K30 datasheet</a>.</td>
</tr>
</tbody>
</table>
<p>Meanwhile, though -- good advice on connecting to signals that run at higher voltage from JeeLab, <a href="https://jeelabs.org/2010/12/16/voltage-3-3-vs-5/index.html">here</a>.  Punchline -- can add a 1K resistor in series with signal as protection.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/fig2.png"> <img src="/img/co2/fig2.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Figure 2 from the <a href="http://co2meters.com/Documentation/Datasheets/DS_SE_0118_CM_0024_Revised9%20(1).pdf">K30 datasheet</a>.</td>
</tr>
</tbody>
</table>
<ul>
<li>'G0' -- GND</li>
<li>'G+' -- Voltage input (5V to 9V)</li>
<li>'TxD, RxD' -- UART</li>
<li>'OUT1' -- Analog output (alternative way of getting the data)</li>
</ul>
<p>Datasheet says: should avoid connecting analog and digital ground pins externally in order to avoid ground loops</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/analog_outputs.png"> <img src="/img/co2/analog_outputs.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Analog outputs.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/calibration.png"> <img src="/img/co2/calibration.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Calibration.</td>
</tr>
</tbody>
</table>
<h2>Connecting to an Arduino</h2>
<h3>Via I2C</h3>
<p><a href="http://www.co2meters.com/Documentation/AppNotes/AN102-K30-Sensor-Arduino-I2C.pdf">Connecting a K30 to an Arduino via I2C</a></p>
<p>This suggests using 6 to 9V input. (Might be good to upgrade the spec on the MCP1702 voltage reg so we can take &gt; 6V input on the Mothbot).  Needs to be able to provide 500mA.  So: direct from battery power is likely best.</p>
<h3>Notes on using a Feather</h3>
<p><a href="https://cdn-learn.adafruit.com/assets/assets/000/032/914/large1024/feather_schem.png?1465421956">Schematic</a> of the Feather M0 Lora.</p>
<p>Datasheet for the AP2112-3.3 voltage regulator used on the feather is <a href="https://www.diodes.com/assets/Datasheets/AP2112.pdf">here</a>.</p>
<p>From the AP2112K datasheet -- 6V max allowed on Feather:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/feather_voltage_input.png"> <img src="/img/co2/feather_voltage_input.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">UART connection.</td>
</tr>
</tbody>
</table>
<h3>Via UART</h3>
<p>Note: <strong>Logic levels for the UART are at 3.3V</strong>.</p>
<p><a href="http://www.co2meters.com/Documentation/AppNotes/AN126-K3x-sensor-arduino-uart.pdf">Connecting a K30 to an Arduino via UART</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/uart_closeup.png"> <img src="/img/co2/uart_closeup.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">UART connection.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/first_readings.png"> <img src="/img/co2/first_readings.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">First readings.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/breath_test.png"> <img src="/img/co2/breath_test.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Blowing on the sensor and then letting it recover.</td>
</tr>
</tbody>
</table>
<p>Edge Collective copy of the library for UART connection is <a href="https://github.com/edgecollective/co2-kseries">here</a> (replica of that provided by CO2 Monitor <a href="http://www.co2meters.com/Documentation/AppNotes/AN126-K3x-sensor-arduino-uart.zip">here</a>).</p>
<h2>SSD1306 Display</h2>
<p>Guide <a href="https://randomnerdtutorials.com/guide-for-oled-display-with-arduino/">here</a> for hookup to Arduino UNO.</p>
<h2>UART + SSD1306 Display</h2>
<p>Example code <a href="https://gist.github.com/dwblair/310acc6f8dafa8f82af713200ceda577">here</a>.</p>
<h2><a name="gatewaysetup"></a> Remote LoRa CO2 Node and Heltec Gateway sending to FarmOS</h2>
<p>Using a <a href="https://edgecollective.io/posts/notes/mothbot/">Mothbot</a> to connect to the K30 sensor over UART and send via LoRa to a <a href="https://www.amazon.com/MakerFocus-Development-Bluetooth-0-96inch-Display/dp/B076MSLFC9">Heltec</a> Wifi-LoRa gateway, posting to <a href="https://edgecollective.farmos.net/farm/sensor/heltecone">FarmOS</a>.</p>
<p>Code for remote and gateway is <a href="https://github.com/edgecollective/co2-remote-and-gateway">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/remote_v1.jpg"> <img src="/img/co2/remote_v1.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Mothbot remote node connected to K30 CO2 sensor.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mothbo.jpg"> <img src="/img/co2/mothbo.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Closeup of Mothbot.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/k30.jpg"> <img src="/img/co2/k30.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Closeup of K30 CO2 sensor.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/heltec_gateway.jpg"> <img src="/img/co2/heltec_gateway.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Heltec Wifi-LoRa gateway</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/farmos_graph.png"> <img src="/img/co2/farmos_graph.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Graphing on FarmOS</td>
</tr>
</tbody>
</table>
<h2>Misc</h2>
<p>Would be nice to develop useful ways of connecting to some standard hardware (e.g. Feathers, etc).</p>
<h2>CO2 and Greenhouses</h2>
<p><a href="https://www.greenhousegrower.com/production/monitoring-carbon-dioxide-in-the-greenhouse/">Article</a> on measuring CO2 in greenhouses:</p>
<blockquote>
<p>Until recently, the vast majority of growers in the U.S. did not measure CO2 or use it to enrich their greenhouses. However, during the winter, CO2 levels can quickly become limiting in unventilated greenhouses full of plants on cold and sunny days. Over the past 10 years, we have also seen greenhouse growers seal up their greenhouses in an effort to control their heating bills during the winter. Other growers, especially in northern latitudes, have invested in supplemental lighting because of the numerous benefits, from improved quality and yields to reduced production time. An apparent result of tightly sealing the greenhouse is increased humidity and condensation. A not-so-apparent result of reducing air infiltration is a reduction of CO2 levels within the greenhouse below ambient levels found outdoors.</p>
</blockquote>
<hr>
<p>Oct 9 2020:</p>
<p>Maybe a good configuraiton is to have the sensor powered via a 7.4V rechargeable lith-ion, while the micro attached has its separate battery voltage?</p>
<hr>
<p>oct 13 2020:</p>
<p>Recreating the prototype but using a Feather M0 instead ...</p>
<p>now we want to use Hardware Serial instead of Software Serial ...</p>
<p>We noticed a <a href="https://twitter.com/linseymarr/status/1314582969168920577?s=20">Twitter thread</a> by Linsey Marr on Oct 8 2020 that references using a CO2 monitor to assess activity in a space re: COVID-19; they use the HOBO CO2 monitor pictured in Fig C below.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/hobo_c02.jpeg"> <img src="/img/co2/hobo_c02.jpeg" alt="figC"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig C. HOBO CO2 Logger used to assess activity level / air turnover in a college gym.</td>
</tr>
</tbody>
</table>
<p>Note: some power options (if plugging into the wall):  use a 9V power wall wart, and drop down voltage to 5V; or use a 5V wall wart (more commong), and boost up to 9V.</p>
<p>If the latter, probably need to check on current (mA) requirements of the K30.</p>
<p>Offhand, seems like drop down is easier; boosting to 6V / 9V is a bit odd.</p>
<h3><a name="feather"></a>Feather Hookup Guide for K30</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/feather_setup.jpg"> <img src="/img/co2/feather_setup.jpg" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig A2.  Feather M0 connected to a K30 sensor.</td>
</tr>
</tbody>
</table>
<p>Feather firmware is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/v1/featherm0_K30">here</a>.</p>
<p>Wiring for test:</p>
<ul>
<li>Connect TXD (K30, see Fig A below) to RX0 (Feather);</li>
<li>Connect RXD (K30, see Fig A below) to TX1 (Feather);</li>
<li>Connect Feather GND to 6V Battery GND;</li>
<li>Connect 6V battery Power to Feather to K30 Power in (labeled &quot;5V&quot; in fig A below)</li>
<li>Power Feather via USB (for initial test)</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/uart_closeup.png"> <img src="/img/co2/uart_closeup.png" alt="figA"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig A.  UART connection on the K30.  When connecting to the Feather, connect TXD (K30) to RX0 (Feather) and RXD (K30) to TX1 (Feather).</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/feather_co2_decay_test.png"> <img src="/img/co2/feather_co2_decay_test.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig B.  Data from Feather, plotted in Arduino plotter utility.  Data shows breathing on sensor at a particular time and and watching decay. Time interval unit is 2 seconds.</td>
</tr>
</tbody>
</table>
<p>UPDATE: looks like the K30 can be powered by up to 14V.  So a 12V boost, or power supply, could be an option.</p>
<p>Started by closing door, sitting next to sensor.   At 150 time mark, opened door and left room.  Then At 250 time mark, reentered room and closed door. At 280 time mark, started a conversation.</p>
<p>Cf. 'room_test.png'.</p>
<p>'room_test_later.png' -- had a phone call</p>
<p>'room_test_later_2.png' -- left room for a bit with door open, then emilie came back and worked with the door open.</p>
<h2>Reference for typical / expected CO2 values</h2>
<p>Nice discussion <a href="https://inspectapedia.com/hazmat/CO2_Typical_Levels.php">here</a>, thanks to Laura P.</p>
<h2>Other CO2 Sensors</h2>
<h3>MH-Z14:</h3>
<p>Specifically mentions NDIR.</p>
<p>For sale on <a href="https://usa.banggood.com/NDIR-CO2-Sensor-MH-Z14A-PWM-NDIR-Infrared-Carbon-Dioxide-Sensor-Module-Serial-Port-0-5000PPM-Controller-p-1248270.html?utm_source=googleshopping&amp;utm_medium=cpc_organic&amp;gmcCountry=US&amp;utm_content=minha&amp;utm_campaign=minha-usg-pc&amp;currency=USD&amp;createTmp=1&amp;utm_source=googleshopping&amp;utm_medium=cpc_bgs&amp;utm_content=frank&amp;utm_campaign=frank-ssc-us-all-1108&amp;ad_id=395572890419&amp;cur_warehouse=CN">Banggood</a>.
Another option</p>
<h3>MH-Z19:</h3>
<p>Mentions infrared. This is the one that Craig used / that I have in my possession now.</p>
<p>For sale on <a href="https://usa.banggood.com/MH-Z19-MH-Z19B-Infrared-CO2-Sensor-Module-Carbon-Dioxide-Gas-Sensor-for-CO2-Monitor-0-5000ppm-MH-Z19B-NDIR-with-Pin-p-1693604.html">Banggood</a> for $20.</p>
<p>Goal as of 13 OCT 2020: get this up and running in parallel to the K30 and see how they compare with the 'ambient' test.</p>
<p>Nice <a href="https://www.circuits.dk/testing-mh-z19-ndir-co2-sensor-module/">article</a> on testing out the Z19 on a Raspberry Pi.</p>
<p>Update 15 OCT 2020: Just found a fairly official-looking Arduino library for the MH-Z19 <a href="https://github.com/WifWaf/MH-Z19">here</a> by WifWaf.</p>
<p>In that repo they have some nice notes about calibration.  The Z19 allows us to turn autocalibration off (which seems useful -- otherwise it is using the lowest reading in a 24 hour period as '400 ppm').  Would be good to experiment with this.</p>
<p>Also, here's <a href="https://github.com/tobiasschuerg/MH-Z-CO2-Sensors">another library for the MH-19</a> -- looks a bit older.  Going to try the WifWaf one above for now.</p>
<p>Note that the WifWaf github MH-Z19 lib is already in the Arduino online Lib repo, can just install via Library Manager in IDE.</p>
<p>Update 15 OCT 2020:  was able to get the WifWaf lib running on the MothbotV3.  Radiohead + the library ends up generating a 'low memory' warning.  This is fine; we'll likely end up using the Feather; also, we can pare down the full library to just generate raw values, likely.</p>
<h2>Programming the Heltec Gateway</h2>
<p><a href="https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/">Guide to using ESP32 in Arduino IDE</a></p>
<p><a href="https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/boards_manager.md">Another guide from Sparkfun</a></p>
<p>Add this to Boards Manager:</p>
<p><code>https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json</code></p>
<p>Select 'Heltec Wifi Lora (v2)'</p>
<h2>Programming with Feather</h2>
<p>Add this to Boards Manager:</p>
<p><code>https://adafruit.github.io/arduino-board-index/package_adafruit_index.json</code></p>
<h2><a name="co2_farmos_overnight"></a> CO2 with K30 to FarmOS</h2>
<p>Oct 14 2020</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_farmos.png"> <img src="/img/co2/co2_farmos.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Posting CO2 PPM data from a K30 to FarmOS, measuring overnight from 14 OCT to 15 OCT 2020.</td>
</tr>
</tbody>
</table>
<h2>Turning off autocalibration in K30</h2>
<p><a href="http://www.yoctopuce.com/EN/article/how-to-calibrate-a-co2-sensor">This article</a> mentions a technique, using their library.</p>
<h2>CO2 with custom server</h2>
<p>(TODO: set up using chappy-server as a model?)</p>
<hr>
<p>15 OCT 2020 10:42 AM</p>
<p>K30 is autocalibrating, Z19 is not.</p>
<p>Ah -- looks like the K30 also can give temp, and RH!  Cf the example <a href="https://gist.github.com/pkourany/53415d7f0c354a6d1e05">here</a>.</p>
<p>How to read the K30 via I2c app note <a href="http://www.co2meters.com/Documentation/AppNotes/AN102-K30-Sensor-Arduino-I2C.pdf">here</a>.</p>
<p>Ahhh here is a library for multiple params by CO2meter for the K30 -- <a href="http://www.co2meters.com/Documentation/AppNotes/AN126-K3x-sensor-arduino-uart.pdf">boom</a>.</p>
<p>need to modify their library so that it doesn't rely on SoftwareSerial (necessarily)</p>
<p>-- but first check whether we can even disable autocalibration?</p>
<p>Reading the <a href="https://img.ozdisan.com/ETicaret_Dosya/456729_1584920.PDF">K30 datasheet</a></p>
<p>Useful CO2meter guide to K30 ABC <a href="https://www.co2meter.com/blogs/news/7512282-co2-sensor-calibration-what-you-need-to-know">here</a>.</p>
<p><a href="http://www.warf.com/download/3671_7081_I2C_comm_guide_2_1031.pdf">i2c communication guide to K series sensors</a></p>
<p>-- looks like it can be disabled in EEPROM via I2C, at least ...</p>
<p>Nice reference on connecting a Teensy to a K30 <a href="https://forum.pjrc.com/threads/23963-Teensy-3-0-and-co2-sensor-with-UART">here</a></p>
<p>Reference to a key application note re: K-Series eeprom setup <a href="https://www.co2meter.com/blogs/news/9278787-senseair-k-series-sensor-uart-eeprom-ram-access-procedure">here</a></p>
<p>-- need to email them, UART command lib is missing ...</p>
<p>15 OCT 14:00 -- Interesting link to the <a href="http://www.yoctopuce.com/EN/products/usb-environmental-sensors/yocto-co2-v2">Yoctopuce V2</a>, which uses a 'better sensor' than the K30, they claim ...</p>
<p>The K30-based yoctopuce-c02 is <a href="http://www.yoctopuce.com/EN/products/discontinued-products/yocto-co2">here</a></p>
<p>More about the yp-co2-v2 is <a href="https://www.yoctopuce.com/EN/article/new-the-yocto-co2-v2">here</a></p>
<p>Yp-co2 (K30) <a href="https://www.yoctopuce.com/EN/products/yocto-co2/doc/YCO2MK01.usermanual.html">user's guide</a></p>
<h2>K30 via i2c</h2>
<p>this is the serious guide, <a href="http://www.warf.com/download/3671_7081_I2C_comm_guide_2_1031.pdf">here</a></p>
<p>simple i2c example <a href="http://www.co2meters.com/Documentation/AppNotes/AN102-K30-Sensor-Arduino-I2C.pdf">here</a></p>
<h2>SCD30</h2>
<p>The yocto uses the SCD30 -- listed for $54 on <a href="https://www.digikey.com/en/products/detail/sensirion-ag/SCD30/8445334?utm_adgroup=Sensors%20%26%20Transducers&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Dynamic%20Search&amp;utm_term=&amp;utm_content=Sensors%20%26%20Transducers&amp;gclid=CjwKCAjw5p_8BRBUEiwAPpJO63lPqw8gZyFFETPN5SMQElL0quJ5jvgLhi2gGq7jW4WlxdnqgtCC_xoCyLAQAvD_BwE">digikey</a></p>
<p>Here's the SCD30 <a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">datasheet</a></p>
<p>Arduino library <a href="https://www.arduino.cc/reference/en/libraries/sparkfun-scd30-arduino-library/">here</a></p>
<p>And on <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">github</a></p>
<p>annnnd the Sparkfun library has a 'disable calibration' settting <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/tree/master/examples/Example4_DisableCalibrate">here</a></p>
<h2>Summary as of 15 OCt 2020 15:00</h2>
<p>K30 seems outdated; won't trust it until we figure out how to turn off the autocalibration ... waiting to hear back from CO2 meter</p>
<p>MH-Z19 is also a bit older;  can at least control the autocal ...</p>
<p>The calibration assumption with these meters seems to be that they use the lowest ppm value over some period and consider it to be 400 ppm -- assumes that all spaces end up getting 'fresh air' at some point in that period.  For the K30, this is et to 7 days.  Not sure for the other sensors.</p>
<p>Also: readings for NDIR are temp, humidity, and pressure dependent.  My sense is that all the sensors measure these variables and compensate; the SCD30 also allows for feeding it the current ambient pressure and using it for calibration.</p>
<p>My current thought is the SCD30 would be a good one to get, along with an ambient pressure sensor.</p>
<hr>
<p>OCT 16 2020</p>
<p><a href="https://www.amazon.com/DFROBOT-Gravity-Analog-Sensor-Arduino/dp/B00R5CCH7U/ref=pd_lpo_469_t_0/147-7195648-8919536?_encoding=UTF8&amp;pd_rd_i=B00R5CCH7U&amp;pd_rd_r=8568e96f-b65d-4703-880d-17fe796d82cb&amp;pd_rd_w=zJnfI&amp;pd_rd_wg=LWVMI&amp;pf_rd_p=7b36d496-f366-4631-94d3-61b87b52511b&amp;pf_rd_r=2CT08KJ5JB9PC3GFSM38&amp;psc=1&amp;refRID=2CT08KJ5JB9PC3GFSM38">Example</a> of an electrochemical CO2 sensor.</p>
<p>Really <a href="https://www.co2meter.com/pages/indoor-air-quality-links">nice collection of references</a> from co2meter.com</p>
<hr>
<p>OCT 21 2020</p>
<p>Looks like the SCD30 can run off 3.3V, requiring max current of 80mA -- that's well within range of Feather LDO I believe!</p>
<p>SCD30 <a href="https://cdn.sparkfun.com/assets/1/a/7/9/9/Sensirion_CO2_Sensors_SCD30_Preliminary-Datasheet.pdf">datasheet</a> has the following table:</p>
<p>SCD30 <a href="https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/9.5_CO2/Sensirion_CO2_Sensors_SCD30_Assembly_Guideline.pdf">handling and assembly guide</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/electric_scd30.png"> <img src="/img/co2/electric_scd30.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Electrical characeristics of SCD30.</td>
</tr>
</tbody>
</table>
<p>Listing for th SCD30 on Amazon, <a href="https://www.amazon.com/SCD30-CO2-SENSOR-MODULE-Detection/dp/B07R1KCJ8F">here</a>.</p>
<p>And on Digikey, <a href="https://www.digikey.com/en/products/detail/sensirion-ag/SCD30/8445334?utm_adgroup=Gas%20Sensors&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Product_Sensors%2C%20Transducers&amp;utm_term=&amp;utm_content=Gas%20Sensors&amp;gclid=Cj0KCQjwuL_8BRCXARIsAGiC51DYiI4bJ21_4XyMzXfu4_-hHUoTJMfTvMqc2sEJYov2--rf9fmn45IaAsNcEALw_wcB">here</a>.</p>
<p>Note: should likely pair with a precision pressure sensor like the BME280 or better.</p>
<hr>
<p>OCT 22 2020</p>
<p>CO2Meter note on calibration <a href="https://www.co2meter.com/blogs/news/7512282-co2-sensor-calibration-what-you-need-to-know">here</a></p>
<p>Calibration for the SCD30 sensor document <a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">here</a> p. 7 / 10.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_calibration.png"> <img src="/img/co2/scd30_calibration.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Calibration of the SCD30, via <a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">this document</a></td>
</tr>
</tbody>
</table>
<p>Upshot:  seems as though with the ABC algorithm, sensor needs to see at least 1 hour of fresh air daily.
With the 'manual' mode, can run it for 2 minutes outdoors and press button saying 'calibrate' and set it to '400ppm'.<br>
Seems like this latter mode would work best.</p>
<h3>Assembly of SCD30</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_assembly.png"> <img src="/img/co2/scd30_assembly.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Assembly of SCD30 PCB, via <a href="https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/9.5_CO2/Sensirion_CO2_Sensors_SCD30_Assembly_Guideline.pdf">this doc</a></td>
</tr>
</tbody>
</table>
<hr>
<p>OCT 23 2020</p>
<h3>SCD30 Field Calibration</h3>
<p><a href="/data/CD_AN_SCD30_Field_Calibration_D2.pdf">Field calibration guide for SCD30</a></p>
<h4>Manual Field Calibration</h4>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_frc.png"> <img src="/img/co2/scd30_frc.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Effect of 'forced recalibration' (FRC) of SCD30 as described in the <a href="/data/CD_AN_SCD30_Field_Calibration_D2.pdf.">SCD30 ield calibration guide</a></td>
</tr>
</tbody>
</table>
<h5>Automatic Field Calibration</h5>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_asc_calibration.png"> <img src="/img/co2/scd30_asc_calibration.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Effect of automatic self-calibration (ASC) algorithm used in SCD30 as described in the <a href="/data/CD_AN_SCD30_Field_Calibration_D2.pdf">SCD30 ield calibration guide</a>.</td>
</tr>
</tbody>
</table>
<hr>
<p>OCT 24 2020</p>
<p>Might consider adding a high-precision pressure sensor to any SCD30 breakout board; the SCD30 can compensate for pressure if sent values directly.  E.g. the <a href="https://www.adafruit.com/product/3966">BMP388 breakout from Adafruit</a>.</p>
<hr>
<p>NOV 12 2020</p>
<p>Quick task: Feather-based breakout for SCD30 + BMP388 or equiv.</p>
<ul>
<li>can run on USB or lithium ion battery</li>
<li>mount for SCD30</li>
</ul>
<p>Any other useful things to add?</p>
<ul>
<li>i2c and uart breakouts?</li>
<li>display header -- oled to show graph of last few hours, w/ normal range?</li>
</ul>
<p>Should we use the ESP32?</p>
<p>If we use Heltec, it could be a remote node <em>or</em> a gateway ...</p>
<p>That's an argument for using the Heltec ...</p>
<p>Looks like SCD30 can use i2c ...
... other sensors can use i2c (break it out!) or UART ...</p>
<p>which library does Sparkfun use?</p>
<h3>SCD30 library and pinout</h3>
<p><strong>Sparkfun SCD30 library</strong> Ah, here's the <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">Sparkfun SCD30 CO2 Library</a>.  They use i2c, great!</p>
<p><strong>SCD30 pinout</strong> From the <a href="https://cdn.sparkfun.com/assets/1/a/7/9/9/Sensirion_CO2_Sensors_SCD30_Preliminary-Datasheet.pdf">SCD30 datasheet</a>:</p>
<p><a href="/img/co2/scd30_pinout.png"><img src="/img/co2/scd30_pinout.png" alt=""></a></p>
<h3>Making a breakout</h3>
<p>Pinout for <a href="https://www.adafruit.com/product/3966">BMP388</a>, precision temp + pressure ...</p>
<p><a href="/img/co2/bmp388.jpg"><img src="/img/co2/bmp388.jpg" alt=""></a></p>
<p>Current thinking: make a place for the i2c oled displays, both the thin and the larger versions.</p>
<p>Ahhh ... <a href="https://www.adafruit.com/product/4816">BM390</a> has even greater precision, why not go for that. Looks like same pinout, in fact.</p>
<h4>BMP390 Pinout</h4>
<p>(Same as BMP380)</p>
<p><a href="/img/co2/bmp390.jpg"><img src="/img/co2/bmp390.jpg" alt=""></a></p>
<p>Question -- do we need the INT pin assigned to a feather pin?</p>
<p>Looks like it might only be for SPI -- see Adafruit description of <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx/pinouts">pinout</a>. In any case, not used in their libraries, so don't assign for now.</p>
<h4>Feather M0 pinout</h4>
<p><a href="/img/co2/feather_m0_pinout.jpg"><img src="/img/co2/feather_m0_pinout.jpg" alt=""></a></p>
<h4>Adding a second UART to the Feather M0</h4>
<p>Guide is <a href="https://learn.adafruit.com/using-atsamd21-sercom-to-add-more-spi-i2c-serial-ports/creating-a-new-serial">here</a></p>
<p>They give an example with D10 as TX and D11 as RX.  So, break out those pins.</p>
<h4>Display</h4>
<ul>
<li>
<p>[Small i2c display] is 38x12mm.</p>
</li>
<li>
<p><a href="https://www.amazon.com/Dorhea-Display-SSD1306-Self-Luminous-Raspberry/dp/B07WPCPM5H/ref=psdc_306754011_t2_B0761LV1SD">Large i2c display</a> is 27mm x 27mm.</p>
</li>
</ul>
<h5>Breakout REV A</h5>
<p>Current breakout board is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/atkins">here</a>.</p>
<p><a href="/img/co2/co2_3drender.png"><img src="/img/co2/co2_3drender.png" alt=""></a></p>
<hr>
<p>2020 NOV 13</p>
<p>Lithium Ion battery that fits nicely inside of feather, <a href="https://www.adafruit.com/product/3898">here</a>.</p>
<p>Sizing logos in Kicad, article <a href="https://www.defproc.co.uk/tutorial/sizing-logos-in-kicad/">here</a>.</p>
<hr>
<p>2020 NOV 14</p>
<p>Nice guide to trace width <a href="https://bayareacircuits.com/picking-the-right-trace-width-for-your-next-pcb-design/">here</a>.</p>
<p>Trace width calculator link <a href="https://www.4pcb.com/trace-width-calculator.html">here</a>, and <a href="https://docs.oshpark.com/design-tools/eagle/design-rules-files/">here</a>.</p>
<h3>Calculating trace width</h3>
<p>Based on <a href="https://docs.oshpark.com/services/two-layer-hhdc/">this link at OSHPark</a>, the typical copper thickness for a 2-layer board is 2oz.</p>
<p>Then,</p>
<ul>
<li>For 1 Amp current, we get .4 mm trace width.</li>
<li>For 200 mA (.2 Amps), we get .04 mm trace width.</li>
<li>For 20 mA (.02 Amps), we get .002 mm trace width.</li>
</ul>
<p>I think the CO2 board won't source more than 0.2 Amps.</p>
<p>Ah!  Note that JLCPCB uses 1 oz copper by default.  This means:</p>
<ul>
<li>1 Amp --&gt; .78 mm trace width</li>
<li>200 mA --&gt; .09 mm trace width</li>
<li>20 mA --&gt; .004 mm trace width</li>
</ul>
<h2>CO2 Motherboard REV A</h2>
<p>Idea:  develop footprint for K30 and Z19, to co-deploy the sensors and test them out.</p>
<p>On the other hand: nice to have a board that is smaller, that can connect to these other boards, but is ready to start deploying as its own sensor.</p>
<p>Here's a version (REV_A) that does the latter.</p>
<p><a href="/img/co2/scd30_breakout_3drender.png"><img src="/img/co2/scd30_breakout_3drender.png" alt=""></a></p>
<p>Now, need to ask again: can we turn off the autocalibration for the Z19 and the K30?</p>
<p>Z19, I believe it's straightforward -- need to review.</p>
<p>K30 -- here are the links sent via email from CO2Meter:</p>
<ul>
<li><a href="https://www.co2meter.com/pages/downloads">'Downloads'</a></li>
<li><a href="https://www.co2meter.com/collections/sensors/products/k-30-co2-sensor-module">'K30 Web page'</a> (cf 'Documents' tab)</li>
<li><a href="http://co2meters.com/Documentation/Other/AN_SE_0018_AN_126_Revised8.pdf">'connecting K30 to an Arduino'</a></li>
</ul>
<p>Screenshot of gaslab software from CO2Meter, showing serial interface to turn ABC off:</p>
<p><a href="/img/co2/k30_abc_off.png"><img src="/img/co2/k30_abc_off.png" alt=""></a></p>
<p>Turning off ABC in K30 via i2c (found in <a href="http://co2meters.com/Documentation/Other/SenseAirCommGuide.zip">'Communications Protocols Manuals'</a>, in the i2c folder.  Specific document stored in our archives <a href="/img/co2/I2C_comm_guide_2_15.pdf">here</a>.</p>
<p><a href="/img/co2/abc_control_k30.png"><img src="/img/co2/abc_control_k30.png" alt=""></a></p>
<p>Communicating with K30 via I2C + Arduino guide, <a href="">here</a>.  Example below:</p>
<pre><code>// CO2 Meter K-series Example Interface
// Revised by Marv Kausch, 7/2016 at CO2 Meter &lt;co2meter.com&gt;
// Talks via I2C to K30/K22/K33/Logger sensors and displays CO2 values
// 12/31/09
#include &lt;Wire.h&gt;
// We will be using the I2C hardware interface on the Arduino in
// combination with the built-in Wire library to interface.
// Arduino analog input 5 - I2C SCL
// Arduino analog input 4 - I2C SDA
/*
  In this example we will do a basic read of the CO2 value and checksum verification.
  For more advanced applications please see the I2C Comm guide.
*/
int co2Addr = 0x68;
// This is the default address of the CO2 sensor, 7bits shifted left.
void setup() {
  Serial.begin(9600);
  Wire.begin ();
  pinMode(13, OUTPUT); // address of the Arduino LED indicator
  Serial.println(&quot;Application Note AN-102: Interface Arduino to K-30&quot;);
}
///////////////////////////////////////////////////////////////////
// Function : int readCO2()
// Returns : CO2 Value upon success, 0 upon checksum failure
// Assumes : - Wire library has been imported successfully.
// - LED is connected to IO pin 13
// - CO2 sensor address is defined in co2_addr
///////////////////////////////////////////////////////////////////
int readCO2()
{
  int co2_value = 0;  // We will store the CO2 value inside this variable.

  digitalWrite(13, HIGH);  // turn on LED
  // On most Arduino platforms this pin is used as an indicator light.

  //////////////////////////
  /* Begin Write Sequence */
  //////////////////////////

  Wire.beginTransmission(co2Addr);
  Wire.write(0x22);
  Wire.write(0x00);
  Wire.write(0x08);
  Wire.write(0x2A);

  Wire.endTransmission();

  /////////////////////////
  /* End Write Sequence. */
  /////////////////////////

  /*
    We wait 10ms for the sensor to process our command.
    The sensors's primary duties are to accurately
    measure CO2 values. Waiting 10ms will ensure the
    data is properly written to RAM

  */

  delay(10);

  /////////////////////////
  /* Begin Read Sequence */
  /////////////////////////

  /*
    Since we requested 2 bytes from the sensor we must
    read in 4 bytes. This includes the payload, checksum,
    and command status byte.

  */

  Wire.requestFrom(co2Addr, 4);

  byte i = 0;
  byte buffer[4] = {0, 0, 0, 0};

  /*
    Wire.available() is not nessessary. Implementation is obscure but we leave
    it in here for portability and to future proof our code
  */
  while (Wire.available())
  {
    buffer[i] = Wire.read();
    i++;
  }

  ///////////////////////
  /* End Read Sequence */
  ///////////////////////

  /*
    Using some bitwise manipulation we will shift our buffer
    into an integer for general consumption
  */

  co2_value = 0;
  co2_value |= buffer[1] &amp; 0xFF;
  co2_value = co2_value &lt;&lt; 8;
  co2_value |= buffer[2] &amp; 0xFF;


  byte sum = 0; //Checksum Byte
  sum = buffer[0] + buffer[1] + buffer[2]; //Byte addition utilizes overflow

  if (sum == buffer[3])
  {
    // Success!
    digitalWrite(13, LOW);
    return co2_value;
  }
  else
  {
    // Failure!
    /*
      Checksum failure can be due to a number of factors,
      fuzzy electrons, sensor busy, etc.
    */

    digitalWrite(13, LOW);
    return 0;
  }
}
void loop() {

  int co2Value = readCO2();
  if (co2Value &gt; 0)
  {
    Serial.print(&quot;CO2 Value: &quot;);
    Serial.println(co2Value);
  }
  else
  {
    Serial.println(&quot;Checksum failed / Communication failure&quot;);
  }
  delay(2000);
}
</code></pre>
<h3>CO2 Motherboard Update NOV 14 2020</h3>
<p>'Final' REV_A version (ordered on JLCPCB on 14 NOV) is here:</p>
<p><a href="/img/co2/co2_reva_schematic.png"><img src="/img/co2/co2_reva_schematic.png" alt=""></a></p>
<p><a href="/img/co2/co2_reva_3drender.png"><img src="/img/co2/co2_reva_3drender.png" alt=""></a></p>
<p>Repo for REV_A schematic and board file is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/atkins">here</a>.</p>
<hr>
<p>2020 NOV 16</p>
<h3><a name="jimenez"></a>Research paper on CO2 and COVID safety by Peng et al</h3>
<p>Really nice research paper by Peng and Jimenez that yields CO2 thresholds for indoor activity, with thresholds based on activity / mask use / etc -- linked <a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf"><img src="/img/co2/jimenez_abstract.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Abstract from <a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf">Peng and Jimenez 2020</a>.</td>
</tr>
</tbody>
</table>
<p>This is the key figure (Fig 2) to understand from the paper:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/peng_fig2.png"><img src="/img/co2/peng_fig2_small.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Figure 2. from <a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf">Peng and Jimenez 2020</a>.</td>
</tr>
</tbody>
</table>
<p>An online aersol transmission calculator based on the paper is <a href="https://docs.google.com/spreadsheets/d/16K1OQkLD4BjgBdO8ePj6ytf-RpPMlJ6aXFg3PrIQBbQ/edit#gid=519189277">here</a>.</p>
<p>The tweet broadcasting the tool is <a href="https://twitter.com/jljcolorado/status/1275466006312304640">here</a>.</p>
<p>The lead author on the paper, an expert on aerosol transmission, is <a href="https://twitter.com/jljcolorado">here</a>.</p>
<p>Some of the feedback on the paper &amp; tool was from Linsey Marr, the NYTimes-quoted air expert on COVID transmission.  Her Twitter profile is <a href="https://twitter.com/linseymarr">here</a>.</p>
<p>TODO:</p>
<p>Need to add buttons!!  For calibration, and other navigation.</p>
<p>Sensiron SCD30 <a href="https://www.amazon.co.uk/X-SCD30-Air-Quality-Sensors/dp/B07WRJD4TN/ref=sr_1_2?dchild=1&amp;keywords=scd30&amp;qid=1605562830&amp;sr=8-2">available on Amazon UK</a></p>
<p>NRF52 + LoRa wing setup --</p>
<ul>
<li>B / 11 -- RST</li>
<li>D / 30 -- CS</li>
<li>E / 27 -- IRQ</li>
</ul>
<p><a href="/img/co2/nrf52_pinout.jpg"><img src="/img/co2/nrf52_pinout.jpg" alt=""></a></p>
<h3>Button</h3>
<p><img src="/img/valedalama/kicad_button.png" alt=""></p>
<p><img src="/img/valedalama/button_wiring.png" alt=""></p>
<p><img src="/img/co2/sparkfun_pushbutton.png" alt=""></p>
<hr>
<p>2020 NOV 17</p>
<h3>REV_B -- Based on Feather, adds buttons</h3>
<p>REVB board 3D rendering:</p>
<p><img src="/img/co2/co2_revb_3drender.png" alt=""></p>
<p>REV_B KiCAD design files are <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/atkins">here</a>.</p>
<hr>
<p>2020 NOV 18</p>
<p>Heltec version of CO2 board ... 'REV_C' ...</p>
<p><a href="/img/valedalama/heltec_pinout.png"><img src="/img/valedalama/heltec_pinout.png" alt=""></a></p>
<p>Aside -- interesting 'hiveyes' project using the Heltec, might have interesting code associated with it, <a href="https://community.hiveeyes.org/t/heltec-wifi-lora-32/3125">here</a>.  Nice collection of github code <a href="https://github.com/hiveeyes">here</a>, including weight scales!</p>
<p>Interesting radio protocol <a href="https://github.com/hiveeyes/beradio">here</a>.</p>
<p>Radio protocols -- another way in which efficiency might be in tradeoff with legibility.</p>
<h3>REV_C of board -- based on Heltec</h3>
<p><a href="/img/co2/co2_revc_3drender.png"><img src="/img/co2/co2_revc_3drender.png" alt=""></a></p>
<p>Kicad design files are <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/atkins">here</a>.</p>
<p>Thread <a href="https://www.thethingsnetwork.org/forum/t/big-esp32-sx127x-topic-part-1/10247/43">here</a> on the battery connector type for the Heltec -- &quot;Micro JST 1.25 mm&quot;.</p>
<h3>CO2 Calibration via Gas Cylinder</h3>
<p>Example of 1000 ppm cylinder <a href="http://www.calgasdirect.com/gasco-17l-37-1000-carbon-dioxide-calibration-gas-co2-1000-ppm-balance-air-in-a-17-liter-steel-disposable-cylinder/">here</a></p>
<h3>Aranet: Bluetooth E-Ink CO2 Sensor</h3>
<p>Product <a href="https://www.amazon.com/Aranet4-Home-Temperature-Ink-Configuration/dp/B07YY7BH2W/ref=cm_cr_arp_d_product_top?ie=UTF8">here</a></p>
<p>Manual <a href="https://images-na.ssl-images-amazon.com/images/I/A1ubqWpxeiL.pdf">here</a></p>
<h3>Moteino M0</h3>
<p>Product page <a href="https://lowpowerlab.com/shop/product/184">here</a></p>
<p>Product guide <a href="https://lowpowerlab.com/guide/moteino/moteinom0/">here</a></p>
<h3>IQAir monitor</h3>
<p>Link on Amazon <a href="https://www.amazon.com/dp/B0784TZFRW/ref=syn_sp_syn_da_desktop_2?psc=1&amp;tag=dradisplay-20&amp;ascsubtag=addfab9c56bb6f407e973154a0adf08a_CT&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEzVFJTSjBDMkJHQlFVJmVuY3J5cHRlZElkPUEwNDIxNTc0Mlc2M1A3VlZHOE05MSZlbmNyeXB0ZWRBZElkPUEwNDA5ODE3MzExTVdEQUZIMjFXWCZ3aWRnZXROYW1lPXNwX3N5bl9kYV9kZXNrdG9wJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==">here</a>.</p>
<h3>GZair monitor for CO2</h3>
<p>Link on Amazon <a href="https://www.amazon.com/dp/B0861777SL/ref=syn_sd_onsite_desktop_96?psc=1&amp;uh_it=831b79d927acc84ecbf32f6df054d07c_CT&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEzVTRMWFREU1pUUzY2JmVuY3J5cHRlZElkPUEwODkxNTcyMzZCWFc3OFZISDdWJmVuY3J5cHRlZEFkSWQ9QTAwNTk2NzcyUVJRR0NaVU80M09ZJndpZGdldE5hbWU9c2Rfb25zaXRlX2Rlc2t0b3AmYWN0aW9uPWNsaWNrUmVkaXJlY3QmZG9Ob3RMb2dDbGljaz10cnVl">here</a>.</p>
<hr>
<p>2020 NOV 23</p>
<h3><a name="rev_a_build"></a>Carbon Dioxide Board Rev_A</h3>
<p>REV_A Boards have arrived in the mail.  Assembly and initial code tests!</p>
<p>Sparkfun SCD30 i2c library is <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">here</a>.</p>
<p>First version with display, lora, screen, scd30 is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/firmware/feather_m0_scd30_batt_lora_display">here</a>.</p>
<p><img src="/img/co2/rev_a_proto.jpeg" alt=""></p>
<p>Associated gateway code is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/firmware/gateway/heltec_wifi_lora_bayou_farmos">here</a>.</p>
<p>Online data is currently posting <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/rev_a_data.png"><img src="/img/co2/rev_a_data.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Quick indoor test of REV_A board.</td>
</tr>
</tbody>
</table>
<p>Also took sensor outside for a few minutes.  It fluctuated a lot.  Seems like we're going to want to average readings over a minute or or more to get some stable value when the CO2 is low.  Might have been due to wind. Might need to suggest that people get out of wind if they calibrate outside.  Or, to tell folks to wait til the reading stabilizes before hitting calibrate.  Or even have this happen automatically.</p>
<h3>TODO</h3>
<ul>
<li>Add watchdog to remote node and to gateway</li>
<li>Add calibration procedure</li>
<li>switch to set measurement interval?</li>
<li>dip switch to set node ID</li>
</ul>
<hr>
<p>2020 NOV 24</p>
<p><strong>Results of overnight test on NOV 23.</strong>  Out of three people in apartment, two went to bed at around 8 PM, the final person at around 10:30 PM.  One person (me) woke up and started using computer right next to CO2 sensor at 4:30 AM. Collecting data in <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">this Bayou feed</a>, generated these graphs as of 4:30 AM:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_nov23_night.png"><img src="/img/co2/co2_nov23_night.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CO2 concentration in PPM, 2020 NOV 23 overnight.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/temp_nov23_night.png"><img src="/img/co2/temp_nov23_night.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Temperature in C, 2020 NOV 23 overnight.</td>
</tr>
</tbody>
</table>
<p><strong>Comment</strong>. Note the correlation between temperature and CO2, with co-occurring peaks around 12 AM and 1:30 AM. The temperature pattern likely due to the HVAC system.  (The spike in CO2 and temperature at 4:30 AM are likely simply due to my presence near the sensor.) Unless the HVAC is in fact bringing in air with higher concentration of CO2, perhaps this indicates the range of fluctuation in CO2 reading due to temperature.  Do we expect CO2 to rise with temperature for this NDIR sensor type?</p>
<p>Found nice reference for effect of temperature and pressure on CO2, <a href="https://www.bapihvac.com/application_note/effects-of-temperature-and-barometric-pressure-on-co2-sensors-application-note/">here</a>.</p>
<p>Key passage:</p>
<blockquote>
<p>The size of the NDIR sampling chamber is fixed and is open to the atmosphere so that air can move in and out.  As explained above, the number of air molecules in a given volume is affected by temperature and air pressure but not the concentration of CO2.  At low pressures or high temperatures, there will be fewer air molecules in the sample chamber, so there will also be fewer CO2 molecules, even though the ppm of CO2 hasn’t changed.  Fewer CO2 molecules “fools” the sensor into thinking that the CO2 concentration is lower than it really is.  At high pressures or low temperatures, there are more air molecules in the sample chamber and more CO2 molecules, even though the CO2 concentration hasn’t changed.  More CO2 molecules “fools” the sensor into thinking that the CO2 concentration is higher than it really is. Therefore a CO2 sensor calibration will only be accurate at one temperature and one air pressure.</p>
</blockquote>
<p>This would suggest:</p>
<ul>
<li>higher pressures &amp; lower pressures--&gt; more air (and thus more CO2) molecules in the chamber --&gt; higher CO2 readings</li>
<li>lower pressures &amp; higher temperatures --&gt; less air (and thus less CO2) molecules in chamber --&gt; lower CO2 readings</li>
</ul>
<p>This fluctuation is due to pressure inside the apartment, when the HVAC system turns on?  Now worth attempting to compensate with external pressure sensor.</p>
<p><strong>Addendum</strong>.  I've now replaced the above graphs so that we can see the readings from 0430 to 0530, during which time I sat close to sensor.  Note that the temperature rose less than during some of the nightly spikes, but CO2 rose more, as one might expect given my proximity to the sensor. This perhaps leads to more confidence in the temperature-compensation of the SCD30.</p>
<p><a name="calibration"></a></p>
<p><strong>Thoughts on calibration, and baselines.</strong>  The key metric in the 2020 paper by <a href="#jimenez">Peng et al</a> is 'PPM above baseline'.  So, perhaps absolute calibration isn't really an important metric, here; more useful and interesting might be to establish a 'baseline', algorithmically; display it graphically; and allow the user to adjust based on their interpretation.</p>
<p>Key passage from page one of <a href="#jimenez">Peng et al</a>:</p>
<blockquote>
<p>Indoor CO2 has been suggested as a practical proxy of respiratory infectious disease transmission
risk (8), as pathogen-containing aerosols and CO2 are co-exhaled by those infected (Fig. 1).
Since background (ambient) CO2 level is stable and indoor excess CO2 is usually only from
human exhalation, measurements of indoor CO2 concentration by low-cost CO2 sensors can
often be good indicators of infection risk and suitable for mass deployment (9, 10).</p>
</blockquote>
<h3>Use of microphones to detect ambient activity</h3>
<ul>
<li>Electret MAX4466 (manual gain) listed on Adafruit, <a href="https://www.adafruit.com/product/1063">here</a>. Note that it's also widely avail on <a href="https://www.amazon.com/dp/B08CV2X658/ref=sspa_dk_detail_1?psc=1&amp;pd_rd_i=B08CV2X658&amp;pd_rd_w=e4Wqd&amp;pf_rd_p=7d37a48b-2b1a-4373-8c1a-bdcc5da66be9&amp;pd_rd_wg=jK4OK&amp;pf_rd_r=0WTC7Z5H34N5NVXD75YE&amp;pd_rd_r=e8a78340-09f3-4f09-a9fe-63e5a2dae57b&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyTE85RlYxVU5SWkRZJmVuY3J5cHRlZElkPUEwNjE5ODUyMlE5MEhGNUFEMzlDWSZlbmNyeXB0ZWRBZElkPUEwMzEwMzMxMUxTNEZUR1k2NTJCVCZ3aWRnZXROYW1lPXNwX2RldGFpbCZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">Amazon</a></li>
<li>Electret MAX9814 (auto gain) listed on Adafruit, <a href="https://www.adafruit.com/product/1713">here</a>.</li>
<li>Adafruit Silicon MEMS Microphone Breakout - SPW2430, <a href="https://www.adafruit.com/product/2716">here</a></li>
</ul>
<p>Nice <a href="https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/overview">tutorial</a> on measuring sound levels using the MAX4466.  This might be the way to go if we're going to use ambient audio data to determine in-room activity.</p>
<p>Tutorial on using the <a href="https://learn.adafruit.com/adafruit-agc-electret-microphone-amplifier-max9814">auto-gain</a> mic, which might be even better ...</p>
<blockquote>
<p>This fancy microphone amplifier module is a step above the rest, with built in automatic gain control. The AGC in the amplifier means that nearby 'loud' sounds will be quieted so they don't overwhelm &amp; 'clip' the amplifier, and even quiet, far-away sounds will be amplified. This amplifier is great for when you want to record or detect audio in a setting where levels change and you don't want to have to tweak the amplifier gain all the time.</p>
</blockquote>
<p><strong>Design.</strong>  Using a simple, auto-amplified microphone in this context seems useful.  The raw data can be presented online, and used in an attempt to discern baseline thresholds.  No algorithm needs to be applied at first; or, the user community can supply the algorithm.</p>
<p>This leads to an instrument in the following <strong>Designer PCB</strong> configuration:</p>
<ul>
<li>ESP32 ($3)</li>
<li>USB chip ($2)</li>
<li>Lithium ion charging ($1)</li>
<li>OLED display (larger if possible) ($3)</li>
<li>microphone (MAX9814 with switch to turn power off) ($2) -- MAX9814 datasheet is <a href="https://www.mouser.com/datasheet/2/256/MAX9814-1516143.pdf">here</a>; chip is listed <a href="https://www.mouser.com/ProductDetail/Maxim-Integrated/MAX9814ETD%2BT?qs=1THa7WoU59HUZGorIAH%2Frw%3D%3D&amp;gclid=CjwKCAiA-_L9BRBQEiwA-bm5fu4Xw3jLMp2pgE2Dl_CsuoqKs4_FdG-qEZDOrhAV2GQXbrhy5HwSVRoCcXMQAvD_BwE">here</a>.</li>
<li>SCD30 ($50)</li>
<li>BMP388 or 390 ($5)</li>
<li>a button or two ($2)</li>
<li>PCB ($4)</li>
</ul>
<p>Total: $72</p>
<p>This can also be accomplished by a more <strong>DIY Version</strong>:</p>
<ul>
<li>ESP32 + OLED + USB (Heltec) ($20)</li>
<li>microphone (adafruit MAX9814) ($8)</li>
<li>SCD30 ($50)</li>
<li>pressure sensor (adafruit BMP388) ($10)</li>
<li>PCB ($10)</li>
</ul>
<p>Total: $98</p>
<p>Likely best to produce this latter version immediately, and then take time, if available, to make the inexpensive version.</p>
<p><strong>Philosophy.</strong></p>
<p>This is an open hardware project in the realm of home-based IOT; a highly-contested area around privacy.  In this case, for example, a microphone levels can probably serve a useful proxy for indoor occupancy status. Usually, this would lead to anxieties about privacy.  But because we can produce this device in an open hardware manner, we can avoid an entire class of such concerns.  (Not all such concerns:  there's still the possibility that other surveillance software made it onto the device).</p>
<p>By making this a FOSS/H project, we allow more eyes onto the design to evaluate.</p>
<p>Switch on microphone.</p>
<p>Ability to deploy mic without CO2, if just want to monitor activity levels in an area.</p>
<p>Ability to deploy CO2 without mic, in order to secure privacy.</p>
<h3>MAX9814 Adafruit module</h3>
<p>Listing for product is <a href="https://www.adafruit.com/product/1713">here</a>.</p>
<p>Schematic is <a href="https://cdn-learn.adafruit.com/assets/assets/000/014/290/large1024/adafruit_products_max9814sch.gif?1448049933">here</a>.</p>
<h3>Note on confounding factors</h3>
<p>From page 2 of Peng 2020:</p>
<blockquote>
<p>If there are no other significant CO2 sources/sinks (e.g., gas/coal stove and pets/plants), i.e., if
indoor excess CO2 (relative to the background outdoor level) production is only due to human
exhalation and its loss is ventilation, similar quantities for CO2 can be expressed as follows (see
Materials and Methods for the derivation)</p>
</blockquote>
<p>Gas stove or pets can be a source; plants can be a sink.</p>
<p>Indeed, looks like I may have seen this effect using a propane stove on Nov 24 2020, as per experiment above.</p>
<hr>
<p>24 NOV 2020 Update @ 14:30</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/nov_24_left_house.png"><img src="/img/co2/nov_24_left_house.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CO2 (PPM).  Note: made lunch around noon on Nov 24 (gas stove).  Left house around 12:30 / 12:45 on Nov 24.</td>
</tr>
</tbody>
</table>
<h3>Microphone pinouts</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/max9814.jpg"><img src="/img/co2/max9814.jpg" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MAX9814 Auto-gain audio board from Adafruit.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/max4466.jpg"><img src="/img/co2/max4466.jpg" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MAX4466 adjustible audio board from Adafruit.</td>
</tr>
</tbody>
</table>
<p>2020 NOV 24 Update 22:10</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_nov24_full.png"><img src="/img/co2/co2_nov24_full.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Arrived back home at 5:30 PM Nov 24th. Interesting that the ambient CO2 decreased in our absence to a value lower than overnight in the apartment with us sleeping there.</td>
</tr>
</tbody>
</table>
<hr>
<p><a name="nov25"></a></p>
<p>2020 NOV 25</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/nov25_over.png"><img src="/img/co2/nov25_over.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>CO2 (PPM) measured on Nov 245th through morning of Nov 25th.</strong>  Spikes on Nov 24th at 7:30 AM, 10:30 AM, 12 PM, and on Nov 25th at 8 AM, are perhaps due to use of propane stove for cooking.  Apartment was unoccupied on Nov 24th from about 12:30 PM until 5:30 PM.</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-11-27 17:20:40</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_nov26_nov27.png"><img src="/img/co2/co2_nov26_nov27.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Snapshot from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong>  Left house around 9 AM on Nov 26th.  Visitors likely in house, late morning of Nov 27th. Returned home a little before 5 PM, and started using gas stove.</td>
</tr>
</tbody>
</table>
<h3>Light sensors</h3>
<p>Vishay light sensor <a href="https://www.adafruit.com/product/4162">here</a>.</p>
<p>Simple, cheap analog light sensor breakout <a href="https://www.adafruit.com/product/2748">here</a>.</p>
<p>BH1750 <a href="https://www.adafruit.com/product/4681">here</a>,seemed to be recommended for ambient light sensing ... but difficult to solder.  Note though that this seems widely available on Amazon as breakout boards.  <a href="https://makersportal.com/shop/ambient-light-sensor-bh1750-16-bit">This description</a> also indicates that it's a good candidate for this application; and in fact, the leads don't look too small.</p>
<h3>Microphones</h3>
<p>MEMS mic from Adafruit, the <a href="https://www.adafruit.com/product/2716?gclid=CjwKCAiA5IL-BRAzEiwA0lcWYmVgg-sFYvw2DV5d3ki49VliOATt6F7_MmGSpVRBbz_hWldCvHzw-BoCmDgQAvD_BwE">SPW2430</a></p>
<p>Looks like: use the electret verison for the DIY solderable verison; use the SPW2430 or similar for custom PCB.</p>
<p><a href="https://www.amazon.com/dp/B08CV2X658/ref=sspa_dk_detail_1?psc=1&amp;pd_rd_i=B08CV2X658&amp;pd_rd_w=e4Wqd&amp;pf_rd_p=7d37a48b-2b1a-4373-8c1a-bdcc5da66be9&amp;pd_rd_wg=jK4OK&amp;pf_rd_r=0WTC7Z5H34N5NVXD75YE&amp;pd_rd_r=e8a78340-09f3-4f09-a9fe-63e5a2dae57b&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyTE85RlYxVU5SWkRZJmVuY3J5cHRlZElkPUEwNjE5ODUyMlE5MEhGNUFEMzlDWSZlbmNyeXB0ZWRBZElkPUEwMzEwMzMxMUxTNEZUR1k2NTJCVCZ3aWRnZXROYW1lPXNwX2RldGFpbCZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">MAX4466 from Amazon</a>:</p>
<p><img src="/img/co2/max4466_amazon.png" alt=""></p>
<p>Nice <a href="https://www.cuidevices.com/blog/comparing-mems-and-electret-condenser-microphones">post</a> on comparing MEMS and Electret microphones.</p>
<p>Tutorial on measuring sound levels with the MAX4466 by Adafruit <a href="https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/measuring-sound-levels">here</a>.</p>
<h3>Design Review</h3>
<p>2020-11-27 20:18:07</p>
<p>Microphones:</p>
<ul>
<li>for DIY version: use electret, b/c cheap and widely available. Also use SPW2430 breakout from Adafruit.</li>
<li>for artisanal verison: use SPW2430.</li>
</ul>
<p>Light sensors:</p>
<ul>
<li>for both DIY and artisanal versions, use BH1750 boards / chips.</li>
</ul>
<h3>REV_B + MAX4466 Experiment</h3>
<p><img src="/img/co2/rev_b.jpg" alt=""></p>
<p><img src="/img/co2/co2_and_mic.jpg" alt=""></p>
<p>REV_B appears to work!</p>
<p>Now testing microphone ...</p>
<p>Connecting analog out of mic to A0 on REV_B (one of the button pins) ...</p>
<p>Running overnight on Nov 27th with mic sampling of 10 sec ...</p>
<p>Test code is [here](</p>
<p>Data will appear <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">here</a>.</p>
<hr>
<p>2020-11-28 04:22:39</p>
<p>My impression is that this mic will require additional signal conditioning to pick up ambient noise; perhaps this can be done with an op-amp and a potentiometer that allows experimentation; or maybe a light sensor is the best next step.  Or maybe auto-gain is best, the idea being that it will attempt to acquire <em>any</em> signal.  That said, I'd think that 'max gain' on this system would do the trick, if that would work.  All depends on the circuit and the mic.</p>
<p><a href="https://cdn-shop.adafruit.com/datasheets/MAX4465-MAX4469.pdf">MAX4466 Datasheet</a>.</p>
<p>Data from the Bayou feed, overnight Nov 27th -- Nov 28th in CSV format has a snapshot <a href="https://docs.google.com/spreadsheets/d/11WYxWyIDqpz9qTyOSo6GRbPs4L-iIx42mY1tSCSNI58/edit?usp=sharing">here</a>. This analysis is necessary because the current graphical display in Bayou is configured to who only every 10th data point;  we'd like to see the higher-density data.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mic_morning_nov28.png"><img src="/img/co2/mic_morning_nov28.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Snapshot of mic data from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong>  Woke up at 5 AM.  Note that pattern of sampling shown is a bit odd.  Need to dive back in an look at how data is captured and how it should be averaged.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mic_sampled_nov28_unix.png"><img src="/img/co2/mic_sampled_nov28_unix.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Higher sampling rate of mic data from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong>   Working to convert this to proper dates (see below) ...</td>
</tr>
</tbody>
</table>
<h3>Aside: converting unix timestamps in Sheets</h3>
<p>Formula for converting unix timestamp to date in Excel / Sheets is discussed <a href="https://websiteseochecker.com/blog/what-is-timestamp/">here</a>;  if the timestamp is in cell 'A1', the formula for the date is:</p>
<pre><code>=(((A1/60)/60/24)+DATE(1970,1,1)
</code></pre>
<h2><a name="mic_experiment"></a> Analysis of Initial CO2 and Microphone Data</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mic_and_co2_unix_hours.png"><img src="/img/co2/mic_and_co2_unix_hours.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>CO2 and Mic data from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong> Microphone data is &quot;highest p-p amplitude over 10 sec interval&quot;.  Note -- entered room with sensor around 4:30 AM.  Generally mic data seems to precipitate rise in CO2 level.  At some point gas stove was used;  from this data, I would surmise around 6:40 AM, but unsure. Need to track this next round.</td>
</tr>
</tbody>
</table>
<h3>Enclosure options</h3>
<p>115 x 90 x 55mm for $10 w/ transparent screw cover <a href="ZW5jcnlwdGVkUXVhbGlmaWVyPUEyNlY3TlNQTks4WTY0JmVuY3J5cHRlZElkPUEwMTcyOTc0M1A5OTBMNE1DV0E4SyZlbmNyeXB0ZWRBZElkPUEwNTEwMzQ1SkY1MDYwQ0ZMQzBBJndpZGdldE5hbWU9c3BfZGV0YWlsMiZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU">here</a>.</p>
<p>Popular 200 x120 x56 mm for $15 w/ transparent screw cover <a href="https://www.amazon.com/LeMotech-Dustproof-Waterproof-Electrical-Enclosure/dp/B07BPPJZBG/ref=pd_sbs_60_1/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07BPPJZBG&amp;pd_rd_r=86924a94-2620-4e15-91d7-f9a01104fb4f&amp;pd_rd_w=VUfCX&amp;pd_rd_wg=tdXB2&amp;pf_rd_p=ed1e2146-ecfe-435e-b3b5-d79fa072fd58&amp;pf_rd_r=M5FYKR285RHNS1H54ZFB&amp;psc=1&amp;refRID=M5FYKR285RHNS1H54ZFB">here</a></p>
<p>5.9 x 3.9 x 2.8inch w latching cover <a href="https://www.amazon.com/LMioEtool-Dustproof-Waterproof-Electrical-Transparent/dp/B07PK8K8S2/ref=pd_lpo_60_t_2/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07PK8K8S2&amp;pd_rd_r=105ea24a-0322-41f7-8b9f-6d5b31591072&amp;pd_rd_w=xO7n2&amp;pd_rd_wg=5A7XY&amp;pf_rd_p=7b36d496-f366-4631-94d3-61b87b52511b&amp;pf_rd_r=M5FYKR285RHNS1H54ZFB&amp;psc=1&amp;refRID=M5FYKR285RHNS1H54ZFB">here</a></p>
<p>Would be nice to have 'wings' for mounting ...</p>
<p>This one has wings, <a href="https://www.amazon.com/YXQ-83x58x33mm-Junction-Waterproof-Enclosure/dp/B07JH8LNHY/ref=pd_sbs_60_4/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07JH8LNHY&amp;pd_rd_r=86924a94-2620-4e15-91d7-f9a01104fb4f&amp;pd_rd_w=VUfCX&amp;pd_rd_wg=tdXB2&amp;pf_rd_p=ed1e2146-ecfe-435e-b3b5-d79fa072fd58&amp;pf_rd_r=M5FYKR285RHNS1H54ZFB&amp;psc=1&amp;refRID=M5FYKR285RHNS1H54ZFB">here</a>.</p>
<p>In fact, seems to be part of a pretty standard and well-rated series, <a href="https://www.amazon.com/Awclub-Junction-Dustproof-Weatherproof-Electrical/dp/B07NSTW7QB/ref=pd_di_sccai_4/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07NSTW7QB&amp;pd_rd_r=a2c81e3d-386a-43ae-a847-00ab2f985575&amp;pd_rd_w=WY4y1&amp;pd_rd_wg=V0jWO&amp;pf_rd_p=c9443270-b914-4430-a90b-72e3e7e784e0&amp;pf_rd_r=HE1G91ZWD43Y8H33FZJ3&amp;psc=1&amp;refRID=HE1G91ZWD43Y8H33FZJ3">here</a></p>
<p>In particular, the <a href="https://www.amazon.com/Awclub-Junction-Dustproof-Weatherproof-Electrical/dp/B07NSV7CSM/ref=pd_di_sccai_4/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07NSTW7QB&amp;pd_rd_r=a2c81e3d-386a-43ae-a847-00ab2f985575&amp;pd_rd_w=WY4y1&amp;pd_rd_wg=V0jWO&amp;pf_rd_p=c9443270-b914-4430-a90b-72e3e7e784e0&amp;pf_rd_r=HE1G91ZWD43Y8H33FZJ3&amp;refRID=HE1G91ZWD43Y8H33FZJ3&amp;th=1">4.5&quot;x3.3&quot;x1.4&quot;(115x85x35mm)</a> size looks good, for $10.  But: maybe too flat to drill holes for cables. And will require fairly large PCB.</p>
<p>From comments, the comparison is between Awclub and LeMotech on Amazon, favoring LeMotech for quality. Likely to find some analysis of sizes and design in hobby projects online (or better: datasheets) given how popular the brands are.</p>
<p>Plan: first assess how large the project will likely be by laying out some PCBs, and order an enclosure.</p>
<p>Review of best projecte enclosures <a href="https://diabeteshealthequity.org/arduino-project-enclosure/">here</a></p>
<p>Apparently the 'wings' I'm referring to are termed 'ears'.</p>
<p>E.g.: for the <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G58SLB1?th=1">4.5 x 3.5 x 2.68 inch(115 x 90 x 68 mm) 'ear' Lemotech version</a>, the  PCB is essentially 84 mm by 89 mm.</p>
<p>This might be a good case size to shoot for.  I think I can accommodate it. A larger PCB might be expensive, anyway.</p>
<p>Datasheet for this enclosure is <a href="https://images-na.ssl-images-amazon.com/images/I/61P4XQPyJyL.pdf">here</a>.</p>
<p>Need to accommodate a USB cable.</p>
<p>Alright: let's lay out a PCB for testing, and if it looks plausible, order one of these.</p>
<p>Note that the  6.2&quot;x3.5&quot;x1.8&quot; version of LeMotech has a nice drawing by a user. Also has same price as smallest version.</p>
<p>Suggestion to make panel mounting oneself.</p>
<p>This is in keeping with previous ideas.</p>
<p>From what I can tell online, the most effective &amp; inexpensive / adaptable approach to enclosures might be:</p>
<ul>
<li>design a PCB to be as small as possible, with mounting holes for standard screw sizes</li>
<li>find a nice inexpensive enclosure design</li>
<li>make a 'mounting plate' that fits snugly inside the enclosure, with mounting holes for one's PCB</li>
</ul>
<p>The reason given online for this is that the inexpensive enclosures are often made from 'recycled molds' that have poor tolerances.  So it really isn't a great idea to design a custom PCB for them.  Rather, lasercut inexpensive (ideally, drillable, as backup) mounting plates.</p>
<h3>Large, Flat LeMotech enclosure</h3>
<blockquote>
<p>Outside Size (approx.): 6.2&quot;x3.5&quot;x1.8&quot;(158mmx90mmx46mm)/(L<em>W</em>H); Inner size (approx.): 5.9&quot;x3.3&quot;x1.6&quot;(151mmx84mmx42mm)/(L<em>W</em>H)- - (Allowable Error: 2mm); Screw Thread Size: M4</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/larger_lemotech.png"><img src="/img/co2/larger_lemotech.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Lemotech enclosure, <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G4VT33D?th=1">6.2 x 3.5 x 1.8 inch (158 x 90 x 46 mm)</a>.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/larger_lemotech_drawing.png"><img src="/img/co2/larger_lemotech_drawing.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Customer-provided CAD drawings for Lemotech enclosure, <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G4VT33D?th=1">6.2 x 3.5 x 1.8 inch (158 x 90 x 46 mm)</a>.</td>
</tr>
</tbody>
</table>
<h3>Smallest LeMotech enclosure</h3>
<blockquote>
<p>Outside Size (approx.): 4.5&quot;x3.5&quot;x2.68&quot;/(115mmx90mmx68mm)(L<em>W</em>H); Inner size (approx.): 4.3&quot;x3.3&quot;x2.44&quot;/(111mmx86mmx62mm) (L<em>W</em>H)- -(Allowable Error: 2mm); Screw Thread Dia.: 4mm/0.16&quot;</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/smallest_lemotech.png"><img src="/img/co2/smallest_lemotech.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Lemotech enclosure, <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G58SLB1?th=1">4.5&quot;x3.5&quot;x2.68&quot;/(115mmx90mmx68mm)</a>.</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-11-28 15:37:00</p>
<p><strong>Overall framing / todos.</strong></p>
<ul>
<li>Donation-based server setup?  How difficult to arrange for logins?</li>
<li>How to display threshold guide information (if at all)</li>
<li>Wifi configuration setup</li>
<li>Firmware update configuration.  (Perhaps it's best to start with folks who are familiar with Arduino, so that they can help refine / test the workflow.)</li>
<li>Cheaper artisanal pcb version.  Likely based on ESP32.  using as many SMT parts as possible.</li>
<li>Laser-cut mount for electronics. Or something that can be cut out from stiff paper / etc.</li>
<li>Cardboard enclosure?</li>
<li>Partnering institutions who'd like to help evaluate and test. Peng et al are an initial candidate. Others?</li>
<li>Online documentation for assembly and use of kit.</li>
</ul>
<hr>
<p>2020-11-29 21:52:45</p>
<h3>Dashboards</h3>
<p><a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">Jupyter dashboard</a> via voila -- <a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">gallery of examples</a></p>
<p>gesis notebooks, <a href="https://notebooks.gesis.org/">here</a></p>
<p>guide to voila, <a href="https://analyticsindiamag.com/complete-guide-to-voila-to-turn-a-jupyter-notebook-into-a-standalone-web-application/">here</a></p>
<p>Dashboarding options in Jupyter discussed <a href="https://medium.com/informatics-lab/jupyter-dashboarding-some-thoughts-on-voila-panel-and-dash-b84df9c9482f">here</a></p>
<hr>
<p>2020-12-01 13:41:41</p>
<h3>REV_D -- ESP32 + RFM95 SMT Version</h3>
<ul>
<li>FTDI / USB-TTL cable req'd for first version</li>
<li>mimic pinout of the heltec wifi 32 lora v2</li>
<li>auto-reset feature from Quahog revision</li>
<li>leds for mic level?</li>
<li>mic</li>
<li>light sensor</li>
<li>oled display</li>
<li>ultrasonic distance sensor breakout? or time of flight / i2c breakout?</li>
<li>qwik connector for i2c breakout for additional sensors</li>
</ul>
<hr>
<p>2020-12-01 16:17:24</p>
<p>Continuing research for REV_D ...</p>
<h3>Quahog circuit (ESP32 + RFM95) ...</h3>
<p><a href="/img/hog32.pdf"><img src="/img/hog32.png" alt=""></a></p>
<p>Some changes that need to be made to the circuit:</p>
<ul>
<li>get rid of R4 and C4</li>
<li>place R1, C3, R2, R3, Q1, and Q2</li>
<li>need to connect pin 2 to ground (or it can float; but currently it is used in i2c, and is pulled high with a resistor, so we need to connect it to ground)</li>
<li>need to connect the 'DTR' pin on the CP2104 breakout to the DTR pin on the quahog</li>
</ul>
<h3>Heltec pinout (ESP32 + RFM95) ...</h3>
<p><a href="/img/co2/heltec_wifi_lora_v2_pinout.png"><img src="/img/co2/heltec_wifi_lora_v2_pinout.png" alt=""></a></p>
<h3>Heltec schematic</h3>
<p><a href="/img/co2/WIFI_LoRa_32_V2(868-915).PDF"><img src="/img/co2/heltec_schematic.png" alt=""></a></p>
<h3>Feather ESP32 Schematic</h3>
<p><a href="/img/co2/feather_esp32_schem.png"><img src="/img/co2/feather_esp32_schem.png" alt=""></a></p>
<h3>REV_C Notes</h3>
<p>Misjudged the header spaceings on the Heltec -- too far apart by one row!</p>
<h3>REV_D Notes</h3>
<p><a href="https://www.onsemi.com/pub/Collateral/MMBT2222LT1-D.PDF">MMBT2222 NPN Mosfet datasheet</a> -- it's 'BEC' -- 1: BASE, 2: EMITTER, 3: COLLECTOR</p>
<h3>BMP388 / 390</h3>
<p>Adafruit guide to BMP388 is <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx">here</a>.</p>
<p>Breakout schematic:</p>
<p><a href="/img/co2/sensors_BMP390_sch.png"><img src="/img/co2/sensors_BMP390_sch.png" alt=""></a></p>
<hr>
<p>2020-12-01 20:45:59</p>
<h3>REV_D Initial Pass</h3>
<p><img src="/img/co2/rev_d_3drender.png" alt=""></p>
<hr>
<p>2020-12-02 20:41:42</p>
<p>Upshot -- the SPW2430 mic is weak w/out an amplifier -- should check out tutorial for how to add it when doing SMT version ...</p>
<p>Meanwhile, light sensor BH1750 tutorial is <a href="https://learn.adafruit.com/adafruit-bh1750-ambient-light-sensor">here</a></p>
<p>Install hp_BH1750 library via Arduino IDE ...</p>
<p>firmware that adds the light sensor is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/remote/feather_m0_scd30_batt_lora_display_max4466_bh1750">here</a></p>
<p>Resultant data feed <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">here</a></p>
<h3>Adding an amplifier to the SPW2430</h3>
<p>For reference, Eagle CAD for max4466 is <a href="https://github.com/adafruit/Adafruit-MAX4466-Electret-Mic-Amplifier-PCBs">here</a> -- can likely use the amp setup they have ...</p>
<hr>
<p>2020-12-03 08:25:40</p>
<p>co2 sensor seems to have stopped last night? and reset on m0 didn't reset it -- needed to power cycle -- do we need a mosfet on it?</p>
<p>if we use esp32 for mic, do we need to worry about analog performance / drift?</p>
<p>Should SEL be floating to ground (or tied to ground) on SCD30? https://forum.sparkfun.com/viewtopic.php?t=48325</p>
<p>issue where bh1750 library hangs <a href="https://forum.mysensors.org/topic/9214/bh1750-library-hangs">here</a>.</p>
<p>tried co2 + bh1750 -- co2 freezes</p>
<p>can't reset, co2 still 'frozen'</p>
<p>changed firmware to remove bh1750, but kept bh1750 on board, co2 freezes</p>
<p>then removed wires of bh1750, no freezing yet</p>
<p>I wonder if it's an 'address' issue with the bh1750?  can check.  info on the module i'm using is <a href="https://www.amazon.com/SMAKN%C2%AE-BH1750-Digital-intensity-Arduino/dp/B014IP9V4I">here</a></p>
<p>BUT:  light sensor is of questionable use for now.  better perhaps to have breakout for i2c.</p>
<p>real next steps:</p>
<ul>
<li>check esp32 feather functionality on rev_b breakout board</li>
<li>pull in bmp388 parameters [X]</li>
<li>how to incorprate the max4466 electret, or add amplification to the smt mic module? (the 'sw something')?</li>
</ul>
<p>Seems like the max4466 board avail on amazon (<a href="https://www.amazon.com/uxcell-Electret-Microphone-Amplifier-Adjustable/dp/B07W3HV92Z/ref=sr_1_10?dchild=1&amp;keywords=max4466&amp;qid=1607006487&amp;s=industrial&amp;sr=1-10">here</a>) is fairly identical to that sold by Adafruit. wonder if the op-amp is similarly set up.</p>
<p>So, design:</p>
<ul>
<li>esp32</li>
<li>oled</li>
<li>bmp388</li>
<li>scd30</li>
<li>mic (electret or smt)</li>
<li>buttons</li>
<li>leds to show mic level? or just: remove board</li>
<li>breakouts for avail pins</li>
<li>qwiic breakout</li>
</ul>
<p>i like how explicit the mic on the co2 sensor is ...
and it's an analog reading -- if it's removed, just get 'zero' for analog measurement.</p>
<p>that might be the place to start. simplify the design. part is avail on amazon, alternative to adafruit.</p>
<p>don't even need a switch -- just remove the part.</p>
<p>Nice feature:  basic board that can be produced with SMT parts; then, add adafruit boards for pressure and/or mic as one likes.</p>
<h3>Adding BMP388 functionality to REV_B</h3>
<p>Tutorial on Adafruit <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx/arduino">here</a>.</p>
<p>Actually, confusing way to do the i2c / spi ... not sure how to hook up to Feather's i2c ...</p>
<p>Shifting to Sparkfun library <a href="https://www.sparkfun.com/products/17001">here</a> ....</p>
<p>which leads to the library <a href="https://github.com/MartinL1/BMP388_DEV">here</a></p>
<p>Nice feature:  allows for use with ESP32, has special code for that ... (maybe just picks particular pins?)</p>
<hr>
<p>2020-12-03 10:10:13</p>
<p>Looks like BMP388 code is working (using the lib from MartinL1, 'BMP388_DEV', <a href="https://github.com/MartinL1/BMP388_DEV">here</a>).</p>
<p>Also: having the device on a Feather LoRa, using a gateway, is a nice system -- can deploy several all over a building, or across a campus, even if no wifi available.</p>
<p>University systems have issues using wifi.  This way, can use where there is wifi.  Also: get <em>one</em> device registered on wifi network, rather than several.  (Typically, for IT on campus, would need to register every one).</p>
<p>Also note:  might be useful to have a PC with a heltec and a python script. That way the PC can be registered on the network, the heltec can be placed at a height.</p>
<p>Also: might be good to have a microsd on the heltec.</p>
<p>Need to test soon in a university / high school class setting.</p>
<p>Can we get serial input to a chromebook this way?</p>
<hr>
<p>2020-12-03 15:58:47</p>
<p>Features to add:</p>
<ul>
<li>DIP switch to identify the remote node, if feather lora based</li>
<li>access point signup w/ node id entry</li>
</ul>
<p>Another reason to do esp32 + rfm95 is to allow for access point configuration of device</p>
<hr>
<p>2020-12-04 22:21:45</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_mic_dec4_2020.png"><img src="/img/co2/co2_mic_dec4_2020.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Red is mic data, blue is CO2.  Spreadsheet is <a href="https://docs.google.com/spreadsheets/d/1y74CIL4FuVBikPx3nCTVWIgqVZ9oZfcVcnaa1pv78OU/edit?usp=sharing">here</a>, based on feed <a href="http://159.65.226.222:3000/api/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de/csv?limit=40000">here</a> (pulled on eve of Dec 4).</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-12-06 09:54:24</p>
<h3>Feather ESP32 remote wifi sensor (&quot;REV_B&quot;)</h3>
<p>All systems go!</p>
<p><img src="/img/co2/feather_esp32_data_test.png" alt=""></p>
<p><img src="/img/co2/feather_esp32_test.jpeg" alt=""></p>
<p>Feather ESP32 scd30 code for &quot;rev_b&quot; is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/wifi_sensor/feather_esp32_wifi_bayou_scd30_display">here</a></p>
<h3>Heltec ESP32 + LoRa remote wifi sensor (&quot;REV_C&quot;)</h3>
<p>SSD1306 with the u8x8 library tutorial <a href="https://tronixstuff.com/2019/08/29/ssd1306-arduino-tutorial/">here</a></p>
<p>List of u8x8 fonts <a href="https://github.com/olikraus/u8g2/wiki/fntlist8x8">here</a></p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/firmware/wifi_sensor/heltec_wifi_bayou_scd30_display_bmp388">Arduino code for heltec-based &quot;rev_c&quot; with bmp388 is here</a></p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/firmware/wifi_sensor/heltec_wifi_bayou_scd30_display">without bmp388 is here</a></p>
<p><img src="/img/co2/co2_rev_c.jpeg" alt=""></p>
<h3>Max4466 on ESP32</h3>
<p><a href="https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/measuring-sound-levels">Adafruit tutorial</a> on Max4466</p>
<hr>
<p>2020-12-06 14:42:04</p>
<p>Fixed the microphone issue with the Feather ESP32 -- seems to be necessary to refer to A0 by its gpio number for feather esp32 -- i.e., &quot;26&quot; for A0.</p>
<p>Updated code for REV_B Feather ESP32 is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/wifi_sensor/feather_esp32_wifi_bayou_scd30_display">here</a></p>
<p>Posting data from REV_B with Feather esp32 ('wifi sensor' mode) <a href="http://159.65.226.222:3000/api/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74/csv">here</a>.</p>
<hr>
<p>2020-12-06 15:08:54</p>
<p>Parallel tests:</p>
<p>REV_C board (heltec) feed <a href="http://159.65.226.222:3000/drives/8b3f9d89866ac91fd748e2d89e8005f96e77e6cdeef10ffd033d74aeff1105ab">here</a></p>
<p>REV_B board (with Feather ESP32) feed <a href="http://159.65.226.222:3000/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74">here</a></p>
<hr>
<p>2020-12-06 19:05:45</p>
<p>Jupyter plotting csv file tutorial <a href="https://towardsdatascience.com/plotting-with-pandas-an-introduction-to-data-visualization-8bd7c0831650">here</a></p>
<p>Another nice guide <a href="https://www.geeksforgeeks.org/python-read-csv-using-pandas-read_csv/">here</a></p>
<p>plotting two data traces on the same graph:</p>
<pre><code>ax = df1.plot()
df2.plot(ax=ax)
</code></pre>
<hr>
<p>2020-12-06 20:02:10</p>
<h3><a name="compare_scd30"></a> Comparing two scd30 sensors</h3>
<p><strong>Procedure:</strong> Sensors were placed side-by-side.  No effort was made to calibrate manually.  They had been operating for only a few seconds before data was collected; so the automatic calibration algorithm (which begins at 7 days) had not been in operation.  Next attempt will involve manually calibrating both in same fresh air conditions, and looking at resulting behavior.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/co2/scd30_cross/compare_hardware.jpg" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Using two SCD30 sensors, side-by-side.  Left: &quot;REV_C&quot; board using Heltec 32 Wifi LoRa v2 as micro. Right: &quot;REV_B&quot; board using Feather ESP32 as micro.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_cross/compare.png"><img src="/img/co2/scd30_cross/compare.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Comparison of two side-by-side SCD30 CO2 sensors for a given time range.  Jupyter notebook used in the analysis is <a href="/img/co2/scd30_cross/compare.ipynb">here</a>.</td>
</tr>
</tbody>
</table>
<p>Tweet about aerosol transmission <a href="https://twitter.com/kprather88/status/1335738927156588547?s=20">here</a>.</p>
<h2>Aerosol / virus researchers</h2>
<ul>
<li><a href="https://twitter.com/Don_Milton">Don Milton</a></li>
<li><a href="https://twitter.com/kprather88">Kimberly Prather</a></li>
<li><a href="https://twitter.com/drdavidmichaels">David Michaels</a>; <a href="https://twitter.com/jksmith34/status/1333297370872819715?s=20">on Maddow</a></li>
<li><a href="https://twitter.com/linseymarr">Linsay Marr</a></li>
<li><a href="https://twitter.com/florian_krammer">Florian Krammer</a></li>
<li><a href="https://twitter.com/MackayIM">Ian Mackay</a></li>
<li><a href="https://twitter.com/j_g_allen">Joseph Allen</a> -- 'Health Buildings'</li>
<li><a href="https://twitter.com/mlipsitch">Marc Lipstich</a></li>
</ul>
<h2>SCD30 Pressure Correction and Calibration Disable</h2>
<p>Sparkfun SCD30 library is <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">here</a>, and has several relevant examples:</p>
<ul>
<li><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/examples/Example2_SetOptions/Example2_SetOptions.ino">Pressure correction</a></li>
<li><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/examples/Example4_DisableCalibrate/Example4_DisableCalibrate.ino">Disable autocalibration</a></li>
<li><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/examples/Example3_WireOptions/Example3_WireOptions.ino">Alternative i2c / Wire</a></li>
</ul>
<p><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/documents/Sensirion_CO2_Sensors_SCD30_Preliminary-Datasheet.pdf">SCD30 datasheet</a></p>
<h3>Forced calibration of SCD30</h3>
<p>See 1.3.7 (p. 7) of document:</p>
<p><a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">SCD30 interface description</a></p>
<p>For implementation, look at Sparkfun library and follow procedure for temperature / altitude compensation.</p>
<p>E.g. altitude compensation code begins <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/0a6ca999ffcb725a9d528f98bc87881ac1688b35/src/SparkFun_SCD30_Arduino_Library.cpp#L139">here</a></p>
<pre><code>//Set the altitude compenstation. See 1.3.9.
bool SCD30::setAltitudeCompensation(uint16_t altitude)
{
  return sendCommand(COMMAND_SET_ALTITUDE_COMPENSATION, altitude);
}
</code></pre>
<p>Can we set this up with a button? Would be nice if it works mid-loop ... test with ESP32?</p>
<p>ESP32 GPIO interrupts guide <a href="https://lastminuteengineers.com/handling-esp32-gpio-interrupts-tutorial/">here</a></p>
<p>Fork of Sparkfun library <a href="https://github.com/edgecollective/SparkFun_SCD30_Arduino_Library">here</a></p>
<p>Experimental feed is <a href="http://159.65.226.222:3000/api/drives/5bd89f163a158797ab86668e67ac92736905c4056ec03600b8c37b0296da6763/csv">here</a></p>
<p>Update: the library already includes the functionality!</p>
<pre><code>setForcedRecalibrationFactor(int co2_concentration_ppm)
</code></pre>
<p>the 'calibrate' button on rev_c is pin 36</p>
<p>ESP32 debouncing a button w/ interrupts, <a href="https://www.switchdoc.com/2018/04/esp32-tutorial-debouncing-a-button-press-using-interrupts/">here</a></p>
<p>The <a href="https://github.com/craftmetrics/esp32-button">ultimate debouncer</a> from Hackaday</p>
<p><a href="http://community.heltec.cn/t/wifi-lora-32-v2-pinout-diagram-questions/1762">Heltec pinout discussion</a></p>
<p>Following debounce <a href="https://lastminuteengineers.com/handling-esp32-gpio-interrupts-tutorial/">here</a></p>
<hr>
<p>2020-12-06 21:37:07</p>
<p>Meanwhile, verify that the forced calibration works.  Expectation:  if we do it after a few loops, the current CO2 value will suddenly appear to be whatever we force it to be.</p>
<p>Force calibrate seems to work!</p>
<p><img src="/img/co2/force_calibrate.png" alt=""></p>
<p>Code (still working out a button debounce routine) <a href="">here</a></p>
<p>overnight feeds as of 2020-12-06 22:13:47:</p>
<p><a href="http://159.65.226.222:3000/api/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74/csv">feather esp32 feed</a></p>
<p><a href="http://159.65.226.222:3000/api/drives/5bd89f163a158797ab86668e67ac92736905c4056ec03600b8c37b0296da6763/csv">heltec (calibrated)</a></p>
<hr>
<p>2020-12-07 09:35:29</p>
<h2>Plan update</h2>
<ul>
<li>leaflet floormap</li>
</ul>
<hr>
<p>2020-12-07 10:23:27</p>
<p>Further reading on temperature / other compensation for the SCD30, <a href="https://www.mouser.com/pdfdocs/CD_AN_SCD30_Low_Power_Mode_D2.pdf">&quot;Low Power Mode for the SCD30&quot;</a></p>
<p>Observation: when force calibrating the sensor outdoors in much lower temperature and assuming 410 ppm, it recovered inside to &lt; 400 ppm.  This may be because of temperature effects. There is a temperature compensation function for the sensor.  It requires an external temperature reading for calibration.  This might be done with a 1-wire temp sensor attached to the device.</p>
<p>So, advantages of the pvos device:</p>
<ul>
<li>1-wire external temp sensor compensation (similar in setup to maxbotix)</li>
<li>external pressure sensor compensation</li>
<li>microphone data</li>
<li>i2c and other breakout pins for additional setup</li>
<li>wifi, bluetooth, lora configurations</li>
<li>open hardware design</li>
</ul>
<hr>
<p>2020-12-07 10:37:03</p>
<p>Blog on use of SCD30 <a href="https://blog.devmobile.co.nz/tag/scd30/">here</a></p>
<p>TODO: need to find field calibration guide for SCD30.</p>
<p><a href="https://wiki.seeedstudio.com/Grove-CO2_Temperature_Humidity_Sensor-SCD30/">SEEED wiki on SCD30</a></p>
<p><a href="https://files.seeedstudio.com/wiki/Grove-CO2-Temperature-Humidity-Sensor-SCD30/res/CD_AN_SCD30_Design-In_Guidelines_D2.pdf">SCD30 design-in guidelines</a></p>
<p><img src="/img/co2/scd30_protection_from_light.png" alt=""></p>
<p>I believe the airflow isolation issue is the reason for seeing such strong fluctuations of measurements when outdoors in wind, and is a strong argument for designing an enclosure:</p>
<p><img src="/img/co2/scd30_airflow_isolation.png" alt=""></p>
<p><img src="/img/co2/scd30_thermal_decoupling.png" alt=""></p>
<p><img src="/img/co2/scd30_coupling_ambient.png" alt=""></p>
<p><img src="/img/co2/scd30_auto_self_calibration.png" alt=""></p>
<hr>
<p>2020-12-07 11:53:18</p>
<p>Resurrecting the React code ...</p>
<p><img src="/img/co2/react_experiments.png" alt=""></p>
<p>React sparkines library <a href="https://www.google.com/search?q=react+sparklines&amp;oq=react+sparklines&amp;aqs=chrome.0.35i39j69i59j0l5j69i60.1939j0j7&amp;sourceid=chrome&amp;ie=UTF-8">here</a></p>
<p>How to trigger a popup in Leaflet, <a href="https://gis.stackexchange.com/questions/88273/triggering-click-event-on-leaflet-map">here</a></p>
<p><a href="https://react-leaflet.js.org/docs/example-external-state">React Leaflet documentation</a></p>
<p>Stack overflow for interacting with leaflet in React <a href="https://stackoverflow.com/questions/38730152/popup-always-open-in-the-marker">here</a> -- with associated <a href="https://jsfiddle.net/jrcoq72t/">fiddle</a></p>
<p><a href="https://formidable.com/open-source/victory/docs/victory-chart/">Victory Chart</a></p>
<p><a href="https://github.com/pswoodworth/poll-watcher/blob/master/pages/index.js">pswoodworth's code for poll / leaflet</a></p>
<p><a href="https://blog.logrocket.com/how-to-use-react-leaflet/">How to use React Leaflet</a></p>
<p><a href="https://stackoverflow.com/questions/13110763/is-leaflet-a-good-tool-for-non-map-images">Using Leaflet for non-map images</a></p>
<p><a href="https://build-failed.blogspot.com/2012/11/zoomable-image-with-leaflet.html">Nice tutorial on using leaflet to zoom into images</a> -- has some nice tiling programs!</p>
<p><a href="https://kempe.net/blog/2014/06/14/leaflet-pan-zoom-image.html">Using leaflet to pan and zoom a big image</a></p>
<ul>
<li>working gist <a href="https://gist.github.com/longhotsummer/ba9c96bb2abb304e4095ce00df17ae2f">here</a> -- nicely works (as 'start.html' in</li>
</ul>
<h2>first go at non-geographical imagery</h2>
<p>Based on: <a href="http://omarriott.com/aux/leaflet-js-non-geographical-imagery/">&quot;using leaflet with non-geographical imagery&quot;</a> tutorial.</p>
<p>Code in 'trial.html' <a href="https://github.com/edgecollective/sensor-webclient/blob/main/trial.html">here</a></p>
<p><img src="/img/co2/leaflet_crs.png" alt=""></p>
<p>leaflet map in a flexbox layout <a href="https://stackoverflow.com/questions/27240894/leaflet-map-in-a-flexbox-layout">here</a></p>
<p>See 'side.html' <a href="https://github.com/edgecollective/sensor-webclient/blob/main/side.html">here</a>:</p>
<p><img src="/img/co2/leaf_floor.png" alt=""></p>
<p>Leaflet guide to non-geographic maps <a href="https://leafletjs.com/examples/crs-simple/crs-simple.html">here</a></p>
<p>Using CRS in React-Leaflet <a href="https://stackoverflow.com/questions/48185208/set-react-leaflet-map-crs-atribute">here</a></p>
<p>Example with imageoverlay and react-leaflet <a href="https://codesandbox.io/s/react-leaflet-with-functional-components-and-imageoverlay-u225j?file=/src/Map.js">here</a></p>
<p>Note: &quot;reg-leaf&quot; branch of spark-leaf repo is a working example.</p>
<p>Jamming on inserting code from <a href="https://codesandbox.io/s/react-leaflet-with-functional-components-and-imageoverlay-forked-n57cu?file=/src/Map.js">here</a> into my current setup</p>
<p>hmm, this approach seems simple <a href="https://stackoverflow.com/questions/48185208/set-react-leaflet-map-crs-atribute">here</a></p>
<p>support for non-geographical maps <a href="https://github.com/PaulLeCam/react-leaflet/issues/311">here</a></p>
<hr>
<p>2020-12-07 21:23:59</p>
<p>'clicknav' is a working branch.</p>
<p>fetching data in react using hooks <a href="https://blog.bitsrc.io/fetching-data-in-react-using-hooks-c6fdd71cb24a">here</a></p>
<p>another article <a href="https://dev.to/nicomartin/the-right-way-to-fetch-data-with-react-hooks-48gc">here</a></p>
<p>much nicer guide <a href="https://www.pluralsight.com/guides/fetching-data-updating-state-hooks">here</a></p>
<p>working with 'livedata' branch of spark-map currently ...</p>
<p>using react and fetch <a href="https://reactjs.org/docs/faq-ajax.html">here</a></p>
<hr>
<p>2020-12-08 10:58:47</p>
<p>nice leaflet grid layer code for displaying lat / long <a href="https://gist.github.com/letmaik/e71eae5b3ae9e09f8aeb288c3b95230b">here</a></p>
<p>Nice leaflet grid layer <a href="http://bl.ocks.org/letmaik/e71eae5b3ae9e09f8aeb288c3b95230b">here</a></p>
<hr>
<p>2020-12-08 12:39:52</p>
<p>running p2p-farm-server locally, branch: 'mappin'</p>
<p>http://localhost:3050/drives/94dc05a75bc3ac9b064cbe1c2ae3264e96ca753ff05aef28303d1c5b752a1f4b/console</p>
<p>reference putscript_local.sh for the appropriate keys and to add more data</p>
<p><img src="/img/co2/co2_console.png" alt=""></p>
<p>SVG sparklines <a href="https://github.com/fnando/sparkline">here</a></p>
<p>keeping popups open in leaflet <a href="https://stackoverflow.com/questions/9047931/leaflet-js-open-all-popup-bubbles-on-page-load">here</a></p>
<p>intro to leaflet <a href="https://leafletjs.com/examples/quick-start/">here</a></p>
<p>add and remove leaflet circle on click <a href="https://gist.github.com/mollietaylor/8564724">here</a></p>
<p>assigning ids to markers in leaflet <a href="https://stackoverflow.com/questions/25683871/assign-id-to-marker-in-leaflet">here</a></p>
<p>adding horizontal lines in chartjs <a href="https://riptutorial.com/chart-js/example/22333/draw-horizonal-lines">here</a></p>
<p><img src="/img/co2/console_demo.png" alt=""></p>
<p>above is 'mappin' branch of p2p-farm-server on gitlab</p>
<hr>
<p>2020-12-09 17:39:11</p>
<p>modfiying leaflet icon on mouseover <a href="https://gis.stackexchange.com/questions/267400/highlight-l-divicon-on-mouseover-or-programmatically-in-leaflet-map">here</a></p>
<p>nice working example of buttons and overlap and highlighting <a href="https://github.com/edgecollective/leaflet-highlight">here</a>.</p>
<p>https://www.providencejournal.com/story/news/coronavirus/2020/08/14/umass-professor-expands-on-risks-of-covid-19-and-how-to-avoid-them-in-schools/113968580/</p>
<p>https://twitter.com/ErinBromage</p>
<p>https://twitter.com/ErinBromage/status/1336769111922241539</p>
<p>great writings collected here: https://twitter.com/JuliaLMarcus</p>
<p>battery-powered datalogging, for use on e.g. planes?
export to csv ...</p>
<hr>
<p>2020-12-10 11:08:32</p>
<h2>Curated Twitter list of air quality / covid / science</h2>
<p>Link <a href="https://twitter.com/i/lists/1337064747762642947">here</a></p>
<p>Key organizing tweet by Jose-Luis Jimenez, <a href="https://twitter.com/jljcolorado/status/1335025183493599232?s=20">here</a> and <a href="https://twitter.com/jljcolorado/status/1337066415694733320?s=20">here</a>.  Jimenez group <a href="http://cires1.colorado.edu/jimenez/">here</a>.</p>
<p>Jimenez group listing <a href="http://cires1.colorado.edu/jimenez-group/">here</a></p>
<p>Aranet4 listing <a href="https://www.amazon.com/Aranet4-Home-Temperature-Ink-Configuration/dp/B07YY7BH2W">here</a></p>
<p>Article covering Jimenez int'l org around air quality and covid <a href="https://drive.google.com/file/d/1rBToRlgQfRoEPuY1WHhlwmIhcl5WrTye/view?usp=sharing">here</a></p>
<p>Online presentation <a href="https://www.aireamos.org/presentacion-online-de-la-nueva-plataforma-aireamos/">here</a></p>
<hr>
<p>2020-12-10 13:42:11</p>
<p>note on next steps:</p>
<ul>
<li>see how the two scd30s compare after force calibration procedure, side-by-side (don't need to be calibrated outdoors, just cross-comparison)</li>
<li>make sure can force calibrate the k30 and z19 and then do cross-comparison -- if they work comparably, can be lower-cost option</li>
<li>end-to-end demo of tech, including floorplan viz</li>
<li>(storage to microSD? easy next step)</li>
<li>kit assembly instructions for heltec version and for feather version</li>
<li>make a video explaining the project and the status</li>
<li>show Jupyter and R workflows</li>
</ul>
<hr>
<p>2020-12-10 17:44:16</p>
<h2>SCD30 Cross-comparison with force calibration</h2>
<ul>
<li>Heltec + REV_C using <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/firmware/wifi_sensor/heltec_wifi_bayou_scd30_display_bmp388_calibrate">this code</a> posting to <a href="http://159.65.226.222:3000/api/drives/5bd89f163a158797ab86668e67ac92736905c4056ec03600b8c37b0296da6763/csv">this feed</a></li>
<li>Feather ESP32 + REV_B using <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/wifi_sensor/feather_esp32_wifi_bayou_scd30_display_calibrate">this code</a> posting to <a href="http://159.65.226.222:3000/api/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74/csv">this feed</a></li>
</ul>
<p>Note on experimental setup.  Code is set up to broadcast every 90 seconds; on third round, it force calibrates to 410 ppm; there is a parameter named 'forced' that is '0' initially and then '1' after forced calibration. Both devices were reset simultaneously, hopefully they will be relatively in sync when force calibrated.  need to check difference.</p>
<p>Update: no, better to force calibrate in beginning.  Send value right after force calibration, then reset to 0.</p>
<hr>
<p>2020-12-10 20:21:52</p>
<ul>
<li>not sure that the force calibrate functions were simultaneous, might need to run again ...</li>
<li>but as a one-off the data looks spot-on right now ...</li>
</ul>
<hr>
<p>2020-12-10 22:03:01</p>
<ul>
<li>the data was spot on because the devices were force calibrating every cycle :) so they were always at around 410 ppm.</li>
<li>edited code so that it would force calibrate only once, about 2 minutes into cycle of measuring every 30 sec.  Data is here:</li>
</ul>
<p><img src="/img/co2/co_test.png" alt=""></p>
<p>Note that the orange line is the FeatherESP2, and tracking the 'forced' parameter indicates that the device rebooted and then re-force calibrated to 410 ppm.  Not sure why it rebooted -- perhaps the power supply on the Feather is insufficient to handle the SCD30, or the memory?  Note that the readings were more variable for the Feather prior to the reboot.</p>
<p><img src="/img/co2/co_test_color.png" alt=""></p>
<hr>
<p>2020-12-10 22:12:26</p>
<p>Added legend, and the 'forced' parameter, to make it all more explicit. Here, the red line is the Feather32 data, the blue is the Heltec. The accompanying 'forced' data are shown, multiplied and shifted to show on scale.</p>
<p>New experiment:  restart code, but swap the SCD30 modules.</p>
<hr>
<p>2020-12-10 22:18:31</p>
<p>Update:  swapped the scd30.  heltec didn't start up at first. realized that i placed the scd30, was shorting something.  so there may be some odd data out of the heltec now.  if there was something wrong with the scd30 module associated with the feather, it's on the heltec now.</p>
<ul>
<li>Last 'forced' dip before '53000' is beginning of above run.</li>
<li>'forced' event in green (feather32) only at '55000', feather32 seemed to reset and then 'force' to 410 (as firmware demands on reset)</li>
<li>powered off, swapped scd30s, maybe shorted the one that was originally on the feather by plugging it in improperly to heltec.  result is at '56500', shows forced status.  but devices somehow immediately end up 30+ppm apart. So at a little after 57000, did another reset (devices had been powered on).</li>
<li>now they definitely do hit the same 410 mark, but diverge. could be oddness in enclosure setup -- one is closer to inlet.</li>
<li>going to readjust and then reset again.</li>
<li>readjusted box, performed another collective reset now at approx 1607657789</li>
</ul>
<p>Note -- if this immediate divergence is 'real', it could indicate that small variations in air flow are very important / and/or that one oughtn't to worry about fluctuations on order of approx 50 ppm.</p>
<p>Reasons it might not be 'real' -- one of the sensors is underpowered b/c of a different micro ... the scd30 sampling rate is too high, or we're force calibrating too soon ... others?</p>
<hr>
<p>2020-12-10 22:45:58</p>
<p><img src="/img/co2/co_test_color_2.png" alt=""></p>
<p>Ah -- after careful readjustment inside enclosure, looks like they did coincide more closely (or could be fluke) on restart (last restart / force calibration before the '80000' mark.) Will now monitor to see whether one of the devices exhibits odd behavior.</p>
<p>Now that I've switched scd30 modules ... if the data from the Feather32 still exhibits odd behavior, then my guess would be that the problem is the power supply / memory of the Feather32.  If the data from the heltec exhibits odd behavior, then the problem may lie with that particular scd30 module.</p>
<hr>
<p>2020-12-10 22:53:13</p>
<p><img src="/img/co2/co_test_color_3.png" alt=""></p>
<p>Last two resets are after readjusted enclosure.</p>
<hr>
<p>2020-12-11 06:14:27</p>
<p>Results from overnight, after initial force calibration on both sensors (as per above description):
<img src="/img/co2/co_test_color_4.png" alt=""></p>
<p>Systematic difference (red climbs faster) is perhaps due to placement in box / closer to airflow opening.</p>
<p>Plot of difference between the two traces above:
<img src="/img/co2/co_test_color_diff.png" alt=""></p>
<h3>SCD30 Field Calibration Guide</h3>
<p>SCD30 Field Calibration Guide <a href="/img/co2/CD_AN_SCD30_Field_Calibration_D2.pdf">here</a></p>
<p>Effects of forced recalibration (from guide):</p>
<p><img src="/img/co2/frc_field_calibration.png" alt=""></p>
<p>Effects of automatic calibration (from guide):</p>
<p><img src="/img/co2/asc_algorithm.png" alt=""></p>
<hr>
<p>2020-12-11 08:03:52</p>
<p>Updated scd30 comparison:</p>
<p><img src="/img/co2/co_test_color_5.png" alt=""></p>
<p>Differences:</p>
<p><img src="/img/co2/co2_differences.png" alt=""></p>
<hr>
<p>2020-12-11 09:25:16</p>
<p><img src="/img/co2/co_tst_color_6.png" alt=""></p>
<p><img src="/img/co2/co2_differences_6.png" alt=""></p>


    </div>
  </body>
</html>

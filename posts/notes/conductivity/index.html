

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#post-title{margin-bottom:1px;background-color:#eee;border:1px solid #999;display:block;padding:8px;width:max-content;font-size:40px;margin-right:40px;margin-bottom:5px}#profile_pic{float:right;margin:0 0 1em 1em}#main-title{line-height:1em;font-size:x-large;margin-bottom:.31em}h1{line-height:1em;font-size:30px;margin-bottom:.31em}h2{margin-bottom:1px;display:block;width:max-content;font-size:22px;margin-right:40px;margin-bottom:10px}h3{font-size:15px;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>:  DIY Conductivity Sensor
        <!-- <h1>DIY Conductivity Sensor</h1> -->

  
  <h2>Temperature Measurement</h2>
<p><a href="https://learn.adafruit.com/adafruit-max31865-rtd-pt100-amplifier">RTD amp</a> breakout from Adafruit.</p>
<h2>Signal Sampling</h2>
<p><a href="https://www.ti.com/lit/an/sboa068/sboa068.pdf?ts=1601648370947&amp;ref_url=https%253A%252F%252Fwww.google.com%252F">Burr Brown App Note</a> on precision absolute value circuits.</p>
<h2>Signal generation</h2>
<p><a href="https://www.instructables.com/Arduino-Waveform-Generator/">Arduino Waveform Generator</a></p>
<h2>Prior Art Among Us</h2>
<p>Don's last version in January, based off Craig's 4pstat is <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/blob/4p-v1/kicad-pcb/pdf/4pstat.pdf">here</a></p>
<p>Craig's latest 4pstat is <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/blob/master/kicad-pcb/pdf/4pstat.pdf">here</a></p>
<p>Don's simplified 4 probe based on an earlier design is <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/master/v_0.1/four_probe.pdf">here</a></p>
<h2>Craig comments</h2>
<blockquote>
<p>What I found that seems to work well on the driven shield lines was to use some RC snubbers to ground after the 50 Ohm output resistor.  Values like 10 Ohm and 100nF give you a corner frequency of 160kHz - if your bandwidth is 10kHz that should likely work out.</p>
</blockquote>
<blockquote>
<p>Don, if you use my design, there are lots of mods needed to stop it from oscillating.</p>
</blockquote>
<blockquote>
<p>If you are doing a virtual ground, I suggest using the <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/issues/7#note_364944285">in-the-loop compensation circuit I got from AoE3</a></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/intheloop.jpg"> <img src="/img/intheloop.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">In-the-loop compensation scheme suggested by Craig <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/issues/7#note_364944285">here</a>.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Actually I wonder if the corner frequency is actually 6X lower because of the added 50 Ohm resistor? If that is the case, it might be better to back off the capacitance a bit And what about output resistance from the opamp (Mike, I'm looking at you)? If that's like around 100 Ohm maybe we'd be smart using an even smaller cap. This could be why I did not make my intended bandwidth of 100kHz on the bodged up 4pstat.</p>
</blockquote>
<h2>Revision Notes</h2>
<hr>
<p>As of 10-02-2020:</p>
<ul>
<li>use an OPA281 for the TIA (current measurement)</li>
<li>use an INA2331 for the INAMP (voltage measurement)</li>
<li>add the driven shield, snubs, and in-the-loop compensation as per Craig's design &amp; mods</li>
<li>use through-hole headers for any passives we might want to swap (avoiding the MUX chip for now) to simplify the board</li>
</ul>
<p>Don's current attempt at the above is <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/master/v_0.3/pdf/ec-4p.pdf">here</a>.</p>
<hr>
<p>As of 10-06-2020:</p>
<ul>
<li>Made suggested modifications by C.V. &amp; M.B..  Resultant schematic is <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/master/v_0.4/pdf/ec-4p.pdf">version 0.4</a>.</li>
</ul>
<p>As of 10-07-2020:</p>
<ul>
<li>Mike: 'Do you want a power supply decoupling cap on the current sense TIA, U3?'</li>
<li>Craig: 'What's driving P1 in this circuit?  Shouldn't we have some amp here?'</li>
</ul>
<p>'Adder inputs' section of Craig's 4PSTAT schematic:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/conductivity/adder_inputs.png"> <img src="/img/conductivity/adder_inputs.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">From Craig's schematic <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/blob/master/kicad-pcb/pdf/4pstat.pdf">here</a>.</td>
</tr>
</tbody>
</table>
<p>As of Oct 9 2020:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/conductivity/p1_feedback_circuit.png"> <img src="/img/conductivity/p1_feedback_circuit.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Revision A of the 0.4 EC-4P circuit: attempt at a simpler 'conductivity' measurement with adder amp feedback coming directly from the the amp output. See discussion <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/issues/6#note_427124136">here</a>.</td>
</tr>
</tbody>
</table>
<p><a href="https://en.wikipedia.org/wiki/Adder_(electronics)">Adder circuit</a> explanation on wikipedia.</p>
<p>Oops.  Above places C16 incorrectly:</p>
<p>Craig:</p>
<blockquote>
<p>It looks like you are shorting out C16.  Instead C16 should go across R21 to the summing junction.</p>
</blockquote>
<blockquote>
<p>Think of it this way, your gain at DC for each adder pathway (e0-e3) should be R21/Rn.  What the feedback capacitor C16 does is to short out R21 for high frequency signals where its impedance is small; thus it rolls off the gain at high frequencies, the corner frequency being 1/(2<em>pi</em>R21*C16).  Just set that, say 5X, above your highest intended signal frequency and you will have smoothed DAC signals and more stability.</p>
</blockquote>
<p>Correction:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/conductivity/p1_feedback_circuit_REV-B.png"> <img src="/img/conductivity/p1_feedback_circuit_REV-B.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/d616fd5467dd4cd1d415cf019640ec242f7dc668/v_0.4/pdf/ec-4p.pdf">Revision B</a> of the 0.4 EC-4P circuit: attempt at a simpler 'conductivity' measurement with adder amp feedback coming directly from the the amp output. See discussion <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/issues/6#note_427124136">here</a>.</td>
</tr>
</tbody>
</table>
<h2>References / Datasheets</h2>
<p><a href="https://www.ti.com/lit/ds/symlink/ina2331.pdf?ts=1602019726489&amp;ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FINA2331%253Futm_source%253Dgoogle%2526utm_medium%253Dcpc%2526utm_campaign%253Dasc-null-null-GPN_EN-cpc-pf-google-wwe%2526utm_content%253DINA2331%2526ds_k%253DINA2331%2526DCM%253Dyes%2526gclid%253DCjwKCAjwq_D7BRADEiwAVMDdHqgen4POVfQNUaSvv1tTeDEJar15NgWLAQamLzuEf4j7nOT6NZ4iQBoCoFYQAvD_BwE%2526gclsrc%253Daw.ds">INA331</a></p>
<p><a href="https://www.ti.com/lit/ds/symlink/opa381.pdf?ts=1602019570296&amp;ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FOPA381">OPA831 / OPA2381</a></p>
<p><a href="https://www.ti.com/lit/ds/symlink/lmc6484.pdf?ts=1602019481665">LMC6484</a></p>
<h2>Useful misc info</h2>
<p><a href="https://stackoverflow.com/questions/15677439/command-to-get-latest-git-commit-hash-from-a-branch">via Stackoverflow</a>: Command to get latest URL for remote commit:</p>
<p><code>git ls-remote git://github.com/&lt;user&gt;/&lt;project&gt;.git</code></p>
<hr>
<p>2020 NOV 12</p>
<p>HOBO Freshwater datalogger product page <a href="https://www.onsetcomp.com/products/data-loggers/u24-001/">here</a>.</p>
<p><a href="/img/conductivity/hobo_specs.png"><img src="/img/conductivity/hobo_specs.png" alt=""></a></p>


    </div>
  </body>
</html>

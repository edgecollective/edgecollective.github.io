

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font-family:ubuntu,sans-serif;margin:10px;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.contribute{width:100%;padding-top:10px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />

    <title>Edge Collective</title>
  </head>
  <body>


  <a href="/">Edge Collective</a>
        <h1>Valedalama</h1>

<!--  &lt;nav class=&quot;toc&quot;&gt;&lt;/nav&gt;-->
  
  <p>Highlights:</p>
<ul>
<li><a href="#bme280_wiring">Wiring a BME280 to a Feather</a></li>
</ul>
<hr>
<p><em>April 13, 2020</em></p>
<h2>SQLite</h2>
<p>Great <a href="https://www.youtube.com/watch?v=Jib2AmRb_rk">talk on Sqllite</a>, arguing that it's appropriate for a database located on 'the edge'.</p>
<img src="/img/valedalama/about_sqlite.png">
<hr>
<p><em>24 Apr 2020</em></p>
<h2>Test Feather Code</h2>
<p><a href="https://gist.github.com/dwblair/c18edaaa2de9a8d5e3a6b47c48797d98">Simple test code</a>  for Adafruit Feather + RAK</p>
<hr>
<p><em>05 May 2020</em></p>
<h2>Configuring the region on the RAK</h2>
<p>General setup for the RAK 7243 + Pi firmware is <a href="https://doc.rakwireless.com/rak7243c-lorawan-developer-gateway/device-firmware-setup">here</a>.</p>
<p>Information about the configuration file is <a href="https://www.chirpstack.io/network-server/install/config/">here</a>.</p>
<p>The firmware we're using is <a href="https://downloads.rakwireless.com/LoRa/Pilot-Gateway-Pro-RAK7243/Firmware/">here</a>.</p>
<p>Can use 'gateway-config' command line script on RAK to set the region:</p>
<pre><code>sudo gateway-config
</code></pre>
<p>This script modifies this file:</p>
<pre><code>/etc/chirpstack-network-server/chirpstack-network-server.toml
</code></pre>
<h2>Basic Arduino Test Code</h2>
<p>Basic test code for sending data to the RAK in OTAA mode is in gist form <a href="https://gist.github.com/dwblair/f6a0c3dd07fc3ae073fad3914f77af64">here</a>.</p>
<h2>Configuring the region on the Arduino</h2>
<p>Changing the region on the Arduino requires modifing a special header file.</p>
<p>See the Adafruit Arduino tutorial <a href="https://learn.adafruit.com/the-things-network-for-feather?view=all#region-configuration">here</a>.</p>
<h2>Adafruit Feather 900 Mhz can be tuned to 868 Mhz band</h2>
<p>See the below snippet from the <a href="https://www.adafruit.com/product/3178">Adafruit Feather M0 LoRa 900 Mhz product page</a>:</p>
<img src="/img/valedalama/feather_tunable.png">
<h2>Adafruit LMIC OTAA basic code will attempt to rejoin periodically</h2>
<p>See this example serial output:</p>
<img src="/img/valedalama/rejoin.png">
<h2>Needed tweak on Adafruit for EU band</h2>
<p>See the forum post <a href="https://www.thethingsnetwork.org/forum/t/solved-adafruit-feather-m0-to-connect-to-ttn-over-otaa-unknown-event-20/29990/15">here</a>:</p>
<img src="/img/valedalama/eu_band_adafruit_tweak.png">
<p><a href="https://www.hackster.io/Amedee/the-things-network-node-for-ttnmapper-org-a8bcd4">This</a> might be a useful reference for setting up 868 band.</p>
<p>Current impression is that RAK hardware does indeed distinguish between 868 and 915 Mhz bands ... ?</p>
<p>05 May 2020 13:27 Update:  there is a 'project_config' file located in the 'src' folder on in the lmic library folder itself -- and it's set to the US band -- perhaps this is overriding the project files? Trying setting it to EU and the RAK to EU.  One open question is how specific the RAK Pi Hat is re: freq bands ... can it handle 868?</p>
<p>So the current thinking for getting 868 band to work is:</p>
<ul>
<li>change the Arduino lib folder project_config file to 868</li>
<li>change the sketch lib folder project_config file to 868 (for good measure)</li>
<li>comment out LMIC_selectSubBand(1);</li>
</ul>
<p>Meanwhile, note that upload via bossac did work on the Pi.</p>
<p>Confirmed -- was able to get upload on RAK in US '915' version by setting to '868' following above steps.  Key seems to have been the Arduino library project_config folder issue.</p>
<p>Note: we are using <a href="https://github.com/mcci-catena/arduino-lmic/releases/tag/v2.3.2">mcci-catena arduino-lmic 2.3.2 version</a> of library with success.  Later versions haven't always worked. Stick with that for now.</p>
<h2>Strategy</h2>
<p>First:</p>
<ul>
<li>set up RAK to 868 via sudo gateway-config</li>
<li>try loading binary to Feather via RAK</li>
</ul>
<p>Second:</p>
<ul>
<li>make sure we're using proper version of lmic library (see above)</li>
<li>change the Arduino lib folder project_config file to 868</li>
<li>change the sketch lib folder project_config file to 868 (for good measure)</li>
<li>comment out LMIC_selectSubBand(1);</li>
</ul>
<h2><a name="bme280_wiring">Wiring Adafruit Feather to BME280</a></h2>
<p>As per instructions <a href="https://learn.adafruit.com/adafruit-bme280-humidity-barometric-pressure-temperature-sensor-breakout/arduino-test">here</a>:</p>
<img src="/img/valedalama/feather_pinouts.jpg">
</br>
<img src="/img/valedalama/bme_280_pins.jpg">
<p><strong>BME280 ---&gt; Feather</strong></p>
<ul>
<li>VIN --&gt; 3V</li>
<li>GND --&gt; GND</li>
<li>SCK --&gt; SCL</li>
<li>SDI --&gt; SDA</li>
</ul>

  </body>
</html>

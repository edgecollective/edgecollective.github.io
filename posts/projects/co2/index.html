

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}h2{font-size:large;margin-bottom:1px;background-color:#eee;border:1px solid #999;display:block;padding:10px;font-size:16px;margin-right:40px;margin-bottom:5px;text-align:center}h3{font-size:14px;margin-bottom:1px;background-color:#eef;border:1px solid #999;display:block;padding:10px;width:max-content;margin-right:40px;margin-bottom:5px;text-align:left}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:80%;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Edge Collective</title>
  </head>
  <body>

    <div id='post-content'>

  <a href="/">Edge Collective</a>
        <h1>Developing a Free and Open Source CO2 Sensor System</h1>

  
  <hr>
<h2>Overview</h2>
<p>Developing an Free and Open Source end-to-end system for CO2 monitoring.</p>
<p>Ongoing notes on development are posted <a href="https://edgecollective.io/posts/notes/co2/">here</a>.</p>
<hr>
<h2>Goals for Version 1</h2>
<p>(Updated: 2020-12-09 08:31:32)</p>
<p>Key to assessment of work items:</p>
<ul>
<li>[X] -- &quot;Done&quot;</li>
<li>[EASY] -- Won't take much additional effort or time.  A day or two or work.</li>
<li>[MEDIUM] -- Straightforward, but could take up to a week of work.</li>
<li>[HARD] -- Will take a lot of time / effort.  May need to reconsider.</li>
</ul>
<h3>Hardware + firmware</h3>
<ul>
<li>Ability to turn of autocalibration [X]</li>
<li>Ability to trigger calibration value in firmware [X]</li>
<li>Http PUT/POST to online server [X]</li>
<li>Gardware for pressure compensation [X]</li>
<li>Firmware compensation using pressure input [SHORT]</li>
<li>'Calibrate' button that works on interrupt &amp; is debounced  [MEDIUM]</li>
<li>Reasonable first pass at enclosure that respects the scd30 design guidelines [MEDIUM]</li>
</ul>
<h3>Data server</h3>
<ul>
<li>Initial prototype using 'nosql' data server with simple public key / private key design for accessing / posting to feeds [X]</li>
<li>Redo initial prototype using Node + Express + Postgresql server + database backend [MEDIUM]</li>
<li>Add simple user login to permit data feed creation [HARD]</li>
</ul>
<h3>Client data viz / analysis</h3>
<ul>
<li>Initial simple graphing and location of sensors on a floorplan [X]</li>
<li>Feed graphs can be show in summary graphical form in a 'list' [X]</li>
<li>Client that takes in multiple data feeds from Bayou [HARD]</li>
<li>Client can choose which available parameters to display [HARD]</li>
<li>Feed location on a floorplan / map can be display and 'highlighted' by clicking on / hovering over feed list [MEDIUM]</li>
<li>Thresholds can be displayed on the graph as lines or bands [SHORT]</li>
<li>User can define / select thresholds on a per-graph basis [MEDIUM]</li>
<li>Demo of using Jupyter to download and analyze data [EASY]</li>
<li>Demo of using R to download and analyze data [MEDIUM]</li>
</ul>
<h3>Science / calibration / validation</h3>
<ul>
<li>Demonstrate calibration with 'fresh air' [EASY]</li>
<li>Demonstrate calibration with CO2 cannister (and then matching fresh air on later measurement) [HARD]</li>
<li>Comparison of scd30 modules against one another [EASY]</li>
<li>Comparison of scd30 modules with k30, z19 [MEDIUM]</li>
</ul>
<hr>
<h2>Goals for Version 2</h2>
<h3>User data viz / analysis workflow</h3>
<ul>
<li>Client that takes in data feeds from multiple data feed sources (e.g. Adafruit.io)</li>
<li>Data feed parameters can be overlaid on same graph and compared</li>
</ul>
<h3>Hardware + firmware</h3>
<ul>
<li>bluetooth configuration of parameters</li>
<li>lora gateway + lora remote nodes</li>
<li>MQTT functionality</li>
</ul>
<h3>Science / calibration / validation</h3>
<ul>
<li>Import parameters from various air / infection 'models' and apply as thresholds to graph</li>
</ul>
<hr>
<h2>Update 2020-12-07</h2>
<h3>Hardware and Firmware</h3>
<p>Latest accomplishments:</p>
<ul>
<li>Several working hardware designs, incorporating variously the Feather M0 LoRa, Feather ESP32, and Heltec Wifi 32 LoRa V2.  Focus is on the Sensiron SCD30 CO2 module, as it is well-reviewed, has straightforward power requirements (3.3V), and is well-documented.</li>
<li>Current hardware designs incorporate pressure sensor for ambient pressure compensation, and an OLED display.</li>
<li>Experiments with an electret microphone (using MAX466 amplifier) have been promising.</li>
<li>Preliminary light sensor experiment failed due to (we think) to protocol conflicts; may pause on this until a later version.</li>
<li>Captured data for overnight, morning and evening activities, and simultaneous deployment of two side-by-side SCD30 sensors, and in process of analyzing / reviewing.</li>
</ul>
<p>Next steps:</p>
<ul>
<li>Working to incoroprate an interrupt-based button activation for 'forced calibration'.  Debouncing code will be necessary for this.  SCD30 library from Sparkfun includes the force calibration code.</li>
<li>Currently reviewing best practices around enclosure design, sensor placement, and field calibration for SCD30.</li>
<li>Currently out ESP32 micro workflow; a fully-custom PCB based on the ESP32 will be designed to reduce overall costs.</li>
<li>Deciding on pin breakouts / interfaces.  i2c (including qwiic connector), serial, analog.</li>
<li>Implementing wifi and feed configuration via local wifi / Bluetooth.</li>
<li>Backup battery management.  Battery will be useful in cases where sensor must be brought outdoors temporarily for calibration purposes.</li>
<li>Comparison of 'force calibrated' SCD30 (x2), K30, and Z19 sensors, co-deployed.</li>
</ul>
<h3>Server</h3>
<p>Latest accomplishments:</p>
<ul>
<li>Bayou data storage is operation and working solidly.  Uses 'nosql' / 'flat' database scheme (pouchdb / leveldb), and fastify for server.</li>
</ul>
<p>Next steps:</p>
<ul>
<li>Looking to replace Bayou backend with a node + express + Postgresql alternative.</li>
<li>Beginning to experiment with a React-based front-end.</li>
<li>Working on demonstration of Reach-based mapping of sensor location (on map / floorplan) with most recent values and associated historical graphs.</li>
</ul>
<h3>Data Analysis</h3>
<p>Latest accomplishments:</p>
<ul>
<li>Have begun experimenting with workflows in Jupyter.</li>
</ul>
<p>Next steps:</p>
<ul>
<li>Basic analysis / workflow leading to identification of peak values, averages, baseline.</li>
<li>Reproducing the workflow in R.</li>
</ul>
<hr>
<p>2021-01-16 21:19:52</p>
<h2>REV_E Parts list</h2>
<ul>
<li><strong>PVOS CO2 Rev_E PCB</strong> -- <a href="https://oshpark.com/shared_projects/Sqhe5YpQ">oshpark</a> | <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_e/atkins">github</a></li>
<li><a href="https://www.sparkfun.com/products/15112">Sensirion SCD30 CO2 sensor</a></li>
<li><a href="https://www.amazon.com/MakerFocus-Development-Bluetooth-0-96inch-Display/dp/B076MSLFC9/ref=sr_1_4?crid=1PRQFMZWK1EA9&amp;dchild=1&amp;keywords=heltec+lora+esp32&amp;qid=1610850196&amp;s=electronics&amp;sprefix=heltec%2Celectronics%2C149&amp;sr=1-4">Heltec Wifi 32 LoRa V2</a></li>
<li><a href="https://www.amazon.com/gp/product/B07CXNQ3ZR/ref=ppx_yo_dt_b_asin_title_o04_s00?ie=UTF8&amp;psc=1">3.7V Lithitum Rechargeable battery (NOTE! JST1.25 connector)</a></li>
<li><a href="https://www.adafruit.com/product/3966">Adafruit BMP388</a> (optional pressure sensor)</li>
<li><a href="https://www.adafruit.com/product/1063">Adafruit MAX4466</a> (optional mic)</li>
<li>2 X <a href="https://www.amazon.com/gp/product/B07JKWC6LH/ref=ppx_yo_dt_b_asin_title_o04_s01?ie=UTF8&amp;psc=1">uxcell Momentary PCB Side Mounting Fixed Bracket Pushbutton Push Button Tact Tactile Switch DIP 2 Terminals 6mmx6mmx12mm</a></li>
</ul>


    </div>
  </body>
</html>

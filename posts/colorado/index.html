

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font-family:sans-serif;margin:10px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />

    <title>Edge Collective</title>
  </head>
  <body>
  <a href="/">Edge Collective</a>
        <h1>Colorado -- Soil Moisture Monitoring</h1>
        
    <hr>
<p><em>March 22, 2020</em></p>
<h2>Gatway Setup</h2>
<p>Now that we have a field relay node design for capturing the soil moisture data and sending it to a LoRa gateway (based on the RAK / Raspberry Pi gateway), we are looking to optimize signal strength in the system.</p>
<p>Several resources are available online around this.  I'll record them here later; but in particular, the tutorial I found particularly relevant was this one by Andreas Spiess:  <a href="https://www.youtube.com/watch?v=J3PBL9oLPX8">&quot;What you always wanted to know about Antennas and nobody told you&quot;</a>.  Summary lessons from this video:</p>
<ul>
<li><strong>Minimize the length of cable connecting the gateway to the external antenna</strong>. 10s of feet of cable connecting the gateway to an external antenna -- even high quality, low-loss cable -- can reduce the signal range significantly (in kilometers).  Best to minimize this connection cable to the extent possible.</li>
<li><strong>With good line of sight, very long distances should be possible.</strong></li>
<li><strong>The 'Fresnel effect'</strong> means that line of sight actually requires some margin above / below the direct line of sight.</li>
<li><strong>Always connect an antenna to the sender</strong>.  Without an antenna, energy is reflected back into the sender, potentially damaging the electronics.</li>
</ul>
<h2>Antenna Options</h2>
<p>The above leads me to think that our $50 <a href="https://www.sparkfun.com/products/15597">Sparkfun LoRa Fiberglass Antenna</a>, with its 5 dBi gain, is likely sufficient.  I was able to achieve 5 miles line-of-sight communication between relay node and gateway using this antenna.  The key variables to improve range seem to be: maximizing line-of-sight by increasing the height of the antenna, and using the shortest cable can to connect the gateway to the external antenna.</p>
<p>If, however, we wanted another 3dBi gain, we could Opt for the <a href="https://www.digikey.com/product-detail/en/taoglas-limited/OMB-915-B08F21/931-1519-ND/8275277">Taoglas OMB.915.B08F21</a>, for $161. The datasheet indicates that it is still a fairly uniform / 'omni' antenna (which leads me to believe that our 5 dBi antenna, for which we don't have a datasheet, is likely even more uniform):</p>
<p><a href="/img/harold/taoglas_radiation.png"><img src="/img/harold/taoglas_radiation.png" width=50%></a></p>
<h2>Mounting the atenna</h2>
<p>Nootropic Design has a <a href="https://nootropicdesign.com/projectlab/2018/10/27/lorawan-gateway/">nice short article</a>  describing their deployment of a RAK gateway outdoors. We can ignore the GPS antenna;  this might be a cheap option for getting the fiberglass antenna mounted as high as possible.</p>
<p><a href="/img/harold/antenna_sm.jpg"><img src="/img/harold/antenna_sm.jpg" width=50%></a></p>
<h2>Cable options</h2>
<p>Despite the anticipated signal loss through the cable, it may be sufficiently difficult / inconvenient to place the gateway outdoors (lack of available wifi signal, wind / lightning / weather conditions), that it's worth using a low-loss cable to connect the gateway to the external antenna, and keep the gateway indoors.</p>
<p>If we need to use a long antenna extension cable, I've found some <a href="https://www.amazon.com/Low-Loss-Coax-Extension-Cable-Ohm/dp/B013CY0IRU/ref=sr_1_22?keywords=sma+cable+extender&amp;qid=1584733047&amp;s=electronics&amp;sr=1-22">&quot;Proxicast&quot; Low-Loss Coax Extension Cable (50 Ohm) -- SmA Male to N Male</a>, that seems to be a good option for low-loss cabling.</p>
<ul>
<li><a href="https://www.amazon.com/Low-Loss-Coax-Extension-Cable-Ohm/dp/B00QZEQ5EA/ref=sr_1_22?keywords=sma%2Bcable%2Bextender&amp;qid=1584733047&amp;s=electronics&amp;sr=1-22&amp;th=1">25 feet</a> ($44) -- 2.1 dBi loss</li>
<li><a href="https://www.amazon.com/Low-Loss-Coax-Extension-Cable-Ohm/dp/B07RLJ25GW/ref=sr_1_22?keywords=sma%2Bcable%2Bextender&amp;qid=1584733047&amp;s=electronics&amp;sr=1-22&amp;th=1">36 feet</a> ($67) -- 1.6 dBi loss (Note:  are this and the previous figures swapped in the table above?)</li>
<li><a href="https://www.amazon.com/Low-Loss-Coax-Extension-Cable-Ohm/dp/B013CY0IRU/ref=sr_1_22?keywords=sma+cable+extender&amp;qid=1584733047&amp;s=electronics&amp;sr=1-22">50 feet</a> ($86) -- 2.2 dBi loss</li>
</ul>
<p><a href="/img/harold/cable_wrapped.png"><img src="/img/harold/cable_wrapped.png" width=50%></a></p>
<p>The seller provides a chart with the &quot;total signal loss&quot; over the course of the cable:</p>
<p><a href="/img/harold/cable_loss.png"><img src="/img/harold/cable_loss.png" width=50%></a></p>
<p>(Note: a general reference for signal loss per foot through various cable types at various frequences can be found <a href="https://www.w4rp.com/ref/coax.html">here</a>).</p>
<p>Patrick estimated about 40 feet of cable might be necessary:  the chart indicates that the 50 foot cable option, at 900 MHz (our LoRa band), induces a loss of 2.2 dB.</p>
<p>I believe that this loss can simply be subtracted from whatever RSSI value we would have otherwise gotten with an 'ideal' (or very short) cable; and that it can also be subtracted from the gain of the antenna.  Given that there are some LoRa base station antennas that are sold at 2 or 3 dBi, perhaps this loss is acceptable, so long as we try to maintain line of sight as best we can.</p>
<h2>WiFi Extension Options</h2>
<p><a href="/img/harold/tp-link.png"><img src="/img/harold/tp-link.png" width=50%></a></p>
<p>Even if we use a cable, we will still need to connect the gateway to the wifi network, and this may require extending its range with a WiFi range extender.</p>
<p>Two options that seemed to be promising were:</p>
<ul>
<li>the <a href="https://www.amazon.com/dp/B014YN7LVE/ref=psdc_3015439011_t1_B004YAYM06?th=1">NETGEAR WiFi Range Extender AC1200</a> for $35;  it extends the range up to 1200 sq feet;</li>
<li>the <a href="https://www.amazon.com/TP-Link-PCMag-Editors-Choice-Extender/dp/B010S6SG3S?th=1">TP-Link AC1750</a> for $57; it extends the range up to 2000 sq feet.</li>
</ul>
<h2>External Gateway Enclosures</h2>
<p>If we do opt to place the gateway outdoords, many options here could work for housing the gateway outdoors.  If wind is a concern, a round PVC pipe might be a good option, as in this design from the Things network:</p>
<p><a href="/img/harold/gateway_outdoors.jpeg"><img src="/img/harold/gateway_outdoors.jpeg" width=50%></a></p>
<p>Otherwise, there are quite standard enclosures to be found online, with hinges, like this one used by <a href="https://nootropicdesign.com/projectlab/2018/10/27/lorawan-gateway/">Nootropic Design</a>:</p>
<p><a href="/img/harold/baseStation1_lg.jpg"><img src="/img/harold/baseStation1_lg.jpg" width=50%></a></p>
<p><a href="/img/harold/pi_outdoors.jpg"><img src="/img/harold/pi_outdoors.jpg" width=50%></a></p>
<h2>Overall Recommendedations</h2>
<ul>
<li>If it is possible to situate the external antenna within line of sight of the relay nodes, having a longer cable connector might not be so much of an issue.  At the Olathe site, the antenna location on the roof may have line-of-sight to most of the fields.</li>
<li>Therefore, the recommended purchase at this point will be both the cable and the wifi extender.  The cable can be tried first; if it is of insufficient signal strength, then the wifi extender can be used to extend the wifi signal, and the gateway can be housed outdoors.</li>
<li>For this reason an additional enclosure outside for the gateway may be a good purchase at this stage.</li>
<li>Note that the Sigfox setup in Olathe may already be something we can leverage for the RAK gateway system, if the cable end matches, as it likely uses the same 900 Mhz ISM band, and the antenna is already nicely mounted on the roof.</li>
</ul>
<hr>
<p><em>March 28, 2020</em></p>
<h2>LSN50 + Vegetronix</h2>
<p><a href="https://www.dragino.com/products/lora-lorawan-end-node/item/128-lsn50.html">LSN50</a></p>
<p><a href="https://www.dragino.com/downloads/downloads/LSN50-LoRaST/LSN50_LoRa_Sensor_Node_UserManual_v1.6.3.pdf">User Manual + Case Study</a></p>
<p><a href="https://www.dragino.com/downloads/downloads/LSN50-LoRaST/DRAGINO_LSN50_AT_Commands_v1.6.3.pdf">AT Commands</a></p>
<img src="/img/lsn50/pinout_1_2.png">
<img src="/img/lsn50/pin_functions.png">
<p>What worked with the CP2104:</p>
<ul>
<li>RXD --&gt; P02</li>
<li>TXD --&gt; P03</li>
<li>GND --&gt; GND</li>
</ul>
<p>Seems to take about 2 minutes to join network at start.</p>
<p>Command for changing interval (in units of milliseconds) to 60 seconds:</p>
<pre><code>AT+TDC=60000
</code></pre>
<h2>Burning a MicroSD card image of the RAK OS</h2>
<p>This will require three steps:</p>
<ol>
<li>
<p><strong>Reformatting the microSD card</strong>.  To do this on a MAC, you can follow <a href="https://apple.stackexchange.com/questions/226016/how-to-remove-partition-on-sd-card-using-a-mac">this guide</a>, which is demonstrated in <a href="https://www.youtube.com/watch?v=NY0Aqtx9BSQ">this video</a>.</p>
</li>
<li>
<p><strong>Burning the RAK image</strong> to the formatted microSD card, using <a href="https://www.balena.io/etcher/">Balena Etcher</a>.   The image you'll want to download and burn is <a href="https://drive.google.com/file/d/19H8hP0pc4SMgFN5tfnBUKg9ZB8RsXnZf/view?usp=sharing">here</a>.</p>
</li>
</ol>
<hr>
<h2>Improving Range</h2>
<p><em>30 March 2020</em></p>
<p><a href="https://ham.stackexchange.com/questions/12149/antenna-height-for-lorawan-gateway">Nice post</a> on calculating line-of-sight horizon and Fresnel zone:</p>
<img src='/img/harold/horizon.png'>
<p><a href="https://www.youtube.com/watch?v=HWOivbJjw7s">Fresnel Zone Tutorial on Youtube</a>  by Mobile Fish</p>
<img src='/img/harold/fresnel_zone_diag.png'>
<img src='/img/harold/fresnel_zone_clearance.png'>

  </body>
</html>

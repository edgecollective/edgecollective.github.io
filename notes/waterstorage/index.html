

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:15px/1.5 sans-serif;width:80%}.img-with-caption{font-size:15px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#post-title{margin-bottom:1px;background-color:#eee;border:1px solid #999;display:block;padding:8px;width:max-content;font-size:40px;margin-right:40px;margin-bottom:5px}#profile_pic{float:right;margin:0 0 1em 1em}#main-title{line-height:1em;font-size:x-large;margin-bottom:.31em}h1{line-height:1em;font-size:30px;margin-bottom:.31em}h2{margin-bottom:1px;font-size:22px}h3{font-size:15px;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .project-updated{font-size:6px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:15}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}.frame{height:300px;width:100%;white-space:nowrap;text-align:center;margin:1em 0}.helper{display:inline-block;height:100%;vertical-align:middle}.present_img{background:#3a6f9a;vertical-align:middle;max-height:300}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
</style>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />
    <title>Satellite Modem Prototyping</title>
  </head>
  <body>

    <div id='post-content'>

  <h3><a href="/">Edge Collective</a></h3>
    <h1>Satellite Modem Prototyping</h1>
    <i>Using a satellite modem to send data from off-grid.</i>

        <!-- <h1>Satellite Modem Prototyping</h1> -->

  
  <p>Working with CPy 7 on Feather Blue Sense for now ...</p>
<p>Guide <a href="https://learn.adafruit.com/using-the-rockblock-iridium-modem?view=all#circuitpython-example">https://learn.adafruit.com/using-the-rockblock-iridium-modem?view=all#circuitpython-example</a></p>
<p>Rockblock Circuitpython library <a href="https://github.com/adafruit/Adafruit_CircuitPython_RockBlock">https://github.com/adafruit/Adafruit_CircuitPython_RockBlock</a></p>
<p>Library documentation <a href="https://docs.circuitpython.org/projects/rockblock/en/latest/api.html">https://docs.circuitpython.org/projects/rockblock/en/latest/api.html</a></p>
<h1>ESP32-S2 TFT</h1>
<p>Guide <a href="https://learn.adafruit.com/adafruit-esp32-s2-tft-feather/circuitpython">https://learn.adafruit.com/adafruit-esp32-s2-tft-feather/circuitpython</a></p>
<p>Adding an additional serial port to the Feather S2</p>
<h1>Maxbotix</h1>
<p>Guide for maxbotic sensors: <a href="https://www.maxbotix.com/tutorials.htm">https://www.maxbotix.com/tutorials.htm</a></p>
<p>Sensor output options: <a href="https://www.maxbotix.com/tutorials2/sensor-output-options.htm">https://www.maxbotix.com/tutorials2/sensor-output-options.htm</a></p>
<h1>1-wire sensor</h1>
<p>Guide to Circuitpython <a href="https://learn.adafruit.com/using-ds18b20-temperature-sensor-with-circuitpython/circuitpython?gclid=CjwKCAiAoL6eBhA3EiwAXDom5mIOC8cvQlFba_1gHHcrOiyseLnxqKod4WhS_KgQP5pCrCnVg9h3ihoCKwcQAvD_BwE">here</a></p>
<hr>
<p>Using CPY 7.X on the Feather Bluefruit Sense for now</p>
<p><img src="/img/blue_sat_upload.png" alt=""></p>
<hr>
<p>Message 75 and 76 are in the format:</p>
<pre><code>data = struct.pack(&quot;f&quot;,batt_voltage)
data += struct.pack(&quot;f&quot;,depth_inches)
data += struct.pack(&quot;2f&quot;, sht.relative_humidity, sht.temperature)
data += struct.pack(&quot;2f&quot;, bmp.pressure, bmp.temperature)
</code></pre>
<p>E.g. Message 75:</p>
<pre><code>IMEI: 300234065897350
MOMSN: 75
Transmit Time: 2023-01-25T00:36:18Z UTC
Iridium Latitude: 42.4393
Iridium Longitude: -70.7191
Iridium CEP: 544.0
Iridium Session Status: 2
Data: 982f854090673f43bc35bb410028cf4188577d44646ccf41
</code></pre>
<p>Example python3 code for decoding:</p>
<pre><code>&gt;&gt;&gt; data=bytes.fromhex(&quot;982f854090673f43bc35bb410028cf4188577d44646ccf41&quot;)
&gt;&gt;&gt; struct.unpack(&quot;&lt;6f&quot;, data)
(4.162059783935547, 191.404541015625, 23.40123748779297, 25.89453125, 1013.36767578125, 25.92792510986328)
</code></pre>
<p>Initial version of satellite modem that sends depth and sensor data, waits 1 minute in between:</p>
<p><a href="https://github.com/dwblair/rockblock-ultrasonic/tree/b1fe20872cbe983c372010ae1e78fe4a9b0b035e/feather-bluefruit">https://github.com/dwblair/rockblock-ultrasonic/tree/b1fe20872cbe983c372010ae1e78fe4a9b0b035e/feather-bluefruit</a></p>
<p>Looks as though it's 1 credit per message.</p>
<p>The highest rate is 0.145 British Pounds per credit for 100 credits (.099 BP per credit when buying 1000 credits).</p>
<p>So that's a purchase of $17.86 for 100 credits ($.18 per credits); or $121.94 for 1000 credits ($.12 per credit)</p>
<p>We might be able to pack more data in per message ... i.e., we could perhaps send several hours' worth of data once per day ...</p>
<p>But let's say we want to send one message per day. That's one credit per day.</p>
<p>So, 30 credits per month.</p>
<p>The line rental is $16 per month.</p>
<p>That's $5.40 per month for the messages, and $16 per month for the line rental -- so, that's about $22 per month</p>
<h1>Decoding python structs using javascript</h1>
<p><a href="https://www.thethingsnetwork.org/forum/t/payload-formats-howto/3441/3">https://www.thethingsnetwork.org/forum/t/payload-formats-howto/3441/3</a></p>
<p><a href="https://stackoverflow.com/questions/37471158/converting-ieee-754-from-bit-stream-into-float-in-javascript/37471538#37471538">https://stackoverflow.com/questions/37471158/converting-ieee-754-from-bit-stream-into-float-in-javascript/37471538#37471538</a></p>
<p>Better: a nodejs package python-struct: <a href="https://www.npmjs.com/package/python-struct">https://www.npmjs.com/package/python-struct</a></p>
<p>Or alternatively: <a href="https://github.com/lyngklip/structjs">https://github.com/lyngklip/structjs</a> which seems to include easy to use source code ...</p>
<p>Using python-struct ...</p>
<p>Better link? <a href="https://stackoverflow.com/questions/5605108/pack-unpack-functions-for-node-js">https://stackoverflow.com/questions/5605108/pack-unpack-functions-for-node-js</a></p>
<p>Working code using structjs:</p>
<p>Gist: <a href="https://gist.github.com/dwblair/cc651bcb3bd11f13840c074c80bd924b">https://gist.github.com/dwblair/cc651bcb3bd11f13840c074c80bd924b</a></p>
<p>Structjs: <a href="https://github.com/lyngklip/structjs">https://github.com/lyngklip/structjs</a></p>
<p>Working repository (needed to make it a 'type':'module' ... ?): <a href="https://github.com/dwblair/js-python-struct-converter">https://github.com/dwblair/js-python-struct-converter</a></p>
<h1>Sending / relaying data on server / rock7 side</h1>
<p>rockblock webhooks: <a href="https://docs.rockblock.rock7.com/docs/integration-with-application">https://docs.rockblock.rock7.com/docs/integration-with-application</a></p>
<h1>Data compression for rockblock</h1>
<p>Suggestions on compressing data for the rockblock <a href="https://docs.rockblock.rock7.com/docs/compressing-your-data">https://docs.rockblock.rock7.com/docs/compressing-your-data</a></p>
<h1>Adaptive retry for rockblock</h1>
<p><a href="https://docs.rockblock.rock7.com/docs/adaptive-retry">https://docs.rockblock.rock7.com/docs/adaptive-retry</a></p>
<h1>Rockblock Credit System</h1>
<blockquote>
<p>Credits are used each time you transmit. 1 credit is used per 50 bytes (or part thereof) of message sent or received. 1 credit is also used if you check your mailbox and there are no messages waiting (A mailbox check). Credits do not expire unless you do not use your account at all for 12 months. Credits are shared/pooled between all of the devices on your account</p>
</blockquote>
<p><a href="https://docs.rockblock.rock7.com/docs/iridium-contract-costs">https://docs.rockblock.rock7.com/docs/iridium-contract-costs</a></p>
<hr>
<h1>Update Jan 31 2023</h1>
<p>Rockblock is sending depth data, pulling readings from analog pin on the depth sensor. The Circuipython firmware is v 7.X, and is from here: <a href="https://github.com/dwblair/rockblock-ultrasonic/tree/main/firmware/v1">https://github.com/dwblair/rockblock-ultrasonic/tree/main/firmware/v1</a></p>
<p>The rockblock sends it data to the rockblock server, which has a 'webhook' that sends an HTTP POST JSON of data to 159.65.226.222:4000</p>
<p>The firmware on the rockblock encodes its data using a python struct approach</p>
<p>A 'relay server' is running at 159.65.226.222:4000, using code from here: <a href="https://github.com/edgecollective/iridium-bayou-relay">https://github.com/edgecollective/iridium-bayou-relay</a>. The relay server decodes the data using a js version of the python struct approach, and then does an HTTP POST of the data to bayou.pvos.org at the '2ifhwi34ue4j' data feed</p>
<hr>
<h1>Update Mar 7 2023</h1>
<p>Sleep stats for Feather S2: <a href="https://learn.adafruit.com/adafruit-esp32-feather-v2/power-management">https://learn.adafruit.com/adafruit-esp32-feather-v2/power-management</a></p>
<p>Smaller sharp display (adafruit product) -- <a href="https://www.digikey.com/en/products/detail/adafruit-industries-llc/3502/7386264">https://www.digikey.com/en/products/detail/adafruit-industries-llc/3502/7386264</a></p>
<p>Larger sharp display: <a href="https://www.digikey.com/en/products/detail/sharp-microelectronics/LS013B7DH03/5300387">https://www.digikey.com/en/products/detail/sharp-microelectronics/LS013B7DH03/5300387</a></p>
<p>Sharp memory family <a href="https://www.mouser.com/datasheet/2/365/Sharp_Memory_LCD_Brochure_2015-746065.pdf">https://www.mouser.com/datasheet/2/365/Sharp_Memory_LCD_Brochure_2015-746065.pdf</a></p>
<hr>
<h1>Update Mar 8 2023</h1>
<p>Sleep mode in Feather ESP32 S2 TFT</p>
<p><a href="https://learn.adafruit.com/deep-sleep-with-circuitpython/power-consumption">https://learn.adafruit.com/deep-sleep-with-circuitpython/power-consumption</a></p>


    </div>
  </body>
</html>

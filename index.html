

<!-- feed it through our cssmin filter to minify -->
<style>
  body{font-family:sans-serif;margin:20px;font-size:small;width:90%;margin-right:auto;margin-left:auto;padding-top:15px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:small;margin-bottom:1px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding-right:20px}.post .post-contents{background:#f7f7f7;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}.post .text{height:200px;padding:20px}@media (max-width:680px){.post{width:100%}}body{font:13px/1.5 Verdana,Helvetica,Arial,sans-serif;width:80%}.img-with-caption{font-size:14px;text-align:center;margin:20 0;background-color:F1F1F1;padding:10px}#pullout{text-align:center}#intro{max-width:700px;display:inline-block;text-align:left}#post-content{max-width:800px}#profile_pic{float:right;margin:0 0 1em 1em}h1{line-height:1em;font-size:x-large;margin-bottom:.31em}h2{font-size:large;margin-bottom:1px}h3{font-size:medium;margin-bottom:1px}ol,ul{max-width:650px}a{text-decoration:none}a:hover{text-decoration:underline}a:visited{color:#00f}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.posts-area{width:100%;padding-top:10px}.posts-area:after{content:"";display:table;clear:both}.post{float:left;width:33.33%;padding:0 20px 20px 0}.contribute{width:100%;padding-top:10px}.post .post-contents{border-radius:10px;padding:20px 20px 10px 20px}.post .project-contents{background:#add8e6;border-radius:10px;padding:20px 20px 10px 20px}.post .podcast-contents{background:#e9967a;border-radius:10px;padding:20px 20px 10px 20px}.post .note-contents{background:#e6e6fa;border-radius:10px;padding:20px 20px 10px 20px}.post .pedagogy-contents{background:#90ee90;border-radius:10px;padding:20px 20px 10px 20px}.post .talk-contents{background:pink;border-radius:10px;padding:20px 20px 10px 20px}.post .inter-contents{background:#add8e6;border-radius:5px}.post .image a{display:block;overflow:hidden;height:214px}.post img{object-fit:cover;width:100%;height:100%}img{max-height:500px;max-width:100%}table{margin:30 auto 30 auto;padding:10px;width:80%;text-align:left;border:1px solid #000}td{padding:10px;text-align:left;font-size:12}.post .text{min-height:250px;padding:5px}.post .inter-text{height:250px}audio{width:100%;height:30px}@media (max-width:1100px){.post{width:100%}table{width:100%}}
</style>


<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="/img/edge_favicon.png" />

    <title>Edge Collective</title>
  </head>
  <body>
    <!--<img src="/img/edge_medium.png" id="profile_pic"/>-->
<div id='pullout'>
<!--<img src="/img/edge_flower_medium.png">-->
<img src="/img/ec_flower_logo_small.png">
<h1> Edge Collective </h1>
<!--
*Accessible infrastructure for communities living at ‘the edge'.*
-->
<!--
[Podcast](#podcast) | [Projects](#projects) | [Guides](#guides) | [Presentations](#talks) | [Research](#notebook)
-->
<p><a href="#projects">Projects</a> | <a href="#notebook">Research</a> | <a href="#talks">Presentations</a> |  <a href="#guides">Guides</a></p>
<div id='intro'>
<p><a href="/about">Edge Collective</a> is a distributed <strong>research</strong>, <strong>teaching</strong>, and <strong>facilitation</strong> cooperative working to help individuals and communities increase the capacity of their vital <strong>food</strong>, <strong>water</strong>, <strong>energy</strong>, and <strong>communications infrastructure</strong> to adapt to challenging environments. All of the research, designs, and code that we produce is <a href="https://github.com/edgecollective">freely available online</a>.  We support our research, projects, and teaching through <a href="https://opencollective.com/edgecollective">donations</a> and via 'pay-as-you-can' arrangements.</p>
<p>You can reach us at <strong>collaborate (at) edgecollective (dot) io</strong> -- cheers!</p>
<!-- <p><a href="http://edgecollective.io">edgecollective.io</a> | contact us at: collaborate @ edgecollective.io</p>-->
</div>
</div>
<!--
# <a name="podcast"></a>Podcast


To subscribe, copy the following feed link into your favorite podcast app: ```https://edgecollective.io/podcast/feed.xml```  

And if you'd like to help support our podcast, you can now do so via [Patreon](https://www.patreon.com/edgecollective). Thanks!  


<div class="posts-area">

  <div class="post">
    <div class="podcast-contents">
      <div class="image">
        <a href="/posts/podcast/tom/">
          <img src="img/tom.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/podcast/tom/">The Future of Small Farms</a></h3>
        <p><audio controls id="music"><source src="/audio/tom_audio.m4a" type="audio/mpeg">Your browser does not support the audio element.</audio> </br> </br> Interview with Tom Prohl of Wolfesneck Farm.</p>
        <em>Recorded: 2020-05-19</em>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="podcast-contents">
      <div class="image">
        <a href="/posts/podcast/libre/">
          <img src="img/talks/libre.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/podcast/libre/">Stewarding Technological Freedom in Agriculture</a></h3>
        <p><audio controls id="music"><source src="/audio/libre.mp3" type="audio/mpeg">Your browser does not support the audio element.</audio> </br> </br> Discussion with Mike Stenta, Jamie Gaehring, and Don Blair.  Originally recorded for LibrePlanet2020.</p>
        <em>Recorded: 2020-03-13</em>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="podcast-contents">
      <div class="image">
        <a href="/posts/podcast/hamish/">
          <img src="img/talks/hamish.jpeg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/podcast/hamish/">A History of IndyMedia</a></h3>
        <p><audio controls id="music"><source src="/audio/hamish_indymedia_cop25.mp3" type="audio/mpeg">Your browser does not support the audio element.</audio> </br> </br> Interview with Hamish Campbell about his perspective on -- and role in -- the history of IndyMedia.</p>
        <em>Recorded: 2019-12-06</em>
      </div>
    </div>
  </div>

</div>
-->
<h1><a name="projects"></a>Projects</h1>
<div class="posts-area">
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/mothbot/">
          <img src="/img/mothbot/mothbot.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/mothbot/">Mothbot -- Convivial Radio Microcontroller  Design</a></h3>
        <p>Designing an accessible and easy-to-assemble radio device for use in environmental monitoring and education.</p>
        <em>Updated: 2021-01-12</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/co2/">
          <img src="img/co2/rev_e_built.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/co2/">Developing a Free and Open Source CO2 Sensor System</a></h3>
        <p>Developing an Free and Open Source end-to-end system for CO2 monitoring.</p>
        <em>Updated: 2020-12-06</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/chappy/">
          <img src="img/chappy/chap_front.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/chappy/">Water Level Monitoring on Chappaquiddick Island, Massachusetts (USA)</a></h3>
        <p>Radio + WiFi + Ultrasonic tide monitoring.</p>
        <em>Updated: 2020-07-17</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/wnf/">
          <img src="img/wnf/greenhouse.JPG"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/wnf/">Greenhouse Monitoring at Wolfe's Neck Farm in Freeport, Maine (USA).</a></h3>
        <p>Setting up a LoRa- and WiFi- based greenhouse monitoring system.</p>
        <em>Updated: 2020-05-11</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/floodsense/">
          <img src="img/nola/flood_sensor.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/floodsense/">Flood Sensing in New Orleans, Louisiana (USA)</a></h3>
        <p>Collaborating on the FloodSense project with NOLAFlotilla.</p>
        <em>Updated: 2020-05-11</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/valedalama/">
          <img src="/img/valedalama/cover.JPG"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/valedalama/">Soil and Greenhouse Monitoring at Quinta Vale da Lama in Odiáxere, Faro District (Portugal)</a></h3>
        <p>Prototyping a LoRa- and wifi-based system for Soil moisture and temperature, as well as ambient temperature humidty and soil temperture inside a greenhouse.</p>
        <em>Updated: 2020-12-18</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/colorado/">
          <img src="/img/harold/fields.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/colorado/">Soil Monitoring System in Olathe, Colorado (USA)</a></h3>
        <p>Developing a Free and Open Source LoRa-based system (softwarre, hardware); prototyping a remote node for capturing relaying data from an SDI-12 - based soil moisture sensor.</p>
        <em>Updated: 2020-05-10</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/belfast/">
          <img src="img/belfast/belfast.jpeg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/belfast/">Coastal Tide Monitoring in Belfast, Maine (USA)</a></h3>
        <p>(With Dave Sprague and friends in Belfast, ME -- water level via Radio + WiFi + pressure sensor.</p>
        <em>Updated: 2020-02-17</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="project-contents">
      <div class="image">
        <a href="/posts/projects/knuth/">
          <img src="/img/field_1/cell_kit.JPG"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/projects/knuth/">Soil Monitoring System in Mead, Nebraska (USA)</a></h3>
        <p>Developing a system for capturing soil moisture measurements from a remote field site, using wifi, LoRa, and cellular communications.</p>
        <em>Updated: 2019-07-24</em>
      </div>
    </div>
  </div>
</div>
<h1><a name="guides"></a>Guides</h1>
<div class="posts-area">
  <div class="post">
    <div class="pedagogy-contents">
      <div class="image">
        <a href="/posts/tutorials/circuitpy_farmos/">
          <img src="img/circuitpy_lora/circuitpy_farmos.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/tutorials/circuitpy_farmos/">Using Circuitpython to send data to FarmOS</a></h3>
        <p>Connecting a Circuitpython sensor to FarmOS, using a 'remote node' + 'single-channel gateway' approach.  Specific example uses an Adafruit ItsyBitsy M4, Adafruit LoRa Breakout, and Adafruit Airlift Breakout</p>
        <em>Updated: 2020-05-15</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="pedagogy-contents">
      <div class="image">
        <a href="/posts/tutorials/circuitpy_lora/">
          <img src="img/circuitpy_lora/circuitpy_lora_demo.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/tutorials/circuitpy_lora/">Simple Circuitpython LoRa Demo</a></h3>
        <p>Simple Circuipython LoRa radio send & receive demo.</p>
        <em>Updated: 2020-05-11</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="pedagogy-contents">
      <div class="image">
        <a href="/posts/tutorials/local_lora/">
          <img src="img/local_first_lora/local_first_snap.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/tutorials/local_lora/">Local First Lora Networks</a></h3>
        <p>Developing a design for a 'local first' approach to farm networking.</p>
        <em>Updated: 2020-05-01</em>
      </div>
    </div>
  </div>
</div>
<h1><a name="talks"></a>Presentations</h1>
<div class="posts-area">
  <div class="post">
    <div class="talk-contents">
      <div class="image">
        <a href="/posts/talks/datcon2020/">
          <img src="img/talks/using_dat.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/talks/datcon2020/">Using Dat & Hyper in Agroecology</a></h3>
        <p>Video of talk 'Using Dat & the Hyper Stack in Agroecology', presented at the 2020 Dat Conference.</p>
        <em>Updated: 2020-08-15</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="talk-contents">
      <div class="image">
        <a href="/posts/talks/degrowthvienna_2020/">
          <img src="img/notes/degrowth.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/talks/degrowthvienna_2020/">Design Patterns for Degrowth ICT</a></h3>
        <p>Video of talk 'Design Patterns for Degrowth ICT', presented at Degrowth Vienna 2020, as well as at SCORAI 2020.</p>
        <em>Updated: 2020-06-14</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="talk-contents">
      <div class="image">
        <a href="/posts/talks/libreplanet_2020/">
          <img src="img/notes/stewarding.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/talks/libreplanet_2020/">Stewarding Technological Freedom in Agriculture</a></h3>
        <p>Video of talk presented at the LibrePlanet2020 conference by Mike Stenta, Jamie Gaehring, and Don Blair</p>
        <em>Updated: 2020-04-14</em>
      </div>
    </div>
  </div>
</div>
<h1><a name="notebook"></a>Research Notebook</h1>
<div class="posts-area">
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/pbot/">
          <img src="/img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/pbot/">PBot</a></h3>
        <p><b>Passagassawakeag Bot.</b> Environmental monitoring for education, farming, water montoring.  Free and Open Source, modular; easy to assemble, easy to deploy, easy to redesign with open source tools.</p>
        <em>Updated: 2021-01-25</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/tide/">
          <img src="/img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/tide/">Flood / Tide Sensor</a></h3>
        <p>Flood / tide sensor prototyping</p>
        <em>Updated: 2020-01-18</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/scale/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/scale/">DIY load scale measurement</a></h3>
        <p>Load scale measurements using FOS software + hardware</p>
        <em>Updated: 2020-12-23</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/sdr/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/sdr/">Software Defined Radio (SDR) Experiments</a></h3>
        <p>Experiments in software defined radio.</p>
        <em>Updated: 2020-12-05</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/depth_sensing/">
          <img src="/img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/depth_sensing/">DIY Depth Sensing</a></h3>
        <p>Experiments in depth sensing</p>
        <em>Updated: 2020-11-25</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/compressed_air/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/compressed_air/">Compressed air energy storage</a></h3>
        <p>Reserach into compressed air energy storage</p>
        <em>Updated: 2020-11-25</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/omnivore/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/omnivore/">Off-grid battery control</a></h3>
        <p>Omnivore design for a multi-purpose buck/boost battery system</p>
        <em>Updated: 2020-11-19</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/bluetooth/">
          <img src="/img/co2/nrf52_pinout.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/bluetooth/">Bluetooth experiments</a></h3>
        <p>Experiments with Bluetooth microcontrollers</p>
        <em>Updated: 2020-11-15</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/e_ink/">
          <img src="/img/eink/map_proto.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/e_ink/">E-Ink Map Display Prototyping</a></h3>
        <p>Setting up a (low power?) E-Ink display with a micro</p>
        <em>Updated: 2020-11-08</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/greenhouse_stack/">
          <img src="/img/valedalama/greenhouse_stack.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/greenhouse_stack/">Greenhouse Monitoring, 'Full Stack'</a></h3>
        <p>Instructions for End-to-End Greenhouse monitoring stack</p>
        <em>Updated: 2020-11-02</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/alt_server/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/alt_server/">P2P / DIY Server</a></h3>
        <p>P2P Farm server prototyping</p>
        <em>Updated: 2020-10-20</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/micro_hid/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/micro_hid/">Microcontroller HID input</a></h3>
        <p>Notes on setting up microcontrollers as HID devices</p>
        <em>Updated: 2020-10-18</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/terrapin/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/terrapin/">Terrapin Tracking</a></h3>
        <p>Notes on animal tracking for conservation</p>
        <em>Updated: 2020-10-17</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/podcast_infrastructure/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/podcast_infrastructure/">Podcasting Infrastructure</a></h3>
        <p>Notes on setting up podcasting infrastructure</p>
        <em>Updated: 2020-10-17</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/hyper/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/hyper/">Experiments with the Hyper Protocol</a></h3>
        <p>Experiments with the Hyper Protocol</p>
        <em>Updated: 2020-10-08</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/vale_remote/">
          <img src="/img/valedalama/3d_render.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/vale_remote/">Vale da Lama Greenhouse Monitoring</a></h3>
        <p>Greenhouse monitoring electronics at Vale da Lama</p>
        <em>Updated: 2020-10-20</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/conductivity/">
          <img src="img/placeholder.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/conductivity/">DIY Conductivity Sensor</a></h3>
        <p>Notes on development of DIY conductivity sensors</p>
        <em>Updated: 2020-10-01</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/co2/">
          <img src="/img/co2/rev_a_proto.jpeg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/co2/">DIY CO2 Monitoring</a></h3>
        <p>Notes on inexpensive CO2 monitoring options</p>
        <em>Updated: 2020-10-22</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/heltec/">
          <img src="/img/heltec/heltec_login.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/heltec/">Inexpensive Heltec WiFi + LoRa Gateway Setup</a></h3>
        <p>Notes on setting up a Heltec device.</p>
        <em>Updated: 2020-09-24</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/lincoln/">
          <img src="img/lincoln/mesh.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/lincoln/">Radiohead LoRa Mesh Field Test</a></h3>
        <p>Test of Radiohead mesh networking functionality.</p>
        <em>Updated: 2020-09-14</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/mothbot/">
          <img src="/img/mothbot/mothbot.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/mothbot/">Mothbot Prototyping</a></h3>
        <p>Prototyping the Mothbot -- an Arduino-compatible LoRa node for remote monitoring applications.</p>
        <em>Updated: 2020-10-05</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/newfound/">
          <img src="img/newfound/IMG_20200830_111611868_HDR.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/newfound/">Meshtastic Test at Newfound Lake</a></h3>
        <p>Using the Meshtastic Python API to perform some basic range tests of the Meshtastic system at Newfound Lake in Bristol, NH.</p>
        <em>Updated: 2020-08-30</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/proto1/">
          <img src="/img/proto1/proto.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/proto1/">Low Power experiments with SAMD21</a></h3>
        <p>Seeing what low current sleep modes are possible with various hardware designs.</p>
        <em>Updated: 2020-09-14</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/signal_strength/">
          <img src="/img/signal_strength/fresnel.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/signal_strength/">Predicting Line-of-Sight Locations</a></h3>
        <p>Collecting tools for estimating line-of-sight locations based on topography.</p>
        <em>Updated: 2020-08-27</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/ssb/">
          <img src="/img/Hermies.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/ssb/">Custom Location for Secure Scuttlebutt Data</a></h3>
        <p>How to set up a custom database directory location for Secure Scuttlebutt (SSB) (enabling e.g. storage of SSB on a portable drive).</p>
        <em>Updated: 2020-08-26</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/simplemesh/">
          <img src="/img/proto2/proto.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/simplemesh/">Simple LoRa Mesh</a></h3>
        <p>Experiments with the Radiohead RHMesh approach.</p>
        <em>Updated: 2020-08-22</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/quahogdebug/">
          <img src="img/notebook/quahog_debug/q_debug.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/quahogdebug/">Quahog Debug</a></h3>
        <p>Revising the Quahog ESP32 + LoRa circuit</p>
        <em>Updated: 2020-08-27</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/mesh/">
          <img src="img/mesh/hello.png"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/mesh/">LoRa Mesh Chat</a></h3>
        <p>Experimenting with the Meshtastic system for Android + Bluetooth + LoRa mesh networking.</p>
        <em>Updated: 2020-09-27</em>
      </div>
    </div>
  </div>
  <div class="post">
    <div class="note-contents">
      <div class="image">
        <a href="/posts/notes/lorad/">
          <img src="img/lorad/rough.jpg"/>
        </a>
      </div>
      <div class="text">
        <h3><a href="/posts/notes/lorad/">DIY Low Power Radio Nodes</a></h3>
        <p>Building radio nodes with an eye towards easy assembly and easy sourcing of parts.</p>
        <em>Updated: 2020-08-03</em>
      </div>
    </div>
  </div>
</div>
<!--
# Notes 

<div class="posts-area">

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Rough prototype</h2>
<p>Using a JeeNode and a LoRA FeatherWing ... sleeping at 6 uA!</p>
<p><img src="/img/lorad/rough.jpg" alt="jee"></p>
<h2>LoRa Ra-01</h2>
<p><a href="https://www.openhardware.io/view/395/LoRa-Ra-01-ATmega328P-Node">LoRa Ra-01</a></p>
<p><img src="/img/lorad/node.jpg" alt="lorad"></p>
<h2>JeeNode</h2>
<p><a href="https://jeelabs.org/2009/12/06/building-the-jeenode-v4/">Assembling the JeeNode</a></p>
<p><img src="/img/lorad/jee_assemble.jpg" alt="jee_assemble"></p>
<h2>LoRaWAN MiniBrick</h2>
<p><a href="https://www.tindie.com/products/lps/lorawan-minibrick/">MiniBrick</a></p>
<p><img src="/img/lorad/minibrick.jpg" alt="minibrick"></p>
<h2>Misc Notes</h2>
<p>Using the 328p's internal crystal;  and adding a bootloader -- described <a href="https://www.hackster.io/techmirtz/arduino-without-external-clock-crystal-on-atmega328-d4fcc4">here</a>.</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Meshtastic Project</h2>
<p>Some notes on our experiments with the <a href="https://www.meshtastic.org/">Meshtastic Project</a>.</p>
<p>Check out their <a href="https://meshtastic.letstalkthis.com/">beginner's guide</a>, and their <a href="https://meshtastic.discourse.group/">discussion forum</a>, and watch Andreas Spiess' review of the project:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/TY6m6fS8bxU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/arrow.png"> <img src="/img/mesh/arrow.png" alt="arrow"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2>Heltec Boards</h2>
<p>Picked up some <a href="https://heltec.org/project/wifi-lora-32/">Heltec WiFi LoRa 32 V2</a> boards -- one of the official ports of the Meshtastic project.  Was very easy to get up and running.  Did a quick test by controlling one of the devices (taped in my home window) via a Python script on a PC (using the Meshtastic-python API), and using it to send out pings every 10 seconds to the network; meanwhile I drove around the neighborhood with the other device connected to my Android phone via Bluetooth.</p>
<p>Here's a nice description of the <a href="https://community.hiveeyes.org/t/heltec-wifi-lora-32/3125">Heltec pinout</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/receiving.png"> <img src="/img/mesh/receiving.png" alt="receiving"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/sender_code.png"> <img src="/img/mesh/sender_code.png" alt="sender_code"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/sending.png"> <img src="/img/mesh/sending.png" alt="sending"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/update1/driving.jpeg"> <img src="/img/mesh/update1/driving.jpeg" alt="driving"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/update2/bin.png"> <img src="/img/mesh/update2/bin.png" alt="bin"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/update2/window.png"> <img src="/img/mesh/update2/window.png" alt="window"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/update2/Screenshot_2020-08-16_12-06-16.png"> <img src="/img/mesh/update2/Screenshot_2020-08-16_12-06-16.png" alt="Screenshot_2020-08-16_12-06-16"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2>Quahog</h2>
<p>Got Meshtastic up and running on a <a href="https://edgecollective.io/post/notes/mesh/">Quahog</a> -- a relatively easy-to-assemble ESP32 + RFM9X design.  Just required modifying the 'heltec' LoRa radio GPIO settings in configuration.h in the source code and compiling using Platform.io, as per suggestions on the Meshtastic discourse forum.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/meshtastic.jpeg"> <img src="/img/mesh/meshtastic.jpeg" alt="meshtastic"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Meshtastic running on a Quahog.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mesh/update3/qtest.jpg"> <img src="/img/mesh/update3/qtest.jpg" alt="qtest"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">First message received on the Quahog.</td>
</tr>
</tbody>
</table>
<h2>Meshtastic to connect isolated villages</h2>
<p>Project by Luandro, <a href="https://meshtastic.discourse.group/t/meshtastic-to-connect-isolated-villages/1191">here</a>.</p>
<p>Luandro's public key on Scuttlebutt is here: <code>@2RNGJafZtMHzd76gyvqH6EJiK7kBnXeak5mBWzoO/iU=.ed25519</code></p>
<hr>
<p>2020-12-14 22:00:05</p>
<h2>Cellsol -- IRC over LoRa + ESP32</h2>
<p>Hackaday article <a href="https://hackaday.com/2020/12/12/irc-over-lora-for-when-things-really-go-south/">here</a></p>
<p>Project page <a href="https://www.f3.to/cellsol/">here</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>fixing the bootloader</h2>
<p><a href="https://github.com/espressif/esptool/wiki/ESP32-Boot-Mode-Selection">ESP32 boot mode selection</a></p>
<p>Upshot -- for <a href="https://github.com/edgecollective/hog32">hog32a</a> version:</p>
<ul>
<li>get rid of R4 and C4</li>
<li>place R1, C3, R2, R3, Q1, and Q2</li>
<li>need to connect pin 2 to ground (or it can float; but currently it is used in i2c, and is pulled high with a resistor, so we need to connect it to ground)</li>
<li>need to connect the 'DTR' pin on the CP2104 breakout to the DTR pin on the quahog</li>
</ul>
<p>Once these are done, the board will enter the bootloader automatically.</p>
<h2>flashing using esptool</h2>
<p>Looks like we need to convert the .elf file to a binary image ...</p>
<p>See the <a href="https://github.com/espressif/esptool">guide to esptool</a></p>
<blockquote>
<p>For esp32, elf2image produces a single output binary &quot;image file&quot;. By default this has the same name as the .elf file, with a .bin extension. ie:</p>
</blockquote>
<pre><code>    esptool.py --chip esp32 elf2image my_esp32_app.elf
</code></pre>
<blockquote>
<p>In the above example, the output image file would be called my_esp32_app.bin.</p>
</blockquote>
<p>Actually, checking just now -- platformio generates a 'bin' file directly, so no worries.</p>
<p>need to upload the partitions, too? See <a href="https://github.com/espressif/arduino-esp32/issues/3409">this issue</a></p>
<p><a href="https://robotzero.one/arduino-ide-partitions/">arduino esp32 partitions scheme</a></p>
<p>Setting up <a href="https://www.youtube.com/watch?v=j-Nz14qaNIw">Heltec ESP32 on Arduino</a></p>
<h2>What is working</h2>
<p>If I first erase the chip using:</p>
<pre><code>python esptool.py --chip esp32 erase_flash
</code></pre>
<p>And then use 'adafruit esp32 feather' in the board setup in arduino ide, it seems to just work.  Not sure if I needed simply to erase the flash beforehand.</p>
<h2>Button on Meshtastic</h2>
<p>I was getting 'button press functionality' when running Meshtastic on the Quahog.  I needed to change the quahog Mestastic-device code so that the 'button' was no longer GPIO 0 (default), but GPIO 19 (other pins may also work for this).  This corresponds to 'release/latest/quahog_firmware_v3.bin' in Meshtastic-device-quahog on github.</p>
<h2>Rationale for Quahog</h2>
<p>'Off-grid wifi gateway' ... is this useful?</p>
<p>I guess if you want the Quahog up on a pole ... up to 100 feet away from the wifi gateway... then it can be powered by 12V ... so that might be useful in some circumstances ...</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Overview</h2>
<p>LoRa connectivity (ISM band 900 Mhz in the US) is highly dependent on line-of-sight.  This can be a challenge in many topologies of interest (urban, with buildings; rural, with trees / hills). The typical solution -- mounting a gateway at a very high location, in an attempt to achieve line-of-sight to remote nodes -- is not always feasible.</p>
<p>Non line-of-sight connections are still possible -- they are just very unreliable, and signal strength / connectivity may fluctuate based on the precise orientation and location of any intermediate objects / ground cover.</p>
<p>This is why a 'mesh' networking setup for lora sensor nodes becomes very appealing; one might be able to deploy 'self-healing' collections of nodes that can pass messages along via a chain of connections.</p>
<h2>References</h2>
<p>Basing my experiments on a fantastic writeup by nootropicdesign -- <a href="https://nootropicdesign.com/projectlab/2018/10/20/lora-mesh-networking/">LoRa Mesh Networking with Simple Arduino-Based Modules</a>, and its associated <a href="https://github.com/nootropicdesign/lora-mesh">source code on github</a>.</p>
<p>Also note that there is an RH MESH client example <a href="https://www.airspayce.com/mikem/arduino/RadioHead/rf22_mesh_client_8pde-example.html">here</a> -- though it is currently based on the RF22 radio.</p>
<p>Also notice the other examples of mesh servers and clients <a href="https://www.airspayce.com/mikem/arduino/RadioHead/examples.html">here</a>.</p>
<h2>Near-term Goals</h2>
<ul>
<li>Understanding the flow of data through the mesh to a target node from a source node;</li>
<li>Visualizing the flow of data</li>
<li>Adding GPS in order to track location of at least the source node;</li>
<li>Testing the memory impact on the 328p of using N nodes</li>
</ul>
<h2>Experiments</h2>
<p>I believe that the standard appproach to mesh networking might be simpler than the nootropic design example.  It might simply involve a mesh 'server', and then mesh 'clients'.</p>
<p>A simple verison might only have two types of node:</p>
<ul>
<li>a <a href="https://www.airspayce.com/mikem/arduino/RadioHead/rf22_mesh_server1_8pde-example.html">simple server</a>; and</li>
<li>a <a href="https://www.airspayce.com/mikem/arduino/RadioHead/rf22_mesh_client_8pde-example.html">simple client</a>.</li>
</ul>
<p>Server side:
<img src="/img/proto2/simple_works_server.png" alt="simple works server"></p>
<p>Client side:
<img src="/img/proto2/simple_works.png" alt="simple works"></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Setting up a custom SSB database location</h2>
<p><a href="https://scuttlebutt.nz">Secure Scuttlebutt</a> (SSB) is a peer-to-peer (p2p) social network -- akin to Facebook, but fully decentralized and owned by noone.  Connecting to the SSB network requires a client -- for example, <a href="https://github.com/ssbc/patchwork">Patchwork</a>.</p>
<p>One feature of this p2p network is that you store all of your peer data (your posts, and posts from friends) on your local drive -- which is neat, because it means that all of your data since your last sync is available even if you're offline.</p>
<p>One related caveat is that this means storing a lot of data locally; so it's good to have options for where to store it.</p>
<p>By default, all of your SSB data is stored in your home directory (an obvious location in Linux-based systems; not sure where the default is in Windows / Mac), in a directory called '.ssb'.</p>
<p>If you'd like to store it elsewhere, you can invoke a local installation of Patchwork (at least installations installed via npm) like so:</p>
<pre><code>npm start -- --path ~/Documents/myssb/.ssb
</code></pre>
<p>where in this case '~/Documenst/myssb/.ssb' is your custom (SSB) data directory location (could be external USB drive) for your '.ssb' folder. Seems to work!</p>
<p>Credit for this method goes to an online discussion thread <a href="https://github.com/ssbc/patchwork/issues/822">here</a>.</p>
<p>(To make this easier to invoke on a regular basis, I've posted a <a href="https://gist.github.com/dwblair/951df80d31d2940e55db70b7fd99e5fe">gist</a> with the startup script I use.)</p>
<h2>Dependencies for Patchwork on Ubuntu / Linux-based systems</h2>
<p>Note: I found a hiccup when trying to install Patchwork via npm on my Ubuntu system via 'npm install'.  It was solved by first installing these dependencies:</p>
<pre><code>sudo apt install libx11-dev libxkbfile-dev
</code></pre>
<h2>Further Resources / Links</h2>
<ul>
<li><a href="https://scuttlebutt.nz/">Secure Scuttlebutt</a> -- main site for the p2p networking protocol</li>
<li><a href="https://github.com/ssbc/ssb-server/wiki/pub-servers">Secure Scuttlebutt Pub Servers</a> -- list of servers you can join with a Secure Scuttlebutt 'client'</li>
<li><a href="https://github.com/ssbc/patchwork">Patchwork</a> -- a 'client' for Secure Scuttlebutt</li>
</ul>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>Collecting some tools I'm finding for estimating line-of-sight locations based on topography. Will annotate further as I learn more.</p>
<h2>Ubiquiti AirLink Signal Strength Mapping Tool</h2>
<p><a href="https://link.ui.com/#"><img src="/img/signal_strength/fresnel.png" alt="airlink"></a></p>
<p>The <a href="https://link.ui.com/#">AirLink tool</a> looks really promising!  Its calculations are tailored towards Ubiquiti products; but it will display the height profile and a visualization of the Fresnel zone between any two given points -- which might be really useful for estimating radio signal strength in general for radios (like LoRa) that are heavily dependent on line-of-sight connections.</p>
<h2>Heywhatsthat</h2>
<p><a href="https://www.heywhatsthat.com/"><img src="/img/signal_strength/hey.png" alt="hey"></a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Sparkfun SAMD21 breakout</h2>
<p>Experimenting with the <a href="https://www.sparkfun.com/products/13664">Sparkfun SAMD21 Mini Breakout</a>.
By powering it directly on the 3V line, we avoid the regulator. Was able to achieve 0.03 mA sleep current. Next test will be to put an RFM95 LoRa module in the mix.</p>
<p><img src="/img/proto1/spark_power.png" alt="sparkpower"></p>
<p><img src="/img/proto1/current.jpg" alt="current"></p>
<h2>Adafruit Feather</h2>
<p>Have only been able to achieve 0.2 mA sleep current on this. Somehow disabling the voltage regulator by pulling EN to ground, and powering the device on the 3V line, results in even higher sleep currents.</p>
<p><strong>Update 15 Sep 2020</strong>. Using <a href="https://gist.github.com/dwblair/b69a20dcf87314348bac970db574a723">this code</a> -- on a Feather M0 LoRa without any sensors attached -- was able to get down to 0.09 mA (90 uA). This isn't so far away from what one might expect for the AP2112K LDO used on the Feather (~ 60 uA), plus the M0 itself in standby sleep mode (~ 10 uA), plus the RFM95 radio in sleep mode (a few uA, I believe). Next steps: test sleep current with common sensors, with GPS, etc.</p>
<p><img src="/img/radio.jpg" alt="radio"></p>
<h2>Arm Programming</h2>
<p>Nice <a href="https://learn.sparkfun.com/tutorials/arm-programming?_ga=2.31674685.2071070740.1598130081-351514117.1580570302">notes on ARM programming</a> from Sparkfun.</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>This weekend we used the <a href="https://github.com/meshtastic/Meshtastic-python">Meshtastic Python API</a> to perform some basic range tests of the <a href="https://www.meshtastic.org/">Meshtastic</a> LoRa mesh networking communications system, around the lake at Newfound Lake in Bristol, NH.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111617074_HDR.jpg"> <img src="/img/newfound/IMG_20200830_111617074_HDR.jpg" alt="IMG_20200830_111617074_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://community.hiveeyes.org/t/heltec-wifi-lora-32/3125">Heltec</a> widget set up as a automated <a href="https://www.meshtastic.org/">Meshtastic</a> LoRa mesh 'base station' node in a cabin on a lake. It's run by a <a href="https://github.com/meshtastic/Meshtastic-python">Mesthastic-python</a> script that replies to any messages sent to it with the SNR of the incoming message.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/locations.png"> <img src="/img/newfound/locations.png" alt="locations.png"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">The locations of various nodes in this experiment. With respect to the <strong>base station</strong> node, the <strong>kayak</strong> node is in a landscape-induced 'radio shadow' (the coast has steep hillsides), so that the only viable LoRa radio path from base station to kayak is via the <strong>relay</strong> node.</td>
</tr>
</tbody>
</table>
<h2>Background</h2>
<p>The goal was to test ‘hop’ dynamics with a system of 3 Meshtastic nodes, by first setting up a ‘base station sender’ and a ‘target receiver’ on opposite sides of a hill that blocks direct LoRa transmission; and then placing a ‘relay’ node on the ‘corner’ of that hill, so that messages might ‘hop’ around it.</p>
<p>The ‘sender’ was located in a cabin on a lake, and was controlled by Meshtastic-python, using a script (linked to in the above post) that would ‘reply’ to received messages with the SNR of the incoming message. The idea was that from the field I could send messages from my ‘end node’ (controlled via the Android app), and if the ‘relay’ node was able to relay my message via a ‘hop’ to the ‘base station sender’, I might ultimately get a reply relayed back to me at the end node.</p>
<p>I was able to nicely communicate among all the nodes directly; but in my quick test wasn’t able to accomplish a ‘hop’. Not yet sure why, but my test was a bit goofy and rushed, so I might have been doing something dumb. The ‘hop_limit’ parameter seems to have been set to ‘1’ – which should allow a single hop beyond the immediately adjacent nodes, from what I understand ... need to dig in further.</p>
<p>Below are some hastily-assembled data and scripts; will hope to organize this into a narrative account ASAP.</p>
<h2>Example Mesthastic-Python script</h2>
<p>A link to some of the Meshtastic-Python scripts we played with is <a href="https://github.com/edgecollective/meshtastic-python-experiments">here</a>.</p>
<pre><code class="language-python">import meshtastic
import time
from pubsub import pub

def onReceive(packet): # called when a packet arrives
    print(f&quot;Received: {packet}&quot;)
    if packet['decoded']['data'] is not None:
        msg = packet['decoded']['data']['text']
        rxSnr = packet['rxSnr']
        hopLimit = packet['hopLimit']
        print(f&quot;message: {msg}&quot;)
        reply=&quot;got msg \'{}\' with rxSnr: {} and hopLimit: {}&quot;.format(msg,rxSnr,hopLimit)
        print(&quot;Sending reply: &quot;,reply)
        interface.sendText(reply)

def onConnection(): # called when we (re)connect to the radio
    # defaults to broadcast, specify a destination ID if you wish
    interface.sendText(&quot;hello mesh&quot;)

pub.subscribe(onReceive, &quot;meshtastic.receive&quot;)
pub.subscribe(onConnection, &quot;meshtastic.connection.established&quot;)
interface = meshtastic.StreamInterface()
</code></pre>
<h2>Example Mesthastic-Python script output</h2>
<blockquote>
<p>Received: {'from': 3520888364, 'to': 4294967295, 'decoded': {'data': {'typ': 'CLEAR_TEXT', 'payload': 'dGVzdDc=', 'text': 'test7'}}, 'id': 2204634416, 'rxSnr': 3.0, 'hopLimit': 1, 'fromId': None, 'toId': '^all'}</p>
</blockquote>
<blockquote>
<p>message: test7</p>
</blockquote>
<blockquote>
<p>Sending reply:  got msg 'test7' with rxSnr: 3.0 and hopLimit: 1</p>
</blockquote>
<hr>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-123404.png"> <img src="/img/newfound/screen/Screenshot_20200830-123404.png" alt="Screenshot_20200830-123404"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-121357.png"> <img src="/img/newfound/screen/Screenshot_20200830-121357.png" alt="Screenshot_20200830-121357"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-123413.png"> <img src="/img/newfound/screen/Screenshot_20200830-123413.png" alt="Screenshot_20200830-123413"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-112105.png"> <img src="/img/newfound/screen/Screenshot_20200830-112105.png" alt="Screenshot_20200830-112105"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-124655.png"> <img src="/img/newfound/screen/Screenshot_20200830-124655.png" alt="Screenshot_20200830-124655"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-115555.png"> <img src="/img/newfound/screen/Screenshot_20200830-115555.png" alt="Screenshot_20200830-115555"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-121245.png"> <img src="/img/newfound/screen/Screenshot_20200830-121245.png" alt="Screenshot_20200830-121245"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-122047.png"> <img src="/img/newfound/screen/Screenshot_20200830-122047.png" alt="Screenshot_20200830-122047"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/screen/Screenshot_20200830-115714.png"> <img src="/img/newfound/screen/Screenshot_20200830-115714.png" alt="Screenshot_20200830-115714"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114603940.jpg"> <img src="/img/newfound/IMG_20200830_114603940.jpg" alt="IMG_20200830_114603940"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114936175_HDR.jpg"> <img src="/img/newfound/IMG_20200830_114936175_HDR.jpg" alt="IMG_20200830_114936175_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_120847462.jpg"> <img src="/img/newfound/IMG_20200830_120847462.jpg" alt="IMG_20200830_120847462"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_115532279.jpg"> <img src="/img/newfound/IMG_20200830_115532279.jpg" alt="IMG_20200830_115532279"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114310446_HDR.jpg"> <img src="/img/newfound/IMG_20200830_114310446_HDR.jpg" alt="IMG_20200830_114310446_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111650561.jpg"> <img src="/img/newfound/IMG_20200830_111650561.jpg" alt="IMG_20200830_111650561"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_122019615.jpg"> <img src="/img/newfound/IMG_20200830_122019615.jpg" alt="IMG_20200830_122019615"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_120908720.jpg"> <img src="/img/newfound/IMG_20200830_120908720.jpg" alt="IMG_20200830_120908720"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_130845706.jpg"> <img src="/img/newfound/IMG_20200830_130845706.jpg" alt="IMG_20200830_130845706"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_115540242.jpg"> <img src="/img/newfound/IMG_20200830_115540242.jpg" alt="IMG_20200830_115540242"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_120856393.jpg"> <img src="/img/newfound/IMG_20200830_120856393.jpg" alt="IMG_20200830_120856393"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_122032159.jpg"> <img src="/img/newfound/IMG_20200830_122032159.jpg" alt="IMG_20200830_122032159"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_122022494.jpg"> <img src="/img/newfound/IMG_20200830_122022494.jpg" alt="IMG_20200830_122022494"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_130853240.jpg"> <img src="/img/newfound/IMG_20200830_130853240.jpg" alt="IMG_20200830_130853240"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111632368.jpg"> <img src="/img/newfound/IMG_20200830_111632368.jpg" alt="IMG_20200830_111632368"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114323793.jpg"> <img src="/img/newfound/IMG_20200830_114323793.jpg" alt="IMG_20200830_114323793"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_121654604.jpg"> <img src="/img/newfound/IMG_20200830_121654604.jpg" alt="IMG_20200830_121654604"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_122318035.jpg"> <img src="/img/newfound/IMG_20200830_122318035.jpg" alt="IMG_20200830_122318035"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111611868_HDR.jpg"> <img src="/img/newfound/IMG_20200830_111611868_HDR.jpg" alt="IMG_20200830_111611868_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111400570.jpg"> <img src="/img/newfound/IMG_20200830_111400570.jpg" alt="IMG_20200830_111400570"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111624205.jpg"> <img src="/img/newfound/IMG_20200830_111624205.jpg" alt="IMG_20200830_111624205"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_123023686.jpg"> <img src="/img/newfound/IMG_20200830_123023686.jpg" alt="IMG_20200830_123023686"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_115528816_HDR.jpg"> <img src="/img/newfound/IMG_20200830_115528816_HDR.jpg" alt="IMG_20200830_115528816_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114804035.jpg"> <img src="/img/newfound/IMG_20200830_114804035.jpg" alt="IMG_20200830_114804035"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_110618746.jpg"> <img src="/img/newfound/IMG_20200830_110618746.jpg" alt="IMG_20200830_110618746"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_122026884_HDR.jpg"> <img src="/img/newfound/IMG_20200830_122026884_HDR.jpg" alt="IMG_20200830_122026884_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_130840593.jpg"> <img src="/img/newfound/IMG_20200830_130840593.jpg" alt="IMG_20200830_130840593"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_115535009.jpg"> <img src="/img/newfound/IMG_20200830_115535009.jpg" alt="IMG_20200830_115535009"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_111644049.jpg"> <img src="/img/newfound/IMG_20200830_111644049.jpg" alt="IMG_20200830_111644049"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_112506116.jpg"> <img src="/img/newfound/IMG_20200830_112506116.jpg" alt="IMG_20200830_112506116"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114553112_HDR.jpg"> <img src="/img/newfound/IMG_20200830_114553112_HDR.jpg" alt="IMG_20200830_114553112_HDR"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_120902450.jpg"> <img src="/img/newfound/IMG_20200830_120902450.jpg" alt="IMG_20200830_120902450"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/IMG_20200830_114338715.jpg"> <img src="/img/newfound/IMG_20200830_114338715.jpg" alt="IMG_20200830_114338715"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/newfound/arrival.jpg"> <img src="/img/newfound/arrival.jpg" alt="arrival.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Table of Contents</h2>
<ul>
<li><a href="#mothbot_ver3_parts">Mothbot Version 3 Parts List</a></li>
</ul>
<h2>TODO</h2>
<ul>
<li>Cite the JeeLab post on running the 328p at 3.3V and 16MHz, using UNO bootloader</li>
</ul>
<h2>Background</h2>
<p>Mothbot is based on the initial JeeNode design by JeeLabs.</p>
<p>It's similar to many 'minimal Arduino' designs.  For example:</p>
<ul>
<li>Jameco 'build your own arduino' <a href="https://www.jameco.com/webapp/wcs/stores/servlet/Product_10001_10001_2151259_-1">kit</a></li>
<li>associated <a href="https://www.jameco.com/jameco/workshop/jamecobuilds/arduinocircuit.html">tutorial</a></li>
</ul>
<h2>Burning a bootloader on a 328P using a 328P</h2>
<p>Guide <a href="http://www.vwlowen.co.uk/arduino/bootloader/page2.htm">here</a></p>
<h2>First Build of the Mothbot</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3588DGfwW04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/parts.jpg"> <img src="/img/mothbot/parts.jpg" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2>First Build Notes / Revision Ideas</h2>
<ul>
<li>Should we break out a 0.1&quot; i2c header, compatible with an SSD1306 display?  Maybe that's overkill for this project ...</li>
<li>The footprints for the resistors should be longer</li>
<li>soldermask on the antenna hole -- no good -- need to use another approach for making that hole</li>
<li>add pinout for the higher-voltage DC-DC?  maybe it feeds directly into the 3.3V LDO, too ... or can add jumpers</li>
<li>radio configuration where there's a relay that is constantly 'on' on top of a pole ... powered by 12V bat ... 12V bat being the go-to off-grid battery ...</li>
<li>reorient the power VIN + GND so that the cable will trail / orient towards the ground allowing a vertical antenna? add a mechanical relief location?</li>
<li><strong>BIG</strong> -- caps on power circuit should be 1uF.  Pin order messed up on MCP1700.</li>
<li>soldering the RFM95 -- really need to 'flood' the casselated pins in order for them to be connected properly -- would be good to have a diagnostic</li>
</ul>
<h2>KiCAD notes</h2>
<h3>Custom footprint as logo in KiCAD</h3>
<p>Use the 'Bitmap to component converter' in the main KiCad window (the bitmappy-looking 'a' in the below screenshot) to convert a bitmap to a footprint.  Then you can import this footprint directly to the PCB layout (no need to have an associated symbol), as a logo.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/converter.png"> <img src="/img/mothbot/converter.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Screenshot highlighting the 'bitmap to component converter'</td>
</tr>
</tbody>
</table>
<h3>Design Rules / Templates for OSHPark</h3>
<p><a href="https://docs.oshpark.com/design-tools/kicad/kicad-design-rules/">This guide</a> has some nice info.</p>
<h2>Reference for QWIIC connector</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/qwiic.png"> <img src="/img/mothbot/qwiic.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Sparkfun 'QWIIC' I2C Connector</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/qwiic_board.png"> <img src="/img/mothbot/qwiic_board.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Sparkfun 'QWIIC' I2C Connector</td>
</tr>
</tbody>
</table>
<p><a href="https://www.sparkfun.com/qwiic">Sparkfun QWIIC reference</a></p>
<p><a href="https://www.adafruit.com/product/4208">JST SH 4 Pin Connector</a></p>
<p><a href="https://www.adafruit.com/product/4210">Adafruit reference for JST SH 4 Pin QWIIC Pin Ordering</a></p>
<h2>Adding a reset button</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/reset_button.png"> <img src="/img/mothbot/reset_button.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Footprint for KMR2 pushbutton</td>
</tr>
</tbody>
</table>
<h2>Adding a DC-DC converter footprint</h2>
<p><a href="https://www.adafruit.com/product/1065">TSR12450 Converter</a> -- 5V output</p>
<p><a href="https://www.adafruit.com/product/1066">TSR12433 Converter</a> -- 3.3V output</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/dc_dc.png"> <img src="/img/mothbot/dc_dc.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Pinout for DC-DC</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/dcdc_bottom.png"> <img src="/img/mothbot/dcdc_bottom.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Footprint for DC-DC</td>
</tr>
</tbody>
</table>
<hr>
<h2>Misc Notes</h2>
<h3>Aside on STM32</h3>
<p>Nice note on <a href="https://jeelabs.org/2015/11/25/pi-based-stm32f103-development/index.html">STM32 boards</a> from Jeenode, by the way.</p>
<h3>Installing Arduino Libraries</h3>
<p>Adafruit tutorail on installing Arduino libraries <a href="https://learn.adafruit.com/adafruit-all-about-arduino-libraries-install-use">here</a>.</p>
<hr>
<h2>Sensor notes</h2>
<h3>HC-SR04</h3>
<p><a href="https://www.adafruit.com/product/3942">Adafruit page</a></p>
<h3>SHT10</h3>
<p><a href="https://www.adafruit.com/product/1298">Adafruit page</a></p>
<h3>AM2315</h3>
<p><a href="https://github.com/adafruit/Adafruit_AM2315">Adafruit library</a></p>
<hr>
<h2>Mothbot Version 1.0 Notes</h2>
<p>Made explicit i2c header that will allow for display.  But this means that certain i2c sensors are no longer useful via screw terminal.  But, added a 'qwiic' connector for i2c ... so maybe what we do is to make a qwiic adapter for AM2315 (i2c version).</p>
<p>Might need to change screw terminal size to 5mm, as they're far easier to source, it seems ...</p>
<p>Consider placing mounting holes at proper separation for 3XAA battery holder mounting holes ...</p>
<hr>
<h2>Mothbot Version 2.0 Notes</h2>
<ol>
<li>Need bigger spacing on MCP1700 footprint</li>
<li>Need C1 &amp; R1 to be 0.1 uF and 10K (as they are), apparently, for bootloader to auto-reset properly (timing issue?)</li>
<li>Note: I cannibalized C1 from a ver 1.0 Mothbot, need to replace!</li>
<li>Reset button doesn't seem to work?</li>
<li>Swapped A4 &amp; A5 (they are SDA and SCL, not SCL and SDA, respectively) -- need to fix in order for monitor to work</li>
<li>Add 0.1&quot; headers for all terminals, as per i2c ... space as per breadboard?</li>
<li>Match mounting hole spacing to battery pack?</li>
<li>Nice <a href="https://jeelabs.org/2013/05/16/measuring-the-battery-without-draining-it/index.html">note</a> on measuring the battery level without draining it.</li>
</ol>
<hr>
<h2>Mothbot Version 3.0 Notes</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/version3_draft.png"> <img src="/img/mothbot/version3_draft.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">First stab at version 3.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/3drender.png"> <img src="/img/mothbot/3drender.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3D Render of Final for Verison 3.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/mothbot_top.png"> <img src="/img/mothbot/mothbot_top.png" alt="parts.jpg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Final of version 3, as submitted to OSHPARK. Board design files are <a href="https://github.com/edgecollective/dippy-slim/tree/master/ver3">here</a></td>
</tr>
</tbody>
</table>
<p>Update (13 OCT 2020):  Version 3 passed the following tests:</p>
<ul>
<li>Power</li>
<li>Programmable</li>
<li>LoRa Radio</li>
<li>i2c port</li>
<li>i2c Screen</li>
<li>D4 works</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/mothbot_v3_mvp.png"> <img src="/img/mothbot/mothbot_v3_mvp.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Minimal version of the Mothbot version 3.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/ver3_success.png"> <img src="/img/mothbot/ver3_success.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Mothbot Version 3 seems to work! See the Mothbot Version 3 <a href="https://youtu.be/YAIVfK-kL4o">initial build video</a>.</td>
</tr>
</tbody>
</table>
<p>Things to change:</p>
<ul>
<li>make the resistor footprints longer so that they can lie flat</li>
<li>larger text for the scre terminals</li>
<li>J1 and J3 terminals are obscured by i2c display -- move stuff?</li>
</ul>
<h3>Notes on Display</h3>
<ul>
<li>Current (larger) display is nice, but prevents access to screw terminals. Uses 'VCC GND SCL SDA'</li>
<li>Can add a rearranged i2c port at the 'top' of U3 (the ATMEGA), arranged as 'GND VCC SCL SDA', and accommodate a <a href="https://www.amazon.com/Pieces-Display-Module-SSD1306-3-3V-5V/dp/B08CDN5PSJ/ref=sr_1_8?dchild=1&amp;keywords=SSD1306&amp;qid=1602675432&amp;sr=8-8">smaller screen</a>.</li>
<li>Note: 'GND VCC SCL SDA' <a href="https://www.amazon.com/Display-Module-SSD1306-Du-pont-Arduino/dp/B07VDXYDVY/ref=sr_1_9?dchild=1&amp;keywords=SSD1306&amp;qid=1602675432&amp;sr=8-9">is also common</a> for the larger displays.</li>
</ul>
<p>So, maybe we switch over to 'GND VCC SCL SDA' in general, move pins to above U3.</p>
<h3><a name="mothbot_ver3_parts"></a> Mothbot Version 3 Parts List / BOM</h3>
<ul>
<li><a href="https://docs.google.com/spreadsheets/d/10DjISUPHa8-PfmeBYISGM-iekXHcvAeN48qu73FdD7M/edit?usp=sharing">BOM in spreadsheet form</a>. Includes link to PCB files on github and for ordering via OSHPark.</li>
</ul>
<p>Some of the parts list on Amazon:</p>
<p>Aside: some of the Mothbot parts via Amazon:</p>
<ul>
<li><a href="https://www.amazon.com/gp/product/B07VWQY6GG/ref=ppx_yo_dt_b_asin_title_o01_s00?ie=UTF8&amp;psc=1">the rfm95</a></li>
<li><a href="https://www.amazon.com/gp/product/B07X4ZTRD2/ref=ppx_yo_dt_b_asin_title_o01_s01?ie=UTF8&amp;psc=1">inexpensive FTDI clone</a></li>
<li><a href="https://www.amazon.com/gp/product/B07MD9G9LG/ref=ppx_yo_dt_b_asin_title_o02_s00?ie=UTF8&amp;psc=1">cute helical antennae</a></li>
<li><a href="https://www.amazon.com/gp/product/B00M1E0FVM/ref=ppx_yo_dt_b_asin_title_o08_s00?ie=UTF8&amp;psc=1">MCP1700 voltage reg</a></li>
<li><a href="https://www.amazon.com/gp/product/B00SWK2HCO/ref=ppx_yo_dt_b_asin_title_o09_s00?ie=UTF8&amp;psc=1">Crystal</a></li>
<li><a href="https://www.amazon.com/gp/product/B01263IMU8/ref=ppx_yo_dt_b_asin_title_o02_s00?ie=UTF8&amp;psc=1">328p w/ Arduino UNO bootloader</a></li>
</ul>
<p>Also:</p>
<ul>
<li><a href="https://www.amazon.com/gp/product/B076MSLFC9/ref=ppx_yo_dt_b_asin_title_o08_s00?ie=UTF8&amp;psc=1">Heltec Wifi + Lora based on ESP32</a></li>
</ul>
<p>Update 14 OCT 2020:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/mothbot/feather_and_mothbot_talking.mp4"> <img src="/img/mothbot/mothbot_success.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Sands Fish's build of the Mothbot!</td>
</tr>
</tbody>
</table>
<hr>
<h2>Misc</h2>
<p>Using Electron to talk to serial port:</p>
<ul>
<li><a href="https://github.com/serialport/electron-serialport.git">Nice example</a></li>
<li><a href="https://www.electronjs.org/community#boilerplates">Electron boilerplates</a></li>
<li><a href="https://hackernoon.com/arduino-serial-data-796c4f7d27ce">Read the serialport using NodeJS</a></li>
<li><a href="https://girishjoshi.io/post/access-serialport-from-electron-application-and-creating-gui-for-micropython-repl-on-esp8266/">Full project on using Electron with serialport</a> &lt;--- this is the one to try</li>
</ul>
<h2>Work Log</h2>
<hr>
<p>Oct 24 2020</p>
<p>Created dimensions document for Mothbot ver 0.1, <a href="https://github.com/edgecollective/dippy-slim/blob/master/ver1/mothbot_dim/mothbot_dim.pdf">here</a>.</p>
<hr>
<p>NOV 16 2020</p>
<p>Photo of latest version in action here:</p>
<p><img src="/img/mothbot/mothbot_am2315.jpg" alt=""></p>
<h2>Web USB</h2>
<p>Nice description <a href="https://learn.adafruit.com/using-webusb-with-arduino-and-tinyusb">here</a></p>
<hr>
<p>2021-01-13 18:46:49</p>
<p>New repo for Mothbot design files and code <a href="https://github.com/edgecollective/mothbot">here</a></p>
<hr>
<p>2021-01-14 21:23:57</p>
<p>If the mothbot isn't receiving, it might be because the 'INT' pin isn't soldered properly:
e
<img src="/img/mothbot/mothbot_rev4_int_d2_14_matchup.png" alt=""></p>
<hr>
<p>2021-01-15 10:44:21</p>
<p>Below pulled in from 'e-ink' notes ...</p>
<h3>Grid Squares</h3>
<p>Ham Radio for Arduino and Picaxe book --- <a href="http://www.arrl.org/shop/Ham-Radio-for-Arduino-and-PICAXE/">Description</a>, <a href="https://www.amazon.com/Ham-Radio-Arduino-Picaxe-Arrl/dp/087259324X">Amazon</a>.</p>
<p>Source code for generating tiles from OSM is <a href="http://hamradioprojects.com/authors/wa5znu/+marinus/code/">here</a></p>
<p>Grid square locator on above site is broken; perhaps <a href="https://www.k2dsl.com/2008/08/27/finding-grid-square-locators/">this</a> works?</p>
<p>Grid square locator <a href="http://www.arrl.org/grid-squares">here</a>.</p>
<p>Computing lat / lon <a href="https://stevemorse.org/jcal/latlon.php">here</a>.</p>
<p>Conant road lat / lon: 42.41158	-71.2983</p>
<p>Grid square utility <a href="http://www.levinecentral.com/ham/grid_square.php">here</a> works, but doesn't give 10 character grid squares ...</p>
<p>Another tool is <a href="https://dxcluster.ha8tks.hu/hamgeocoding/">here</a>, which generates a nice overlay ... &lt;-- this is the tool to use!</p>
<p>So, the combined tools are:</p>
<ul>
<li>identifying your grid square in ham radio, <a href="https://dxcluster.ha8tks.hu/hamgeocoding/">here</a>.</li>
<li>using a python script to grab the tiles, <a href="http://hamradioprojects.com/authors/wa5znu/+marinus/osm/">here</a> -- seems to be broken.</li>
</ul>
<p>Example grid square:</p>
<p>Finding gridsquares from lat / lon <a href="https://www.amsat.org/amsat-new/tools/grids.php">here</a></p>
<p>Generator <a href="https://dxcluster.ha8tks.hu/hamgeocoding/">here</a>.  Uses a nice open source <a href="https://nominatim.org/">geocoding app</a> that works with OSM.  The author, <a href="https://twitter.com/ha8tks?lang=en">ha8tks</a>, has a <a href="https://github.com/ha8tks/Leaflet.Maidenhead">repo on github</a> that applies the GridSquare layout in Leaflet.</p>
<p><img src="/img/eink/gridquare.png" alt=""></p>
<p><img src="/img/eink/weston.png" alt=""></p>
<p>Reference on gridsquares <a href="https://www.amsat.org/amsat-new/tools/grids.php">here</a></p>
<p>Ham radio chat on grid squares <a href="https://www.youtube.com/watch?v=3w2SPj5Hs5Q">here</a>.</p>
<p>General term for this is the <a href="https://en.wikipedia.org/wiki/Maidenhead_Locator_System">Maidenhead Gridsquare System</a>.</p>
<p>(Alternative:  the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">World Geodetic System</a>)</p>
<p>Nice <a href="https://www.hamradio.in/circuits/grid_locator_system.php">explanation</a> of the grid locator system.</p>
<p>Nice <a href="http://www.jonit.com/fieldlist/maidenhead.htm">historical background</a> on the system.</p>
<p>Really nice <a href="https://www.youtube.com/watch?v=rlkUAHGw_Sg">video explanation</a> of grid squares.</p>
<p><img src="/img/eink/gridquare.png" alt=""></p>
<p><img src="/img/eink/weston.png" alt=""></p>
<p>Reference on gridsquares <a href="https://www.amsat.org/amsat-new/tools/grids.php">here</a></p>
<p>Ham radio chat on grid squares <a href="https://www.youtube.com/watch?v=3w2SPj5Hs5Q">here</a>.</p>
<p>General term for this is the <a href="https://en.wikipedia.org/wiki/Maidenhead_Locator_System">Maidenhead Gridsquare System</a>.</p>
<p>(Alternative:  the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">World Geodetic System</a>)</p>
<p>Nice <a href="https://www.hamradio.in/circuits/grid_locator_system.php">explanation</a> of the grid locator system.</p>
<p>Nice <a href="http://www.jonit.com/fieldlist/maidenhead.htm">historical background</a> on the system.</p>
<p>Really nice <a href="https://www.youtube.com/watch?v=rlkUAHGw_Sg">video explanation</a> of grid squares.</p>
<hr>
<p>2021-01-15 10:48:51</p>
<p>Leaflet + Maidenhead Locator system <a href="https://github.com/ha8tks/Leaflet.Maidenhead">here</a></p>
<p>Key file is <a href="https://github.com/ha8tks/Leaflet.Maidenhead/blob/master/src/L.Maidenhead.js">here</a> -- this is how to figure out GPS on the system.</p>
<hr>
<p>2021-01-15 21:25:09</p>
<p><img src="/img/mothbot/back_and_forth_mv4.png" alt=""></p>
<p><img src="/img/mothbot/433_900_compare.png" alt=""></p>
<hr>
<p>2021-01-16 21:17:20</p>
<p>Some cosmetic fixes, resulting in rev4B!  <a href="https://github.com/edgecollective/mothbot/tree/main/ver4B/hardware">github</a> | <a href="https://oshpark.com/shared_projects/h7LluxAz">oshpark</a></p>
<hr>
<p>2021-01-17 08:50:37</p>
<p>Itsybitsy <a href="https://cdn-learn.adafruit.com/assets/assets/000/054/505/original/adafruit_products_schem.png?1527457190">schematic</a>, with power circuit:</p>
<p><img src="/img/mothbot/itsybitsy_power.png" alt=""></p>
<p>Tiny pico power <a href="https://github.com/tinypico/tinypico-hardware/blob/master/TinyPICO%20Release%20P3/TinyPICO_Schematic.pdf">schematic</a> and power circuit:</p>
<p><img src="/img/mothbot/tinypico_power.png" alt=""></p>
<p>associated p-channel (d-s) LP0404N3T5G mosfet -- <a href="https://datasheet.lcsc.com/szlcsc/Leshan-Radio-LP0404N3T5G_C172433.pdf">LP0404N3T5G datasheet</a></p>
<hr>
<p>2021-01-28 14:06:53</p>
<h2>Low Power</h2>
<p><a href="https://github.com/rocketscream/Low-Power">https://github.com/rocketscream/Low-Power</a></p>
<p>Put device into very deep sleep and listen to serial -- code example <a href="https://arduino.stackexchange.com/questions/13167/put-atmega328-in-very-deep-sleep-and-listen-to-serial">https://arduino.stackexchange.com/questions/13167/put-atmega328-in-very-deep-sleep-and-listen-to-serial</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>We used some Arduino-based devices to demonstrate the <a href="https://www.airspayce.com/mikem/arduino/RadioHead/classRHMesh.html">mesh functionality</a> of the <a href="https://www.airspayce.com/mikem/arduino/RadioHead">Radiohead library</a>, a common radio library for LoRa radio devices.</p>
<p>Our starting point was the <a href="https://github.com/nootropicdesign/lora-mesh">code</a> from a <a href="https://nootropicdesign.com/projectlab/2018/10/20/lora-mesh-networking/">nootropic design blog post</a>. <a href="https://github.com/edgecollective/lora-mesh/tree/master/gpsexpt/exp3">Our version</a> adds GPS funcitonality, using some inexpensive GPS modules and some Adafruit Feather LoRa boards.</p>
<h2>Trial data</h2>
<p>In our first trial, we deployed three nodes at a residence in Lincoln, MA USA, as depicted in <strong>Fig 1</strong> below.  Node #1 (blue) is stationary, and connected to a laptop which is recording any data received by Node #1 (via a Python script).  Nodes #2 (red) and #3 (green) are mobile, and equipped with GPS; every few seconds they make a GPS measurement, and attempt to send their latitude and longitude back to Node #1.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="https://edgecollective.io/lora-mesh/gpsexpt/exp3/plotting/"> <img src="/img/lincoln/mesh.png" alt="mesh"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Fig 1</strong>: Snapshot from an <a href="https://edgecollective.io/lora-mesh/gpsexpt/exp3/plotting/">animated depiction</a> of our first mesh networking test. The blue dot is Node #1 (stationary); Nodes #2 (green) and #3 (red) both attempt to send their GPS coordinates back to Node #1 every few seconds.  In this snapshot we see a situation where Node #2 traveled too far from Node #1 to reach it directly, and needed to relay its data via Node #2.</td>
</tr>
</tbody>
</table>
<p>What you can see in the <a href="https://edgecollective.io/lora-mesh/gpsexpt/exp3/plotting/">animation of the trial data</a> is the following:</p>
<ul>
<li>During the first part of the journey, Nodes #2 and #3 are able to send their data directly back to Node #1, as they are easily within range.</li>
<li>At some point, we found that lost the connection to Node #1 due to topography / obstructions; so we backtracked a bit to where we still had a good signal, and dropped off Node #3 by the side of the road.</li>
<li>We then continued to walk down the path with Node #2.</li>
<li>At various points, Node #2 loses its connection to Node #1, and re-routes (according to the Radiohead mesh algorithm) its messages via Node #3.</li>
</ul>
<p>You can also observe that at some point in our journey -- with Node #2, walking away from Node #1 -- we regain our connection to Node #1 (likely because we went up a hill, and regained line-of-sight).  We believe that the Radiohead algorithm will simply stick with whatever route was most recently successful until it fails; so perhaps this means that when we see Node #2 and Node #3 connecting, the connection between Node #2 and Node #3 must have dropped, prior. will look into this.</p>
<h2>Trial Pics</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/lincoln/snaps//two_nodes.jpg"> <img src="/img/lincoln/snaps//two_nodes.jpg" alt="two_nodes"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Node 2 (left) and Node 3 (right) before the field test.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/lincoln/snaps//node_2.jpg"> <img src="/img/lincoln/snaps//node_2.jpg" alt="node_2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Node 2 -- the 'red' node in the animation above -- that traveled the furthest distance away from Node 1.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/lincoln/snaps//node_2_a.jpg"> <img src="/img/lincoln/snaps//node_2_a.jpg" alt="node_2_a"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Node 2 on the road ...</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/lincoln/snaps//node_3.jpg"> <img src="/img/lincoln/snaps//node_3.jpg" alt="node_3"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Node 3, placed in on a stone wall to serve as a 'relay node' between Node 1 and Node 2.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/lincoln/snaps//node_3_closeup.jpg"> <img src="/img/lincoln/snaps//node_3_closeup.jpg" alt="node_3_closeup"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Closeup of Node 3.</td>
</tr>
</tbody>
</table>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Arduino IDE Setup</h2>
<p>Board Manager URL for ESP32:</p>
<p><code>https://dl.espressif.com/dl/package_esp32_index.json</code></p>
<p>Board Manager URL for Feather M0 LoRa:</p>
<p><code>https://adafruit.github.io/arduino-board-index/package_adafruit_index.json</code></p>
<h2>Guides</h2>
<p><a href="https://robotzero.one/heltec-wifi-kit-32/">Robotzero</a></p>
<p>Basically need to just load this config file in 'Additional Board Manager URLs' field in Preferences in Arduino IDE:</p>
<p><code>https://dl.espressif.com/dl/package_esp32_index.json</code></p>
<p>Then can select Heltec WiFi Lora (V2) (the board we're using).</p>
<p>WiFi scan worked.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/heltec/wifi_scan.png"> <img src="/img/heltec/wifi_scan.png" alt="wifi scan"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Initial wifi scan test.</td>
</tr>
</tbody>
</table>
<h2>Display Library</h2>
<p><a href="https://github.com/olikraus/u8g2">U8g2 library</a> for Arduino covers a wide range of common displays.</p>
<p><a href="https://gist.github.com/dwblair/d74bb01fbd3514ffd6b5eb5d9b66ab88">Test code</a> that will scan wifi and display the results on the screen.</p>
<h2>Main Heltec Documentation</h2>
<p><a href="https://heltec.org/project/wifi-lora-32/">Heltec Wifi Lora 32</a></p>
<h2>Coding and Setup Debugging ...</h2>
<p><a href="https://www.instructables.com/id/Introduction-to-ESP32-WiFi-LoRa/">Instructable</a> that has a nice set of diagrams of pinouts</p>
<p><a href="https://github.com/HelTecAutomation/Heltec_ESP32">Heltec Library</a></p>
<p><a href="https://github.com/Heltec-Aaron-Lee/WiFi_Kit_series">Main github reference for Heltec devices -- includes KiCad file for device</a></p>
<p><a href="http://community.heltec.cn/t/heltec-wifi-lora-32-v2-send-receive/160">Heltec WiFi LoRa send / receive</a></p>
<p><a href="http://community.heltec.cn/t/ping-pong-test-between-cubecell-dev-board-and-wifi-lora-32-v2/508/7">Heltec syncword issue</a></p>
<p><a href="https://robotzero.one/heltec-wifi-lora-32/">Robot Zero One LoRa receiver demo</a></p>
<p>They suggest using <a href="https://github.com/sandeepmistry/arduino-LoRa">this LoRa library</a>.</p>
<h2>Working LoRa Example</h2>
<p>Follow <a href="https://robotzero.one/heltec-wifi-lora-32/">Robot Zero One LoRa receiver demo</a>;</p>
<p>use <a href="https://github.com/sandeepmistry/arduino-LoRa">this LoRa library</a>;</p>
<p>And <a href="https://gist.github.com/dwblair/cfe9bfb895d4ad72d88ed91fb76ded47">this example</a>.</p>
<p><strong>Receive and display</strong>. Can get it posted on the display using <a href="https://gist.github.com/dwblair/9da853fb274c184f89f3f14123b9e032">this example</a> with <a href="https://github.com/olikraus/u8g2">U8g2 display library</a> -- basically works.</p>
<h2>Radiohead Example</h2>
<p><a href="https://gist.github.com/dwblair/e6626567ff14cec6e29db35b8eb985ed">Basic RFM95 Receive</a> code for Heltec.  Works.</p>
<h2>Low Power sleep</h2>
<p><a href="https://github.com/Heltec-Aaron-Lee/WiFi_Kit_series/issues/6">Discussion of entering low power sleep mode</a></p>
<h2>HTTP GET AND POST</h2>
<p>Tutorial <a href="https://randomnerdtutorials.com/esp32-http-get-post-arduino/">here</a>.</p>
<p>Working code to do basic JSON post to FarmOS <a href="https://gist.github.com/dwblair/c1411750491ef2120d01ca661dbcd747">here</a>.</p>
<p>ArduinoJSON SerializeJSON <a href="https://arduinojson.org/v6/api/json/serializejson/">documentation</a>.</p>
<h2>HTTP JSON POST TO FARMOS</h2>
<p>Using loop-updated variables, code is <a href="https://gist.github.com/dwblair/731c806170a11bfc536c32d126559495">here</a>.</p>
<h2>HELTEC WIFI LORA POST TO FARMOS</h2>
<p>Using dummy variables, not yet parsing incoming radio, code is <a href="https://gist.github.com/dwblair/895fdbe3cbb5f5f1c43025230a8a5f10">here</a></p>
<h2>Github Repo</h2>
<p>Feather sends JSON data; Heltec receives, parses, posts to FarmOS; code is <a href="https://github.com/edgecollective/heltec-32-lora-v2-farmos/tree/master/ver1">here</a>.</p>
<h2>1-wire temp sensor on remote</h2>
<p><a href="https://lastminuteengineers.com/ds18b20-arduino-tutorial/">Tutorial</a></p>
<h2>Sleep Modes for ESP32</h2>
<p>Some nice notes <a href="https://lastminuteengineers.com/esp32-sleep-modes-power-consumption/#:~:text=ESP32%20Sleep%20mode%20is%20a,it%20to%20retain%20its%20data.">here</a></p>
<p>Deep sleep <a href="https://lastminuteengineers.com/esp32-deep-sleep-wakeup-sources/">example code</a></p>
<p>Able to get about 2 mA in deep sleep using Heltec. ...</p>
<p>.. then turned off lora radio and got 1 mA.</p>
<p>gist of the code to do this is <a href="https://gist.github.com/dwblair/5bd69024c8536780fa1e3bf835f1d8fb">here</a></p>
<p>Further discussion of low power modes <a href="https://www.reddit.com/r/esp32/comments/gx8fxk/hibernatepower_off/">here</a>.</p>
<h2>ESP32 Data logging</h2>
<p><a href="https://randomnerdtutorials.com/esp32-data-logging-temperature-to-microsd-card/">Nice tutorial here</a></p>
<h2>Single-channel gateway guides</h2>
<p><a href="https://github.com/things4u/ESP-1ch-Gateway">Using ESP8266</a></p>
<p><a href="https://learn.sparkfun.com/tutorials/esp32-lora-1-ch-gateway-lorawan-and-the-things-network/all">From Sparkfun</a></p>
<p><a href="https://appcodelabs.com/introduction-to-iot-building-a-budget-single-channel-lora-gateway">Appcodelabs using MQTT</a></p>
<p><a href="https://www.cnx-software.com/2018/08/21/how-to-make-cheap-single-channel-gateway-lora-esp32-board/">From CNX Software</a> -- looks like they use dozens of nodes here.</p>
<h3>Heltec Deep Sleep</h3>
<p>Thread <a href="http://community.heltec.cn/t/wifi-lora-32-v2-deep-sleep-low-power-test/101">here</a>.</p>
<h3>Heltec OTA updates</h3>
<p>Lastminuteengineer description using Arduino IDE is <a href="https://lastminuteengineers.com/esp32-ota-updates-arduino-ide/">here</a>.</p>
<p>Using the web, <a href="https://lastminuteengineers.com/esp32-ota-web-updater-arduino-ide/">here</a>.</p>
<p>Espressif github example of web-based OTA <a href="https://github.com/espressif/esp-idf/tree/master/examples/system/ota">here</a>.</p>
<p>Modified example worked nicely, code is <a href="https://github.com/edgecollective/heltec-ota">here</a></p>
<p>Login page:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/heltec/heltec_login.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Initial login page to ESP32.</td>
</tr>
</tbody>
</table>
<p>And it works!</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/heltec/ota_progress.png" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Progress after uploading.</td>
</tr>
</tbody>
</table>
<h3>General Heltec guides</h3>
<p>Great guide to Heltec, <a href="https://randomnerdtutorials.com/esp32-access-point-ap-web-server/">here</a></p>
<h3>Config Portal setup for wifi on ESP32</h3>
<p>WiFi Manager library <a href="https://github.com/khoih-prog/ESP_WiFiManager">here</a></p>
<p>I think the relevant section is <a href="https://github.com/khoih-prog/ESP_WiFiManager#howto-open-config-portal">here</a></p>
<p>Nice guide for Config Portal <a href="https://www.instructables.com/ESP8266-and-ESP32-With-WiFiManager/">here</a></p>
<ul>
<li>This library <a href="https://github.com/zhouhan0126/WIFIMANAGER-ESP32">here</a> is the relevant one in the above guide.</li>
</ul>
<p>Nice set of utilities around AutoConnect and etc for ESP32 by 'hieromon', <a href="https://hieromon.github.io/AutoConnect/index.html">here</a></p>
<p>Maybe <a href="https://github.com/Hieromon/AutoConnect">this</a>, by 'Hieromon' is the latest lib &lt;---- yes, this is it!!</p>
<p>Getting started page <a href="https://hieromon.github.io/AutoConnect/gettingstarted.html">here</a> &lt;---- Great place to start with autoconnect.</p>
<h3>Working Autoconfig code</h3>
<p>This is the code that I took from that link just above, and I put it <a href="https://github.com/edgecollective/heltec-ota/tree/main/autoconfig_getting_started">here</a> And it worked!</p>
<p><img src="/img/heltec/autoconnect_worked.png" alt=""></p>
<p>Easiest to install AutoConnect via ArduinoIDE -- it then prompts for other necessary libraries.</p>
<p>Can use AutoConnect 'Credential' example to erase currently-saved WiFi credentials.</p>
<h3>Embedding autoconfig</h3>
<p>How to embed Autoconnect, <a href="https://hieromon.github.io/AutoConnect/howtoembed.html">here</a>.</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Background</h2>
<p>The following is a development notebook for constructing a DIY CO2 monitor.</p>
<h2>Index</h2>
<p>More or less random bookmarks into the notes file, for reference:</p>
<ul>
<li><a href="#feather">Feather Hookup Guide for K30</a></li>
<li><a href="#gatewaysetup">Description of remote node + gateway setup</a>.</li>
<li><a href="#jimenez">Peng and Jimenez paper on CO2 and COVID infection probability</a></li>
<li><a href="#rev_a_build">Rev_A build of Feather-based SCD30 board</a></li>
<li><a href="#calibration">Thoughts on calibration as of 24 NOV 2020</a></li>
<li><a href="#nov25">Nov 25 update</a></li>
<li><a href="#mic_experiment">Initial Microphone Experiment Nov 28</a></li>
<li><a href="#compare_scd30">Comparing two SCD30 sensors</a></li>
<li><a href="https://community.hiveeyes.org/t/heltec-wifi-lora-32/3125">Heltec Wifi Lora 32 v 2 -- Schematic and Pinouts</a></li>
<li><a href="#openscad">Making an OpenSCAD enclosure for Rev E</a></li>
</ul>
<hr>
<p>2020 SEPT 29</p>
<h2>Experiments with K30 from CO2METER.com</h2>
<p><a href="https://www.co2meter.com/products/k-30-co2-sensor-module">Online description of K30</a></p>
<p><a href="http://co2meters.com/Documentation/Datasheets/DS_SE_0118_CM_0024_Revised9%20(1).pdf">K30 Datasheet</a></p>
<p>Needs 5V power minimum (actually, looks like it's best run at 6-9V); meanwhile, <strong>Logic levels for the UART are at 3.3V</strong>.</p>
<p>Useful info on logic levels / etc from the datasheet:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/logic_levels.png"> <img src="/img/co2/logic_levels.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Table 1 from the <a href="http://co2meters.com/Documentation/Datasheets/DS_SE_0118_CM_0024_Revised9%20(1).pdf">K30 datasheet</a>.</td>
</tr>
</tbody>
</table>
<p>Meanwhile, though -- good advice on connecting to signals that run at higher voltage from JeeLab, <a href="https://jeelabs.org/2010/12/16/voltage-3-3-vs-5/index.html">here</a>.  Punchline -- can add a 1K resistor in series with signal as protection.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/fig2.png"> <img src="/img/co2/fig2.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Figure 2 from the <a href="http://co2meters.com/Documentation/Datasheets/DS_SE_0118_CM_0024_Revised9%20(1).pdf">K30 datasheet</a>.</td>
</tr>
</tbody>
</table>
<ul>
<li>'G0' -- GND</li>
<li>'G+' -- Voltage input (5V to 9V)</li>
<li>'TxD, RxD' -- UART</li>
<li>'OUT1' -- Analog output (alternative way of getting the data)</li>
</ul>
<p>Datasheet says: should avoid connecting analog and digital ground pins externally in order to avoid ground loops</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/analog_outputs.png"> <img src="/img/co2/analog_outputs.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Analog outputs.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/calibration.png"> <img src="/img/co2/calibration.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Calibration.</td>
</tr>
</tbody>
</table>
<h2>Connecting to an Arduino</h2>
<h3>Via I2C</h3>
<p><a href="http://www.co2meters.com/Documentation/AppNotes/AN102-K30-Sensor-Arduino-I2C.pdf">Connecting a K30 to an Arduino via I2C</a></p>
<p>This suggests using 6 to 9V input. (Might be good to upgrade the spec on the MCP1702 voltage reg so we can take &gt; 6V input on the Mothbot).  Needs to be able to provide 500mA.  So: direct from battery power is likely best.</p>
<h3>Notes on using a Feather</h3>
<p><a href="https://cdn-learn.adafruit.com/assets/assets/000/032/914/large1024/feather_schem.png?1465421956">Schematic</a> of the Feather M0 Lora.</p>
<p>Datasheet for the AP2112-3.3 voltage regulator used on the feather is <a href="https://www.diodes.com/assets/Datasheets/AP2112.pdf">here</a>.</p>
<p>From the AP2112K datasheet -- 6V max allowed on Feather:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/feather_voltage_input.png"> <img src="/img/co2/feather_voltage_input.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">UART connection.</td>
</tr>
</tbody>
</table>
<h3>Via UART</h3>
<p>Note: <strong>Logic levels for the UART are at 3.3V</strong>.</p>
<p><a href="http://www.co2meters.com/Documentation/AppNotes/AN126-K3x-sensor-arduino-uart.pdf">Connecting a K30 to an Arduino via UART</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/uart_closeup.png"> <img src="/img/co2/uart_closeup.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">UART connection.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/first_readings.png"> <img src="/img/co2/first_readings.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">First readings.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/breath_test.png"> <img src="/img/co2/breath_test.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Blowing on the sensor and then letting it recover.</td>
</tr>
</tbody>
</table>
<p>Edge Collective copy of the library for UART connection is <a href="https://github.com/edgecollective/co2-kseries">here</a> (replica of that provided by CO2 Monitor <a href="http://www.co2meters.com/Documentation/AppNotes/AN126-K3x-sensor-arduino-uart.zip">here</a>).</p>
<h2>SSD1306 Display</h2>
<p>Guide <a href="https://randomnerdtutorials.com/guide-for-oled-display-with-arduino/">here</a> for hookup to Arduino UNO.</p>
<h2>UART + SSD1306 Display</h2>
<p>Example code <a href="https://gist.github.com/dwblair/310acc6f8dafa8f82af713200ceda577">here</a>.</p>
<h2><a name="gatewaysetup"></a> Remote LoRa CO2 Node and Heltec Gateway sending to FarmOS</h2>
<p>Using a <a href="https://edgecollective.io/posts/notes/mothbot/">Mothbot</a> to connect to the K30 sensor over UART and send via LoRa to a <a href="https://www.amazon.com/MakerFocus-Development-Bluetooth-0-96inch-Display/dp/B076MSLFC9">Heltec</a> Wifi-LoRa gateway, posting to <a href="https://edgecollective.farmos.net/farm/sensor/heltecone">FarmOS</a>.</p>
<p>Code for remote and gateway is <a href="https://github.com/edgecollective/co2-remote-and-gateway">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/remote_v1.jpg"> <img src="/img/co2/remote_v1.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Mothbot remote node connected to K30 CO2 sensor.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mothbo.jpg"> <img src="/img/co2/mothbo.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Closeup of Mothbot.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/k30.jpg"> <img src="/img/co2/k30.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Closeup of K30 CO2 sensor.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/heltec_gateway.jpg"> <img src="/img/co2/heltec_gateway.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Heltec Wifi-LoRa gateway</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/farmos_graph.png"> <img src="/img/co2/farmos_graph.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Graphing on FarmOS</td>
</tr>
</tbody>
</table>
<h2>Misc</h2>
<p>Would be nice to develop useful ways of connecting to some standard hardware (e.g. Feathers, etc).</p>
<h2>CO2 and Greenhouses</h2>
<p><a href="https://www.greenhousegrower.com/production/monitoring-carbon-dioxide-in-the-greenhouse/">Article</a> on measuring CO2 in greenhouses:</p>
<blockquote>
<p>Until recently, the vast majority of growers in the U.S. did not measure CO2 or use it to enrich their greenhouses. However, during the winter, CO2 levels can quickly become limiting in unventilated greenhouses full of plants on cold and sunny days. Over the past 10 years, we have also seen greenhouse growers seal up their greenhouses in an effort to control their heating bills during the winter. Other growers, especially in northern latitudes, have invested in supplemental lighting because of the numerous benefits, from improved quality and yields to reduced production time. An apparent result of tightly sealing the greenhouse is increased humidity and condensation. A not-so-apparent result of reducing air infiltration is a reduction of CO2 levels within the greenhouse below ambient levels found outdoors.</p>
</blockquote>
<hr>
<p>Oct 9 2020:</p>
<p>Maybe a good configuraiton is to have the sensor powered via a 7.4V rechargeable lith-ion, while the micro attached has its separate battery voltage?</p>
<hr>
<p>oct 13 2020:</p>
<p>Recreating the prototype but using a Feather M0 instead ...</p>
<p>now we want to use Hardware Serial instead of Software Serial ...</p>
<p>We noticed a <a href="https://twitter.com/linseymarr/status/1314582969168920577?s=20">Twitter thread</a> by Linsey Marr on Oct 8 2020 that references using a CO2 monitor to assess activity in a space re: COVID-19; they use the HOBO CO2 monitor pictured in Fig C below.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/hobo_c02.jpeg"> <img src="/img/co2/hobo_c02.jpeg" alt="figC"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig C. HOBO CO2 Logger used to assess activity level / air turnover in a college gym.</td>
</tr>
</tbody>
</table>
<p>Note: some power options (if plugging into the wall):  use a 9V power wall wart, and drop down voltage to 5V; or use a 5V wall wart (more commong), and boost up to 9V.</p>
<p>If the latter, probably need to check on current (mA) requirements of the K30.</p>
<p>Offhand, seems like drop down is easier; boosting to 6V / 9V is a bit odd.</p>
<h3><a name="feather"></a>Feather Hookup Guide for K30</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/feather_setup.jpg"> <img src="/img/co2/feather_setup.jpg" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig A2.  Feather M0 connected to a K30 sensor.</td>
</tr>
</tbody>
</table>
<p>Feather firmware is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/v1/featherm0_K30">here</a>.</p>
<p>Wiring for test:</p>
<ul>
<li>Connect TXD (K30, see Fig A below) to RX0 (Feather);</li>
<li>Connect RXD (K30, see Fig A below) to TX1 (Feather);</li>
<li>Connect Feather GND to 6V Battery GND;</li>
<li>Connect 6V battery Power to Feather to K30 Power in (labeled &quot;5V&quot; in fig A below)</li>
<li>Power Feather via USB (for initial test)</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/uart_closeup.png"> <img src="/img/co2/uart_closeup.png" alt="figA"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig A.  UART connection on the K30.  When connecting to the Feather, connect TXD (K30) to RX0 (Feather) and RXD (K30) to TX1 (Feather).</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/feather_co2_decay_test.png"> <img src="/img/co2/feather_co2_decay_test.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig B.  Data from Feather, plotted in Arduino plotter utility.  Data shows breathing on sensor at a particular time and and watching decay. Time interval unit is 2 seconds.</td>
</tr>
</tbody>
</table>
<p>UPDATE: looks like the K30 can be powered by up to 14V.  So a 12V boost, or power supply, could be an option.</p>
<p>Started by closing door, sitting next to sensor.   At 150 time mark, opened door and left room.  Then At 250 time mark, reentered room and closed door. At 280 time mark, started a conversation.</p>
<p>Cf. 'room_test.png'.</p>
<p>'room_test_later.png' -- had a phone call</p>
<p>'room_test_later_2.png' -- left room for a bit with door open, then emilie came back and worked with the door open.</p>
<h2>Reference for typical / expected CO2 values</h2>
<p>Nice discussion <a href="https://inspectapedia.com/hazmat/CO2_Typical_Levels.php">here</a>, thanks to Laura P.</p>
<h2>Other CO2 Sensors</h2>
<h3>MH-Z14:</h3>
<p>Specifically mentions NDIR.</p>
<p>For sale on <a href="https://usa.banggood.com/NDIR-CO2-Sensor-MH-Z14A-PWM-NDIR-Infrared-Carbon-Dioxide-Sensor-Module-Serial-Port-0-5000PPM-Controller-p-1248270.html?utm_source=googleshopping&amp;utm_medium=cpc_organic&amp;gmcCountry=US&amp;utm_content=minha&amp;utm_campaign=minha-usg-pc&amp;currency=USD&amp;createTmp=1&amp;utm_source=googleshopping&amp;utm_medium=cpc_bgs&amp;utm_content=frank&amp;utm_campaign=frank-ssc-us-all-1108&amp;ad_id=395572890419&amp;cur_warehouse=CN">Banggood</a>.
Another option</p>
<h3>MH-Z19:</h3>
<p>Mentions infrared. This is the one that Craig used / that I have in my possession now.</p>
<p>For sale on <a href="https://usa.banggood.com/MH-Z19-MH-Z19B-Infrared-CO2-Sensor-Module-Carbon-Dioxide-Gas-Sensor-for-CO2-Monitor-0-5000ppm-MH-Z19B-NDIR-with-Pin-p-1693604.html">Banggood</a> for $20.</p>
<p>Goal as of 13 OCT 2020: get this up and running in parallel to the K30 and see how they compare with the 'ambient' test.</p>
<p>Nice <a href="https://www.circuits.dk/testing-mh-z19-ndir-co2-sensor-module/">article</a> on testing out the Z19 on a Raspberry Pi.</p>
<p>Update 15 OCT 2020: Just found a fairly official-looking Arduino library for the MH-Z19 <a href="https://github.com/WifWaf/MH-Z19">here</a> by WifWaf.</p>
<p>In that repo they have some nice notes about calibration.  The Z19 allows us to turn autocalibration off (which seems useful -- otherwise it is using the lowest reading in a 24 hour period as '400 ppm').  Would be good to experiment with this.</p>
<p>Also, here's <a href="https://github.com/tobiasschuerg/MH-Z-CO2-Sensors">another library for the MH-19</a> -- looks a bit older.  Going to try the WifWaf one above for now.</p>
<p>Note that the WifWaf github MH-Z19 lib is already in the Arduino online Lib repo, can just install via Library Manager in IDE.</p>
<p>Update 15 OCT 2020:  was able to get the WifWaf lib running on the MothbotV3.  Radiohead + the library ends up generating a 'low memory' warning.  This is fine; we'll likely end up using the Feather; also, we can pare down the full library to just generate raw values, likely.</p>
<h2>Programming the Heltec Gateway</h2>
<p><a href="https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/">Guide to using ESP32 in Arduino IDE</a></p>
<p><a href="https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/boards_manager.md">Another guide from Sparkfun</a></p>
<p>Add this to Boards Manager:</p>
<p><code>https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json</code></p>
<p>Select 'Heltec Wifi Lora (v2)'</p>
<h2>Programming with Feather</h2>
<p>Add this to Boards Manager:</p>
<p><code>https://adafruit.github.io/arduino-board-index/package_adafruit_index.json</code></p>
<h2><a name="co2_farmos_overnight"></a> CO2 with K30 to FarmOS</h2>
<p>Oct 14 2020</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_farmos.png"> <img src="/img/co2/co2_farmos.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Posting CO2 PPM data from a K30 to FarmOS, measuring overnight from 14 OCT to 15 OCT 2020.</td>
</tr>
</tbody>
</table>
<h2>Turning off autocalibration in K30</h2>
<p><a href="http://www.yoctopuce.com/EN/article/how-to-calibrate-a-co2-sensor">This article</a> mentions a technique, using their library.</p>
<h2>CO2 with custom server</h2>
<p>(TODO: set up using chappy-server as a model?)</p>
<hr>
<p>15 OCT 2020 10:42 AM</p>
<p>K30 is autocalibrating, Z19 is not.</p>
<p>Ah -- looks like the K30 also can give temp, and RH!  Cf the example <a href="https://gist.github.com/pkourany/53415d7f0c354a6d1e05">here</a>.</p>
<p>How to read the K30 via I2c app note <a href="http://www.co2meters.com/Documentation/AppNotes/AN102-K30-Sensor-Arduino-I2C.pdf">here</a>.</p>
<p>Ahhh here is a library for multiple params by CO2meter for the K30 -- <a href="http://www.co2meters.com/Documentation/AppNotes/AN126-K3x-sensor-arduino-uart.pdf">boom</a>.</p>
<p>need to modify their library so that it doesn't rely on SoftwareSerial (necessarily)</p>
<p>-- but first check whether we can even disable autocalibration?</p>
<p>Reading the <a href="https://img.ozdisan.com/ETicaret_Dosya/456729_1584920.PDF">K30 datasheet</a></p>
<p>Useful CO2meter guide to K30 ABC <a href="https://www.co2meter.com/blogs/news/7512282-co2-sensor-calibration-what-you-need-to-know">here</a>.</p>
<p><a href="http://www.warf.com/download/3671_7081_I2C_comm_guide_2_1031.pdf">i2c communication guide to K series sensors</a></p>
<p>-- looks like it can be disabled in EEPROM via I2C, at least ...</p>
<p>Nice reference on connecting a Teensy to a K30 <a href="https://forum.pjrc.com/threads/23963-Teensy-3-0-and-co2-sensor-with-UART">here</a></p>
<p>Reference to a key application note re: K-Series eeprom setup <a href="https://www.co2meter.com/blogs/news/9278787-senseair-k-series-sensor-uart-eeprom-ram-access-procedure">here</a></p>
<p>-- need to email them, UART command lib is missing ...</p>
<p>15 OCT 14:00 -- Interesting link to the <a href="http://www.yoctopuce.com/EN/products/usb-environmental-sensors/yocto-co2-v2">Yoctopuce V2</a>, which uses a 'better sensor' than the K30, they claim ...</p>
<p>The K30-based yoctopuce-c02 is <a href="http://www.yoctopuce.com/EN/products/discontinued-products/yocto-co2">here</a></p>
<p>More about the yp-co2-v2 is <a href="https://www.yoctopuce.com/EN/article/new-the-yocto-co2-v2">here</a></p>
<p>Yp-co2 (K30) <a href="https://www.yoctopuce.com/EN/products/yocto-co2/doc/YCO2MK01.usermanual.html">user's guide</a></p>
<h2>K30 via i2c</h2>
<p>this is the serious guide, <a href="http://www.warf.com/download/3671_7081_I2C_comm_guide_2_1031.pdf">here</a></p>
<p>simple i2c example <a href="http://www.co2meters.com/Documentation/AppNotes/AN102-K30-Sensor-Arduino-I2C.pdf">here</a></p>
<h2>SCD30</h2>
<p>The yocto uses the SCD30 -- listed for $54 on <a href="https://www.digikey.com/en/products/detail/sensirion-ag/SCD30/8445334?utm_adgroup=Sensors%20%26%20Transducers&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Dynamic%20Search&amp;utm_term=&amp;utm_content=Sensors%20%26%20Transducers&amp;gclid=CjwKCAjw5p_8BRBUEiwAPpJO63lPqw8gZyFFETPN5SMQElL0quJ5jvgLhi2gGq7jW4WlxdnqgtCC_xoCyLAQAvD_BwE">digikey</a></p>
<p>Here's the SCD30 <a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">datasheet</a></p>
<p>Arduino library <a href="https://www.arduino.cc/reference/en/libraries/sparkfun-scd30-arduino-library/">here</a></p>
<p>And on <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">github</a></p>
<p>annnnd the Sparkfun library has a 'disable calibration' settting <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/tree/master/examples/Example4_DisableCalibrate">here</a></p>
<h2>Summary as of 15 OCt 2020 15:00</h2>
<p>K30 seems outdated; won't trust it until we figure out how to turn off the autocalibration ... waiting to hear back from CO2 meter</p>
<p>MH-Z19 is also a bit older;  can at least control the autocal ...</p>
<p>The calibration assumption with these meters seems to be that they use the lowest ppm value over some period and consider it to be 400 ppm -- assumes that all spaces end up getting 'fresh air' at some point in that period.  For the K30, this is et to 7 days.  Not sure for the other sensors.</p>
<p>Also: readings for NDIR are temp, humidity, and pressure dependent.  My sense is that all the sensors measure these variables and compensate; the SCD30 also allows for feeding it the current ambient pressure and using it for calibration.</p>
<p>My current thought is the SCD30 would be a good one to get, along with an ambient pressure sensor.</p>
<hr>
<p>OCT 16 2020</p>
<p><a href="https://www.amazon.com/DFROBOT-Gravity-Analog-Sensor-Arduino/dp/B00R5CCH7U/ref=pd_lpo_469_t_0/147-7195648-8919536?_encoding=UTF8&amp;pd_rd_i=B00R5CCH7U&amp;pd_rd_r=8568e96f-b65d-4703-880d-17fe796d82cb&amp;pd_rd_w=zJnfI&amp;pd_rd_wg=LWVMI&amp;pf_rd_p=7b36d496-f366-4631-94d3-61b87b52511b&amp;pf_rd_r=2CT08KJ5JB9PC3GFSM38&amp;psc=1&amp;refRID=2CT08KJ5JB9PC3GFSM38">Example</a> of an electrochemical CO2 sensor.</p>
<p>Really <a href="https://www.co2meter.com/pages/indoor-air-quality-links">nice collection of references</a> from co2meter.com</p>
<hr>
<p>OCT 21 2020</p>
<p>Looks like the SCD30 can run off 3.3V, requiring max current of 80mA -- that's well within range of Feather LDO I believe!</p>
<p>SCD30 <a href="https://cdn.sparkfun.com/assets/1/a/7/9/9/Sensirion_CO2_Sensors_SCD30_Preliminary-Datasheet.pdf">datasheet</a> has the following table:</p>
<p>SCD30 <a href="https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/9.5_CO2/Sensirion_CO2_Sensors_SCD30_Assembly_Guideline.pdf">handling and assembly guide</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/electric_scd30.png"> <img src="/img/co2/electric_scd30.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Electrical characeristics of SCD30.</td>
</tr>
</tbody>
</table>
<p>Listing for th SCD30 on Amazon, <a href="https://www.amazon.com/SCD30-CO2-SENSOR-MODULE-Detection/dp/B07R1KCJ8F">here</a>.</p>
<p>And on Digikey, <a href="https://www.digikey.com/en/products/detail/sensirion-ag/SCD30/8445334?utm_adgroup=Gas%20Sensors&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Product_Sensors%2C%20Transducers&amp;utm_term=&amp;utm_content=Gas%20Sensors&amp;gclid=Cj0KCQjwuL_8BRCXARIsAGiC51DYiI4bJ21_4XyMzXfu4_-hHUoTJMfTvMqc2sEJYov2--rf9fmn45IaAsNcEALw_wcB">here</a>.</p>
<p>Note: should likely pair with a precision pressure sensor like the BME280 or better.</p>
<hr>
<p>OCT 22 2020</p>
<p>CO2Meter note on calibration <a href="https://www.co2meter.com/blogs/news/7512282-co2-sensor-calibration-what-you-need-to-know">here</a></p>
<p>Calibration for the SCD30 sensor document <a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">here</a> p. 7 / 10.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_calibration.png"> <img src="/img/co2/scd30_calibration.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Calibration of the SCD30, via <a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">this document</a></td>
</tr>
</tbody>
</table>
<p>Upshot:  seems as though with the ABC algorithm, sensor needs to see at least 1 hour of fresh air daily.
With the 'manual' mode, can run it for 2 minutes outdoors and press button saying 'calibrate' and set it to '400ppm'.<br>
Seems like this latter mode would work best.</p>
<h3>Assembly of SCD30</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_assembly.png"> <img src="/img/co2/scd30_assembly.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Assembly of SCD30 PCB, via <a href="https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/9.5_CO2/Sensirion_CO2_Sensors_SCD30_Assembly_Guideline.pdf">this doc</a></td>
</tr>
</tbody>
</table>
<hr>
<p>OCT 23 2020</p>
<h3>SCD30 Field Calibration</h3>
<p><a href="/data/CD_AN_SCD30_Field_Calibration_D2.pdf">Field calibration guide for SCD30</a></p>
<h4>Manual Field Calibration</h4>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_frc.png"> <img src="/img/co2/scd30_frc.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Effect of 'forced recalibration' (FRC) of SCD30 as described in the <a href="/data/CD_AN_SCD30_Field_Calibration_D2.pdf.">SCD30 ield calibration guide</a></td>
</tr>
</tbody>
</table>
<h5>Automatic Field Calibration</h5>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_asc_calibration.png"> <img src="/img/co2/scd30_asc_calibration.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Effect of automatic self-calibration (ASC) algorithm used in SCD30 as described in the <a href="/data/CD_AN_SCD30_Field_Calibration_D2.pdf">SCD30 ield calibration guide</a>.</td>
</tr>
</tbody>
</table>
<hr>
<p>OCT 24 2020</p>
<p>Might consider adding a high-precision pressure sensor to any SCD30 breakout board; the SCD30 can compensate for pressure if sent values directly.  E.g. the <a href="https://www.adafruit.com/product/3966">BMP388 breakout from Adafruit</a>.</p>
<hr>
<p>NOV 12 2020</p>
<p>Quick task: Feather-based breakout for SCD30 + BMP388 or equiv.</p>
<ul>
<li>can run on USB or lithium ion battery</li>
<li>mount for SCD30</li>
</ul>
<p>Any other useful things to add?</p>
<ul>
<li>i2c and uart breakouts?</li>
<li>display header -- oled to show graph of last few hours, w/ normal range?</li>
</ul>
<p>Should we use the ESP32?</p>
<p>If we use Heltec, it could be a remote node <em>or</em> a gateway ...</p>
<p>That's an argument for using the Heltec ...</p>
<p>Looks like SCD30 can use i2c ...
... other sensors can use i2c (break it out!) or UART ...</p>
<p>which library does Sparkfun use?</p>
<h3>SCD30 library and pinout</h3>
<p><strong>Sparkfun SCD30 library</strong> Ah, here's the <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">Sparkfun SCD30 CO2 Library</a>.  They use i2c, great!</p>
<p><strong>SCD30 pinout</strong> From the <a href="https://cdn.sparkfun.com/assets/1/a/7/9/9/Sensirion_CO2_Sensors_SCD30_Preliminary-Datasheet.pdf">SCD30 datasheet</a>:</p>
<p><a href="/img/co2/scd30_pinout.png"><img src="/img/co2/scd30_pinout.png" alt=""></a></p>
<h3>Making a breakout</h3>
<p>Pinout for <a href="https://www.adafruit.com/product/3966">BMP388</a>, precision temp + pressure ...</p>
<p><a href="/img/co2/bmp388.jpg"><img src="/img/co2/bmp388.jpg" alt=""></a></p>
<p>Current thinking: make a place for the i2c oled displays, both the thin and the larger versions.</p>
<p>Ahhh ... <a href="https://www.adafruit.com/product/4816">BM390</a> has even greater precision, why not go for that. Looks like same pinout, in fact.</p>
<h4>BMP390 Pinout</h4>
<p>(Same as BMP380)</p>
<p><a href="/img/co2/bmp390.jpg"><img src="/img/co2/bmp390.jpg" alt=""></a></p>
<p>Question -- do we need the INT pin assigned to a feather pin?</p>
<p>Looks like it might only be for SPI -- see Adafruit description of <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx/pinouts">pinout</a>. In any case, not used in their libraries, so don't assign for now.</p>
<h4>Feather M0 pinout</h4>
<p><a href="/img/co2/feather_m0_pinout.jpg"><img src="/img/co2/feather_m0_pinout.jpg" alt=""></a></p>
<h4>Adding a second UART to the Feather M0</h4>
<p>Guide is <a href="https://learn.adafruit.com/using-atsamd21-sercom-to-add-more-spi-i2c-serial-ports/creating-a-new-serial">here</a></p>
<p>They give an example with D10 as TX and D11 as RX.  So, break out those pins.</p>
<h4>Display</h4>
<ul>
<li>
<p>[Small i2c display] is 38x12mm.</p>
</li>
<li>
<p><a href="https://www.amazon.com/Dorhea-Display-SSD1306-Self-Luminous-Raspberry/dp/B07WPCPM5H/ref=psdc_306754011_t2_B0761LV1SD">Large i2c display</a> is 27mm x 27mm.</p>
</li>
</ul>
<h5>Breakout REV A</h5>
<p>Current breakout board is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/atkins">here</a>.</p>
<p><a href="/img/co2/co2_3drender.png"><img src="/img/co2/co2_3drender.png" alt=""></a></p>
<hr>
<p>2020 NOV 13</p>
<p>Lithium Ion battery that fits nicely inside of feather, <a href="https://www.adafruit.com/product/3898">here</a>.</p>
<p>Sizing logos in Kicad, article <a href="https://www.defproc.co.uk/tutorial/sizing-logos-in-kicad/">here</a>.</p>
<hr>
<p>2020 NOV 14</p>
<p>Nice guide to trace width <a href="https://bayareacircuits.com/picking-the-right-trace-width-for-your-next-pcb-design/">here</a>.</p>
<p>Trace width calculator link <a href="https://www.4pcb.com/trace-width-calculator.html">here</a>, and <a href="https://docs.oshpark.com/design-tools/eagle/design-rules-files/">here</a>.</p>
<h3>Calculating trace width</h3>
<p>Based on <a href="https://docs.oshpark.com/services/two-layer-hhdc/">this link at OSHPark</a>, the typical copper thickness for a 2-layer board is 2oz.</p>
<p>Then,</p>
<ul>
<li>For 1 Amp current, we get .4 mm trace width.</li>
<li>For 200 mA (.2 Amps), we get .04 mm trace width.</li>
<li>For 20 mA (.02 Amps), we get .002 mm trace width.</li>
</ul>
<p>I think the CO2 board won't source more than 0.2 Amps.</p>
<p>Ah!  Note that JLCPCB uses 1 oz copper by default.  This means:</p>
<ul>
<li>1 Amp --&gt; .78 mm trace width</li>
<li>200 mA --&gt; .09 mm trace width</li>
<li>20 mA --&gt; .004 mm trace width</li>
</ul>
<h2>CO2 Motherboard REV A</h2>
<p>Idea:  develop footprint for K30 and Z19, to co-deploy the sensors and test them out.</p>
<p>On the other hand: nice to have a board that is smaller, that can connect to these other boards, but is ready to start deploying as its own sensor.</p>
<p>Here's a version (REV_A) that does the latter.</p>
<p><a href="/img/co2/scd30_breakout_3drender.png"><img src="/img/co2/scd30_breakout_3drender.png" alt=""></a></p>
<p>Now, need to ask again: can we turn off the autocalibration for the Z19 and the K30?</p>
<p>Z19, I believe it's straightforward -- need to review.</p>
<p>K30 -- here are the links sent via email from CO2Meter:</p>
<ul>
<li><a href="https://www.co2meter.com/pages/downloads">'Downloads'</a></li>
<li><a href="https://www.co2meter.com/collections/sensors/products/k-30-co2-sensor-module">'K30 Web page'</a> (cf 'Documents' tab)</li>
<li><a href="http://co2meters.com/Documentation/Other/AN_SE_0018_AN_126_Revised8.pdf">'connecting K30 to an Arduino'</a></li>
</ul>
<p>Screenshot of gaslab software from CO2Meter, showing serial interface to turn ABC off:</p>
<p><a href="/img/co2/k30_abc_off.png"><img src="/img/co2/k30_abc_off.png" alt=""></a></p>
<p>Turning off ABC in K30 via i2c (found in <a href="http://co2meters.com/Documentation/Other/SenseAirCommGuide.zip">'Communications Protocols Manuals'</a>, in the i2c folder.  Specific document stored in our archives <a href="/img/co2/I2C_comm_guide_2_15.pdf">here</a>.</p>
<p><a href="/img/co2/abc_control_k30.png"><img src="/img/co2/abc_control_k30.png" alt=""></a></p>
<p>Communicating with K30 via I2C + Arduino guide, <a href="">here</a>.  Example below:</p>
<pre><code>// CO2 Meter K-series Example Interface
// Revised by Marv Kausch, 7/2016 at CO2 Meter &lt;co2meter.com&gt;
// Talks via I2C to K30/K22/K33/Logger sensors and displays CO2 values
// 12/31/09
#include &lt;Wire.h&gt;
// We will be using the I2C hardware interface on the Arduino in
// combination with the built-in Wire library to interface.
// Arduino analog input 5 - I2C SCL
// Arduino analog input 4 - I2C SDA
/*
  In this example we will do a basic read of the CO2 value and checksum verification.
  For more advanced applications please see the I2C Comm guide.
*/
int co2Addr = 0x68;
// This is the default address of the CO2 sensor, 7bits shifted left.
void setup() {
  Serial.begin(9600);
  Wire.begin ();
  pinMode(13, OUTPUT); // address of the Arduino LED indicator
  Serial.println(&quot;Application Note AN-102: Interface Arduino to K-30&quot;);
}
///////////////////////////////////////////////////////////////////
// Function : int readCO2()
// Returns : CO2 Value upon success, 0 upon checksum failure
// Assumes : - Wire library has been imported successfully.
// - LED is connected to IO pin 13
// - CO2 sensor address is defined in co2_addr
///////////////////////////////////////////////////////////////////
int readCO2()
{
  int co2_value = 0;  // We will store the CO2 value inside this variable.

  digitalWrite(13, HIGH);  // turn on LED
  // On most Arduino platforms this pin is used as an indicator light.

  //////////////////////////
  /* Begin Write Sequence */
  //////////////////////////

  Wire.beginTransmission(co2Addr);
  Wire.write(0x22);
  Wire.write(0x00);
  Wire.write(0x08);
  Wire.write(0x2A);

  Wire.endTransmission();

  /////////////////////////
  /* End Write Sequence. */
  /////////////////////////

  /*
    We wait 10ms for the sensor to process our command.
    The sensors's primary duties are to accurately
    measure CO2 values. Waiting 10ms will ensure the
    data is properly written to RAM

  */

  delay(10);

  /////////////////////////
  /* Begin Read Sequence */
  /////////////////////////

  /*
    Since we requested 2 bytes from the sensor we must
    read in 4 bytes. This includes the payload, checksum,
    and command status byte.

  */

  Wire.requestFrom(co2Addr, 4);

  byte i = 0;
  byte buffer[4] = {0, 0, 0, 0};

  /*
    Wire.available() is not nessessary. Implementation is obscure but we leave
    it in here for portability and to future proof our code
  */
  while (Wire.available())
  {
    buffer[i] = Wire.read();
    i++;
  }

  ///////////////////////
  /* End Read Sequence */
  ///////////////////////

  /*
    Using some bitwise manipulation we will shift our buffer
    into an integer for general consumption
  */

  co2_value = 0;
  co2_value |= buffer[1] &amp; 0xFF;
  co2_value = co2_value &lt;&lt; 8;
  co2_value |= buffer[2] &amp; 0xFF;


  byte sum = 0; //Checksum Byte
  sum = buffer[0] + buffer[1] + buffer[2]; //Byte addition utilizes overflow

  if (sum == buffer[3])
  {
    // Success!
    digitalWrite(13, LOW);
    return co2_value;
  }
  else
  {
    // Failure!
    /*
      Checksum failure can be due to a number of factors,
      fuzzy electrons, sensor busy, etc.
    */

    digitalWrite(13, LOW);
    return 0;
  }
}
void loop() {

  int co2Value = readCO2();
  if (co2Value &gt; 0)
  {
    Serial.print(&quot;CO2 Value: &quot;);
    Serial.println(co2Value);
  }
  else
  {
    Serial.println(&quot;Checksum failed / Communication failure&quot;);
  }
  delay(2000);
}
</code></pre>
<h3>CO2 Motherboard Update NOV 14 2020</h3>
<p>'Final' REV_A version (ordered on JLCPCB on 14 NOV) is here:</p>
<p><a href="/img/co2/co2_reva_schematic.png"><img src="/img/co2/co2_reva_schematic.png" alt=""></a></p>
<p><a href="/img/co2/co2_reva_3drender.png"><img src="/img/co2/co2_reva_3drender.png" alt=""></a></p>
<p>Repo for REV_A schematic and board file is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/atkins">here</a>.</p>
<hr>
<p>2020 NOV 16</p>
<h3><a name="jimenez"></a>Research paper on CO2 and COVID safety by Peng et al</h3>
<p>Really nice research paper by Peng and Jimenez that yields CO2 thresholds for indoor activity, with thresholds based on activity / mask use / etc -- linked <a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf"><img src="/img/co2/jimenez_abstract.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Abstract from <a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf">Peng and Jimenez 2020</a>.</td>
</tr>
</tbody>
</table>
<p>This is the key figure (Fig 2) to understand from the paper:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/peng_fig2.png"><img src="/img/co2/peng_fig2_small.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Figure 2. from <a href="https://www.medrxiv.org/content/10.1101/2020.09.09.20191676v1.full.pdf">Peng and Jimenez 2020</a>.</td>
</tr>
</tbody>
</table>
<p>An online aersol transmission calculator based on the paper is <a href="https://docs.google.com/spreadsheets/d/16K1OQkLD4BjgBdO8ePj6ytf-RpPMlJ6aXFg3PrIQBbQ/edit#gid=519189277">here</a>.</p>
<p>The tweet broadcasting the tool is <a href="https://twitter.com/jljcolorado/status/1275466006312304640">here</a>.</p>
<p>The lead author on the paper, an expert on aerosol transmission, is <a href="https://twitter.com/jljcolorado">here</a>.</p>
<p>Some of the feedback on the paper &amp; tool was from Linsey Marr, the NYTimes-quoted air expert on COVID transmission.  Her Twitter profile is <a href="https://twitter.com/linseymarr">here</a>.</p>
<p>TODO:</p>
<p>Need to add buttons!!  For calibration, and other navigation.</p>
<p>Sensiron SCD30 <a href="https://www.amazon.co.uk/X-SCD30-Air-Quality-Sensors/dp/B07WRJD4TN/ref=sr_1_2?dchild=1&amp;keywords=scd30&amp;qid=1605562830&amp;sr=8-2">available on Amazon UK</a></p>
<p>NRF52 + LoRa wing setup --</p>
<ul>
<li>B / 11 -- RST</li>
<li>D / 30 -- CS</li>
<li>E / 27 -- IRQ</li>
</ul>
<p><a href="/img/co2/nrf52_pinout.jpg"><img src="/img/co2/nrf52_pinout.jpg" alt=""></a></p>
<h3>Button</h3>
<p><img src="/img/valedalama/kicad_button.png" alt=""></p>
<p><img src="/img/valedalama/button_wiring.png" alt=""></p>
<p><img src="/img/co2/sparkfun_pushbutton.png" alt=""></p>
<hr>
<p>2020 NOV 17</p>
<h3>REV_B -- Based on Feather, adds buttons</h3>
<p>REVB board 3D rendering:</p>
<p><img src="/img/co2/co2_revb_3drender.png" alt=""></p>
<p>REV_B KiCAD design files are <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/atkins">here</a>.</p>
<hr>
<p>2020 NOV 18</p>
<p>Heltec version of CO2 board ... 'REV_C' ...</p>
<p><a href="/img/valedalama/heltec_pinout.png"><img src="/img/valedalama/heltec_pinout.png" alt=""></a></p>
<p>Aside -- interesting 'hiveyes' project using the Heltec, might have interesting code associated with it, <a href="https://community.hiveeyes.org/t/heltec-wifi-lora-32/3125">here</a>.  Nice collection of github code <a href="https://github.com/hiveeyes">here</a>, including weight scales!</p>
<p>Interesting radio protocol <a href="https://github.com/hiveeyes/beradio">here</a>.</p>
<p>Radio protocols -- another way in which efficiency might be in tradeoff with legibility.</p>
<h3>REV_C of board -- based on Heltec</h3>
<p><a href="/img/co2/co2_revc_3drender.png"><img src="/img/co2/co2_revc_3drender.png" alt=""></a></p>
<p>Kicad design files are <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/atkins">here</a>.</p>
<p>Thread <a href="https://www.thethingsnetwork.org/forum/t/big-esp32-sx127x-topic-part-1/10247/43">here</a> on the battery connector type for the Heltec -- &quot;Micro JST 1.25 mm&quot;.</p>
<h3>CO2 Calibration via Gas Cylinder</h3>
<p>Example of 1000 ppm cylinder <a href="http://www.calgasdirect.com/gasco-17l-37-1000-carbon-dioxide-calibration-gas-co2-1000-ppm-balance-air-in-a-17-liter-steel-disposable-cylinder/">here</a></p>
<h3>Aranet: Bluetooth E-Ink CO2 Sensor</h3>
<p>Product <a href="https://www.amazon.com/Aranet4-Home-Temperature-Ink-Configuration/dp/B07YY7BH2W/ref=cm_cr_arp_d_product_top?ie=UTF8">here</a></p>
<p>Manual <a href="https://images-na.ssl-images-amazon.com/images/I/A1ubqWpxeiL.pdf">here</a></p>
<h3>Moteino M0</h3>
<p>Product page <a href="https://lowpowerlab.com/shop/product/184">here</a></p>
<p>Product guide <a href="https://lowpowerlab.com/guide/moteino/moteinom0/">here</a></p>
<h3>IQAir monitor</h3>
<p>Link on Amazon <a href="https://www.amazon.com/dp/B0784TZFRW/ref=syn_sp_syn_da_desktop_2?psc=1&amp;tag=dradisplay-20&amp;ascsubtag=addfab9c56bb6f407e973154a0adf08a_CT&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEzVFJTSjBDMkJHQlFVJmVuY3J5cHRlZElkPUEwNDIxNTc0Mlc2M1A3VlZHOE05MSZlbmNyeXB0ZWRBZElkPUEwNDA5ODE3MzExTVdEQUZIMjFXWCZ3aWRnZXROYW1lPXNwX3N5bl9kYV9kZXNrdG9wJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==">here</a>.</p>
<h3>GZair monitor for CO2</h3>
<p>Link on Amazon <a href="https://www.amazon.com/dp/B0861777SL/ref=syn_sd_onsite_desktop_96?psc=1&amp;uh_it=831b79d927acc84ecbf32f6df054d07c_CT&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEzVTRMWFREU1pUUzY2JmVuY3J5cHRlZElkPUEwODkxNTcyMzZCWFc3OFZISDdWJmVuY3J5cHRlZEFkSWQ9QTAwNTk2NzcyUVJRR0NaVU80M09ZJndpZGdldE5hbWU9c2Rfb25zaXRlX2Rlc2t0b3AmYWN0aW9uPWNsaWNrUmVkaXJlY3QmZG9Ob3RMb2dDbGljaz10cnVl">here</a>.</p>
<hr>
<p>2020 NOV 23</p>
<h3><a name="rev_a_build"></a>Carbon Dioxide Board Rev_A</h3>
<p>REV_A Boards have arrived in the mail.  Assembly and initial code tests!</p>
<p>Sparkfun SCD30 i2c library is <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">here</a>.</p>
<p>First version with display, lora, screen, scd30 is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/firmware/feather_m0_scd30_batt_lora_display">here</a>.</p>
<p><img src="/img/co2/rev_a_proto.jpeg" alt=""></p>
<p>Associated gateway code is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_a/firmware/gateway/heltec_wifi_lora_bayou_farmos">here</a>.</p>
<p>Online data is currently posting <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/rev_a_data.png"><img src="/img/co2/rev_a_data.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Quick indoor test of REV_A board.</td>
</tr>
</tbody>
</table>
<p>Also took sensor outside for a few minutes.  It fluctuated a lot.  Seems like we're going to want to average readings over a minute or or more to get some stable value when the CO2 is low.  Might have been due to wind. Might need to suggest that people get out of wind if they calibrate outside.  Or, to tell folks to wait til the reading stabilizes before hitting calibrate.  Or even have this happen automatically.</p>
<h3>TODO</h3>
<ul>
<li>Add watchdog to remote node and to gateway</li>
<li>Add calibration procedure</li>
<li>switch to set measurement interval?</li>
<li>dip switch to set node ID</li>
</ul>
<hr>
<p>2020 NOV 24</p>
<p><strong>Results of overnight test on NOV 23.</strong>  Out of three people in apartment, two went to bed at around 8 PM, the final person at around 10:30 PM.  One person (me) woke up and started using computer right next to CO2 sensor at 4:30 AM. Collecting data in <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">this Bayou feed</a>, generated these graphs as of 4:30 AM:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_nov23_night.png"><img src="/img/co2/co2_nov23_night.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CO2 concentration in PPM, 2020 NOV 23 overnight.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/temp_nov23_night.png"><img src="/img/co2/temp_nov23_night.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Temperature in C, 2020 NOV 23 overnight.</td>
</tr>
</tbody>
</table>
<p><strong>Comment</strong>. Note the correlation between temperature and CO2, with co-occurring peaks around 12 AM and 1:30 AM. The temperature pattern likely due to the HVAC system.  (The spike in CO2 and temperature at 4:30 AM are likely simply due to my presence near the sensor.) Unless the HVAC is in fact bringing in air with higher concentration of CO2, perhaps this indicates the range of fluctuation in CO2 reading due to temperature.  Do we expect CO2 to rise with temperature for this NDIR sensor type?</p>
<p>Found nice reference for effect of temperature and pressure on CO2, <a href="https://www.bapihvac.com/application_note/effects-of-temperature-and-barometric-pressure-on-co2-sensors-application-note/">here</a>.</p>
<p>Key passage:</p>
<blockquote>
<p>The size of the NDIR sampling chamber is fixed and is open to the atmosphere so that air can move in and out.  As explained above, the number of air molecules in a given volume is affected by temperature and air pressure but not the concentration of CO2.  At low pressures or high temperatures, there will be fewer air molecules in the sample chamber, so there will also be fewer CO2 molecules, even though the ppm of CO2 hasn’t changed.  Fewer CO2 molecules “fools” the sensor into thinking that the CO2 concentration is lower than it really is.  At high pressures or low temperatures, there are more air molecules in the sample chamber and more CO2 molecules, even though the CO2 concentration hasn’t changed.  More CO2 molecules “fools” the sensor into thinking that the CO2 concentration is higher than it really is. Therefore a CO2 sensor calibration will only be accurate at one temperature and one air pressure.</p>
</blockquote>
<p>This would suggest:</p>
<ul>
<li>higher pressures &amp; lower pressures--&gt; more air (and thus more CO2) molecules in the chamber --&gt; higher CO2 readings</li>
<li>lower pressures &amp; higher temperatures --&gt; less air (and thus less CO2) molecules in chamber --&gt; lower CO2 readings</li>
</ul>
<p>This fluctuation is due to pressure inside the apartment, when the HVAC system turns on?  Now worth attempting to compensate with external pressure sensor.</p>
<p><strong>Addendum</strong>.  I've now replaced the above graphs so that we can see the readings from 0430 to 0530, during which time I sat close to sensor.  Note that the temperature rose less than during some of the nightly spikes, but CO2 rose more, as one might expect given my proximity to the sensor. This perhaps leads to more confidence in the temperature-compensation of the SCD30.</p>
<p><a name="calibration"></a></p>
<p><strong>Thoughts on calibration, and baselines.</strong>  The key metric in the 2020 paper by <a href="#jimenez">Peng et al</a> is 'PPM above baseline'.  So, perhaps absolute calibration isn't really an important metric, here; more useful and interesting might be to establish a 'baseline', algorithmically; display it graphically; and allow the user to adjust based on their interpretation.</p>
<p>Key passage from page one of <a href="#jimenez">Peng et al</a>:</p>
<blockquote>
<p>Indoor CO2 has been suggested as a practical proxy of respiratory infectious disease transmission
risk (8), as pathogen-containing aerosols and CO2 are co-exhaled by those infected (Fig. 1).
Since background (ambient) CO2 level is stable and indoor excess CO2 is usually only from
human exhalation, measurements of indoor CO2 concentration by low-cost CO2 sensors can
often be good indicators of infection risk and suitable for mass deployment (9, 10).</p>
</blockquote>
<h3>Use of microphones to detect ambient activity</h3>
<ul>
<li>Electret MAX4466 (manual gain) listed on Adafruit, <a href="https://www.adafruit.com/product/1063">here</a>. Note that it's also widely avail on <a href="https://www.amazon.com/dp/B08CV2X658/ref=sspa_dk_detail_1?psc=1&amp;pd_rd_i=B08CV2X658&amp;pd_rd_w=e4Wqd&amp;pf_rd_p=7d37a48b-2b1a-4373-8c1a-bdcc5da66be9&amp;pd_rd_wg=jK4OK&amp;pf_rd_r=0WTC7Z5H34N5NVXD75YE&amp;pd_rd_r=e8a78340-09f3-4f09-a9fe-63e5a2dae57b&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyTE85RlYxVU5SWkRZJmVuY3J5cHRlZElkPUEwNjE5ODUyMlE5MEhGNUFEMzlDWSZlbmNyeXB0ZWRBZElkPUEwMzEwMzMxMUxTNEZUR1k2NTJCVCZ3aWRnZXROYW1lPXNwX2RldGFpbCZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">Amazon</a></li>
<li>Electret MAX9814 (auto gain) listed on Adafruit, <a href="https://www.adafruit.com/product/1713">here</a>.</li>
<li>Adafruit Silicon MEMS Microphone Breakout - SPW2430, <a href="https://www.adafruit.com/product/2716">here</a></li>
</ul>
<p>Nice <a href="https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/overview">tutorial</a> on measuring sound levels using the MAX4466.  This might be the way to go if we're going to use ambient audio data to determine in-room activity.</p>
<p>Tutorial on using the <a href="https://learn.adafruit.com/adafruit-agc-electret-microphone-amplifier-max9814">auto-gain</a> mic, which might be even better ...</p>
<blockquote>
<p>This fancy microphone amplifier module is a step above the rest, with built in automatic gain control. The AGC in the amplifier means that nearby 'loud' sounds will be quieted so they don't overwhelm &amp; 'clip' the amplifier, and even quiet, far-away sounds will be amplified. This amplifier is great for when you want to record or detect audio in a setting where levels change and you don't want to have to tweak the amplifier gain all the time.</p>
</blockquote>
<p><strong>Design.</strong>  Using a simple, auto-amplified microphone in this context seems useful.  The raw data can be presented online, and used in an attempt to discern baseline thresholds.  No algorithm needs to be applied at first; or, the user community can supply the algorithm.</p>
<p>This leads to an instrument in the following <strong>Designer PCB</strong> configuration:</p>
<ul>
<li>ESP32 ($3)</li>
<li>USB chip ($2)</li>
<li>Lithium ion charging ($1)</li>
<li>OLED display (larger if possible) ($3)</li>
<li>microphone (MAX9814 with switch to turn power off) ($2) -- MAX9814 datasheet is <a href="https://www.mouser.com/datasheet/2/256/MAX9814-1516143.pdf">here</a>; chip is listed <a href="https://www.mouser.com/ProductDetail/Maxim-Integrated/MAX9814ETD%2BT?qs=1THa7WoU59HUZGorIAH%2Frw%3D%3D&amp;gclid=CjwKCAiA-_L9BRBQEiwA-bm5fu4Xw3jLMp2pgE2Dl_CsuoqKs4_FdG-qEZDOrhAV2GQXbrhy5HwSVRoCcXMQAvD_BwE">here</a>.</li>
<li>SCD30 ($50)</li>
<li>BMP388 or 390 ($5)</li>
<li>a button or two ($2)</li>
<li>PCB ($4)</li>
</ul>
<p>Total: $72</p>
<p>This can also be accomplished by a more <strong>DIY Version</strong>:</p>
<ul>
<li>ESP32 + OLED + USB (Heltec) ($20)</li>
<li>microphone (adafruit MAX9814) ($8)</li>
<li>SCD30 ($50)</li>
<li>pressure sensor (adafruit BMP388) ($10)</li>
<li>PCB ($10)</li>
</ul>
<p>Total: $98</p>
<p>Likely best to produce this latter version immediately, and then take time, if available, to make the inexpensive version.</p>
<p><strong>Philosophy.</strong></p>
<p>This is an open hardware project in the realm of home-based IOT; a highly-contested area around privacy.  In this case, for example, a microphone levels can probably serve a useful proxy for indoor occupancy status. Usually, this would lead to anxieties about privacy.  But because we can produce this device in an open hardware manner, we can avoid an entire class of such concerns.  (Not all such concerns:  there's still the possibility that other surveillance software made it onto the device).</p>
<p>By making this a FOSS/H project, we allow more eyes onto the design to evaluate.</p>
<p>Switch on microphone.</p>
<p>Ability to deploy mic without CO2, if just want to monitor activity levels in an area.</p>
<p>Ability to deploy CO2 without mic, in order to secure privacy.</p>
<h3>MAX9814 Adafruit module</h3>
<p>Listing for product is <a href="https://www.adafruit.com/product/1713">here</a>.</p>
<p>Schematic is <a href="https://cdn-learn.adafruit.com/assets/assets/000/014/290/large1024/adafruit_products_max9814sch.gif?1448049933">here</a>.</p>
<h3>Note on confounding factors</h3>
<p>From page 2 of Peng 2020:</p>
<blockquote>
<p>If there are no other significant CO2 sources/sinks (e.g., gas/coal stove and pets/plants), i.e., if
indoor excess CO2 (relative to the background outdoor level) production is only due to human
exhalation and its loss is ventilation, similar quantities for CO2 can be expressed as follows (see
Materials and Methods for the derivation)</p>
</blockquote>
<p>Gas stove or pets can be a source; plants can be a sink.</p>
<p>Indeed, looks like I may have seen this effect using a propane stove on Nov 24 2020, as per experiment above.</p>
<hr>
<p>24 NOV 2020 Update @ 14:30</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/nov_24_left_house.png"><img src="/img/co2/nov_24_left_house.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CO2 (PPM).  Note: made lunch around noon on Nov 24 (gas stove).  Left house around 12:30 / 12:45 on Nov 24.</td>
</tr>
</tbody>
</table>
<h3>Microphone pinouts</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/max9814.jpg"><img src="/img/co2/max9814.jpg" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MAX9814 Auto-gain audio board from Adafruit.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/max4466.jpg"><img src="/img/co2/max4466.jpg" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MAX4466 adjustible audio board from Adafruit.</td>
</tr>
</tbody>
</table>
<p>2020 NOV 24 Update 22:10</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_nov24_full.png"><img src="/img/co2/co2_nov24_full.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Arrived back home at 5:30 PM Nov 24th. Interesting that the ambient CO2 decreased in our absence to a value lower than overnight in the apartment with us sleeping there.</td>
</tr>
</tbody>
</table>
<hr>
<p><a name="nov25"></a></p>
<p>2020 NOV 25</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/nov25_over.png"><img src="/img/co2/nov25_over.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>CO2 (PPM) measured on Nov 245th through morning of Nov 25th.</strong>  Spikes on Nov 24th at 7:30 AM, 10:30 AM, 12 PM, and on Nov 25th at 8 AM, are perhaps due to use of propane stove for cooking.  Apartment was unoccupied on Nov 24th from about 12:30 PM until 5:30 PM.</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-11-27 17:20:40</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_nov26_nov27.png"><img src="/img/co2/co2_nov26_nov27.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Snapshot from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong>  Left house around 9 AM on Nov 26th.  Visitors likely in house, late morning of Nov 27th. Returned home a little before 5 PM, and started using gas stove.</td>
</tr>
</tbody>
</table>
<h3>Light sensors</h3>
<p>Vishay light sensor <a href="https://www.adafruit.com/product/4162">here</a>.</p>
<p>Simple, cheap analog light sensor breakout <a href="https://www.adafruit.com/product/2748">here</a>.</p>
<p>BH1750 <a href="https://www.adafruit.com/product/4681">here</a>,seemed to be recommended for ambient light sensing ... but difficult to solder.  Note though that this seems widely available on Amazon as breakout boards.  <a href="https://makersportal.com/shop/ambient-light-sensor-bh1750-16-bit">This description</a> also indicates that it's a good candidate for this application; and in fact, the leads don't look too small.</p>
<h3>Microphones</h3>
<p>MEMS mic from Adafruit, the <a href="https://www.adafruit.com/product/2716?gclid=CjwKCAiA5IL-BRAzEiwA0lcWYmVgg-sFYvw2DV5d3ki49VliOATt6F7_MmGSpVRBbz_hWldCvHzw-BoCmDgQAvD_BwE">SPW2430</a></p>
<p>Looks like: use the electret verison for the DIY solderable verison; use the SPW2430 or similar for custom PCB.</p>
<p><a href="https://www.amazon.com/dp/B08CV2X658/ref=sspa_dk_detail_1?psc=1&amp;pd_rd_i=B08CV2X658&amp;pd_rd_w=e4Wqd&amp;pf_rd_p=7d37a48b-2b1a-4373-8c1a-bdcc5da66be9&amp;pd_rd_wg=jK4OK&amp;pf_rd_r=0WTC7Z5H34N5NVXD75YE&amp;pd_rd_r=e8a78340-09f3-4f09-a9fe-63e5a2dae57b&amp;spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyTE85RlYxVU5SWkRZJmVuY3J5cHRlZElkPUEwNjE5ODUyMlE5MEhGNUFEMzlDWSZlbmNyeXB0ZWRBZElkPUEwMzEwMzMxMUxTNEZUR1k2NTJCVCZ3aWRnZXROYW1lPXNwX2RldGFpbCZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">MAX4466 from Amazon</a>:</p>
<p><img src="/img/co2/max4466_amazon.png" alt=""></p>
<p>Nice <a href="https://www.cuidevices.com/blog/comparing-mems-and-electret-condenser-microphones">post</a> on comparing MEMS and Electret microphones.</p>
<p>Tutorial on measuring sound levels with the MAX4466 by Adafruit <a href="https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/measuring-sound-levels">here</a>.</p>
<h3>Design Review</h3>
<p>2020-11-27 20:18:07</p>
<p>Microphones:</p>
<ul>
<li>for DIY version: use electret, b/c cheap and widely available. Also use SPW2430 breakout from Adafruit.</li>
<li>for artisanal verison: use SPW2430.</li>
</ul>
<p>Light sensors:</p>
<ul>
<li>for both DIY and artisanal versions, use BH1750 boards / chips.</li>
</ul>
<h3>REV_B + MAX4466 Experiment</h3>
<p><img src="/img/co2/rev_b.jpg" alt=""></p>
<p><img src="/img/co2/co2_and_mic.jpg" alt=""></p>
<p>REV_B appears to work!</p>
<p>Now testing microphone ...</p>
<p>Connecting analog out of mic to A0 on REV_B (one of the button pins) ...</p>
<p>Running overnight on Nov 27th with mic sampling of 10 sec ...</p>
<p>Test code is [here](</p>
<p>Data will appear <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">here</a>.</p>
<hr>
<p>2020-11-28 04:22:39</p>
<p>My impression is that this mic will require additional signal conditioning to pick up ambient noise; perhaps this can be done with an op-amp and a potentiometer that allows experimentation; or maybe a light sensor is the best next step.  Or maybe auto-gain is best, the idea being that it will attempt to acquire <em>any</em> signal.  That said, I'd think that 'max gain' on this system would do the trick, if that would work.  All depends on the circuit and the mic.</p>
<p><a href="https://cdn-shop.adafruit.com/datasheets/MAX4465-MAX4469.pdf">MAX4466 Datasheet</a>.</p>
<p>Data from the Bayou feed, overnight Nov 27th -- Nov 28th in CSV format has a snapshot <a href="https://docs.google.com/spreadsheets/d/11WYxWyIDqpz9qTyOSo6GRbPs4L-iIx42mY1tSCSNI58/edit?usp=sharing">here</a>. This analysis is necessary because the current graphical display in Bayou is configured to who only every 10th data point;  we'd like to see the higher-density data.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mic_morning_nov28.png"><img src="/img/co2/mic_morning_nov28.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Snapshot of mic data from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong>  Woke up at 5 AM.  Note that pattern of sampling shown is a bit odd.  Need to dive back in an look at how data is captured and how it should be averaged.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mic_sampled_nov28_unix.png"><img src="/img/co2/mic_sampled_nov28_unix.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Higher sampling rate of mic data from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong>   Working to convert this to proper dates (see below) ...</td>
</tr>
</tbody>
</table>
<h3>Aside: converting unix timestamps in Sheets</h3>
<p>Formula for converting unix timestamp to date in Excel / Sheets is discussed <a href="https://websiteseochecker.com/blog/what-is-timestamp/">here</a>;  if the timestamp is in cell 'A1', the formula for the date is:</p>
<pre><code>=(((A1/60)/60/24)+DATE(1970,1,1)
</code></pre>
<h2><a name="mic_experiment"></a> Analysis of Initial CO2 and Microphone Data</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/mic_and_co2_unix_hours.png"><img src="/img/co2/mic_and_co2_unix_hours.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>CO2 and Mic data from the <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">Bayou feed</a>.</strong> Microphone data is &quot;highest p-p amplitude over 10 sec interval&quot;.  Note -- entered room with sensor around 4:30 AM.  Generally mic data seems to precipitate rise in CO2 level.  At some point gas stove was used;  from this data, I would surmise around 6:40 AM, but unsure. Need to track this next round.</td>
</tr>
</tbody>
</table>
<h3>Enclosure options</h3>
<p>115 x 90 x 55mm for $10 w/ transparent screw cover <a href="ZW5jcnlwdGVkUXVhbGlmaWVyPUEyNlY3TlNQTks4WTY0JmVuY3J5cHRlZElkPUEwMTcyOTc0M1A5OTBMNE1DV0E4SyZlbmNyeXB0ZWRBZElkPUEwNTEwMzQ1SkY1MDYwQ0ZMQzBBJndpZGdldE5hbWU9c3BfZGV0YWlsMiZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU">here</a>.</p>
<p>Popular 200 x120 x56 mm for $15 w/ transparent screw cover <a href="https://www.amazon.com/LeMotech-Dustproof-Waterproof-Electrical-Enclosure/dp/B07BPPJZBG/ref=pd_sbs_60_1/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07BPPJZBG&amp;pd_rd_r=86924a94-2620-4e15-91d7-f9a01104fb4f&amp;pd_rd_w=VUfCX&amp;pd_rd_wg=tdXB2&amp;pf_rd_p=ed1e2146-ecfe-435e-b3b5-d79fa072fd58&amp;pf_rd_r=M5FYKR285RHNS1H54ZFB&amp;psc=1&amp;refRID=M5FYKR285RHNS1H54ZFB">here</a></p>
<p>5.9 x 3.9 x 2.8inch w latching cover <a href="https://www.amazon.com/LMioEtool-Dustproof-Waterproof-Electrical-Transparent/dp/B07PK8K8S2/ref=pd_lpo_60_t_2/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07PK8K8S2&amp;pd_rd_r=105ea24a-0322-41f7-8b9f-6d5b31591072&amp;pd_rd_w=xO7n2&amp;pd_rd_wg=5A7XY&amp;pf_rd_p=7b36d496-f366-4631-94d3-61b87b52511b&amp;pf_rd_r=M5FYKR285RHNS1H54ZFB&amp;psc=1&amp;refRID=M5FYKR285RHNS1H54ZFB">here</a></p>
<p>Would be nice to have 'wings' for mounting ...</p>
<p>This one has wings, <a href="https://www.amazon.com/YXQ-83x58x33mm-Junction-Waterproof-Enclosure/dp/B07JH8LNHY/ref=pd_sbs_60_4/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07JH8LNHY&amp;pd_rd_r=86924a94-2620-4e15-91d7-f9a01104fb4f&amp;pd_rd_w=VUfCX&amp;pd_rd_wg=tdXB2&amp;pf_rd_p=ed1e2146-ecfe-435e-b3b5-d79fa072fd58&amp;pf_rd_r=M5FYKR285RHNS1H54ZFB&amp;psc=1&amp;refRID=M5FYKR285RHNS1H54ZFB">here</a>.</p>
<p>In fact, seems to be part of a pretty standard and well-rated series, <a href="https://www.amazon.com/Awclub-Junction-Dustproof-Weatherproof-Electrical/dp/B07NSTW7QB/ref=pd_di_sccai_4/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07NSTW7QB&amp;pd_rd_r=a2c81e3d-386a-43ae-a847-00ab2f985575&amp;pd_rd_w=WY4y1&amp;pd_rd_wg=V0jWO&amp;pf_rd_p=c9443270-b914-4430-a90b-72e3e7e784e0&amp;pf_rd_r=HE1G91ZWD43Y8H33FZJ3&amp;psc=1&amp;refRID=HE1G91ZWD43Y8H33FZJ3">here</a></p>
<p>In particular, the <a href="https://www.amazon.com/Awclub-Junction-Dustproof-Weatherproof-Electrical/dp/B07NSV7CSM/ref=pd_di_sccai_4/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07NSTW7QB&amp;pd_rd_r=a2c81e3d-386a-43ae-a847-00ab2f985575&amp;pd_rd_w=WY4y1&amp;pd_rd_wg=V0jWO&amp;pf_rd_p=c9443270-b914-4430-a90b-72e3e7e784e0&amp;pf_rd_r=HE1G91ZWD43Y8H33FZJ3&amp;refRID=HE1G91ZWD43Y8H33FZJ3&amp;th=1">4.5&quot;x3.3&quot;x1.4&quot;(115x85x35mm)</a> size looks good, for $10.  But: maybe too flat to drill holes for cables. And will require fairly large PCB.</p>
<p>From comments, the comparison is between Awclub and LeMotech on Amazon, favoring LeMotech for quality. Likely to find some analysis of sizes and design in hobby projects online (or better: datasheets) given how popular the brands are.</p>
<p>Plan: first assess how large the project will likely be by laying out some PCBs, and order an enclosure.</p>
<p>Review of best projecte enclosures <a href="https://diabeteshealthequity.org/arduino-project-enclosure/">here</a></p>
<p>Apparently the 'wings' I'm referring to are termed 'ears'.</p>
<p>E.g.: for the <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G58SLB1?th=1">4.5 x 3.5 x 2.68 inch(115 x 90 x 68 mm) 'ear' Lemotech version</a>, the  PCB is essentially 84 mm by 89 mm.</p>
<p>This might be a good case size to shoot for.  I think I can accommodate it. A larger PCB might be expensive, anyway.</p>
<p>Datasheet for this enclosure is <a href="https://images-na.ssl-images-amazon.com/images/I/61P4XQPyJyL.pdf">here</a>.</p>
<p>Need to accommodate a USB cable.</p>
<p>Alright: let's lay out a PCB for testing, and if it looks plausible, order one of these.</p>
<p>Note that the  6.2&quot;x3.5&quot;x1.8&quot; version of LeMotech has a nice drawing by a user. Also has same price as smallest version.</p>
<p>Suggestion to make panel mounting oneself.</p>
<p>This is in keeping with previous ideas.</p>
<p>From what I can tell online, the most effective &amp; inexpensive / adaptable approach to enclosures might be:</p>
<ul>
<li>design a PCB to be as small as possible, with mounting holes for standard screw sizes</li>
<li>find a nice inexpensive enclosure design</li>
<li>make a 'mounting plate' that fits snugly inside the enclosure, with mounting holes for one's PCB</li>
</ul>
<p>The reason given online for this is that the inexpensive enclosures are often made from 'recycled molds' that have poor tolerances.  So it really isn't a great idea to design a custom PCB for them.  Rather, lasercut inexpensive (ideally, drillable, as backup) mounting plates.</p>
<h3>Large, Flat LeMotech enclosure</h3>
<blockquote>
<p>Outside Size (approx.): 6.2&quot;x3.5&quot;x1.8&quot;(158mmx90mmx46mm)/(L<em>W</em>H); Inner size (approx.): 5.9&quot;x3.3&quot;x1.6&quot;(151mmx84mmx42mm)/(L<em>W</em>H)- - (Allowable Error: 2mm); Screw Thread Size: M4</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/larger_lemotech.png"><img src="/img/co2/larger_lemotech.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Lemotech enclosure, <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G4VT33D?th=1">6.2 x 3.5 x 1.8 inch (158 x 90 x 46 mm)</a>.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/larger_lemotech_drawing.png"><img src="/img/co2/larger_lemotech_drawing.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Customer-provided CAD drawings for Lemotech enclosure, <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G4VT33D?th=1">6.2 x 3.5 x 1.8 inch (158 x 90 x 46 mm)</a>.</td>
</tr>
</tbody>
</table>
<h3>Smallest LeMotech enclosure</h3>
<blockquote>
<p>Outside Size (approx.): 4.5&quot;x3.5&quot;x2.68&quot;/(115mmx90mmx68mm)(L<em>W</em>H); Inner size (approx.): 4.3&quot;x3.3&quot;x2.44&quot;/(111mmx86mmx62mm) (L<em>W</em>H)- -(Allowable Error: 2mm); Screw Thread Dia.: 4mm/0.16&quot;</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/smallest_lemotech.png"><img src="/img/co2/smallest_lemotech.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Lemotech enclosure, <a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G58SLB1?th=1">4.5&quot;x3.5&quot;x2.68&quot;/(115mmx90mmx68mm)</a>.</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-11-28 15:37:00</p>
<p><strong>Overall framing / todos.</strong></p>
<ul>
<li>Donation-based server setup?  How difficult to arrange for logins?</li>
<li>How to display threshold guide information (if at all)</li>
<li>Wifi configuration setup</li>
<li>Firmware update configuration.  (Perhaps it's best to start with folks who are familiar with Arduino, so that they can help refine / test the workflow.)</li>
<li>Cheaper artisanal pcb version.  Likely based on ESP32.  using as many SMT parts as possible.</li>
<li>Laser-cut mount for electronics. Or something that can be cut out from stiff paper / etc.</li>
<li>Cardboard enclosure?</li>
<li>Partnering institutions who'd like to help evaluate and test. Peng et al are an initial candidate. Others?</li>
<li>Online documentation for assembly and use of kit.</li>
</ul>
<hr>
<p>2020-11-29 21:52:45</p>
<h3>Dashboards</h3>
<p><a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">Jupyter dashboard</a> via voila -- <a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">gallery of examples</a></p>
<p>gesis notebooks, <a href="https://notebooks.gesis.org/">here</a></p>
<p>guide to voila, <a href="https://analyticsindiamag.com/complete-guide-to-voila-to-turn-a-jupyter-notebook-into-a-standalone-web-application/">here</a></p>
<p>Dashboarding options in Jupyter discussed <a href="https://medium.com/informatics-lab/jupyter-dashboarding-some-thoughts-on-voila-panel-and-dash-b84df9c9482f">here</a></p>
<hr>
<p>2020-12-01 13:41:41</p>
<h3>REV_D -- ESP32 + RFM95 SMT Version</h3>
<ul>
<li>FTDI / USB-TTL cable req'd for first version</li>
<li>mimic pinout of the heltec wifi 32 lora v2</li>
<li>auto-reset feature from Quahog revision</li>
<li>leds for mic level?</li>
<li>mic</li>
<li>light sensor</li>
<li>oled display</li>
<li>ultrasonic distance sensor breakout? or time of flight / i2c breakout?</li>
<li>qwik connector for i2c breakout for additional sensors</li>
</ul>
<hr>
<p>2020-12-01 16:17:24</p>
<p>Continuing research for REV_D ...</p>
<h3>Quahog circuit (ESP32 + RFM95) ...</h3>
<p><a href="/img/hog32.pdf"><img src="/img/hog32.png" alt=""></a></p>
<p>Some changes that need to be made to the circuit:</p>
<ul>
<li>get rid of R4 and C4</li>
<li>place R1, C3, R2, R3, Q1, and Q2</li>
<li>need to connect pin 2 to ground (or it can float; but currently it is used in i2c, and is pulled high with a resistor, so we need to connect it to ground)</li>
<li>need to connect the 'DTR' pin on the CP2104 breakout to the DTR pin on the quahog</li>
</ul>
<h3>Heltec pinout (ESP32 + RFM95) ...</h3>
<p><a href="/img/co2/heltec_wifi_lora_v2_pinout.png"><img src="/img/co2/heltec_wifi_lora_v2_pinout.png" alt=""></a></p>
<h3>Heltec schematic</h3>
<p><a href="/img/co2/WIFI_LoRa_32_V2(868-915).PDF"><img src="/img/co2/heltec_schematic.png" alt=""></a></p>
<h3>Feather ESP32 Schematic</h3>
<p><a href="/img/co2/feather_esp32_schem.png"><img src="/img/co2/feather_esp32_schem.png" alt=""></a></p>
<h3>REV_C Notes</h3>
<p>Misjudged the header spaceings on the Heltec -- too far apart by one row!</p>
<h3>REV_D Notes</h3>
<p><a href="https://www.onsemi.com/pub/Collateral/MMBT2222LT1-D.PDF">MMBT2222 NPN Mosfet datasheet</a> -- it's 'BEC' -- 1: BASE, 2: EMITTER, 3: COLLECTOR</p>
<h3>BMP388 / 390</h3>
<p>Adafruit guide to BMP388 is <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx">here</a>.</p>
<p>Breakout schematic:</p>
<p><a href="/img/co2/sensors_BMP390_sch.png"><img src="/img/co2/sensors_BMP390_sch.png" alt=""></a></p>
<hr>
<p>2020-12-01 20:45:59</p>
<h3>REV_D Initial Pass</h3>
<p><img src="/img/co2/rev_d_3drender.png" alt=""></p>
<hr>
<p>2020-12-02 20:41:42</p>
<p>Upshot -- the SPW2430 mic is weak w/out an amplifier -- should check out tutorial for how to add it when doing SMT version ...</p>
<p>Meanwhile, light sensor BH1750 tutorial is <a href="https://learn.adafruit.com/adafruit-bh1750-ambient-light-sensor">here</a></p>
<p>Install hp_BH1750 library via Arduino IDE ...</p>
<p>firmware that adds the light sensor is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/remote/feather_m0_scd30_batt_lora_display_max4466_bh1750">here</a></p>
<p>Resultant data feed <a href="http://159.65.226.222:3000/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de">here</a></p>
<h3>Adding an amplifier to the SPW2430</h3>
<p>For reference, Eagle CAD for max4466 is <a href="https://github.com/adafruit/Adafruit-MAX4466-Electret-Mic-Amplifier-PCBs">here</a> -- can likely use the amp setup they have ...</p>
<hr>
<p>2020-12-03 08:25:40</p>
<p>co2 sensor seems to have stopped last night? and reset on m0 didn't reset it -- needed to power cycle -- do we need a mosfet on it?</p>
<p>if we use esp32 for mic, do we need to worry about analog performance / drift?</p>
<p>Should SEL be floating to ground (or tied to ground) on SCD30? https://forum.sparkfun.com/viewtopic.php?t=48325</p>
<p>issue where bh1750 library hangs <a href="https://forum.mysensors.org/topic/9214/bh1750-library-hangs">here</a>.</p>
<p>tried co2 + bh1750 -- co2 freezes</p>
<p>can't reset, co2 still 'frozen'</p>
<p>changed firmware to remove bh1750, but kept bh1750 on board, co2 freezes</p>
<p>then removed wires of bh1750, no freezing yet</p>
<p>I wonder if it's an 'address' issue with the bh1750?  can check.  info on the module i'm using is <a href="https://www.amazon.com/SMAKN%C2%AE-BH1750-Digital-intensity-Arduino/dp/B014IP9V4I">here</a></p>
<p>BUT:  light sensor is of questionable use for now.  better perhaps to have breakout for i2c.</p>
<p>real next steps:</p>
<ul>
<li>check esp32 feather functionality on rev_b breakout board</li>
<li>pull in bmp388 parameters [X]</li>
<li>how to incorprate the max4466 electret, or add amplification to the smt mic module? (the 'sw something')?</li>
</ul>
<p>Seems like the max4466 board avail on amazon (<a href="https://www.amazon.com/uxcell-Electret-Microphone-Amplifier-Adjustable/dp/B07W3HV92Z/ref=sr_1_10?dchild=1&amp;keywords=max4466&amp;qid=1607006487&amp;s=industrial&amp;sr=1-10">here</a>) is fairly identical to that sold by Adafruit. wonder if the op-amp is similarly set up.</p>
<p>So, design:</p>
<ul>
<li>esp32</li>
<li>oled</li>
<li>bmp388</li>
<li>scd30</li>
<li>mic (electret or smt)</li>
<li>buttons</li>
<li>leds to show mic level? or just: remove board</li>
<li>breakouts for avail pins</li>
<li>qwiic breakout</li>
</ul>
<p>i like how explicit the mic on the co2 sensor is ...
and it's an analog reading -- if it's removed, just get 'zero' for analog measurement.</p>
<p>that might be the place to start. simplify the design. part is avail on amazon, alternative to adafruit.</p>
<p>don't even need a switch -- just remove the part.</p>
<p>Nice feature:  basic board that can be produced with SMT parts; then, add adafruit boards for pressure and/or mic as one likes.</p>
<h3>Adding BMP388 functionality to REV_B</h3>
<p>Tutorial on Adafruit <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx/arduino">here</a>.</p>
<p>Actually, confusing way to do the i2c / spi ... not sure how to hook up to Feather's i2c ...</p>
<p>Shifting to Sparkfun library <a href="https://www.sparkfun.com/products/17001">here</a> ....</p>
<p>which leads to the library <a href="https://github.com/MartinL1/BMP388_DEV">here</a></p>
<p>Nice feature:  allows for use with ESP32, has special code for that ... (maybe just picks particular pins?)</p>
<hr>
<p>2020-12-03 10:10:13</p>
<p>Looks like BMP388 code is working (using the lib from MartinL1, 'BMP388_DEV', <a href="https://github.com/MartinL1/BMP388_DEV">here</a>).</p>
<p>Also: having the device on a Feather LoRa, using a gateway, is a nice system -- can deploy several all over a building, or across a campus, even if no wifi available.</p>
<p>University systems have issues using wifi.  This way, can use where there is wifi.  Also: get <em>one</em> device registered on wifi network, rather than several.  (Typically, for IT on campus, would need to register every one).</p>
<p>Also note:  might be useful to have a PC with a heltec and a python script. That way the PC can be registered on the network, the heltec can be placed at a height.</p>
<p>Also: might be good to have a microsd on the heltec.</p>
<p>Need to test soon in a university / high school class setting.</p>
<p>Can we get serial input to a chromebook this way?</p>
<hr>
<p>2020-12-03 15:58:47</p>
<p>Features to add:</p>
<ul>
<li>DIP switch to identify the remote node, if feather lora based</li>
<li>access point signup w/ node id entry</li>
</ul>
<p>Another reason to do esp32 + rfm95 is to allow for access point configuration of device</p>
<hr>
<p>2020-12-04 22:21:45</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/co2_mic_dec4_2020.png"><img src="/img/co2/co2_mic_dec4_2020.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Red is mic data, blue is CO2.  Spreadsheet is <a href="https://docs.google.com/spreadsheets/d/1y74CIL4FuVBikPx3nCTVWIgqVZ9oZfcVcnaa1pv78OU/edit?usp=sharing">here</a>, based on feed <a href="http://159.65.226.222:3000/api/drives/112a7b2a9d08f492a6736aba33de90c519b7966158f6a2682f9db5eb122c51de/csv?limit=40000">here</a> (pulled on eve of Dec 4).</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-12-06 09:54:24</p>
<h3>Feather ESP32 remote wifi sensor (&quot;REV_B&quot;)</h3>
<p>All systems go!</p>
<p><img src="/img/co2/feather_esp32_data_test.png" alt=""></p>
<p><img src="/img/co2/feather_esp32_test.jpeg" alt=""></p>
<p>Feather ESP32 scd30 code for &quot;rev_b&quot; is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/wifi_sensor/feather_esp32_wifi_bayou_scd30_display">here</a></p>
<h3>Heltec ESP32 + LoRa remote wifi sensor (&quot;REV_C&quot;)</h3>
<p>SSD1306 with the u8x8 library tutorial <a href="https://tronixstuff.com/2019/08/29/ssd1306-arduino-tutorial/">here</a></p>
<p>List of u8x8 fonts <a href="https://github.com/olikraus/u8g2/wiki/fntlist8x8">here</a></p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/firmware/wifi_sensor/heltec_wifi_bayou_scd30_display_bmp388">Arduino code for heltec-based &quot;rev_c&quot; with bmp388 is here</a></p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/firmware/wifi_sensor/heltec_wifi_bayou_scd30_display">without bmp388 is here</a></p>
<p><img src="/img/co2/co2_rev_c.jpeg" alt=""></p>
<h3>Max4466 on ESP32</h3>
<p><a href="https://learn.adafruit.com/adafruit-microphone-amplifier-breakout/measuring-sound-levels">Adafruit tutorial</a> on Max4466</p>
<hr>
<p>2020-12-06 14:42:04</p>
<p>Fixed the microphone issue with the Feather ESP32 -- seems to be necessary to refer to A0 by its gpio number for feather esp32 -- i.e., &quot;26&quot; for A0.</p>
<p>Updated code for REV_B Feather ESP32 is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/wifi_sensor/feather_esp32_wifi_bayou_scd30_display">here</a></p>
<p>Posting data from REV_B with Feather esp32 ('wifi sensor' mode) <a href="http://159.65.226.222:3000/api/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74/csv">here</a>.</p>
<hr>
<p>2020-12-06 15:08:54</p>
<p>Parallel tests:</p>
<p>REV_C board (heltec) feed <a href="http://159.65.226.222:3000/drives/8b3f9d89866ac91fd748e2d89e8005f96e77e6cdeef10ffd033d74aeff1105ab">here</a></p>
<p>REV_B board (with Feather ESP32) feed <a href="http://159.65.226.222:3000/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74">here</a></p>
<hr>
<p>2020-12-06 19:05:45</p>
<p>Jupyter plotting csv file tutorial <a href="https://towardsdatascience.com/plotting-with-pandas-an-introduction-to-data-visualization-8bd7c0831650">here</a></p>
<p>Another nice guide <a href="https://www.geeksforgeeks.org/python-read-csv-using-pandas-read_csv/">here</a></p>
<p>plotting two data traces on the same graph:</p>
<pre><code>ax = df1.plot()
df2.plot(ax=ax)
</code></pre>
<hr>
<p>2020-12-06 20:02:10</p>
<h3><a name="compare_scd30"></a> Comparing two scd30 sensors</h3>
<p><strong>Procedure:</strong> Sensors were placed side-by-side.  No effort was made to calibrate manually.  They had been operating for only a few seconds before data was collected; so the automatic calibration algorithm (which begins at 7 days) had not been in operation.  Next attempt will involve manually calibrating both in same fresh air conditions, and looking at resulting behavior.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/co2/scd30_cross/compare_hardware.jpg" alt=""></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Using two SCD30 sensors, side-by-side.  Left: &quot;REV_C&quot; board using Heltec 32 Wifi LoRa v2 as micro. Right: &quot;REV_B&quot; board using Feather ESP32 as micro.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/scd30_cross/compare.png"><img src="/img/co2/scd30_cross/compare.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Comparison of two side-by-side SCD30 CO2 sensors for a given time range.  Jupyter notebook used in the analysis is <a href="/img/co2/scd30_cross/compare.ipynb">here</a>.</td>
</tr>
</tbody>
</table>
<p>Tweet about aerosol transmission <a href="https://twitter.com/kprather88/status/1335738927156588547?s=20">here</a>.</p>
<h2>Aerosol / virus researchers</h2>
<ul>
<li><a href="https://twitter.com/Don_Milton">Don Milton</a></li>
<li><a href="https://twitter.com/kprather88">Kimberly Prather</a></li>
<li><a href="https://twitter.com/drdavidmichaels">David Michaels</a>; <a href="https://twitter.com/jksmith34/status/1333297370872819715?s=20">on Maddow</a></li>
<li><a href="https://twitter.com/linseymarr">Linsay Marr</a></li>
<li><a href="https://twitter.com/florian_krammer">Florian Krammer</a></li>
<li><a href="https://twitter.com/MackayIM">Ian Mackay</a></li>
<li><a href="https://twitter.com/j_g_allen">Joseph Allen</a> -- 'Health Buildings'</li>
<li><a href="https://twitter.com/mlipsitch">Marc Lipstich</a></li>
</ul>
<h2>SCD30 Pressure Correction and Calibration Disable</h2>
<p>Sparkfun SCD30 library is <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library">here</a>, and has several relevant examples:</p>
<ul>
<li><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/examples/Example2_SetOptions/Example2_SetOptions.ino">Pressure correction</a></li>
<li><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/examples/Example4_DisableCalibrate/Example4_DisableCalibrate.ino">Disable autocalibration</a></li>
<li><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/examples/Example3_WireOptions/Example3_WireOptions.ino">Alternative i2c / Wire</a></li>
</ul>
<p><a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/master/documents/Sensirion_CO2_Sensors_SCD30_Preliminary-Datasheet.pdf">SCD30 datasheet</a></p>
<h3>Forced calibration of SCD30</h3>
<p>See 1.3.7 (p. 7) of document:</p>
<p><a href="https://cdn.sparkfun.com/assets/d/c/0/7/2/SCD30_Interface_Description.pdf">SCD30 interface description</a></p>
<p>For implementation, look at Sparkfun library and follow procedure for temperature / altitude compensation.</p>
<p>E.g. altitude compensation code begins <a href="https://github.com/sparkfun/SparkFun_SCD30_Arduino_Library/blob/0a6ca999ffcb725a9d528f98bc87881ac1688b35/src/SparkFun_SCD30_Arduino_Library.cpp#L139">here</a></p>
<pre><code>//Set the altitude compenstation. See 1.3.9.
bool SCD30::setAltitudeCompensation(uint16_t altitude)
{
  return sendCommand(COMMAND_SET_ALTITUDE_COMPENSATION, altitude);
}
</code></pre>
<p>Can we set this up with a button? Would be nice if it works mid-loop ... test with ESP32?</p>
<p>ESP32 GPIO interrupts guide <a href="https://lastminuteengineers.com/handling-esp32-gpio-interrupts-tutorial/">here</a></p>
<p>Fork of Sparkfun library <a href="https://github.com/edgecollective/SparkFun_SCD30_Arduino_Library">here</a></p>
<p>Experimental feed is <a href="http://159.65.226.222:3000/api/drives/5bd89f163a158797ab86668e67ac92736905c4056ec03600b8c37b0296da6763/csv">here</a></p>
<p>Update: the library already includes the functionality!</p>
<pre><code>setForcedRecalibrationFactor(int co2_concentration_ppm)
</code></pre>
<p>the 'calibrate' button on rev_c is pin 36</p>
<p>ESP32 debouncing a button w/ interrupts, <a href="https://www.switchdoc.com/2018/04/esp32-tutorial-debouncing-a-button-press-using-interrupts/">here</a></p>
<p>The <a href="https://github.com/craftmetrics/esp32-button">ultimate debouncer</a> from Hackaday</p>
<p><a href="http://community.heltec.cn/t/wifi-lora-32-v2-pinout-diagram-questions/1762">Heltec pinout discussion</a></p>
<p>Following debounce <a href="https://lastminuteengineers.com/handling-esp32-gpio-interrupts-tutorial/">here</a></p>
<hr>
<p>2020-12-06 21:37:07</p>
<p>Meanwhile, verify that the forced calibration works.  Expectation:  if we do it after a few loops, the current CO2 value will suddenly appear to be whatever we force it to be.</p>
<p>Force calibrate seems to work!</p>
<p><img src="/img/co2/force_calibrate.png" alt=""></p>
<p>Code (still working out a button debounce routine) <a href="">here</a></p>
<p>overnight feeds as of 2020-12-06 22:13:47:</p>
<p><a href="http://159.65.226.222:3000/api/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74/csv">feather esp32 feed</a></p>
<p><a href="http://159.65.226.222:3000/api/drives/5bd89f163a158797ab86668e67ac92736905c4056ec03600b8c37b0296da6763/csv">heltec (calibrated)</a></p>
<hr>
<p>2020-12-07 09:35:29</p>
<h2>Plan update</h2>
<ul>
<li>leaflet floormap</li>
</ul>
<hr>
<p>2020-12-07 10:23:27</p>
<p>Further reading on temperature / other compensation for the SCD30, <a href="https://www.mouser.com/pdfdocs/CD_AN_SCD30_Low_Power_Mode_D2.pdf">&quot;Low Power Mode for the SCD30&quot;</a></p>
<p>Observation: when force calibrating the sensor outdoors in much lower temperature and assuming 410 ppm, it recovered inside to &lt; 400 ppm.  This may be because of temperature effects. There is a temperature compensation function for the sensor.  It requires an external temperature reading for calibration.  This might be done with a 1-wire temp sensor attached to the device.</p>
<p>So, advantages of the pvos device:</p>
<ul>
<li>1-wire external temp sensor compensation (similar in setup to maxbotix)</li>
<li>external pressure sensor compensation</li>
<li>microphone data</li>
<li>i2c and other breakout pins for additional setup</li>
<li>wifi, bluetooth, lora configurations</li>
<li>open hardware design</li>
</ul>
<hr>
<p>2020-12-07 10:37:03</p>
<p>Blog on use of SCD30 <a href="https://blog.devmobile.co.nz/tag/scd30/">here</a></p>
<p>TODO: need to find field calibration guide for SCD30.</p>
<p><a href="https://wiki.seeedstudio.com/Grove-CO2_Temperature_Humidity_Sensor-SCD30/">SEEED wiki on SCD30</a></p>
<p><a href="https://files.seeedstudio.com/wiki/Grove-CO2-Temperature-Humidity-Sensor-SCD30/res/CD_AN_SCD30_Design-In_Guidelines_D2.pdf">SCD30 design-in guidelines</a></p>
<p><img src="/img/co2/scd30_protection_from_light.png" alt=""></p>
<p>I believe the airflow isolation issue is the reason for seeing such strong fluctuations of measurements when outdoors in wind, and is a strong argument for designing an enclosure:</p>
<p><img src="/img/co2/scd30_airflow_isolation.png" alt=""></p>
<p><img src="/img/co2/scd30_thermal_decoupling.png" alt=""></p>
<p><img src="/img/co2/scd30_coupling_ambient.png" alt=""></p>
<p><img src="/img/co2/scd30_auto_self_calibration.png" alt=""></p>
<hr>
<p>2020-12-07 11:53:18</p>
<p>Resurrecting the React code ...</p>
<p><img src="/img/co2/react_experiments.png" alt=""></p>
<p>React sparkines library <a href="https://www.google.com/search?q=react+sparklines&amp;oq=react+sparklines&amp;aqs=chrome.0.35i39j69i59j0l5j69i60.1939j0j7&amp;sourceid=chrome&amp;ie=UTF-8">here</a></p>
<p>How to trigger a popup in Leaflet, <a href="https://gis.stackexchange.com/questions/88273/triggering-click-event-on-leaflet-map">here</a></p>
<p><a href="https://react-leaflet.js.org/docs/example-external-state">React Leaflet documentation</a></p>
<p>Stack overflow for interacting with leaflet in React <a href="https://stackoverflow.com/questions/38730152/popup-always-open-in-the-marker">here</a> -- with associated <a href="https://jsfiddle.net/jrcoq72t/">fiddle</a></p>
<p><a href="https://formidable.com/open-source/victory/docs/victory-chart/">Victory Chart</a></p>
<p><a href="https://github.com/pswoodworth/poll-watcher/blob/master/pages/index.js">pswoodworth's code for poll / leaflet</a></p>
<p><a href="https://blog.logrocket.com/how-to-use-react-leaflet/">How to use React Leaflet</a></p>
<p><a href="https://stackoverflow.com/questions/13110763/is-leaflet-a-good-tool-for-non-map-images">Using Leaflet for non-map images</a></p>
<p><a href="https://build-failed.blogspot.com/2012/11/zoomable-image-with-leaflet.html">Nice tutorial on using leaflet to zoom into images</a> -- has some nice tiling programs!</p>
<p><a href="https://kempe.net/blog/2014/06/14/leaflet-pan-zoom-image.html">Using leaflet to pan and zoom a big image</a></p>
<ul>
<li>working gist <a href="https://gist.github.com/longhotsummer/ba9c96bb2abb304e4095ce00df17ae2f">here</a> -- nicely works (as 'start.html' in</li>
</ul>
<h2>first go at non-geographical imagery</h2>
<p>Based on: <a href="http://omarriott.com/aux/leaflet-js-non-geographical-imagery/">&quot;using leaflet with non-geographical imagery&quot;</a> tutorial.</p>
<p>Code in 'trial.html' <a href="https://github.com/edgecollective/sensor-webclient/blob/main/trial.html">here</a></p>
<p><img src="/img/co2/leaflet_crs.png" alt=""></p>
<p>leaflet map in a flexbox layout <a href="https://stackoverflow.com/questions/27240894/leaflet-map-in-a-flexbox-layout">here</a></p>
<p>See 'side.html' <a href="https://github.com/edgecollective/sensor-webclient/blob/main/side.html">here</a>:</p>
<p><img src="/img/co2/leaf_floor.png" alt=""></p>
<p>Leaflet guide to non-geographic maps <a href="https://leafletjs.com/examples/crs-simple/crs-simple.html">here</a></p>
<p>Using CRS in React-Leaflet <a href="https://stackoverflow.com/questions/48185208/set-react-leaflet-map-crs-atribute">here</a></p>
<p>Example with imageoverlay and react-leaflet <a href="https://codesandbox.io/s/react-leaflet-with-functional-components-and-imageoverlay-u225j?file=/src/Map.js">here</a></p>
<p>Note: &quot;reg-leaf&quot; branch of spark-leaf repo is a working example.</p>
<p>Jamming on inserting code from <a href="https://codesandbox.io/s/react-leaflet-with-functional-components-and-imageoverlay-forked-n57cu?file=/src/Map.js">here</a> into my current setup</p>
<p>hmm, this approach seems simple <a href="https://stackoverflow.com/questions/48185208/set-react-leaflet-map-crs-atribute">here</a></p>
<p>support for non-geographical maps <a href="https://github.com/PaulLeCam/react-leaflet/issues/311">here</a></p>
<hr>
<p>2020-12-07 21:23:59</p>
<p>'clicknav' is a working branch.</p>
<p>fetching data in react using hooks <a href="https://blog.bitsrc.io/fetching-data-in-react-using-hooks-c6fdd71cb24a">here</a></p>
<p>another article <a href="https://dev.to/nicomartin/the-right-way-to-fetch-data-with-react-hooks-48gc">here</a></p>
<p>much nicer guide <a href="https://www.pluralsight.com/guides/fetching-data-updating-state-hooks">here</a></p>
<p>working with 'livedata' branch of spark-map currently ...</p>
<p>using react and fetch <a href="https://reactjs.org/docs/faq-ajax.html">here</a></p>
<hr>
<p>2020-12-08 10:58:47</p>
<h3>interactive viz of data on map</h3>
<p>nice leaflet grid layer code for displaying lat / long <a href="https://gist.github.com/letmaik/e71eae5b3ae9e09f8aeb288c3b95230b">here</a></p>
<p>Nice leaflet grid layer <a href="http://bl.ocks.org/letmaik/e71eae5b3ae9e09f8aeb288c3b95230b">here</a></p>
<hr>
<p>2020-12-08 12:39:52</p>
<p>running p2p-farm-server locally, branch: 'mappin'</p>
<p>http://localhost:3050/drives/94dc05a75bc3ac9b064cbe1c2ae3264e96ca753ff05aef28303d1c5b752a1f4b/console</p>
<p>reference putscript_local.sh for the appropriate keys and to add more data</p>
<p><img src="/img/co2/co2_console.png" alt=""></p>
<p>SVG sparklines <a href="https://github.com/fnando/sparkline">here</a></p>
<p>keeping popups open in leaflet <a href="https://stackoverflow.com/questions/9047931/leaflet-js-open-all-popup-bubbles-on-page-load">here</a></p>
<p>intro to leaflet <a href="https://leafletjs.com/examples/quick-start/">here</a></p>
<p>add and remove leaflet circle on click <a href="https://gist.github.com/mollietaylor/8564724">here</a></p>
<p>assigning ids to markers in leaflet <a href="https://stackoverflow.com/questions/25683871/assign-id-to-marker-in-leaflet">here</a></p>
<p>adding horizontal lines in chartjs <a href="https://riptutorial.com/chart-js/example/22333/draw-horizonal-lines">here</a></p>
<p><img src="/img/co2/console_demo.png" alt=""></p>
<p>above is 'mappin' branch of p2p-farm-server on gitlab</p>
<hr>
<p>2020-12-09 17:39:11</p>
<p>modfiying leaflet icon on mouseover <a href="https://gis.stackexchange.com/questions/267400/highlight-l-divicon-on-mouseover-or-programmatically-in-leaflet-map">here</a></p>
<h3>leaflet icon resize</h3>
<p>nice working example of buttons and overlap and highlighting <a href="https://github.com/edgecollective/leaflet-highlight">here</a>.</p>
<h3>references for covid 19</h3>
<p>https://www.providencejournal.com/story/news/coronavirus/2020/08/14/umass-professor-expands-on-risks-of-covid-19-and-how-to-avoid-them-in-schools/113968580/</p>
<p>https://twitter.com/ErinBromage</p>
<p>https://twitter.com/ErinBromage/status/1336769111922241539</p>
<p>great writings collected here: https://twitter.com/JuliaLMarcus</p>
<p>battery-powered datalogging, for use on e.g. planes?
export to csv ...</p>
<hr>
<p>2020-12-10 11:08:32</p>
<h2>Curated Twitter list of air quality / covid / science</h2>
<p>Link <a href="https://twitter.com/i/lists/1337064747762642947">here</a></p>
<p>Key organizing tweet by Jose-Luis Jimenez, <a href="https://twitter.com/jljcolorado/status/1335025183493599232?s=20">here</a> and <a href="https://twitter.com/jljcolorado/status/1337066415694733320?s=20">here</a>.  Jimenez group <a href="http://cires1.colorado.edu/jimenez/">here</a>.</p>
<p>Jimenez group listing <a href="http://cires1.colorado.edu/jimenez-group/">here</a></p>
<p>Aranet4 listing <a href="https://www.amazon.com/Aranet4-Home-Temperature-Ink-Configuration/dp/B07YY7BH2W">here</a></p>
<p>Article covering Jimenez int'l org around air quality and covid <a href="https://drive.google.com/file/d/1rBToRlgQfRoEPuY1WHhlwmIhcl5WrTye/view?usp=sharing">here</a></p>
<p>Online presentation <a href="https://www.aireamos.org/presentacion-online-de-la-nueva-plataforma-aireamos/">here</a></p>
<hr>
<p>2020-12-10 13:42:11</p>
<p>note on next steps:</p>
<ul>
<li>see how the two scd30s compare after force calibration procedure, side-by-side (don't need to be calibrated outdoors, just cross-comparison)</li>
<li>make sure can force calibrate the k30 and z19 and then do cross-comparison -- if they work comparably, can be lower-cost option</li>
<li>end-to-end demo of tech, including floorplan viz</li>
<li>(storage to microSD? easy next step)</li>
<li>kit assembly instructions for heltec version and for feather version</li>
<li>make a video explaining the project and the status</li>
<li>show Jupyter and R workflows</li>
</ul>
<hr>
<p>2020-12-10 17:44:16</p>
<h2>SCD30 Cross-comparison with force calibration</h2>
<ul>
<li>Heltec + REV_C using <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_c/firmware/wifi_sensor/heltec_wifi_bayou_scd30_display_bmp388_calibrate">this code</a> posting to <a href="http://159.65.226.222:3000/api/drives/5bd89f163a158797ab86668e67ac92736905c4056ec03600b8c37b0296da6763/csv">this feed</a></li>
<li>Feather ESP32 + REV_B using <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_b/firmware/wifi_sensor/feather_esp32_wifi_bayou_scd30_display_calibrate">this code</a> posting to <a href="http://159.65.226.222:3000/api/drives/516d21cb12f7e724be7c3d1ea66b7113316fb9f4018d2a9345bacf4b05f00c74/csv">this feed</a></li>
</ul>
<p>Note on experimental setup.  Code is set up to broadcast every 90 seconds; on third round, it force calibrates to 410 ppm; there is a parameter named 'forced' that is '0' initially and then '1' after forced calibration. Both devices were reset simultaneously, hopefully they will be relatively in sync when force calibrated.  need to check difference.</p>
<p>Update: no, better to force calibrate in beginning.  Send value right after force calibration, then reset to 0.</p>
<hr>
<p>2020-12-10 20:21:52</p>
<ul>
<li>not sure that the force calibrate functions were simultaneous, might need to run again ...</li>
<li>but as a one-off the data looks spot-on right now ...</li>
</ul>
<hr>
<p>2020-12-10 22:03:01</p>
<ul>
<li>the data was spot on because the devices were force calibrating every cycle :) so they were always at around 410 ppm.</li>
<li>edited code so that it would force calibrate only once, about 2 minutes into cycle of measuring every 30 sec.  Data is here:</li>
</ul>
<p><img src="/img/co2/co_test.png" alt=""></p>
<p>Note that the orange line is the FeatherESP2, and tracking the 'forced' parameter indicates that the device rebooted and then re-force calibrated to 410 ppm.  Not sure why it rebooted -- perhaps the power supply on the Feather is insufficient to handle the SCD30, or the memory?  Note that the readings were more variable for the Feather prior to the reboot.</p>
<p><img src="/img/co2/co_test_color.png" alt=""></p>
<hr>
<p>2020-12-10 22:12:26</p>
<p>Added legend, and the 'forced' parameter, to make it all more explicit. Here, the red line is the Feather32 data, the blue is the Heltec. The accompanying 'forced' data are shown, multiplied and shifted to show on scale.</p>
<p>New experiment:  restart code, but swap the SCD30 modules.</p>
<hr>
<p>2020-12-10 22:18:31</p>
<p>Update:  swapped the scd30.  heltec didn't start up at first. realized that i placed the scd30, was shorting something.  so there may be some odd data out of the heltec now.  if there was something wrong with the scd30 module associated with the feather, it's on the heltec now.</p>
<ul>
<li>Last 'forced' dip before '53000' is beginning of above run.</li>
<li>'forced' event in green (feather32) only at '55000', feather32 seemed to reset and then 'force' to 410 (as firmware demands on reset)</li>
<li>powered off, swapped scd30s, maybe shorted the one that was originally on the feather by plugging it in improperly to heltec.  result is at '56500', shows forced status.  but devices somehow immediately end up 30+ppm apart. So at a little after 57000, did another reset (devices had been powered on).</li>
<li>now they definitely do hit the same 410 mark, but diverge. could be oddness in enclosure setup -- one is closer to inlet.</li>
<li>going to readjust and then reset again.</li>
<li>readjusted box, performed another collective reset now at approx 1607657789</li>
</ul>
<p>Note -- if this immediate divergence is 'real', it could indicate that small variations in air flow are very important / and/or that one oughtn't to worry about fluctuations on order of approx 50 ppm.</p>
<p>Reasons it might not be 'real' -- one of the sensors is underpowered b/c of a different micro ... the scd30 sampling rate is too high, or we're force calibrating too soon ... others?</p>
<hr>
<p>2020-12-10 22:45:58</p>
<p><img src="/img/co2/co_test_color_2.png" alt=""></p>
<p>Ah -- after careful readjustment inside enclosure, looks like they did coincide more closely (or could be fluke) on restart (last restart / force calibration before the '80000' mark.) Will now monitor to see whether one of the devices exhibits odd behavior.</p>
<p>Now that I've switched scd30 modules ... if the data from the Feather32 still exhibits odd behavior, then my guess would be that the problem is the power supply / memory of the Feather32.  If the data from the heltec exhibits odd behavior, then the problem may lie with that particular scd30 module.</p>
<hr>
<p>2020-12-10 22:53:13</p>
<p><img src="/img/co2/co_test_color_3.png" alt=""></p>
<p>Last two resets are after readjusted enclosure.</p>
<hr>
<p>2020-12-11 06:14:27</p>
<p>Results from overnight, after initial force calibration on both sensors (as per above description):
<img src="/img/co2/co_test_color_4.png" alt=""></p>
<p>Systematic difference (red climbs faster) is perhaps due to placement in box / closer to airflow opening.</p>
<p>Plot of difference between the two traces above:
<img src="/img/co2/co_test_color_diff.png" alt=""></p>
<h3>SCD30 Field Calibration Guide</h3>
<p>SCD30 Field Calibration Guide <a href="/img/co2/CD_AN_SCD30_Field_Calibration_D2.pdf">here</a></p>
<p>Effects of forced recalibration (from guide):</p>
<p><img src="/img/co2/frc_field_calibration.png" alt=""></p>
<p>Effects of automatic calibration (from guide):</p>
<p><img src="/img/co2/asc_algorithm.png" alt=""></p>
<hr>
<p>2020-12-11 08:03:52</p>
<p>Updated scd30 comparison:</p>
<p><img src="/img/co2/co_test_color_5.png" alt=""></p>
<p>Differences:</p>
<p><img src="/img/co2/co2_differences.png" alt=""></p>
<hr>
<p>2020-12-11 09:25:16</p>
<p><img src="/img/co2/co_test_color_6.png" alt=""></p>
<p><img src="/img/co2/co2_differences_6.png" alt=""></p>
<h3>Jupyter Lab setup</h3>
<p>Notebook for above analysis is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/master/analysis/cross_compare.ipynb">here</a></p>
<p><img src="/img/co2/jupyter.png" alt=""></p>
<hr>
<p>2020-12-11 13:54:30</p>
<p><img src="/img/co2/co_test_color_7.png" alt=""></p>
<p><img src="/img/co2/co2_differences_7.png" alt=""></p>
<hr>
<p>2020-12-11 22:33:39</p>
<h3>Revisiting the 'map' interface code</h3>
<p>p2p-farm-server/public/console.html is the latest code connected to the p2p-farm-server, which does floorplan side by side with the charts.</p>
<p>the route to visit is <a href="http://0.0.0.0:3050/drives/94dc05a75bc3ac9b064cbe1c2ae3264e96ca753ff05aef28303d1c5b752a1f4b/console">here</a>.</p>
<p>It's determined in p2p-farm-server/routes/index.js</p>
<p>meanwhile, the code that connects buttons and highlights leaflet markers is <a href="https://github.com/edgecollective/leaflet-highlight">here</a>.</p>
<hr>
<p>2020-12-12 10:50:11</p>
<h2>console update</h2>
<p>Video of attempt at interactive code <a href="https://youtu.be/otHVABif8Rs">here</a>, and below:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/otHVABif8Rs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Relevant code is in 'console.html', <a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html">here</a>; the routes portion of the server that handles that page is index.js, <a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/routes/index.js">here</a>.</p>
<p>Note: was able to resolve CORS errors when prototyping locally by simply referencing the '0.0.0.0' address rather than 'localhost'.</p>
<p>Inspirational map flood network viz <a href="https://flood.network/">here</a> (link to actual viz seems to be broken).</p>
<hr>
<p>2020-12-12 14:04:25</p>
<h2>Revisiting mic</h2>
<p>Adafruit max4466 is <a href="https://www.adafruit.com/product/1063">here</a>.</p>
<ul>
<li>Pinout from 'left to right' when mic is facing viewer and is oriented at 'bottom' is:  VCC GND OUT</li>
</ul>
<p>Typical Amazon cheaper product is <a href="https://www.amazon.com/HiLetgo-Electret-Microphone-Amplifier-Adjustable/dp/B07DRGF8C2/ref=pd_lpo_147_t_0/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07DRGF8C2&amp;pd_rd_r=dc81b1e9-e296-4ec2-8eee-8f102542b805&amp;pd_rd_w=Octxo&amp;pd_rd_wg=EnXDs&amp;pf_rd_p=7b36d496-f366-4631-94d3-61b87b52511b&amp;pf_rd_r=BYWGQV117YHEYJBE8WNE&amp;psc=1&amp;refRID=BYWGQV117YHEYJBE8WNE">here</a></p>
<ul>
<li>Pinout from 'left to right' when mic is facing viewer and is oriented at 'bottom' is also:  VCC GND OUT</li>
</ul>
<p><img src="/img/co2/adafruit_electret_dim.png" alt=""></p>
<p>Dimensions of board seem to be about (width x height) (15 mm x 22 mm).</p>
<h2>qwiic connector, right angle</h2>
<ul>
<li>listed on adafruit <a href="https://www.adafruit.com/product/4208">here</a>. &quot;JST SH 4-pin&quot; -- 'micro' / 'right angle' version.</li>
</ul>
<p><img src="/img/co2/jst_sh_4_right.png" alt=""></p>
<h2>qwiic connector, vertical</h2>
<p>listed on adafruit <a href="https://www.adafruit.com/product/4328">here</a>. &quot;JST SH 4-pin&quot; -- 'micro' / 'vertical' version.</p>
<p><img src="/img/co2/jst_sh_4_vertical.png" alt=""></p>
<h2>tactile switch side / horizontal</h2>
<p>amazon listing <a href="https://www.amazon.com/uxcell-Momentary-Pushbutton-Terminals-6mmx6mmx12mm/dp/B07JKWC6LH/ref=sr_1_18?dchild=1&amp;keywords=tactile+switch+push&amp;qid=1607805967&amp;s=automotive&amp;sr=1-18">here</a></p>
<p><img src="/img/co2/tactile_side.png" alt=""></p>
<p>For now: break out A0 and A1 pins to do the button measurement separately on a breakout if need be (to externalize the control, avoid interacting with scd30).</p>
<p>Aside: nice <a href="https://github.com/ppelleti/NeoBit">neobit project</a></p>
<h2>battery for heltec</h2>
<p>micro li-ion board on Amazon <a href="https://www.amazon.com/MakerFocus-Rechargable-Protection-Insulated-Development/dp/B07CXNQ3ZR/ref=pd_bxgy_img_2/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B07CXNQ3ZR&amp;pd_rd_r=6e7cfcdc-c293-4378-aa63-5c7473b5b896&amp;pd_rd_w=45JGk&amp;pd_rd_wg=s7u5J&amp;pf_rd_p=f325d01c-4658-4593-be83-3e12ca663f0e&amp;pf_rd_r=YHBZ9KHHR1X6CY0GS3E2&amp;psc=1&amp;refRID=YHBZ9KHHR1X6CY0GS3E2">here</a> -- 'jst 1.25 connector 2 pin'</p>
<p>Size: 8.5<em>25</em>40（mm）</p>
<hr>
<p>2020-12-13 09:55:51</p>
<h2>buttons</h2>
<p>mini pushbutton switch -- tall <a href="https://www.sparkfun.com/products/8605">via sparkfun</a></p>
<p>10 mm tall.</p>
<p>How tall is a typical header?</p>
<p>Assortment of pushbuttons <a href="https://www.amazon.com/DaFuRui-250pcs-Tactile-Momentary-Assortment/dp/B07KGR7L9M/ref=asc_df_B07KGR7L9M/?tag=hyprod-20&amp;linkCode=df0&amp;hvadid=312112220877&amp;hvpos=&amp;hvnetw=g&amp;hvrand=4606913672532958917&amp;hvpone=&amp;hvptwo=&amp;hvqmt=&amp;hvdev=c&amp;hvdvcmdl=&amp;hvlocint=&amp;hvlocphy=9058138&amp;hvtargid=pla-614560844137&amp;psc=1">here</a></p>
<p>Omron B3F datasheet <a href="https://4donline.ihs.com/images/VipMasterIC/IC/OMRN/OMRN-S-A0001309768/OMRN-S-A0001309768-1.pdf?hkey=52A5661711E402568146F3353EA87419">here</a></p>
<p><img src="/img/co2/tactile_side_connectivity.png" alt=""></p>
<p>need to swap out 'dual' switch for a single ..</p>
<p><img src="/img/co2/in_progress.png" alt=""></p>
<h2>Guide for qwiic connectors</h2>
<p>Discussion <a href="https://forum.kicad.info/t/hand-soldering-jst-sh-connector/12894">here</a></p>
<pre><code>Connectors_JST:JST_SH_SM04B-SRSS-TB_04x1.00mm_Angled
</code></pre>
<p>Redo for easier hand soldering?</p>
<p><img src="/img/co2/rev_e.png" alt=""></p>
<p><img src="/img/co2/rev_e_3d.png" alt=""></p>
<p><img src="/img/co2/qwiic_pinout.png" alt=""></p>
<p><a href="https://learn.sparkfun.com/tutorials/qwiic-adapter-hookup-guide/all">Qwiic adapter hookup guide</a></p>
<p><img src="/img/co2/qwiic_pin_assignment.png" alt=""></p>
<hr>
<p>2020-12-14 13:27:09</p>
<h2>enclosure options</h2>
<p><a href="https://www.amazon.com/LeMotech-Junction-Dustproof-Weatherproof-Electrical/dp/B07G58SLB1?th=1">link to smaller enclosure</a></p>
<p><img src="/img/co2/smaller_enclosure_co2.png" alt=""></p>
<p>Datasheet for smaller enclosure is <a href="https://images-na.ssl-images-amazon.com/images/I/61P4XQPyJyL.pdf">here</a></p>
<hr>
<p>2020-12-14 21:52:32</p>
<h2>PCB ordering for REV_E</h2>
<p>Github repo for REV_E is <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_e/">here</a></p>
<p><img src="/img/co2/rev_3_3d_render.png" alt=""></p>
<p><img src="/img/co2/rev_e_jlcpcb_render.png" alt=""></p>
<p>Zipped Gerber files for REV_E are <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/master/rev_e/atkins/co2_rev_e_gerber.zip">here</a></p>
<h2>Next steps</h2>
<ul>
<li><strong>TOP PRIORITY</strong>: wifi manager setup for heltec gateway</li>
<li>Attempt force calibration comparison, Z19 / K30 with SCD30</li>
<li>Online structure for viewing multiple feeds</li>
<li>Things Network demo code (using RPi) w/ Heltec</li>
<li>Feather board setup -- enable Things Network by connection i01</li>
</ul>
<hr>
<p>2020-12-19 08:07:40</p>
<h2>Enclosures</h2>
<p><img src="/img/co2/lemotech_a.png" alt=""></p>
<p><img src="/img/co2/lemotech_b.png" alt=""></p>
<p><img src="/img/co2/lemotech_c.png" alt=""></p>
<hr>
<h2>Qwiic</h2>
<p>JST SH 4 pin micro -- vertical, <a href="https://www.amazon.com/Micro-4-Pin-Connector-100mm-Female/dp/B01L5PSHDA/ref=sr_1_12?crid=J2RDX2QAWXZY&amp;dchild=1&amp;keywords=jst-sh+1.0mm&amp;qid=1608386735&amp;sprefix=jst-sh%2Caps%2C371&amp;sr=8-12">here</a></p>
<p>horizontal (as placed on rev_e) <a href="https://www.adafruit.com/product/4208">here</a></p>
<p>or as listed on sparkfun (horizontal) <a href="https://www.sparkfun.com/products/14417">here</a></p>
<hr>
<p>2020-12-19 13:18:40</p>
<h2>uFL connector</h2>
<p>adafruit uFL connector <a href="https://www.adafruit.com/product/1661">here</a></p>
<p>looking at feather m0 lora pcb for uFL connector reference <a href="https://github.com/adafruit/Adafruit-Feather-M0-RFM-LoRa-PCB.git">here</a></p>
<p><img src="/img/co2/feather_m0_antenna.png" alt=""></p>
<h2>BMP3XX</h2>
<p>BMP3XX adafruit firmware on github <a href="https://github.com/adafruit/Adafruit_BMP3XX">here</a></p>
<p>BMP3XX adafruit hardware design files on github <a href="https://github.com/adafruit/Adafruit-BMP3xx-PCB">here</a></p>
<h2>BMP390</h2>
<p>BMP390 datasheet <a href="/img/co2/bst-bmp390-fl000.pdf">here</a></p>
<p>Adafruit BMP390 schematic:</p>
<p><img src="/img/co2/sensors_BMP390_sch.png" alt=""></p>
<h2>BMP388</h2>
<p>BMP388 datasheet <a href="https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BMP388-DS001.pdf">here</a></p>
<p>Adafruit BMP388 schematic:</p>
<p><img src="/img/co2/sensors_BMP388_Sch.png" alt=""></p>
<p>Question: do we need to add a power supply to board? Seems to be a common way of keeping the power supply clean for the pressure sensor chip.</p>
<p>Reference: <a href="https://community.bosch-sensortec.com/t5/MEMS-sensors-forum/BMP388-PCBs/td-p/16815">here</a></p>
<p><img src="/img/co2/bmp388_regulator.png" alt=""></p>
<p>Looks like we should add a regulator. Default to using the Adafruit part, change if something else seems better.</p>
<p>Adafruit uses AP2112K-3.3 for the BMP390 breakout (more recent breakout). This also seems to be used for the feather.</p>
<p>Look to see if it's also used for the Feather ESP32 -- and what its specs are -- if it can source sufficient current for the full CO2 board (which are ...?)</p>
<p>Q:</p>
<ul>
<li>what LDO is used on the Feather ESP32?</li>
<li>what are the current req's for this board?</li>
<li>footprint to use for AP2112K?  (SOT-23-5 assumed)</li>
</ul>
<h2>LDO</h2>
<p>AP2112K-3.3 on <a href="https://www.digikey.com/en/products/detail/diodes-incorporated/AP2112K-3-3TRG1/4470746">Digikey</a> and associated <a href="https://www.diodes.com/assets/Datasheets/AP2112.pdf">datasheet</a></p>
<p>Looks like it can provide 600 mA.</p>
<p>max input 6V</p>
<p>Assume SOT-23-5 package on Adafruit</p>
<p><img src="/img/co2/feather_m0_power.png" alt=""></p>
<h2>Battery charger</h2>
<p>Also add MCP73831.</p>
<p>Feather M0 MCP7831:</p>
<p><img src="/img/co2/feather_m0_mcp7831.png" alt=""></p>
<h2>FTDI</h2>
<p>Do FTDI board separately? yes b/c DTR might be needed</p>
<p><img src="/img/co2/ftdi_plus.png" alt=""></p>
<h2>Reset and GPIO0</h2>
<p>TODO: Need also to break out the reset and other button, in case ftdi cable someone uses doesn't expose dtr ...</p>
<p>Buttons -- use SW_Push symbol ... with which SMT buttons? use adafruits?</p>
<p>these are the KMR2 buttons from the Feather and etc.  datasheet is <a href="https://www.ckswitches.com/media/1479/kmr2.pdf">here</a></p>
<p>look to see how adafruit did it with the huzzah board</p>
<p><img src="/img/co2/huzzah_breakout.png" alt=""></p>
<p>Ah, there we go -- GPIO0 is floating:</p>
<p><img src="/img/co2/huzzah_pin_schem.png" alt=""></p>
<h2>Calibrate / other buttons</h2>
<p>TODO: add the side-mounted through-hole buttons that ordered on Amazon, and that were present on REV_E</p>
<p><img src="/img/co2/buttons_rev_e.png" alt=""></p>
<h2>JST connectors</h2>
<p>Add connectors for micro and reg lithium ion?  Might be nice for folks used the world of feathers.</p>
<p>Using standard Adafruit one (2-pin JST PH)</p>
<p>as well as a micro one -- JST SH -- SM02B-SRSS-TB(LF)(SN) -- digikey link <a href="https://www.digikey.com/en/products/detail/jst-sales-america-inc/SM02B-SRSS-TB-LF-SN/926708">here</a></p>
<p><img src="/img/co2/jst_sh_2_horizontal.png" alt=""></p>
<h2>microUSB</h2>
<p>this would simplify things.</p>
<p>Q: Possible to solder? Look at Feather ESP32 schematic / footprint.</p>
<p>Maybe this is a separate project -- make an ftdi header board.</p>
<p>Need to decide on nice microUSB footprint. SMT would be nice, and fine for this context -- don't need through-hole. feather esp32 part should be fine. see if you can source them on digikey (or which smt parts are easy to source).</p>
<p>Adafruit microUSB part is the 4UConn 20329 v2, datasheet <a href="https://cdn-shop.adafruit.com/datasheets/1833_MicroB_20329.pdf">here</a></p>
<p>Link to Adafruit microUSB part <a href="https://www.adafruit.com/product/4023?gclid=Cj0KCQiA5vb-BRCRARIsAJBKc6IKvJSYo8HQ0puhsz5kJ9BQRWiMQ9BnAQePovzEpwGElwPXCAUFrhMaAl0VEALw_wcB">here</a></p>
<p>MicroUSB B with KiCad footprints:</p>
<ul>
<li>105017-0001 on digikey <a href="https://www.digikey.com/en/products/detail/molex/1050170001/2350832">here</a></li>
</ul>
<p>the microUSB device used on the riffle is <a href="https://www.digikey.com/en/products/detail/10104111-0001LF/609-4053-1-ND/2350359">here</a>; datasheet is <a href="https://cdn.amphenol-icc.com/media/wysiwyg/files/documentation/datasheet/inputoutput/io_usb_micro.pdf?__cf_chl_jschl_tk__=c05332b2f0e5b1a38d92708593c5ac3845744461-1608419698-0-ASmLq4QwyzKwGjwO6fdYVigeQ4gjdIX1gZ19ZX1NFBYK5yl0GJQcm1GwAE49yV3B46VJCLx2ZmTwBpWX84x49qPez9a0y5TxePaTPoF9bSIll5gLVEm1KTxXQ3kqQACaxgFW2nphPpOQcES3grOkdJYnxamcMMU7Lt-avOTf-no-QN4kinudAT-iKUxfIYQ40YgmVqNmlEo8KvScG_EaRo2kvadOApWRskv2XRxP_u5PhOz91YzkSa5flpq-PdCqmW0xeskIesEpQssduR1RFk26INRnvE5A39wt3CdFUvG4DYYrYAY-69sdn2puRzdnh346jUmxsGoCcGEnsaRzKZRVBgwYtBTPF2FJtC_ZlKW1cwqEgAPH0W-lPe0l4bZuKawRx4_ZO_QGBgK0SfsjGnnhmZOEOtS47U_3VH-CF6USoGkij080JGCsPQMSHCbWGiA0jl5NNzziUgrNat0vrnE">here</a></p>
<p><img src="/img/co2/amphenol_diffs.png" alt=""></p>
<p>above left: 10104110; above right: 10104111</p>
<p>some optoins for footprints in kicad:</p>
<ul>
<li>Molex 105017-0001 -- <a href="https://www.digikey.com/en/products/detail/molex/1050170001/2350885">digikey</a>; <a href="https://www.molex.com/pdm_docs/sd/1050170001_sd.pdf">datasheet</a></li>
<li>Molex 105133-0001</li>
<li>Molex 105133-0031</li>
<li>Molex 47346-0001</li>
</ul>
<p>A recommended Amphenol part is <a href="https://www.digikey.com/en/products/detail/amphenol-icc-fci/10118194-0001LF/2785389">here</a></p>
<h2>Filtering / decoupling</h2>
<p>TODO Need to add caps from all relevant sub-circuits:</p>
<ul>
<li>subcircuit (reference schem)</li>
<li>ESP32 (feather esp2)</li>
<li>RFM95 (feather M0)</li>
<li>MCP7381 (feather M0)</li>
<li>BMP388 (adafruit BMP388 breakout)</li>
<li>power (feather esp32 / m0)</li>
</ul>
<p>Possible to add footprint for USB chip <em>and</em> allow FTDI?</p>
<p>Adafruit Feather ESP32 eagle files <a href="https://github.com/adafruit/Adafruit-HUZZAH32-ESP32-Feather-PCB">on github</a></p>
<p>Feather ESP32 schematic:</p>
<p><img src="/img/co2/huzzah32_feather_schem.png" alt=""></p>
<p>CP2104 subcircuit:</p>
<p><img src="/img/co2/cp2104_schem.png" alt=""></p>
<h2>microSD</h2>
<p>the microSD card used on the Riffle 0.1.8 is <a href="https://www.digikey.com/en/products/detail/DM3D-SF/HR1941CT-ND/1786515">here</a></p>
<hr>
<p>2020-12-19 19:00:53</p>
<p>TODO: double check pin order on JST connectors ...</p>
<p><img src="/img/co2/jst_pin_order.png" alt=""></p>
<p>DMG3415U p-mosfet used in power circuit for Feather ESP32 <a href="https://www.digikey.com/en/products/detail/diodes-incorporated/DMG3415U-7/2052768">here</a>; <a href="https://media.digikey.com/pdf/Data%20Sheets/Diodes%20PDFs/DMG3415U.pdf">datasheet</a>; SOT23;</p>
<p><img src="/img/co2/dmg3415u_data.png" alt=""></p>
<p>to check orientation / pin assign for the pmos as part of the power circuit, here's what we see on the feather esp32:</p>
<p><img src="/img/co2/q3_feather_pmos.png" alt=""></p>
<p><img src="/img/co2/heltec_wifi_lora_v2_pintout.png" alt=""></p>
<p>Diode -- MBR120 -- SOD-123FL -- <a href="https://www.digikey.com/en/products/detail/on-semiconductor/MBR120VLSFT1G/893861">datasheet</a></p>
<p>Note: used KiCAD 123F rather than 123FL</p>
<p>now I have all of them avail.  seems like sod 123FL is the most pop part on digikey.  but 123 and 123FL are avail. see <a href="https://www.digikey.com/en/products/base-product/on-semiconductor/488/MBR120/31292">here</a></p>
<hr>
<p>2020-12-19 20:37:04</p>
<p>latest updates to board design (&quot;REV_D&quot;) are <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/master/rev_d/atkins">here</a></p>
<p>note: need to review and see if there are any remaining changes.</p>
<p>might try to place a microSD on the board and guess at a CS pin; but also break out SPI + optional CS pins. If SPI conflict, might be able to start by only doing LoRa (SPI) OR microSD (SPI) on bus in any given firmware.</p>
<p>TODO:</p>
<ul>
<li>look into adding a mic, or a header for one</li>
<li>add extension header</li>
<li>add qwiic connector</li>
<li>re-measure and redo the oled &amp; scd30 outlines, to ensure enough space</li>
</ul>
<p><img src="/img/co2/rev_d_3drender_dec_19.png" alt=""></p>
<p><img src="/img/co2/board_rev_d_process.png" alt=""></p>
<p>if add a smt mic, add a switch
otherwise: maybe just make it an optional DIP add-on ...</p>
<hr>
<p>2020-12-20 08:21:38</p>
<p>rather than replicate the mosfet on the power supply, maybe just have one at the intake?</p>
<p>alright -- emulate feather 32 instead of heltec. we know that the circuit works, and it's the same esp32 module, with same pins avail.</p>
<p>iterate to fancier version of batt meas circuit.</p>
<p>check against tinypico for power circuit</p>
<p>nice reference for esp32 pinouts and which pins to use <a href="https://randomnerdtutorials.com/esp32-pinout-reference-gpios/">here</a></p>
<p>default spi pins on esp32 for lora <a href="https://randomnerdtutorials.com/esp32-lora-rfm95-transceiver-arduino-ide/">here</a></p>
<p><img src="/img/co2/esp32_lora_random_nerd.png" alt=""></p>
<p>Hog 32 schematic:</p>
<p><img src="/img/co2/hog32_schem.png" alt=""></p>
<p>using the arduino ide + esp32 + sd card <a href="http://www.iotsharing.com/2017/05/how-to-use-arduino-esp32-to-store-data-to-sdcard.html">here</a></p>
<p>update: heltec uses gpio5 for lora sck; feather esp32 uses gpio5 for sck; so that's fine.
default to using feather esp32 pinouts.</p>
<p>pins 34,35,36,39 are input only.  use these on buttons.</p>
<p>ref for using sd card featherwing with feather esp32 <a href="https://learn.adafruit.com/adafruit-adalogger-featherwing/using-the-sd-card">here</a> -- cs is on gpio33</p>
<h2>BMP388 wiring / connections</h2>
<p>nice reference <a href="https://learn.adafruit.com/adafruit-bmp388-bmp390-bmp3xx/arduino">here</a></p>
<h2>Qwiic pin arrangement</h2>
<p><img src="/img/co2/qwiic_arrangement.png" alt=""></p>
<h2>Adalogger featherwing pin arrangement</h2>
<p>(mimic in rev_d)</p>
<p><img src="/img/co2/adalogger_featherwing.png" alt=""></p>
<h2>Advice regarding microusb ground</h2>
<p>Reference <a href="https://electronics.stackexchange.com/questions/4515/how-to-connect-usb-connector-shield">here</a></p>
<h2>SOD123 oddness?</h2>
<p>TODO: Look into changing footprint ...</p>
<h2>Pad sizes</h2>
<p><img src="/img/co2/pin_sizes.png" alt=""></p>
<hr>
<p>2020-12-22 09:41:59</p>
<p>for low power tests -- look up tinypico schematic</p>
<p>schematic <a href="https://cromwell-intl.com/open-source/raspberry-pi/sdr-getting-started.html">here</a></p>
<p>and in our own repo <a href="/img/co2/TinyPICO_Schematic.pdf">here</a></p>
<p>key part is the power subcircuit:</p>
<p><img src="/img/co2/tinypico_power.png" alt=""></p>
<p>This is the regulator they are using on the board <a href="https://www.digikey.com/en/products/detail/on-semiconductor/NCP167BMX330TBG/9169761">here</a></p>
<p>and this is the mosfet <a href="https://datasheet.lcsc.com/szlcsc/Leshan-Radio-LP0404N3T5G_C172433.pdf">here</a></p>
<p>analysis: looks like we've got essentially an identical circuit; they make a different choice of mosfet, but we can probably dial that in easily ....</p>
<hr>
<p>2020-12-22 10:00:06</p>
<p>battery voltage meas reference on jeenode <a href="https://jeelabs.org/2013/05/16/measuring-the-battery-without-draining-it/index.html">here</a></p>
<p>TODO: check reset subcircuit -- match feather</p>
<hr>
<p>2020-12-24 05:04:43</p>
<p>Test of the co2 board &quot;rev_e&quot;!</p>
<p>Used firmware <a href="">here</a></p>
<p>bayou data feed is <a href="http://159.65.226.222:3000/drives/493074c83fde57d306e13d972739d8b4d2c7d1d7506835264b1e196f979a87ec">here</a></p>
<p><img src="/img/co2/rev_e_test_bayou.png" alt=""></p>
<hr>
<p>2020-12-27 08:57:35</p>
<p>Enclosure arriving today linked to on Amazon <a href="https://www.amazon.com/gp/product/B07G58SLB1">here</a></p>
<p><img src="/img/co2/small_enclose.png" alt=""></p>
<p>example enclosure from pac-tec <a href="https://www.pactecenclosures.com/product-detail.php?productid=165&amp;seriesid=73&amp;classid=28">here</a></p>
<p>free samples <a href="https://www.pactecenclosures.com/free-samples.php">here</a></p>
<p>the OD43 looks good <a href="https://www.pactecenclosures.com/product-detail.php?classid=36&amp;seriesid=39&amp;productid=202">here</a>; drawing <a href="https://www.pactecenclosures.com/pdfs/drw_OD43.pdf">here</a></p>
<p><img src="/img/co2/rev_e_built.png" alt=""></p>
<p><img src="/img/co2/rev_e_soldered.png" alt=""></p>
<p><img src="/img/co2/rev_e_collection.png" alt=""></p>
<hr>
<p>2020-12-27 15:55:50</p>
<p>Update:  small enclsoure arrived.  The shape is a bit awkward, and it was anyway broken.  If going with plastic enclosure, might be better to find another / a specific manufacturer.</p>
<p>Rev_f was an attempt to re-spin rev_e in order to fit inside
New idea:  3d print a nice enclosure, and then also design a cardboard one.  Run them side-by-side for a few days to see any differences.  Humidity might be a factor; but can line inside with tape, and humidity is supposedly compensated for.</p>
<hr>
<p>2020-12-27 20:24:24</p>
<p>openscad ...</p>
<p>designing a <a href="https://www.instructables.com/Creating-a-custom-sized-box-for-3D-printing-with-O/">box</a> with openscad</p>
<p>3d printed enclosures with openscad <a href="https://scholarslab.lib.virginia.edu/blog/3d-printed-enclosures-with-openscad/">here</a></p>
<hr>
<p>2020-12-28 07:28:38</p>
<p>Test of REV_E system starting <a href="http://159.65.226.222:3000/drives/f447b1c81ee96c7c0783fc4a7c1ac379cebe92bef8459803f89665f76b023465">here</a></p>
<p>UPDATE: Looks like it never really went above initial baseline (which started around 8:10 AM on below graph):</p>
<p><img src="/img/co2/co2_10_conant.png" alt=""></p>
<p>Aside: nice info on openscad shapes / language <a href="https://en.wikibooks.org/wiki/OpenSCAD_User_Manual/The_OpenSCAD_Language#cube">here</a></p>
<hr>
<p>2020-12-28 11:52:02</p>
<h2><a name="openscad"></a> Making an enclosure for Rev_E using OpenSCAD</h2>
<p>Description of process of making an enclosure for Rev_E (<a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/lay3/rev_e/atkins">kicad board files for RevE</a>) in the below video:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kqvc1j8dmJ8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>The associated scad file for this video is:</p>
<ul>
<li><a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/lay3/rev_e/enclosure/ver1c.scad">ver1c.scad</a></li>
</ul>
<p>Some additional files / information:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/rev_e_measurements.png"> <img src="/img/co2/rev_e_measurements.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Dimensions for PVOS CO2 Rev_E (KiCAD board files are <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/lay3/rev_e/atkins">here</a>.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/ver1c_render.png"> <img src="/img/co2/ver1c_render.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">OpenSCAD rendering of an enclosure protype. Scad file is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/lay3/rev_e/enclosure/ver1c.scad">here</a>.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/ver1c_cover.png"> <img src="/img/co2/ver1c_cover.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">STL file for cover is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/lay3/rev_e/enclosure/ver1c_cover.stl">here</a>.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/ver1c_bottom.png"> <img src="/img/co2/ver1c_bottom.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">STL file for bottom is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/lay3/rev_e/enclosure/ver1c_bottom.stl">here</a>.</td>
</tr>
</tbody>
</table>
<p>Separately rendered cover and bottom are here:</p>
<ul>
<li><a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/lay3/rev_e/enclosure/ver1c_cover.stl">ver1c_cover.stl</a></li>
<li><a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/lay3/rev_e/enclosure/ver1c_bottom.stl">ver1c_bottom.stl</a></li>
</ul>
<hr>
<p>2020-12-28 19:52:34</p>
<p>Craig has now revamped the scad file considerably, allowing everything to be measured in 'pcb coordinates' much more readily.</p>
<p>Latest branch is &quot;ver1d_holes&quot;, and the associated scad file is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/ver1d_holes/rev_e/enclosure/ver1d.scad">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/pcb_place_holes.png"> <img src="/img/co2/pcb_place_holes.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Latest version (&quot;ver1d&quot;) of <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/ver1d_holes/rev_e/enclosure/ver1d.scad">OpenSCAD enclosure</a>.</td>
</tr>
</tbody>
</table>
<hr>
<p>2020-12-28 20:34:24</p>
<p>Meanwhile, working on box enclosure:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/co2/box_enclosure.png"> <img src="/img/co2/box_enclosure.png" alt="figB"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Latest version 'box enclosure template' for REV_E. Scad file is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/ver1d_holes/rev_e/cardboard/ver1.scad">here</a></td>
</tr>
</tbody>
</table>
<hr>
<p>2020-12-29 10:59:16</p>
<p><img src="/img/co2/box_enclosure_printable.png" alt=""></p>
<p><img src="/img/co2/scad_reworked.png" alt=""></p>
<hr>
<p>2020-12-29 13:53:04</p>
<p>latest file with holes for screen, mic, buttons is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/ver1d_holes/rev_e/cardboard/ver1.scad">here</a> -- still need to add USB and lora holes</p>
<p><img src="/img/co2/screen_hole_cardboard.png" alt=""></p>
<p>maybe should make cover a bit narrower to accomodate the bend ends ?</p>
<hr>
<p>2020-12-29 16:59:44</p>
<p><img src="/img/co2/with_holes.png" alt=""></p>
<h2>REV_E Cardboard enclosure update</h2>
<p>2020-12-29 20:13:52</p>
<p>File is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/cardboard/rev_e/cardboard/ver1.scad">here</a> (note that it's in the 'cardboard' branch)</p>
<p><img src="/img/co2/b1.png" alt="">
<img src="/img/co2/b2.png" alt="">
<img src="/img/co2/b3.png" alt="">
<img src="/img/co2/b4.png" alt="">
<img src="/img/co2/b5.png" alt=""></p>
<h2>REV_E 3D printed enclsoure update</h2>
<p>File is <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/master/rev_e/enclosure/ver1d.scad">here</a>.</p>
<p><img src="/img/co2/3d_enclosure_render.png" alt=""></p>
<hr>
<p>2020-12-30 14:16:53</p>
<h2>Optimizing cardboard designs</h2>
<p>The current design worked out better with a thinner cardboard box from Amazon, that has 'A3' and 'FLX' printed prominently on it, and which also had some graphics printed on it. Saving that as &quot;a3_flx.scad&quot; in the 'cardboard' branc.</p>
<p>Going to try also to optimize for the thicker (but I think more standard) Amazon box that has &quot;Z12&quot; and &quot;120&quot; printed on it, saving as 'z12_120.scad'.</p>
<hr>
<p>2020-12-30 14:55:05</p>
<p>Set up 'router-style' connection on rev_e ...</p>
<p>'heltec_router.ino' ...</p>
<hr>
<p>2020-12-30 15:03:18</p>
<h2>Buttons</h2>
<p>TODO: check button status on rev_e -- is &quot;A&quot; connected to LED pin?</p>
<p>Basic button check ...</p>
<p>Buttons check out.  Pin &quot;A&quot; is gpio37, Pin &quot;B&quot; is gpio36.</p>
<h2>Jupyter analysis</h2>
<p>Todo!</p>
<h2>WiFi setup with ESP32</h2>
<p>Nice tutorial <a href="https://www.instructables.com/ESP8266-and-ESP32-With-WiFiManager/">here</a></p>
<p>Ahh -- this is the code I'd found that worked nicely -- from hieromon, <a href="https://hieromon.github.io/AutoConnect/gettingstarted.html">here</a>.</p>
<p>Arduino WiFi module description <a href="https://www.arduino.cc/en/Reference/WiFi">here</a></p>
<hr>
<p>captive portal <a href="https://arduino.stackexchange.com/questions/77642/esp32-open-captive-portal-on-connected">here</a></p>
<p>wifimanager for esp32 <a href="https://github.com/zhouhan0126/WIFIMANAGER-ESP32">here</a></p>
<p>or maybe better library <a href="https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X-99TnVKjVM">https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X-99TnVKjVM</a></p>
<p>this seems powerful -- not sure how to use though!</p>
<p><a href="https://github.com/warmcat/lws-esp32-factory">https://github.com/warmcat/lws-esp32-factory</a></p>
<p><a href="https://github.com/tonyp7/esp32-wifi-manager/">https://github.com/tonyp7/esp32-wifi-manager/</a> looks like a great option</p>
<p>back to trying <a href="https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X--CfHVKjVM">https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X--CfHVKjVM</a></p>
<p><img src="/img/co2/library_options.png" alt=""></p>
<p>documentation for wifi manager <a href="https://github.com/tzapu/WiFiManager">here</a></p>
<p>note: seems that we want the 'development' branch of wifimanger for esp32 -- as per instructions <a href="https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X--CfHVKjVM">here</a></p>
<p>tutorial on using wifimanager (with esp8266, but should work here) -- <a href="https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X--CfHVKjVM">https://diyprojects.io/esp32-test-wifimanager-library-manage-wifi-connections/#.X--CfHVKjVM</a></p>
<hr>
<p>2021-01-01 15:48:48</p>
<p>OKAY!  working wifi configuration (basic) at <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/wifi_config_basic_scd30">https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/wifi_config_basic_scd30</a></p>
<hr>
<p>2021-01-01 18:13:05</p>
<p>migrating from arduinojson5 to 6 article <a href="https://arduinojson.org/v6/doc/upgrade/">here</a></p>
<hr>
<p>2021-01-01 19:17:36</p>
<p>okay, current candidates are: wifimanager (dev branch), and hieromon.</p>
<p>latest attempt at getting it to work (which req'd upgrading the ArduinoJSON code) was here: <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnectWithFSParameters_bayou">AutoConnectWithFSParameters_bayou</a></p>
<p>customization on wifimanager looks a bit hairy.<br>
l
hieromon might work better re: customization.</p>
<p>trying more with hieromon now ...</p>
<p>for autoconnect, looks like we want to consider autoreconnect to determine behavior if device needs to connect to wifi again. link here: <a href="https://hieromon.github.io/AutoConnect/adconnection.html">https://hieromon.github.io/AutoConnect/adconnection.html</a></p>
<hr>
<p>2021-01-01 19:49:31</p>
<p>Here's a thread on how to delete credentials --</p>
<p><a href="https://github.com/Hieromon/AutoConnect/issues/175">https://github.com/Hieromon/AutoConnect/issues/175</a></p>
<hr>
<p>2021-01-01 20:31:46</p>
<p>This code is working fairly nicely!</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display">https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display</a></p>
<p>Document this tomorrow first thing.</p>
<p>It displays the AP to visit, then once connected, displays the IP.</p>
<p>Need to collect custom paramters ...</p>
<hr>
<p>2021-01-02 10:45:37</p>
<p>autocnnect wifi connect sending to bayou -- sort of an mvp -- <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30">https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30</a></p>
<hr>
<p>2021-01-02 11:16:49</p>
<p>basic landing page functionality here: <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30_landing_page">https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30_landing_page</a></p>
<p><img src="/img/co2/landing_page.png" alt=""></p>
<hr>
<p>2021-01-02 12:26:43</p>
<p>Getting data form AutoConnect -- <a href="https://hieromon.github.io/AutoConnect/achandling.html">https://hieromon.github.io/AutoConnect/achandling.html</a></p>
<hr>
<p>2021-01-02 13:40:42</p>
<p>use of snprintf: <a href="https://joequery.me/code/snprintf-c/">https://joequery.me/code/snprintf-c/</a></p>
<hr>
<p>2021-01-02 14:45:33</p>
<p>A nice basic MVP, here:</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30_landing_page_config">https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30_landing_page_config</a></p>
<p><img src="/img/co2/co2_landing.png" alt=""></p>
<p>It allows for configuring wifi. The Bayou credentials are set via 'credentials.h' (requires Arduino IDE).  There's an informative landing page.</p>
<p>This would work for a version where the Bayou feed is flashed before the device is shipped, or by the user.</p>
<p>For a user-config version, a nice starting point might be the code here:</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30_landing_page">https://github.com/edgecollective/co2-remote-and-gateway/tree/rev_e_wifi_config/rev_e/firmware/wifi_sensor/AutoConnect_Elements_display_scd30_landing_page</a></p>
<p>... where one might use the '/elements' page to capture Bayou feed credentials (and maybe set the measurement interval).</p>
<p>TODO: set the measurement interval in the config file.</p>
<p>Some more todos:</p>
<ul>
<li>BUTTON action!  A: wifi settings; B: calibration</li>
<li>get a nicer URL for bayou?</li>
<li>figure out how to capture Bayou parameters</li>
</ul>
<p>Initial rollout:</p>
<ul>
<li>pre-flash Bayou credentials</li>
<li>aim for tweaks by Arduino folks</li>
<li>simplify the Autoconnect interface</li>
<li>SMT version soon</li>
</ul>
<p>Does the SMT need to be part of the rollout?</p>
<p>Add an opencollective tier for:</p>
<ul>
<li>hardware</li>
<li>data service</li>
</ul>
<hr>
<p>2021-01-02 18:35:56</p>
<p>u8x8 fonts here: <a href="https://github.com/olikraus/u8g2/wiki/fntlist8x8">https://github.com/olikraus/u8g2/wiki/fntlist8x8</a></p>
<hr>
<p>2021-01-02 19:17:19</p>
<p>Two button interface video demo <a href="https://youtu.be/w6CxT43gUV8">here</a></p>
<p>Code here: <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/button/rev_e/firmware/wifi_sensor/two_buttons">https://github.com/edgecollective/co2-remote-and-gateway/tree/button/rev_e/firmware/wifi_sensor/two_buttons</a></p>
<p>NOTE: LED D1 doesn't seem to work -- perhaps value of resistor?</p>
<hr>
<p>2021-01-02 21:01:25</p>
<p>Idea: measure every X seconds; average these values; PUT every Y*X seconds so that the PUT interval is 5 or 10 min or more. The averaging will help smooth out the noise.  Every measurement, can blink the LED (optionally) and update the screen.  Indicate on screen when have sent data online.</p>
<p>Also: can embed videos &amp; other 'heavy' material in the ESP32 landing page by pulling it from online such that it only shows up once there's an internet connection to the outside world ...</p>
<hr>
<p>2021-01-03 10:54:43</p>
<p>cap_params seems to work alright ...</p>
<p>working on cap_params_load ...</p>
<p>retrieving files from SPIFFS -- <a href="https://techexplorations.com/blog/esp32/blog-esp32-how-to-retrieve-a-file-from-the-spiffs/">https://techexplorations.com/blog/esp32/blog-esp32-how-to-retrieve-a-file-from-the-spiffs/</a></p>
<hr>
<p>2021-01-03 11:55:47</p>
<p>arduinojson read file -- <a href="https://arduinojson.org/v6/example/config/">https://arduinojson.org/v6/example/config/</a></p>
<p>arduinojson read array -- <a href="https://arduinojson.org/v6/api/jsonarray/">https://arduinojson.org/v6/api/jsonarray/</a></p>
<p>SPIFFS read and write examples <a href="https://www.esp8266.com/viewtopic.php?f=29&amp;t=8194">https://www.esp8266.com/viewtopic.php?f=29&amp;t=8194</a></p>
<p>this is how i want to reference an element of the array i think <a href="https://arduinojson.org/v6/api/jsonarray/subscript/">https://arduinojson.org/v6/api/jsonarray/subscript/</a></p>
<hr>
<p>2021-01-03 13:12:57</p>
<p>Okay, this version of the code uses a file, elements.json, on the SPIFFS filesystem of the esp32 to configure things; and it can be modified by the esp32 as well.</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/cap_params_load_immediate">https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/cap_params_load_immediate</a></p>
<hr>
<p>2021-01-03 13:29:44</p>
<p>Getting closer to capturing parameters data:</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/params_fuller">https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/params_fuller</a></p>
<hr>
<p>2021-01-03 16:51:47</p>
<p>params_fuller_FS is where it's at!</p>
<p>warning regarding dynamic memory usage in micros here: <a href="https://arduino.stackexchange.com/questions/1013/how-do-i-split-an-incoming-string">https://arduino.stackexchange.com/questions/1013/how-do-i-split-an-incoming-string</a></p>
<hr>
<p>2021-01-03 19:02:50</p>
<p>This is getting really close now:</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/params_fuller_FS">https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/params_fuller_FS</a></p>
<p>Need to get it to make some measurements; but basic interface seems to be in place now.</p>
<hr>
<p>2021-01-04 08:52:08</p>
<p>setting the AutConnect menu items <a href="https://hieromon.github.io/AutoConnect/apiconfig.html#menuitems">https://hieromon.github.io/AutoConnect/apiconfig.html#menuitems</a></p>
<p>Captive portal IP address if captive doesn't work: 192.168.10.1</p>
<p>configuration of autoconnect portal <a href="https://hieromon.github.io/AutoConnect/apiconfig.html">here</a></p>
<p>customizing menu further <a href="https://hieromon.github.io/AutoConnect/menu.html">here</a></p>
<p>IDEA: be able to modify 'force calibrate co2 value' from AutoConnect</p>
<p><a href="https://hieromon.github.io/AutoConnect/apiconfig.html#menuitems">this</a> is what I ended up using to customize the menu</p>
<p>resulting in <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/e49a35e0fe30a4b1170608f16184063047d8f5d6/rev_e/firmware/wifi_sensor/params_fuller_FS">this commit for param_fuller_FS</a></p>
<p>TODO:</p>
<ul>
<li>
<p>combine cap_params_load code (measuring CO2) into params_fuller_FS</p>
</li>
<li>
<p>change /mqqt endpoint settings to e.g. 'data'</p>
</li>
<li>
<p>force calibration setting in autconnect</p>
</li>
<li>
<p>mic on/off in autoconnect</p>
</li>
<li>
<p>average co2 readings</p>
</li>
<li>
<p>use pressure values to compensate for co2</p>
</li>
<li>
<p>redesign through-hole board to match existing case on amazon</p>
</li>
<li>
<p>look at specs on amazon case</p>
</li>
<li>
<p>redesign SMT board -- with advantages (longer on battery, say, lower cost to produce)</p>
</li>
</ul>
<hr>
<p>2021-01-04 13:30:08</p>
<p>enclosure</p>
<p>free enclosure from pac-tec:</p>
<p>interesting free enclosure option:</p>
<ul>
<li>page here: <a href="https://www.pactecenclosures.com/product-detail.php?classid=36&amp;seriesid=39&amp;productid=198">https://www.pactecenclosures.com/product-detail.php?classid=36&amp;seriesid=39&amp;productid=198</a></li>
<li>design drawings here: <a href="https://www.pactecenclosures.com/pdfs/drw_OD43.pdf">https://www.pactecenclosures.com/pdfs/drw_OD43.pdf</a></li>
</ul>
<p>PCB size (from design drawing above):</p>
<p><img src="/img/co2/pcb_board.png" alt=""></p>
<p>Nice plastic enclosure -- hammond -- <a href="https://www.newark.com/hammond/1591btcl/enclosure-multipurpose-pc-clear/dp/50H6344?gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSaA4dpnCVFMKYrILm7lfwtSkz8Ny4HzIejUIkhMuzIm0uqSNvsL_kIaAiK8EALw_wcB&amp;mckv=sFz5B29IT_dc%7Cpcrid%7C434136793431%7Cplid%7C%7Ckword%7C%7Cmatch%7C%7Cslid%7C%7Cproduct%7C50H6344%7Cpgrid%7C100464451426%7Cptaid%7Cpla-917181830621%7C&amp;CMP=KNC-GUSA-GEN-Shopping-NewStructure-Enclosures-Racks-Cabinets">https://www.newark.com/hammond/1591btcl/enclosure-multipurpose-pc-clear/dp/50H6344?gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSaA4dpnCVFMKYrILm7lfwtSkz8Ny4HzIejUIkhMuzIm0uqSNvsL_kIaAiK8EALw_wcB&amp;mckv=sFz5B29IT_dc|pcrid|434136793431|plid||kword||match||slid||product|50H6344|pgrid|100464451426|ptaid|pla-917181830621|&amp;CMP=KNC-GUSA-GEN-Shopping-NewStructure-Enclosures-Racks-Cabinets</a></p>
<p>Some nice options</p>
<h2>Serpac 032C</h2>
<p><a href="https://www.digikey.com/en/products/detail/serpac/032CBK/2286005">https://www.digikey.com/en/products/detail/serpac/032CBK/2286005</a></p>
<p>Serpac 032C</p>
<ul>
<li><a href="https://www.serpac.com/userprints/032C_UP.pdf">here</a></li>
<li>listing on serpace <a href="https://www.serpac.com/s-series/032c.aspx">here</a></li>
<li>circuit board drawing <a href="https://www.serpac.com/userprints/circuit-board/330-430-cb.pdf">here</a></li>
</ul>
<p>detachable wall mount! https://www.serpac.com/accessories/wall-mounts.aspx</p>
<h2>Serpac wall mount</h2>
<p><a href="https://serpac.com/wm-series/wm072rc.aspx">https://serpac.com/wm-series/wm072rc.aspx</a></p>
<p>This could actually be cool -- 'main board' on left, 'proto board' on right</p>
<p>--- but it's $20 :)</p>
<hr>
<p><a href="https://www.digikey.com/en/products/detail/serpac/232CBK/2286017">https://www.digikey.com/en/products/detail/serpac/232CBK/2286017</a></p>
<p>hammond tiny enclosure -- <a href="https://vetco.net/products/hammond-1551ltbu-translucent-blue-plastic-enclosure-3-15-in-x-1-58-in-x-0-59-in?gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSbv12vGAESWYlcDZyyMR1AF3k45esmKYOVDSHDajJhLA6uLqX9A1j0aAqqiEALw_wcB">https://vetco.net/products/hammond-1551ltbu-translucent-blue-plastic-enclosure-3-15-in-x-1-58-in-x-0-59-in?gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSbv12vGAESWYlcDZyyMR1AF3k45esmKYOVDSHDajJhLA6uLqX9A1j0aAqqiEALw_wcB</a></p>
<p>hammond clear enclosure -- <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591BTCL/1090769?utm_adgroup=Boxes&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Boxes%2C%20Enclosures%2C%20Racks&amp;utm_term=&amp;utm_content=Boxes&amp;gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSbbCxZ7-93S11wYu57zYg54tGOrZ8DzqvXXx9VZYEySfmGR_M6y7EwaAtUCEALw_wcB">https://www.digikey.com/en/products/detail/hammond-manufacturing/1591BTCL/1090769?utm_adgroup=Boxes&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Boxes%2C%20Enclosures%2C%20Racks&amp;utm_term=&amp;utm_content=Boxes&amp;gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSbbCxZ7-93S11wYu57zYg54tGOrZ8DzqvXXx9VZYEySfmGR_M6y7EwaAtUCEALw_wcB</a></p>
<p>octopart enclosure listing <a href="https://octopart.com/electronic-parts/tools-and-supplies/enclosures">here</a></p>
<p>bud industries BT-2723 <a href="https://www.digikey.com/en/products/detail/bud-industries/BT-2723/1640952">here</a></p>
<hr>
<p>hammond 1551LTBU <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1551LTBU/2094883?utm_adgroup=Boxes&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Boxes%2C%20Enclosures%2C%20Racks_NEW&amp;utm_term=&amp;utm_content=Boxes&amp;gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSZfDv_3hdnA2Bgk4ZCFI5cJm1E6USjf4TUefQBHqM_dZcB09cAH15MaArmaEALw_wcB">here</a></p>
<h2>hammond cheap boxes</h2>
<p>multipurpose translucent hammond boxes <a href="https://www.hammfg.com/electronics/small-case/plastic/1591t">here</a></p>
<p>accessory plastic flanges avail!!</p>
<p>hammond 1591S --</p>
<p>hammond economical enclosures <a href="http://www.hammondmfg.com/dwg2p.htm">here</a></p>
<p>hammond 1591STCL on digikey <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591STCL/1646698?WT.z_cid=ref_neda_dkc_buynow&amp;utm_source=ecia&amp;utm_medium=aggregator&amp;utm_campaign=buynow">here</a></p>
<p>really cool series, with accessories! <a href="https://www.alliedelec.com/m/d/8e5ceccbb6067db9688b20d9a61de415.pdf">here</a></p>
<p>allows mounting of pc boards horizontally within enclosure <a href="https://www.hammfg.com/electronics/small-case/plastic/1591.pdf">here</a></p>
<hr>
<p>shenzen enclosure <a href="https://www.alibaba.com/pla/IP65-plastic-transparent-electronic-enclosure_60787051803.html?mark=google_shopping&amp;biz=pla&amp;src=sem_ggl&amp;mark=shopping&amp;cmpgn=11895329719&amp;adgrp=112297194941&amp;locintrst=&amp;locphyscl=9001876&amp;ntwrk=u&amp;device=c&amp;dvcmdl=&amp;position=&amp;pla_adtype=&amp;pla_mrctid=298077247&amp;pla_channel=online&amp;pla_prdid=60787051803&amp;pla_country=US&amp;pla_lang=en&amp;pla_group=1082573610178&amp;pla_localcode=&amp;gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSZ_AD4jOo1L0dAIOmYdCqo_sslhj_XRAkzLpZIJt1_IZvwRhUtqrNwaAvWBEALw_wcB#shopping-ads">here</a></p>
<p>this is worth ordering for testing -- enclosures for $4 ea here -- <a href="https://www.alibaba.com/product-detail/IP65-plastic-transparent-electronic-enclosure_60787051803.html">https://www.alibaba.com/product-detail/IP65-plastic-transparent-electronic-enclosure_60787051803.html</a></p>
<hr>
<p>top candidates:</p>
<p>hammond 1591STCL / 1591BTCL
serpac  032C</p>
<p>listing for that whole hammond line is <a href="https://www.alliedelec.com/m/d/bfcc0d7ad5cacf7a1b5d441385853eb4.pdf">here</a></p>
<p>avail on amazon!! <a href="https://www.amazon.com/HAMMOND-1591ATCL-ENCLOSURE-MULTIPURPOSE-CLEAR/dp/B00CS2YP22">here</a></p>
<p>1591BTCL avail via amazon <a href="https://www.amazon.com/HAMMOND-1591BTCL-ENCLOSURE-MULTIPURPOSE-CLEAR/dp/B00CSRW6UU/ref=pd_sbs_328_2/140-4251148-5297717?_encoding=UTF8&amp;pd_rd_i=B00CSRW6UU&amp;pd_rd_r=e29e6723-c035-4a65-b731-5646e915d7fd&amp;pd_rd_w=VJlwF&amp;pd_rd_wg=BhPDO&amp;pf_rd_p=ed1e2146-ecfe-435e-b3b5-d79fa072fd58&amp;pf_rd_r=0FXQRA6Z4GJVPHEK1V91&amp;psc=1&amp;refRID=0FXQRA6Z4GJVPHEK1V91">here</a></p>
<p>1591BTCL datasheet is <a href="https://www.hammfg.com/files/parts/pdf/1591BTCL.pdf">here</a></p>
<p>hammond page for 1591btcl is <a href="https://www.hammfg.com/part/1591BTCL">here</a></p>
<p>the whole 1591 series is listed <a href="https://www.hammfg.com/electronics/small-case/plastic/1591t">here</a></p>
<p>1591BTCL is avail for $5.10 ea at Hawk Electronics <a href="https://www.hawkusa.com/manufacturers/hammond-mfg/enclosures/1591btcl?gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSaw87aKUqNYWzVMJldf0uB6pPb4Coa40BlF7klpT3ivT919JQ_UndwaAlGpEALw_wcB">here</a></p>
<hr>
<p>1591STCL <a href="https://www.hammfg.com/files/parts/pdf/1591STCL.pdf">here</a></p>
<p>1591DTCL -- would fit the REV_E board!</p>
<p>meanwhile I think I can probably redesign and fit the 1591STCL or 1591BTCL (whichever is cheaper)</p>
<p>1591STCL -- $10.50
1591BTCL -- $7.80
1591DTCL -- $12.02</p>
<hr>
<p>conclusion:</p>
<p>1591BTCL (<a href="https://www.hammfg.com/files/parts/pdf/1591BTCL.pdf">datasheet</a>) -- this is the target to design for.<br>
1591DTCL (<a href="https://www.hammfg.com/files/parts/pdf/1591DTCL.pdf">datasheet</a>) (<a href="https://octopart.com/1591dtcl-hammond-40152">octopart</a>) (<a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591DTCL/1090771">digikey</a>) -- this is what I can buy to house the REV_E enclosure.</p>
<p>1591DTCL avail via Powell electronics <a href="https://www.powell.com/item/Hammond-Manufacturing-1591DTCL-Octoparts/4324663">here</a></p>
<p>DTCL arrives on jan 25 - ish <a href="https://www.amazon.com/Enclosures-Boxes-Cases-5-9-Clear/dp/B00HKJ2NIG">here</a></p>
<p>If I do the BTCL, I'll need to find a clever way to include the battery ... maybe on top somehow.</p>
<p>--</p>
<hr>
<p>$10 aluminum enclosure bud insdustries -- https://www.digikey.com/en/products/detail/bud-industries/AN-1302-A/5804534?utm_adgroup=Boxes&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Boxes%2C%20Enclosures%2C%20Racks&amp;utm_term=&amp;utm_content=Boxes&amp;gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSZDrdL__T4EZEguqhJTtaaFs6oxlLmh0ItZ9ZZeMTFqdDHsmJ5U4goaAiZJEALw_wcB</p>
<p>1591STCL <a href="https://www.amazon.com/Hammond-1591STCL-Translucent-Polycarbonate-Project/dp/B00D5T2O34/ref=pd_sbs_328_2/140-4251148-5297717?_encoding=UTF8&amp;pd_rd_i=B00D5T2O34&amp;pd_rd_r=814923ec-fe3d-46db-b8d6-240267bf9366&amp;pd_rd_w=KcVgb&amp;pd_rd_wg=PAHvC&amp;pf_rd_p=ed1e2146-ecfe-435e-b3b5-d79fa072fd58&amp;pf_rd_r=TKVQ1DYPVZ0ZEDP9ZF6Q&amp;psc=1&amp;refRID=TKVQ1DYPVZ0ZEDP9ZF6Q">here</a></p>
<hr>
<p>2021-01-04 22:12:14</p>
<p>accessory flanges for 1591 series <a href="https://www.hammfg.com/electronics/small-case/accessories/1591-flange?referer=1190&amp;itm_type=accessory">here</a> --</p>
<p>digikey listing for the flange for the 1591DTCL <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591FDBK/2357940">here</a></p>
<p>1591BSFLBK on newark <a href="https://www.newark.com/hammond/1591bsflbk/enclosure-ip54-flanged-lid-multipurpose/dp/59M4600?gclid=Cj0KCQiAlsv_BRDtARIsAHMGVSZz1mDgGKX_sD6WUa7Sgvrvj9-YUlyoIPW0Z32FtEHSTPTfjOehGXUaAmbqEALw_wcB&amp;mckv=sIRXRJZJt_dc%7Cpcrid%7C434136793431%7Cplid%7C%7Ckword%7C%7Cmatch%7C%7Cslid%7C%7Cproduct%7C59M4600%7Cpgrid%7C100464451426%7Cptaid%7Cpla-917181830541%7C&amp;CMP=KNC-GUSA-GEN-Shopping-NewStructure-Enclosures-Racks-Cabinets">here</a></p>
<p>adapter card pcb for 1591 series:</p>
<ul>
<li>description <a href="http://hammondmfg.com/dwg2b.htm">hammond</a></li>
<li>6 pack <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591Z6/131165">digikey</a></li>
<li>50 pack <a href="https://www.digikey.com/en/products/detail/1591Z50/HM3997-ND/460666?itemSeq=349725590">digikey</a></li>
</ul>
<p>1591DTCL enclosure diagram <a href="https://www.hammfg.com/files/parts/pdf/1591DTCL.pdf">here</a></p>
<p>associated slot pcb mountings diagram <a href="http://hammondmfg.com/dwg2b.htm">here</a></p>
<p>associated plastic flanges listed <a href="https://www.hammfg.com/electronics/small-case/accessories/1591-flange?referer=1190&amp;itm_type=accessory">here</a></p>
<p>Likely should order some on Digikey tomorrow.</p>
<p>Interesting that it gives us some room for prototyping</p>
<p><img src="/img/co2/1591DTCL_lifesize.png" alt=""></p>
<p>Epidemiologist around rapid testing <a href="https://twitter.com/michaelmina_lab">here</a></p>
<p>TODO: add the flange to the digikey order and order tomorrow</p>
<p>flange for the DTCL seems to be the 1591FDBK (<a href="https://www.digikey.com/en/products/detail/1591FDBK/HM3903-ND/2357940?itemSeq=349727843">digikey</a> <a href="https://www.digikey.com/en/products/detail/1591FDBK/HM3903-ND/2357940?itemSeq=349727843">drawing</a>)</p>
<p>Aside: gorgeous hammond enclosure 1590B die-cast aluminum (<a href="https://www.amazon.com/HAMMOND-1590B-ENCLOSURE-DIECAST-60-5X112X31MM/dp/B0002BBRA4/ref=pd_sbs_21_3/140-4251148-5297717?_encoding=UTF8&amp;pd_rd_i=B0002BBRA4&amp;pd_rd_r=7b1cb10e-a0d9-4042-9d64-da960c05e6c3&amp;pd_rd_w=4LW1Q&amp;pd_rd_wg=zDW6J&amp;pf_rd_p=d2a3ee7d-5d69-4331-b32f-a3ce40b5e0d3&amp;pf_rd_r=P66MAJQ7KSDNJ98WAMR6&amp;psc=1&amp;refRID=P66MAJQ7KSDNJ98WAMR6">amazon</a>)</p>
<hr>
<p>2021-01-05 11:46:04</p>
<p>to get:</p>
<ul>
<li>the spacers</li>
<li>1591BTCL flange in grey and black</li>
<li>1591DTCL flange in gray and black</li>
</ul>
<p>update: gray is on backorder. going with black.</p>
<hr>
<p>2021-01-05 18:37:37</p>
<p>this seems to be key -- how to set up the captive portal IP address -- need to check whether this works on a laptop <a href="https://hieromon.github.io/AutoConnect/apiconfig.html#gateway">https://hieromon.github.io/AutoConnect/apiconfig.html#gateway</a></p>
<hr>
<p>2021-01-05 19:07:15</p>
<p>Finished the AutoConnect switch-over of endpoint names -- now use 'bayou_settings' instead of 'mqtt_setting'.</p>
<p>Resultant working code is here (note branch): <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/params_fuller_FS_endpoint">https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_e/firmware/wifi_sensor/params_fuller_FS_endpoint</a></p>
<hr>
<p>2021-01-06 16:27:47</p>
<p>1591 enclosure guide for pcb <a href="https://www.hammfg.com/files/products/1591/1591z-card-guide-instructions.pdf">here</a></p>
<p>might use a clear lid with a pre-flanged enclosure -- look <a href="https://www.hammfg.com/electronics/small-case/plastic/1591">here</a></p>
<hr>
<p>2021-01-06 16:33:46</p>
<p>Black 'B' enclosure with a flange <a href="http://hammondmfg.com/pdf/1591BFL.pdf">here</a></p>
<p>direct link for pc board adapter <a href="https://www.hammfg.com/part/1591Z6">here</a></p>
<p>and dimensions for pcb board adapter <a href="https://www.hammfg.com/files/parts/pdf/1591Z6.pdf">here</a></p>
<p>catalog page for 1591 series <a href="http://www.hammondmfg.com/pdf/9c2pg8-9.pdf">here</a></p>
<p>looks here as though the 'C' enclosures come between 'B' and 'D' (surprise) -- <a href="https://www.hammfg.com/electronics/small-case/accessories/1591-flange">hammond</a></p>
<p>also: C is just slightly larger than B, it seems</p>
<p>here are the C dimensions <a href="http://www.hammondmfg.com/pdf/1591C.pdf">pdf</a> -- and on <a href="https://www.amazon.com/Hammond-Manufacturing-1591CTCL-1591C-POLYCARBONATE/dp/B00CS2TWE8">amazon</a> and <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591CTCL/1090770?s=N4IgTCBcDaIIwFYCccDCAVVAZEBdAvkA">digikey</a></p>
<hr>
<p>2021-01-07 11:36:19</p>
<p>Document from Hammond re: the proper PCB size for the 1591B series here: <a href="/img/co2/1591B_BOX_PCB.pdf">pdf</a> |  <a href="1591B_BOX_PCB.dxf">dxf file</a> | <a href="/img/co2/1591B_BOX_PCB_DIM.dxf">dxf file with dim</a></p>
<p>heltec dimensions</p>
<p><img src="/img/co2/heltec_dimensions.jpg" alt=""></p>
<hr>
<p>2021-01-07 14:08:27</p>
<p><img src="/img/co2/rev_f_layout.png" alt=""></p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_f/atkins">https://github.com/edgecollective/co2-remote-and-gateway/tree/cap_params/rev_f/atkins</a></p>
<p>particular commit here:</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/commit/37cfff4540a2506cf84b3bc35e8255eb14a25da0#diff-8b7e3d045d2effcb6738a35190e48460e3f8d084dc97983bb0b740101097caaa">https://github.com/edgecollective/co2-remote-and-gateway/commit/37cfff4540a2506cf84b3bc35e8255eb14a25da0#diff-8b7e3d045d2effcb6738a35190e48460e3f8d084dc97983bb0b740101097caaa</a></p>
<hr>
<p>2021-01-07 15:07:44</p>
<p>Update: Pin 34-39 on the ESP32 are not capable of output -- that's why pin 39 wasn't working as an LED control.</p>
<p>looks like scd30 could use a 2.5 mm screw, ish;  the height of the screw would be about 8 mm.  so can guess at a standoff size perhaps.</p>
<p>nice material heltec <a href="https://community.hiveeyes.org/t/heltec-wifi-lora-32/3125">here</a></p>
<p>full heltec tech specs <a href="https://heltec.org/project/wifi-lora-32/">here</a></p>
<p>does look in the schematic that there's a battery divider already in place -- see discussion <a href="http://community.heltec.cn/t/heltec-battery-power-example-not-working/1234/4">here</a></p>
<p>interesting code for heltec from a lot of perspectives re: optimal use of esp32, includes battery measurement here: <a href="https://github.com/HelTecAutomation/Heltec_ESP32/blob/master/examples/ESP32/ADC_Read_Voltage/Battery_power/Battery_power.ino">https://github.com/HelTecAutomation/Heltec_ESP32/blob/master/examples/ESP32/ADC_Read_Voltage/Battery_power/Battery_power.ino</a></p>
<p>pin 21 is external battery control -- low, ON --</p>
<p>special pins on esp32 <a href="https://randomnerdtutorials.com/esp32-pinout-reference-gpios/">here</a></p>
<p>pin 12 must be low during boot</p>
<hr>
<p>2021-01-07 20:33:35</p>
<p>PIR sensor <a href="https://learn.adafruit.com/pir-passive-infrared-proximity-motion-sensor">here</a></p>
<p>just need 3V, GND, and an input pin ... maybe add a screw terminal?</p>
<p>&quot;sh1.25&quot; is perhaps the search term for relevant batteries on aliexpress <a href="https://www.aliexpress.com/item/32923649233.html">here</a></p>
<hr>
<p>2021-01-08 11:54:39</p>
<p>Rev_F board submitted to JLCPCB, order Order #: Y12-2489114A  // W202101090100951</p>
<p><img src="/img/co2/rev_f_board.png" alt=""></p>
<p>board files github commit <a href="https://github.com/edgecollective/co2-remote-and-gateway/tree/9067113e187eb8cbb6cef703900c8b911c834a40/rev_f/atkins">here</a></p>
<p>zipped gerber files in particular <a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/9067113e187eb8cbb6cef703900c8b911c834a40/rev_f/atkins/rev_f_gerbers.zip">here</a></p>
<hr>
<p>2021-01-12 14:40:22</p>
<p><img src="/img/co2/bayou_co2.png" alt=""></p>
<hr>
<p>2021-01-14 12:54:10</p>
<p><img src="/img/co2/bayou_feed.png" alt=""></p>
<hr>
<p>2021-01-15 11:25:38</p>
<p>Feed Name: &quot;asdfasdf&quot;
Feed Public Key: 9816e2df7cc14d64698d7012859080757780c73f22213bd1
Feed Private Key: 7e633222f381a99170e370ea7476b43662507a5352077ade
Feed Home Page: http://data.pvos.org/co2/data/9816e2df7cc14d64698d7012859080757780c73f22213bd1</p>
<p>TODO: add a download from the feed page (CSV?)</p>
<hr>
<p>2021-01-15 12:26:46</p>
<p>Hammond flanged enclosures <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1551NFLBK/2094795?utm_adgroup=Boxes&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=Shopping_Boxes%2C%20Enclosures%2C%20Racks_NEW&amp;utm_term=&amp;utm_content=Boxes&amp;gclid=CjwKCAiAl4WABhAJEiwATUnEF89YZ6J7mwMHrF8YBiMvPcSJYSGLQwPan4NlqhwElw8m3Iptas8XsBoCdrQQAvD_BwE">here</a></p>
<p>Main plastic enclosure page for Hammond <a href="https://enclosurehub.com/collections/small-plast">here</a></p>
<p><a href="https://enclosurehub.com/collections/small-plastic-enclosures/products/hammond-type-4-4x-6-6p-polycarbonate-and-abs-plastic-enclosures-1557-series-water-tight-multiple-mounting-features">1557 series</a></p>
<p>Vented sensor enclosure! <a href="https://enclosurehub.com/collections/hammond-enclosures/products/abs-plastic-miniature-enclosures-snap-fit-wall-mount-vented-sensor-enclosure">here</a></p>
<hr>
<p>2021-01-15 21:52:47</p>
<p>Latest firmware attempt is <a href="https://github.com/p-v-o-s/co2-monitor/commit/1dd94116d17d0d8d63ebd13b496b2d24819e7d22">here</a>.  Acquires actual CO2 values &amp; uploads them to Bayou-CO2</p>
<p>Test feed on Bayou-CO2 'loft' is at <a href="http://data.pvos.org/co2/data/09b3f0239025e03c386b3f3ccfeba5501f95b8eff0ec9358">http://data.pvos.org/co2/data/09b3f0239025e03c386b3f3ccfeba5501f95b8eff0ec9358</a></p>
<hr>
<p>2021-01-17 05:04:02</p>
<p><strong>Loft test feed</strong> continues: <a href="http://data.pvos.org/co2/data/09b3f0239025e03c386b3f3ccfeba5501f95b8eff0ec9358">http://data.pvos.org/co2/data/09b3f0239025e03c386b3f3ccfeba5501f95b8eff0ec9358</a></p>
<p><img src="/img/co2/bayou_loft_jan17.png" alt=""></p>
<p>Notes on feed above:</p>
<p><strong>jan 16</strong></p>
<ul>
<li>had vid meeting in loft at 11 AM  (which involved picking up sensor and holding it near me)</li>
<li>cooking happened in morning and afternoon</li>
<li>left house for long walk mid-afternoon, return and went up to loft around 5 pm quickly, then left for dinner</li>
<li>returned back hom after 8 pm, went up to loft to do some work</li>
</ul>
<p><strong>jan 17</strong></p>
<ul>
<li>got up at 4 AM went into kitchen / living room</li>
<li>went up to loft at 5 AM</li>
<li>went back down to living room at 5:15 AM</li>
</ul>
<p>Note that it seems that when I walk around a bit and go upstairs to loft huffing and puffing, there's an initial spike; the co2 calms down when i start to settle and work at computer quietly.  then level decays further when I leave.</p>
<p>UPDATE: after refreshing feed, not sure this is true; the 'spike' isn't that much higher than what is perhaps 'noise'; the CO2 level does seem to be fairly stably higher when I'm up in loft.</p>
<p>Question: I wonder why there's an apparent dip below 'baseline' 6 PM to 830 PM on Jan 16?  Maybe the doors to house were open a bit?  interesting if we can show that baseline shifts considerably when crack open doors (experiment to be done)</p>
<hr>
<p>2021-01-17 08:12:24</p>
<p>Just re-entered loft w/ coleman now ...</p>
<p>went back down, then camb back around 8:30 ...</p>
<hr>
<p>2021-01-18 11:59:52</p>
<p>Working on pulling in parameters ... looks like this is how I did it here:</p>
<p><a href="https://github.com/edgecollective/co2-remote-and-gateway/blob/cap_params/rev_e/firmware/wifi_sensor/cap_params_load_immediate/cap_params_load_immediate.ino">https://github.com/edgecollective/co2-remote-and-gateway/blob/cap_params/rev_e/firmware/wifi_sensor/cap_params_load_immediate/cap_params_load_immediate.ino</a></p>
<hr>
<p>2021-01-18 12:06:20</p>
<p>Requirements in Arduino IDE for CO2 monitor based on ESP32 ...</p>
<p>IDE setup:</p>
<ul>
<li>ESP32 board support in Arduino: <a href="https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/">https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/</a></li>
<li>ESP32 file upload tool: <a href="https://randomnerdtutorials.com/install-esp32-filesystem-uploader-arduino-ide/">https://randomnerdtutorials.com/install-esp32-filesystem-uploader-arduino-ide/</a>. Tool is <a href="https://github.com/me-no-dev/arduino-esp32fs-plugin/releases/">here</a></li>
</ul>
<p>Libraries:</p>
<ul>
<li><a href="https://github.com/thomasfredericks/Bounce2">Bounce2</a> library (via IDE)</li>
<li>U8g2 (via IDE)</li>
<li>PubSubClient // https://github.com/knolleary/pubsubclient</li>
<li>BMP388_DEV (lindupp, via IDE)</li>
<li>Sparkfun SCD30 (via IDE)</li>
</ul>
<hr>
<p>2021-01-18 12:49:59</p>
<p>Test feed here: <a href="http://data.pvos.org/co2/data/cbb8d444591def61d4e59f9b53d3193dd7724a9d8599c6ee">http://data.pvos.org/co2/data/cbb8d444591def61d4e59f9b53d3193dd7724a9d8599c6ee</a></p>
<hr>
<p>2021-01-18 13:54:57</p>
<p>Now reading in parameter file and displaying CO2 value with this commit: <a href="https://github.com/p-v-o-s/co2-monitor/commit/39c589e08763c8f280da3e49c05ae70d059a7791">https://github.com/p-v-o-s/co2-monitor/commit/39c589e08763c8f280da3e49c05ae70d059a7791</a></p>
<p>Feed is here: <a href="http://data.pvos.org/co2/data/cbb8d444591def61d4e59f9b53d3193dd7724a9d8599c6ee">http://data.pvos.org/co2/data/cbb8d444591def61d4e59f9b53d3193dd7724a9d8599c6ee</a></p>
<hr>
<p>2021-01-18 14:10:36</p>
<p>Now show network config on button press <a href="https://github.com/p-v-o-s/co2-monitor/commit/5f05b084ba1b026370a0f2adb9492b0d187b2205">https://github.com/p-v-o-s/co2-monitor/commit/5f05b084ba1b026370a0f2adb9492b0d187b2205</a></p>
<p>NOTE: should try to do everything with non-blocking code. This button approach currently delays for 3 sec.  Could instead check every loop for whether enough time has passed, and whether should display which info.</p>
<p>TODO: implement this; also factor out display functions.</p>
<hr>
<p>2021-01-19 04:57:51</p>
<p>Got weird error message -- result seemed to be no wifi connection, but loop still ran and measurement was made / screen updated every measurement interval:</p>
<blockquote>
<p>E (52119735) wifi: esf_buf: t=2 l=76 max:32, alloc:32 no eb, TXQ_BLOCK=0</p>
</blockquote>
<p>Really useful post on strings and esp32 and memory <a href="https://esp8266life.wordpress.com/2019/01/13/memory-memory-always-memory/">here</a></p>
<p>Looks like free heap is okay.</p>
<p>New test feed is here: <a href="http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9">http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9</a></p>
<p>The current version of the code is here: <a href="https://github.com/p-v-o-s/co2-monitor/commit/af6c57182ef2486cf87aedc404f5fca257c330d0">https://github.com/p-v-o-s/co2-monitor/commit/af6c57182ef2486cf87aedc404f5fca257c330d0</a>.</p>
<p>TODO: Reading in measurement interval from param file initially still not working (fix).</p>
<p>TODO: We should implement a watchdog that looks to see if successful post and/or connection and resets if not -- the error message I was seeing might be related to the wifi, apparently</p>
<p>TODO: Should also change the plotting style in Bayou-CO2 to <em>not</em> use bezier ...</p>
<hr>
<p>2021-01-19 09:26:43</p>
<p>More TODOS:</p>
<ul>
<li>Watchdog ping every loop</li>
<li>Reset if no wifi connection after one iteration</li>
<li>autocalibration turn on in bayou settings</li>
<li>Bayou-CO2 -- download keys as CSV / JSON</li>
<li>Make a Feather ESP32 option? Can be ESP32 or lora feather</li>
</ul>
<p>ESP32 power req's ...</p>
<p>Observation -- looks like heap stabilizes ...</p>
<pre><code>getFreeHeap(): 250128
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:331,&quot;tempC&quot;:22.7,&quot;humidity&quot;:23.25,&quot;mic&quot;:0,&quot;auxPressure&quot;:1008.91,&quot;auxTempC&quot;:19.61,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
200
Measurement recorded

getFreeHeap(): 250128
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:328,&quot;tempC&quot;:22.52,&quot;humidity&quot;:23.64,&quot;mic&quot;:0,&quot;auxPressure&quot;:1008.86,&quot;auxTempC&quot;:19.56,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
200
Measurement recorded

getFreeHeap(): 250128
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:332,&quot;tempC&quot;:22.65,&quot;humidity&quot;:23.66,&quot;mic&quot;:0,&quot;auxPressure&quot;:1008.85,&quot;auxTempC&quot;:19.59,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
200
Measurement recorded


getFreeHeap(): 250128
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:348,&quot;tempC&quot;:22.55,&quot;humidity&quot;:24.13,&quot;mic&quot;:0,&quot;auxPressure&quot;:1008.89,&quot;auxTempC&quot;:19.58,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
200
Measurement recorded
</code></pre>
<hr>
<p>2021-01-19 09:34:25</p>
<p>Get calibration code working ...</p>
<p>TODO: add force calibration value to the Bayou settings</p>
<p>TODO: add field to database indicating whether force calibrated in the last round ...</p>
<p>TODO: pull out configuration values as 'config' file (or put in json param file)</p>
<hr>
<p>2021-01-19 10:40:54</p>
<p>Looks like by default, SCD30 sensor measurement interval is 2 seconds ... and can't go lower.</p>
<p>SCD30 datasheet reference p 10 of <a href="https://media.digikey.com/pdf/Data%20Sheets/Sensirion%20PDFs/CD_AN_SCD30_Interface_Description_D1.pdf">https://media.digikey.com/pdf/Data%20Sheets/Sensirion%20PDFs/CD_AN_SCD30_Interface_Description_D1.pdf</a></p>
<p>Just checked -- in fact, it does work to ask if there is new CO2 data available -- that gives us a delay of about 2 sec.</p>
<hr>
<p>2021-01-19 10:49:03</p>
<p>Added calibration procedure with this commit: <a href="https://github.com/p-v-o-s/co2-monitor/commit/68c467baa1c6b8c20b4b76a5eb5f6a89d55c9508">https://github.com/p-v-o-s/co2-monitor/commit/68c467baa1c6b8c20b4b76a5eb5f6a89d55c9508</a></p>
<hr>
<p>2021-01-19 10:56:50</p>
<p>Fixed an interface bug with canceling forced calibration ...</p>
<p>Now, after pressing the calibrate button, in any case we drop into a 'firstLoop' meausurement, so that we make a measurement, display it, and send it.  Probably a good feature anyway to have a way to send a value immediately.  Might want to indicate graphically that data has been sent (&quot;200&quot; on top right of screen or something)</p>
<p>Also looks like the sensor needs at least a few seconds to warm up (check datasheet) ... maybe we should check for startup and display 'warming up' and show measurement every few seconds ..</p>
<hr>
<p>2021-01-20 05:48:45</p>
<p>Stopped working overnight:</p>
<pre><code>http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:383,&quot;tempC&quot;:18.98,&quot;humidity&quot;:25.85,&quot;mic&quot;:0,&quot;auxPressure&quot;:1004.71,&quot;auxTempC&quot;:19.74,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
[HTTP] GET... failed, error: connection refused
getFreeHeap(): 250108
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:376,&quot;tempC&quot;:18.9,&quot;humidity&quot;:25.87,&quot;mic&quot;:0,&quot;auxPressure&quot;:1004.66,&quot;auxTempC&quot;:19.57,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
[HTTP] GET... failed, error: connection refused
getFreeHeap(): 250108
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:368,&quot;tempC&quot;:19.02,&quot;humidity&quot;:25.47,&quot;mic&quot;:0,&quot;auxPressure&quot;:1004.64,&quot;auxTempC&quot;:19.62,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
[HTTP] GET... failed, error: connection refused
getFreeHeap(): 250108
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:363,&quot;tempC&quot;:19.18,&quot;humidity&quot;:25.34,&quot;mic&quot;:0,&quot;auxPressure&quot;:1004.58,&quot;auxTempC&quot;:19.96,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
[HTTP] GET... failed, error: connection refused
getFreeHeap(): 250108
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:372,&quot;tempC&quot;:19,&quot;humidity&quot;:25.77,&quot;mic&quot;:0,&quot;auxPressure&quot;:1004.47,&quot;auxTempC&quot;:19.8,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
[HTTP] GET... failed, error: connection refused
getFreeHeap(): 250108
http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
{&quot;private_key&quot;:&quot;13adcd2e8704165a62aea86bee0a3abe2fd3be4d62427a35&quot;,&quot;co2&quot;:377,&quot;tempC&quot;:18.9,&quot;humidity&quot;:25.87,&quot;mic&quot;:0,&quot;auxPressure&quot;:1004.4,&quot;auxTempC&quot;:19.66,&quot;aux001&quot;:0,&quot;aux002&quot;:0}http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9
[HTTP] GET... failed, error: connection refused
</code></pre>
<p>-- is this Bayou, or the monitor?</p>
<p>UPDATE: answer -- it wasn't Bayou.</p>
<p>Pressed reset, and it just worked.  Need to look into this as a bug; but this is another reason to set up a 'reset' if we don't a good connection to the server.</p>
<p>Ah -- it could be that the IP address changes overnight.</p>
<p>Good thread on watchdog style approach here: <a href="https://github.com/espressif/arduino-esp32/issues/653">https://github.com/espressif/arduino-esp32/issues/653</a></p>
<p>More on this here: <a href="https://github.com/Hieromon/AutoConnect/issues/292">https://github.com/Hieromon/AutoConnect/issues/292</a></p>
<p>This might be the approach to take: <a href="https://github.com/Hieromon/AutoConnect/issues/292#issuecomment-757340418">https://github.com/Hieromon/AutoConnect/issues/292#issuecomment-757340418</a>.</p>
<p>Skeleton code here: <a href="https://github.com/Hieromon/AutoConnect/issues/292#issuecomment-756634645">https://github.com/Hieromon/AutoConnect/issues/292#issuecomment-756634645</a></p>
<p>There is a patched release here: <a href="https://github.com/Hieromon/AutoConnect/issues/292#issuecomment-759202689">https://github.com/Hieromon/AutoConnect/issues/292#issuecomment-759202689</a> that might address the issue, and apparently release v1.2.3 will fix it?</p>
<p>Another nice post about dropping the wifi here: <a href="https://rntlab.com/question/wifi-connection-drops-auto-reconnect/">https://rntlab.com/question/wifi-connection-drops-auto-reconnect/</a></p>
<p>oooh -- and it offers some auto-restart code ... will try that ...</p>
<p>implemented in the 'restart' branch here: <a href="https://github.com/p-v-o-s/co2-monitor/tree/restart/co2monitor">https://github.com/p-v-o-s/co2-monitor/tree/restart/co2monitor</a></p>
<hr>
<p>2021-01-20 10:47:23</p>
<p>CORS and associated issues explained <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">here</a></p>
<hr>
<p>2021-01-20 11:00:02</p>
<p>Ideas discussed w/ Mike:</p>
<p>Bayou / deployment ideas:</p>
<ul>
<li>Mapping out data on a floorplan</li>
<li>Deploying in various spaces but starting co-located as a test</li>
<li>Cardboard enclosures</li>
<li>Lending library</li>
<li>Classes on how to use / deploy</li>
<li>Add 'let's encrypt' functionality</li>
</ul>
<p>Firmware ideas:</p>
<ul>
<li>Add a 'LOG' field to Bayou for error messages / etc for a feed -- include calibration events, reset events, bad connection</li>
<li>Add a 'battery level' indicator in the feed, and on the display</li>
</ul>
<p>Hardware ideas:</p>
<ul>
<li>Label the i2c resistors on the boards</li>
<li>Do a &quot;Rev G&quot; ...?</li>
</ul>
<p>Documentation:</p>
<ul>
<li>Need to spin up pvos.org landing page, documentation, links</li>
<li>Need to put in place the web infrastructure on opencollective</li>
</ul>
<hr>
<p>2021-01-20 11:08:20</p>
<p>How to upload and display an image in NodeJS here: <a href="https://stackoverflow.com/questions/15772394/how-to-upload-display-and-save-images-using-node-js-and-express">https://stackoverflow.com/questions/15772394/how-to-upload-display-and-save-images-using-node-js-and-express</a></p>
<p>General impression I'm getting: store image files on file system; store their filenames / references in the relational database.</p>
<p>Oh nice -- can use ImageMagic in NodeJs -- see this link here: <a href="https://stackoverflow.com/questions/12539918/get-the-width-and-height-of-an-image-in-node-js">https://stackoverflow.com/questions/12539918/get-the-width-and-height-of-an-image-in-node-js</a></p>
<p>Or you can probe the image size without a full download here: <a href="https://github.com/nodeca/probe-image-size">https://gitehub.com/nodeca/probe-image-size</a></p>
<p>One interim solution is: host your own image somewhere, and we can display feed data on top of it via URL ...</p>
<p>How to start a nodejs project here: <a href="https://philna.sh/blog/2019/01/10/how-to-start-a-node-js-project/">https://philna.sh/blog/2019/01/10/how-to-start-a-node-js-project/</a></p>
<hr>
<p>2021-01-20 11:40:26</p>
<p>Trying to work in this repo here: <a href="https://github.com/edgecollective/floorplan">https://github.com/edgecollective/floorplan</a></p>
<p>This is the file that seems to have been the demo file I was playing with around mapping: <a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html">https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html</a></p>
<p>Handling CORS <a href="https://flaviocopes.com/express-cors/">here</a> -- good guide; and:</p>
<p>good guide <a href="https://expressjs.com/en/resources/middleware/cors.html#demo">here</a>, which leads to:</p>
<ul>
<li><a href="https://github.com/troygoode/node-cors-server/blob/master/server.js">https://github.com/troygoode/node-cors-server/blob/master/server.js</a></li>
</ul>
<hr>
<p>2021-01-20 15:24:42</p>
<p>Follwing this example <a href="https://www.htmlgoodies.com/beyond/javascript/serve-external-content-from-your-express.js-apps.html">here</a></p>
<p>Guide to pug here: <a href="https://www.sitepoint.com/a-beginners-guide-to-pug/">https://www.sitepoint.com/a-beginners-guide-to-pug/</a></p>
<hr>
<p>2021-01-20 16:57:33</p>
<p>Good start on plotting data in separate Node server here: <a href="https://github.com/edgecollective/floorplan/commit/607816a05848093a471966e0b9dd00c1cab90733">https://github.com/edgecollective/floorplan/commit/607816a05848093a471966e0b9dd00c1cab90733</a></p>
<hr>
<p>2021-01-20 20:38:45</p>
<p>Latest:  try this link: http://192.168.1.163:4000/map/cbb8d444591def61d4e59f9b53d3193dd7724a9d8599c6ee?key=co2</p>
<p>Some layout details here: <a href="https://coder-coder.com/display-divs-side-by-side/">https://coder-coder.com/display-divs-side-by-side/</a></p>
<p>Latest attempt is at this commit of floorplan in the url-load branch, here: <a href="https://github.com/edgecollective/floorplan/commit/4972382b4982f34b75a60b5f8026a180a1591daf">https://github.com/edgecollective/floorplan/commit/4972382b4982f34b75a60b5f8026a180a1591daf</a></p>
<hr>
<p>2021-01-20 20:59:49</p>
<p>Ongoing test feed is here: <a href="http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9">http://data.pvos.org/co2/data/3897755c6379d00bbb1d622827b1ffd1ba6a0579802044c9</a></p>
<hr>
<p>2021-01-22 11:22:08</p>
<h2>NDIR reference circuit</h2>
<p>May be very similar to one used in SCD30 ...</p>
<p>&quot;Complete Gas Sensor Circuit Using Nondispersive Infrared (NDIR)&quot;:  link: <a href="https://www.analog.com/media/en/analog-dialogue/volume-50/number-4/articles/complete-gas-sensor-circuit.pdf">https://www.analog.com/media/en/analog-dialogue/volume-50/number-4/articles/complete-gas-sensor-circuit.pdf</a></p>
<p><img src="/img/co2/ad_ndir_ref.png" alt=""></p>
<p>Mike B. comments on the SCD30:</p>
<blockquote>
<p>Looks like a lamp at one end, and two legs are the two wavelengths - sensing, and reference;
75mA when measuring implies about 70 Ohms for that lamp.</p>
</blockquote>
<h2>NDIR refrence circuit for Alphasense CO2 Sensor</h2>
<p><img src="/img/co2/alphasense.png" alt=""></p>
<p>Link here: <a href="http://www.alphasense.com/WEB1213/wp-content/uploads/2016/01/AAN_202-04.pdf">http://www.alphasense.com/WEB1213/wp-content/uploads/2016/01/AAN_202-04.pdf</a>e</p>
<p>--
2021-01-22 14:28:56</p>
<h2>Design Review w MB</h2>
<ul>
<li>Keep constant scale for all graphs, to aid comparison</li>
<li>Error bars and thresholds (if device is calibration -- maybe, make optional, with warning)</li>
<li>Several plots overlaid, for easy comparison</li>
<li>Deploy at least one 'baseline' reference sensor in a room that doesn't have people, if possible, for immediate comparison to 'baseline'</li>
<li>Assess impact of pressure on device</li>
<li>Make a calibration rig, with source of CO2 (or Argon)</li>
</ul>
<hr>
<p>2021-01-23 11:52:42</p>
<p>Current case for REV_E ... 1591BTCL</p>
<ul>
<li>Case <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591BTCL/1090769">https://www.digikey.com/en/products/detail/hammond-manufacturing/1591BTCL/1090769</a></li>
<li>Mounting flange <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591FBBK/2357902">https://www.digikey.com/en/products/detail/hammond-manufacturing/1591FBBK/2357902</a></li>
<li>Adapter inserts <a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591Z50/460666">https://www.digikey.com/en/products/detail/hammond-manufacturing/1591Z50/460666</a></li>
</ul>
<hr>
<p>2021-01-25 11:25:35</p>
<p>v0.1-alpha release of the firmware for REV_F!</p>
<p><a href="https://github.com/p-v-o-s/co2-monitor/releases">https://github.com/p-v-o-s/co2-monitor/releases</a></p>
<hr>
<p>2021-01-25 19:14:15</p>
<p>Added more info to the screen!</p>
<p><img src="/img/co2/rev_f_mucho_info.png" alt=""></p>
<hr>
<p>2021-01-27 07:46:09</p>
<p>Two devices:</p>
<p><img src="/img/co2/double_sm.jpg" alt=""></p>
<p>ESP-1cfe
posting to: <a href="http://data.pvos.org/co2/data/a00aed3265bf99e1784168ac9b1b509f30adfe9d00a2918d">http://data.pvos.org/co2/data/a00aed3265bf99e1784168ac9b1b509f30adfe9d00a2918d</a></p>
<p>and</p>
<p>ESP-2c7e
posting to: <a href="http://data.pvos.org/co2/data/e9d7a2df343e8e6d0bf6c169011be8721ee9c24707ad7347">http://data.pvos.org/co2/data/e9d7a2df343e8e6d0bf6c169011be8721ee9c24707ad7347</a></p>
<hr>
<p>2021-01-27 09:24:36</p>
<p>SCD30 enclosure app note <a href="https://www.google.com/url?q=https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/9.5_CO2/Sensirion_CO2_Sensors_SCD30_Design-In_Guidelines_D1.pdf&amp;sa=D&amp;source=hangouts&amp;ust=1611842158712000&amp;usg=AFQjCNE3z7ACuQZWf6VPmSG4CB_wEYk5Fg">https://www.google.com/url?q=https://www.sensirion.com/fileadmin/user_upload/customers/sensirion/Dokumente/9.5_CO2/Sensirion_CO2_Sensors_SCD30_Design-In_Guidelines_D1.pdf&amp;sa=D&amp;source=hangouts&amp;ust=1611842158712000&amp;usg=AFQjCNE3z7ACuQZWf6VPmSG4CB_wEYk5Fg</a></p>
<hr>
<p>2021-01-27 19:57:10</p>
<p><img src="/img/co2/a2.png" alt=""></p>
<hr>
<p>2021-01-28 08:21:57</p>
<p>TODOS:</p>
<ul>
<li>config.h pull in</li>
<li>do everything with char instead of strings (later?)</li>
<li>factor out 'display' function</li>
<li>present all info on main screen</li>
<li>unique esp32 ID (later?)</li>
<li>'trim' the user input (later?)</li>
<li>add relevant fields to bayou-co2</li>
</ul>
<hr>
<p>2021-01-28 14:59:42</p>
<p>Article on airborne covid and CO2 montoring <a href="https://www.aol.com/article/lifestyle/2020/08/12/the-best-ways-to-reduce-the-risk-of-covid-19-indoors/24589315/">https://www.aol.com/article/lifestyle/2020/08/12/the-best-ways-to-reduce-the-risk-of-covid-19-indoors/24589315/</a></p>
<hr>
<p>2021-01-28 15:28:17</p>
<p><img src="/img/co2/force_fed.png" alt=""></p>
<hr>
<p>2021-01-28 17:49:17</p>
<p>Adding microSD functionality to the Heltec ...</p>
<p><a href="https://randomnerdtutorials.com/esp32-data-logging-temperature-to-microsd-card/">https://randomnerdtutorials.com/esp32-data-logging-temperature-to-microsd-card/</a></p>
<p>First get the libraries ...</p>
<p>Maybe it's possible to talk to SCD30 i2c over OLED i2c (as did on Quahog)?  see <a href="https://github.com/HelTecAutomation/Heltec_ESP32/blob/master/examples/SD/SD_Time/SD_Time.ino">https://github.com/HelTecAutomation/Heltec_ESP32/blob/master/examples/SD/SD_Time/SD_Time.ino</a></p>
<p>Ah, SD card might require resistors!  See answer here: <a href="https://stackoverflow.com/questions/57454066/how-to-use-2-spi-devices-lora-and-sd-card-on-esp32">https://stackoverflow.com/questions/57454066/how-to-use-2-spi-devices-lora-and-sd-card-on-esp32</a></p>
<p>Also this info here -- looks like it can get dug out!  <a href="http://ldsrc.blogspot.com/2018/02/micro-sd-card-for-esp32.html">http://ldsrc.blogspot.com/2018/02/micro-sd-card-for-esp32.html</a></p>
<hr>
<p>2021-01-29 11:19:51</p>
<p>Switching over to Feather ESP32 ...</p>
<p>Arduino SD Card library + Feather breakout ... <a href="https://learn.adafruit.com/adafruit-adalogger-featherwing/using-the-sd-card">https://learn.adafruit.com/adafruit-adalogger-featherwing/using-the-sd-card</a></p>
<p><a href="https://www.adafruit.com/product/254">Adafruit microsd breakout board</a></p>
<p>Trying Examples &gt; SD &gt; Cardinfo</p>
<p>Note: important code for multiple SPI buses (for use later when doing microSD + lora): <a href="https://github.com/jonashoechst/ttgo-lora-sd">https://github.com/jonashoechst/ttgo-lora-sd</a></p>
<p>works ...</p>
<p><a href="http://www.hammondmfg.com/dwg2.htm">1591 Page on Hammond</a>
<a href="https://www.digikey.com/en/products/detail/hammond-manufacturing/1591BTCL/1090769">1591BTCL Listing on Digikey</a>
<a href="http://www.hammondmfg.com/pdf/1591B.pdf">Enclosure datasheet with screw positions</a></p>
<h2>from datasheet</h2>
<p>horizontal cover inside lip: 107.7
horizontal screw distance: 98.3
horizonal span (screw, inside lip): (107.7-98.3)/2 =</p>
<p>vertical screw distance: 48.4
vertical cover inside lip: 57.8
vertical span (screw, inside lip): (57.8-48.4)/2 =</p>
<h2>sit inside enclosure</h2>
<p>horizontal span: 106 mm
horiz screw dist: 98.3
horiz screw center to edge: (106-98.3)/2 = 3.85</p>
<p>vertical span: 56 mm
vert screw dist: 48.4
vert screw center to edge: (56-48.4)/2 = 3.8</p>
<p>x,y:</p>
<p>top left: 3.85,3.8
top right: 3.85+98.3, 3.8 = 102.15,3.8
bottom left: 3.85, 3.8+48.4 = 3.85, 52.2
bottom right: 102.15, 52.2</p>
<h3>USB &quot;up angle&quot;</h3>
<p><a href="https://www.amazon.com/StarTech-com-Micro-USB-Cable-Cord/dp/B00ENZDFQ4/ref=sr_1_5?dchild=1&amp;keywords=micro%2Busb%2Bright%2Bangle&amp;qid=1611948044&amp;sr=8-5&amp;th=1">Listing on amazon</a></p>
<p><a href="https://www.amazon.com/StarTech-com-Micro-USB-Cable-Cord/dp/B00ENZDFQ4/ref=sr_1_5?dchild=1&amp;keywords=micro%2Busb%2Bright%2Bangle&amp;qid=1611948044&amp;sr=8-5&amp;th=1"><img src="/img/co2/up_angle.png" alt=""></a></p>
<h2>Pi as Bridge</h2>
<p><a href="https://www.raspberrypi.org/documentation/configuration/wireless/access-point-bridged.md">https://www.raspberrypi.org/documentation/configuration/wireless/access-point-bridged.md</a></p>
<p><a href="https://www.balena.io/blog/turn-a-raspberry-pi-into-a-wi-fi-access-point-or-repeater/">https://www.balena.io/blog/turn-a-raspberry-pi-into-a-wi-fi-access-point-or-repeater/</a></p>
<p><a href="https://medium.com/@brunoamaroalmeida/rogueone-creating-a-rogue-wi-fi-access-point-using-a-raspberry-pi-79e1b7e628c6">https://medium.com/@brunoamaroalmeida/rogueone-creating-a-rogue-wi-fi-access-point-using-a-raspberry-pi-79e1b7e628c6</a></p>
<p><a href="https://gist.github.com/Lewiscowles1986/fecd4de0b45b2029c390">https://gist.github.com/Lewiscowles1986/fecd4de0b45b2029c390</a></p>
<hr>
<p>2021-01-29 17:12:36</p>
<h2>deleting partitions using fdisk</h2>
<p><a href="https://www.pidramble.com/wiki/benchmarks/external-usb-drives">https://www.pidramble.com/wiki/benchmarks/external-usb-drives</a></p>
<p>This worked nicely: <a href="https://www.nayab.xyz/linux-tools/partitioning-using-fdisk.html">https://www.nayab.xyz/linux-tools/partitioning-using-fdisk.html</a></p>
<p>Showing progress while zipping: <a href="https://unix.stackexchange.com/questions/179563/when-i-use-zip-how-can-i-display-the-overall-progress-without-flooding-the-comm">https://unix.stackexchange.com/questions/179563/when-i-use-zip-how-can-i-display-the-overall-progress-without-flooding-the-comm</a></p>
<p>Back up raspberry pi image:</p>
<blockquote>
<p>sudo dd bs=4M if=/dev/sdb of=pvosPi.img status=progress</p>
</blockquote>
<p>Zipping it afterwards:</p>
<blockquote>
<p>zip -qr - pvosPi.img | pv -bep -s $(du -bs pvosPi.img | awk '{print $1}') &gt; pvosPi.img.zip</p>
</blockquote>
<hr>
<p>2021-01-30 10:20:43</p>
<p><img src="/img/co2/pushbutton.png" alt=""></p>
<p><img src="/img/co2/button_wiring.png" alt=""></p>
<hr>
<p>2021-01-30 16:30:53</p>
<p><img src="/img/co2/right_1.png" alt=""></p>
<p><img src="/img/co2/right_2.png" alt=""></p>
<p><a href="https://randomnerdtutorials.com/esp32-lora-rfm95-transceiver-arduino-ide/">https://randomnerdtutorials.com/esp32-lora-rfm95-transceiver-arduino-ide/</a></p>
<p>Adding additional SPI buses <a href="https://github.com/espressif/arduino-esp32/issues/1219">https://github.com/espressif/arduino-esp32/issues/1219</a></p>
<p><a href="https://forum.arduino.cc/index.php?topic=637121.0">https://forum.arduino.cc/index.php?topic=637121.0</a></p>
<p><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/spi_master.html">https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/spi_master.html</a></p>
<p><img src="/img/co2/rfm95.png" alt=""></p>
<hr>
<p>2021-01-30 21:24:20</p>
<p>Working setup!</p>
<p><a href="https://gitlab.com/p-v-o-s/co2/co2monitor-firmware/-/tree/master/v0.1-alpha/feather_esp32/feather_esp32_lora_sd_u8x8_scd30">https://gitlab.com/p-v-o-s/co2/co2monitor-firmware/-/tree/master/v0.1-alpha/feather_esp32/feather_esp32_lora_sd_u8x8_scd30</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Temperature Measurement</h2>
<p><a href="https://learn.adafruit.com/adafruit-max31865-rtd-pt100-amplifier">RTD amp</a> breakout from Adafruit.</p>
<h2>Signal Sampling</h2>
<p><a href="https://www.ti.com/lit/an/sboa068/sboa068.pdf?ts=1601648370947&amp;ref_url=https%253A%252F%252Fwww.google.com%252F">Burr Brown App Note</a> on precision absolute value circuits.</p>
<h2>Signal generation</h2>
<p><a href="https://www.instructables.com/Arduino-Waveform-Generator/">Arduino Waveform Generator</a></p>
<h2>Prior Art Among Us</h2>
<p>Don's last version in January, based off Craig's 4pstat is <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/blob/4p-v1/kicad-pcb/pdf/4pstat.pdf">here</a></p>
<p>Craig's latest 4pstat is <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/blob/master/kicad-pcb/pdf/4pstat.pdf">here</a></p>
<p>Don's simplified 4 probe based on an earlier design is <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/master/v_0.1/four_probe.pdf">here</a></p>
<h2>Craig comments</h2>
<blockquote>
<p>What I found that seems to work well on the driven shield lines was to use some RC snubbers to ground after the 50 Ohm output resistor.  Values like 10 Ohm and 100nF give you a corner frequency of 160kHz - if your bandwidth is 10kHz that should likely work out.</p>
</blockquote>
<blockquote>
<p>Don, if you use my design, there are lots of mods needed to stop it from oscillating.</p>
</blockquote>
<blockquote>
<p>If you are doing a virtual ground, I suggest using the <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/issues/7#note_364944285">in-the-loop compensation circuit I got from AoE3</a></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/intheloop.jpg"> <img src="/img/intheloop.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">In-the-loop compensation scheme suggested by Craig <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/issues/7#note_364944285">here</a>.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Actually I wonder if the corner frequency is actually 6X lower because of the added 50 Ohm resistor? If that is the case, it might be better to back off the capacitance a bit And what about output resistance from the opamp (Mike, I'm looking at you)? If that's like around 100 Ohm maybe we'd be smart using an even smaller cap. This could be why I did not make my intended bandwidth of 100kHz on the bodged up 4pstat.</p>
</blockquote>
<h2>Revision Notes</h2>
<hr>
<p>As of 10-02-2020:</p>
<ul>
<li>use an OPA281 for the TIA (current measurement)</li>
<li>use an INA2331 for the INAMP (voltage measurement)</li>
<li>add the driven shield, snubs, and in-the-loop compensation as per Craig's design &amp; mods</li>
<li>use through-hole headers for any passives we might want to swap (avoiding the MUX chip for now) to simplify the board</li>
</ul>
<p>Don's current attempt at the above is <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/master/v_0.3/pdf/ec-4p.pdf">here</a>.</p>
<hr>
<p>As of 10-06-2020:</p>
<ul>
<li>Made suggested modifications by C.V. &amp; M.B..  Resultant schematic is <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/master/v_0.4/pdf/ec-4p.pdf">version 0.4</a>.</li>
</ul>
<p>As of 10-07-2020:</p>
<ul>
<li>Mike: 'Do you want a power supply decoupling cap on the current sense TIA, U3?'</li>
<li>Craig: 'What's driving P1 in this circuit?  Shouldn't we have some amp here?'</li>
</ul>
<p>'Adder inputs' section of Craig's 4PSTAT schematic:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/conductivity/adder_inputs.png"> <img src="/img/conductivity/adder_inputs.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">From Craig's schematic <a href="https://gitlab.com/p-v-o-s/echem/4pstat/-/blob/master/kicad-pcb/pdf/4pstat.pdf">here</a>.</td>
</tr>
</tbody>
</table>
<p>As of Oct 9 2020:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/conductivity/p1_feedback_circuit.png"> <img src="/img/conductivity/p1_feedback_circuit.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Revision A of the 0.4 EC-4P circuit: attempt at a simpler 'conductivity' measurement with adder amp feedback coming directly from the the amp output. See discussion <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/issues/6#note_427124136">here</a>.</td>
</tr>
</tbody>
</table>
<p><a href="https://en.wikipedia.org/wiki/Adder_(electronics)">Adder circuit</a> explanation on wikipedia.</p>
<p>Oops.  Above places C16 incorrectly:</p>
<p>Craig:</p>
<blockquote>
<p>It looks like you are shorting out C16.  Instead C16 should go across R21 to the summing junction.</p>
</blockquote>
<blockquote>
<p>Think of it this way, your gain at DC for each adder pathway (e0-e3) should be R21/Rn.  What the feedback capacitor C16 does is to short out R21 for high frequency signals where its impedance is small; thus it rolls off the gain at high frequencies, the corner frequency being 1/(2<em>pi</em>R21*C16).  Just set that, say 5X, above your highest intended signal frequency and you will have smoothed DAC signals and more stability.</p>
</blockquote>
<p>Correction:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/conductivity/p1_feedback_circuit_REV-B.png"> <img src="/img/conductivity/p1_feedback_circuit_REV-B.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/blob/d616fd5467dd4cd1d415cf019640ec242f7dc668/v_0.4/pdf/ec-4p.pdf">Revision B</a> of the 0.4 EC-4P circuit: attempt at a simpler 'conductivity' measurement with adder amp feedback coming directly from the the amp output. See discussion <a href="https://gitlab.com/p-v-o-s/echem/ec-4p/-/issues/6#note_427124136">here</a>.</td>
</tr>
</tbody>
</table>
<h2>References / Datasheets</h2>
<p><a href="https://www.ti.com/lit/ds/symlink/ina2331.pdf?ts=1602019726489&amp;ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FINA2331%253Futm_source%253Dgoogle%2526utm_medium%253Dcpc%2526utm_campaign%253Dasc-null-null-GPN_EN-cpc-pf-google-wwe%2526utm_content%253DINA2331%2526ds_k%253DINA2331%2526DCM%253Dyes%2526gclid%253DCjwKCAjwq_D7BRADEiwAVMDdHqgen4POVfQNUaSvv1tTeDEJar15NgWLAQamLzuEf4j7nOT6NZ4iQBoCoFYQAvD_BwE%2526gclsrc%253Daw.ds">INA331</a></p>
<p><a href="https://www.ti.com/lit/ds/symlink/opa381.pdf?ts=1602019570296&amp;ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FOPA381">OPA831 / OPA2381</a></p>
<p><a href="https://www.ti.com/lit/ds/symlink/lmc6484.pdf?ts=1602019481665">LMC6484</a></p>
<h2>Useful misc info</h2>
<p><a href="https://stackoverflow.com/questions/15677439/command-to-get-latest-git-commit-hash-from-a-branch">via Stackoverflow</a>: Command to get latest URL for remote commit:</p>
<p><code>git ls-remote git://github.com/&lt;user&gt;/&lt;project&gt;.git</code></p>
<hr>
<p>2020 NOV 12</p>
<p>HOBO Freshwater datalogger product page <a href="https://www.onsetcomp.com/products/data-loggers/u24-001/">here</a>.</p>
<p><a href="/img/conductivity/hobo_specs.png"><img src="/img/conductivity/hobo_specs.png" alt=""></a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Overview</h2>
<p>All of this research and prototyping is occurring at <a href="https://www.valedalama.net/en/">Quinta Vale Da Lama</a>.</p>
<hr>
<p><em>April 13, 2020</em></p>
<h2>SQLite</h2>
<p>Great <a href="https://www.youtube.com/watch?v=Jib2AmRb_rk">talk on Sqllite</a>, arguing that it's appropriate for a database located on 'the edge'.</p>
<img src="/img/valedalama/about_sqlite.png">
<hr>
<p><em>24 Apr 2020</em></p>
<h2>Test Feather Code</h2>
<p><a href="https://gist.github.com/dwblair/c18edaaa2de9a8d5e3a6b47c48797d98">Simple test code</a>  for Adafruit Feather + RAK</p>
<hr>
<p><em>05 May 2020</em></p>
<h2>Configuring the region on the RAK</h2>
<p>General setup for the RAK 7243 + Pi firmware is <a href="https://doc.rakwireless.com/rak7243c-lorawan-developer-gateway/device-firmware-setup">here</a>.</p>
<p>Information about the configuration file is <a href="https://www.chirpstack.io/network-server/install/config/">here</a>.</p>
<p>The firmware we're using is <a href="https://downloads.rakwireless.com/LoRa/Pilot-Gateway-Pro-RAK7243/Firmware/">here</a>.</p>
<p>Can use 'gateway-config' command line script on RAK to set the region:</p>
<pre><code>sudo gateway-config
</code></pre>
<p>This script modifies this file:</p>
<pre><code>/etc/chirpstack-network-server/chirpstack-network-server.toml
</code></pre>
<h2>Basic Arduino Test Code</h2>
<p>Basic test code for sending data to the RAK in OTAA mode is in gist form <a href="https://gist.github.com/dwblair/f6a0c3dd07fc3ae073fad3914f77af64">here</a>.</p>
<h2>Configuring the region on the Arduino</h2>
<p>Changing the region on the Arduino requires modifing a special header file.</p>
<p>See the Adafruit Arduino tutorial <a href="https://learn.adafruit.com/the-things-network-for-feather?view=all#region-configuration">here</a>.</p>
<h2>Adafruit Feather 900 Mhz can be tuned to 868 Mhz band</h2>
<p>See the below snippet from the <a href="https://www.adafruit.com/product/3178">Adafruit Feather M0 LoRa 900 Mhz product page</a>:</p>
<img src="/img/valedalama/feather_tunable.png">
<h2>Adafruit LMIC OTAA basic code will attempt to rejoin periodically</h2>
<p>See this example serial output:</p>
<img src="/img/valedalama/rejoin.png">
<h2>Needed tweak on Adafruit for EU band</h2>
<p>See the forum post <a href="https://www.thethingsnetwork.org/forum/t/solved-adafruit-feather-m0-to-connect-to-ttn-over-otaa-unknown-event-20/29990/15">here</a>:</p>
<img src="/img/valedalama/eu_band_adafruit_tweak.png">
<p><a href="https://www.hackster.io/Amedee/the-things-network-node-for-ttnmapper-org-a8bcd4">This</a> might be a useful reference for setting up 868 band.</p>
<p>Current impression is that RAK hardware does indeed distinguish between 868 and 915 Mhz bands ... ?</p>
<p>05 May 2020 13:27 Update:  there is a 'project_config' file located in the 'src' folder on in the lmic library folder itself -- and it's set to the US band -- perhaps this is overriding the project files? Trying setting it to EU and the RAK to EU.  One open question is how specific the RAK Pi Hat is re: freq bands ... can it handle 868?</p>
<p>So the current thinking for getting 868 band to work is:</p>
<ul>
<li>change the Arduino lib folder project_config file to 868</li>
<li>change the sketch lib folder project_config file to 868 (for good measure)</li>
<li>comment out LMIC_selectSubBand(1);</li>
</ul>
<p>Meanwhile, note that upload via bossac did work on the Pi.</p>
<p>Confirmed -- was able to get upload on RAK in US '915' version by setting to '868' following above steps.  Key seems to have been the Arduino library project_config folder issue.</p>
<p>Note: we are using <a href="https://github.com/mcci-catena/arduino-lmic/releases/tag/v2.3.2">mcci-catena arduino-lmic 2.3.2 version</a> of library with success.  Later versions haven't always worked. Stick with that for now.</p>
<h2>Strategy</h2>
<p>First:</p>
<ul>
<li>set up RAK to 868 via sudo gateway-config</li>
<li>try loading binary to Feather via RAK</li>
</ul>
<p>Second:</p>
<ul>
<li>make sure we're using proper version of lmic library (see above)</li>
<li>change the Arduino lib folder project_config file to 868</li>
<li>change the sketch lib folder project_config file to 868 (for good measure)</li>
<li>comment out LMIC_selectSubBand(1);</li>
</ul>
<h2><a name="bme280_wiring">Wiring Adafruit Feather to BME280</a></h2>
<p>As per instructions <a href="https://learn.adafruit.com/adafruit-bme280-humidity-barometric-pressure-temperature-sensor-breakout/arduino-test">here</a>:</p>
<img src="/img/valedalama/feather_pinouts.jpg">
</br>
<img src="/img/valedalama/bme_280_pins.jpg">
<p><strong>BME280 ---&gt; Feather</strong></p>
<ul>
<li>VIN --&gt; 3V</li>
<li>GND --&gt; GND</li>
<li>SCK --&gt; SCL</li>
<li>SDI --&gt; SDA</li>
</ul>
<img src="/img/valedalama/bme_280_feather_wiring.png">
<h2>Code for BME280 + Feather M0 LoRa</h2>
<p>Using the BME280 can be accomplished by using the <a href="https://github.com/adafruit/Adafruit_BME280_Library">Adafruit BME280 Arduino Library</a>, which also requires using the <a href="https://github.com/adafruit/Adafruit_Sensor">Adafruit Sensor Library</a>.</p>
<h2>Uplaoding firmware to Adafruit Feather M0 via command line (bossac)</h2>
<p>An Adafruit tutorial is <a href="https://learn.adafruit.com/welcome-to-circuitpython/non-uf2-installation">here</a>.  Note that we need the 'arduino' branch of the bossac tool on github, which is version 1.7.X.</p>
<pre><code>sudo bossac -p /dev/ttyACM0 -e -w -v -R firmware.bin
</code></pre>
<h2>Debugging the BME280 sensor</h2>
<p>Sensor not working on Walt's RAK.  Q: is it because of connection to Feather / problem with Feather, or is it because of some setting on the Gateway?</p>
<p>Diagnostic:  some basic BME280 test code, non-LoRa -- just prints values out to serial port.  Wrote the binary, and then sent it to Walt's feather remotely -- and got back an error:</p>
<img src="/img/valedalama/bme_test.png">
<hr>
<p><em>09 May 2020</em></p>
<h2>BME280 Node Fixed</h2>
<p>Walt was able to fix the BME280 node by re-soldering nad re-wiring:</p>
<img src="/img/valedalama/success_bme280.png">
</br>
</br>
<h2>Local Sqlite database on USB</h2>
<p>We've been able to get a local sqlite database up and running now, stored on a USB flash drive on the RAK:</p>
<img src="/img/valedalama/local_first_iteration_1.png">
</br>
</br>
<img src="/img/valedalama/local_first_iteration_1_rak.png">
</br>
</br>
<img src="/img/valedalama/local_first_node_red.png">
</br>
</br>
<h2>Human-readable date format</h2>
<p>And we added a field to the database that provides a human-readable date.</p>
<img src="/img/valedalama/human_readable_date.png">
</br>
</br>
## Overview
<p><a href="#version_4_assembly">Assembly Guide for Version 4</a>.</p>
<p><a href="https://youtu.be/LljqFv8GzxA">Video explanation</a> of the current status as of Oct 07 2020  ..</p>
<h2>AM2315 and 'new' i2c on Feather M0</h2>
<p>Issue: we designed a <a href="https://github.com/edgecollective/valedalama-greenhouse-remote">breakout board</a> (in Eagle CAD) to be milled in Portugal by <a href="">Lucio</a>; but the original intent was for a different, non-i2c sensor; the one we're using now is an i2c sensor (the <a href="https://www.adafruit.com/product/1293">AM2315</a>, and requires:</p>
<ul>
<li>10K pullups on both signal lines</li>
<li>that the signal lines be used as i2c lines, which isn't standard for the Feather M0 firmware.</li>
</ul>
<h2>References</h2>
<h3>I2C</h3>
<ul>
<li>
<p><a href="https://learn.adafruit.com/using-atsamd21-sercom-to-add-more-spi-i2c-serial-ports/creating-a-new-wire">Creating a new I2c interface on the M0 -- Adafruit</a></p>
</li>
<li>
<p><a href="https://learn.sparkfun.com/tutorials/adding-more-sercom-ports-for-samd-boards/all">Creating a new I2C interface on the M0 -- Sparkfun</a></p>
</li>
</ul>
<p>Ah -- update -- can't reassign the pins because of the 'pad constraint', see the section <a href="https://learn.adafruit.com/using-atsamd21-sercom-to-add-more-spi-i2c-serial-ports/creating-a-new-wire#ok-so-lets-make-a-new-i2c-sercom-already-1603458-14">here</a>.</p>
<h3>AM2315</h3>
<ul>
<li><a href="https://github.com/adafruit/Adafruit_AM2315">Adafruit AM2315 library</a>.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/feather_m0_lora.jpg"> <img src="/img/valedalama/feather_m0_lora.jpg" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Adafruit Feather M0 LoRa (for pin reference).</td>
</tr>
</tbody>
</table>
<h2>FAB Farm</h2>
<p><a href="https://www.google.com/maps?q=37.160365,-8.774516&amp;shorturl=1">Location</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/fabfarm.png"> <img src="/img/valedalama/fabfarm.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Lucio's FAB Farm.</td>
</tr>
</tbody>
</table>
<h2>Feather BME280 data export from server</h2>
<p>One can grab CSV data from the Valedalama server like thus:</p>
<blockquote>
<p><code>http://64.227.0.108:8100/api/csv?limit=1000</code></p>
</blockquote>
<p>where the 'limit=N' parameter gives the 'most recent N values'.</p>
<p>A snapshot of all of the historical data from &quot;Valedalama BME280 Feather&quot; from the earliest collection date (July 10 2020) up through Oct 10 2020 can be downloaded <a href="/data/historical_bme280_as_of_10_oct_2020.csv">here</a>.</p>
<h2>Board Designs</h2>
<h3>Remote</h3>
<h4>Remote Version 4: Eagle CAD</h4>
<p>Design files are <a href="https://github.com/edgecollective/valedalama-greenhouse-remote">here</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_schematic.png"> <img src="/img/valedalama/remote_v4_schematic.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote schematic, version 4.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_board.png"> <img src="/img/valedalama/remote_v4_board.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 4.</td>
</tr>
</tbody>
</table>
<h4>Remote Version 5 in KiCAD:</h4>
<p>Repo is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/remote/v5">here</a>.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/3d_render.png"> <img src="/img/valedalama/3d_render.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 5.</td>
</tr>
</tbody>
</table>
<hr>
<h3><a name="version_4_assembly"></a>Assembly Guide for Remote Node Version 4</h3>
<p>(Update OCT 30 2020)</p>
<p>Lucio has milled both Version 3 and Version 4 of the remote node.  Current focus is on assembly of Version 4 (design files <a href="https://github.com/edgecollective/valedalama-greenhouse-remote/blob/master/pcb/ver4/remote_v4_board.png">here</a>.</p>
<p>For reference, Version 4 board design looks like this:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_board.png"> <img src="/img/valedalama/remote_v4_board.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 4.</td>
</tr>
</tbody>
</table>
<p>It is a 'mother board' for a Feather M0 LoRa microcontroller.</p>
<p>The remote board version 4 requires:</p>
<ul>
<li>A 1x12 and a 1x16 0.1&quot; / 2.54mm female header, to hold the Feather in place.</li>
<li>Note: the Feather also requires 1x12 and 1x16 2.54mm male headers soldered to it, as well as an antenna (a straight wire, or a helical one). I think this is already done.</li>
<li>A 4-position 5mm spacing screw terminal (typically, a pair of 2-position screw terminals)</li>
<li>A 3-position 5mm screw terminal</li>
<li>A 2-position 5mm screw terminal</li>
<li>3 resistors (all of them 10K, or all of them 4.7K).</li>
</ul>
<p>It is obvious from the footprints on the board which of the above go where :)</p>
<p>Note: the ESP32 device only requires that the accompanying antenna that came with the baord be plugged into it (it's a bit fiddly, but no soldering required).</p>
<hr>
<p>2020 Nov 10</p>
<p><img src="/img/valedalama/v5_success.png" alt=""></p>
<p>The associated <a href="">version 5 kicad pcb file</a> is easy to upload to <a href="aisler.net">Aisler</a> (German PCB producer) -- about $25 euros for 3 PCBs, 3-5 day turnaround:</p>
<p><img src="/img/valedalama/aisler_v5.png" alt=""></p>
<hr>
<p>2020 Nov 11</p>
<p>Lucio's setup, with his milled board:</p>
<p><img src="/img/valedalama/lucio_setup.jpeg" alt=""></p>
<p>Sensor working with the feather:</p>
<p><img src="/img/valedalama/feather_working.jpeg" alt=""></p>
<p>Data flowing through to Bayou:</p>
<p><img src="/img/valedalama/bayou_data.png" alt=""></p>
<hr>
<p>2020 Nov 14</p>
<p>Next steps:</p>
<ul>
<li>Modify Bayou to allow for inputing date ranges</li>
<li>Figure out reflashing of boards from command line via Pi</li>
<li>Figure out setting wifi credentials (and OTA firmware) on ESP via bluetooth</li>
<li>NRF52 bluetooth OTA firmware update in Arduino possible? If so maybe switch to NRF52 feather</li>
<li>List the remote board and the esp32 gateway combo -- make a breakout board for the Heltec</li>
</ul>
<p>Can offer ...</p>
<p>Remote:</p>
<ul>
<li>Mothbot</li>
<li>Feather motherboard (add power input 12V or higher)</li>
</ul>
<p>Gateway</p>
<ul>
<li>Heltec</li>
<li>Heltec + motherboard (with timer chip)</li>
<li>Quahog (advantage of power input 12V or higher)</li>
</ul>
<p>Database:</p>
<ul>
<li>FarmOS</li>
<li>Bayou</li>
</ul>
<p>So -- all off-the-shelf, o r fully custom.
Along with guides for all of this.</p>
<h3>OTA for the remote node?</h3>
<p>NRF52 OTA programming link (weather buoy project) <a href="https://opensourceoceanweatherbuoy.wordpress.com/2018/03/11/nrf52-program-sketches-over-the-air/">here</a></p>
<h3>Features to add in REV_C</h3>
<ul>
<li>Heltec wifi connection debug on display</li>
<li>Easy way to set up wifi &amp; bayou on Heltec -- via bluetooth, or via 'router setup' / wifi</li>
<li>Remote node should send status message whether or not the sensors worked</li>
</ul>
<h3>TODO</h3>
<ul>
<li>Change Feather send frequency to every 10 minutes</li>
<li>Change the radio frequency to 868 to match Walt's order</li>
</ul>
<hr>
<p>2020 Nov 17</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/temp_valedalama.png"> <img src="/img/valedalama/temp_valedalama.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Data coming in from first deploymend of milled board version of the remote node.</td>
</tr>
</tbody>
</table>
<p>bayou_longer.png</p>
<h3>Server</h3>
<p>Pagination strategies with pouchdb -- useful for setting up the server, <a href="https://pouchdb.com/2014/04/14/pagination-strategies-with-pouchdb.html">here</a></p>
<h3>Humidity sensor issue?</h3>
<p>Looks like the Humidity tends to get pegged ...</p>
<p><img src="/img/valedalama/humidity_issue.png" alt=""></p>
<h3>Date Conversion formula in Excel</h3>
<p>Example is [here[(https://docs.google.com/spreadsheets/d/1yDYKKenBeMRpYumavZ4Df_dnJOKyFEXB-Inp_YYGFdY/edit?usp=sharing).</p>
<hr>
<p>2020 NOV 19</p>
<h3>Added 'hop' parameter and modified units on Bayou display</h3>
<p><a href="/img/valedalama/temp_hopped.png"><img src="/img/valedalama/temp_hopped.png" alt=""></a></p>
<p>NOTE:  running the branch 'ticks', code on gitlab <a href="https://gitlab.com/dwblair/p2p-farm-server/-/tree/ticks">here</a>.  Might need to tweak if a new sensor is added, because the ticks currently do only every hour.</p>
<h3>Humidity sensor details</h3>
<p>AM2315 temp + humidity sensor tech details:</p>
<p><a href="/img/valedalama/am2315_details.png"><img src="/img/valedalama/am2315_details.png" alt=""></a></p>
<p>AM2315 <a href="https://cdn-shop.adafruit.com/datasheets/AM2315.pdf">datasheet</a></p>
<h2>Architecture Idea</h2>
<p>Gateway is Heltec.  Can do AP wifi credentials and FarmOS / Bayou configuration.</p>
<p>Remote node is Feather / Mothbot.  Has a DIP switch to modify the node ID.</p>
<p>Both might allow for serial configuration, or OTA programming (need to add SPI Memory to Mothbot if so).</p>
<h3>Battery holders</h3>
<p>3XAA holder <a href="https://www.amazon.com/LampVPath-Battery-Holder-Leads-Wires/dp/B07WRQ3XTJ/ref=sr_1_7?dchild=1&amp;keywords=3XAA+holder&amp;qid=1605969565&amp;s=electronics&amp;sr=1-7">here</a>.</p>
<p>Guide to battery holders and mounts <a href="https://uk.rs-online.com/web/generalDisplay.html?id=ideas-and-advice/battery-holders-guide">here</a>.</p>
<h3>Adafruit guide to using the battery on the Feather</h3>
<p>Do's and don't's, <a href="https://learn.adafruit.com/adafruit-feather-m0-adalogger/power-management">here</a>.</p>
<p>What if we put use 3.3V regulator and power the Feather this way?  Try this experiment out at home.  Turning a Feather into a lower-power device would be a win.</p>
<p>Breakout boards for:</p>
<ul>
<li>Feather M0 LoRa</li>
<li>Moteino , and Moteino M0</li>
</ul>
<p>Using: dip switch + MCP1700</p>
<hr>
<p>2020 NOV 22</p>
<p>Looks like remote node (Feather) is requiring reset periodically (every few days) -- doesn't appear to be a battery issue.  Might be in the code -- e.g. if it doesn't read from sensor successfully.</p>
<h3>ESP32 Watchdog timer</h3>
<p>Guide <a href="https://iotassistant.io/esp32/enable-hardware-watchdog-timer-esp32-arduino-ide/">here</a>.</p>
<p>Also, working code <a href="https://medium.com/@supotsaeea/esp32-reboot-system-when-watchdog-timeout-4f3536bf17ef">here</a>. &lt;--- this looks like the proper setup.  Great!</p>
<h3>SAMD21 Watchdog timer</h3>
<p>There's a discussion <a href="https://eugeniopace.org/arduino/resiliency/2020/05/11/Using-a-Watchdog-to-fix-all-issues.html">here</a> &lt;&lt;-- this is a GREAT discussion.</p>
<p>Note that he's also got an e-ink project running, <a href="https://eugeniopace.org/arduino/epaper/eink/stoicism/2020/01/18/A-Display-of-Stoic-Quotes-using-Arduino-and-e-Paper-Display.html">here</a>.</p>
<p>Getting sleepy dog to work, <a href="https://github.com/adafruit/Adafruit_SleepyDog/issues/9">here</a>.</p>
<p>Another blog post on it <a href="https://bitknitting.wordpress.com/2016/08/02/backyard-automatic-watering-using-a-featherarduino/">here</a>.</p>
<h3>AVR Watchdog timers</h3>
<p>Another article on the watchdog timer for AVRs is <a href="https://create.arduino.cc/projecthub/rafitc/what-is-watchdog-timer-fffe20">here</a>.</p>
<p>And yet another nice article for WDTs in AVRs is <a href="https://circuits4you.com/2018/01/24/tutorial-on-arduino-watchdog-timer-setup/">here</a>.</p>
<p>Good point made in <a href="https://www.instructables.com/The-Arduino-Hang-Guardian-Arduino-Watchdog-Timer-T/">this tutorial</a>:</p>
<blockquote>
<p>One possible issue with the watchdog timer, depending on the bootloader of your Arduino is that if the watchdog timer value is too low and the bootloader does not reset the timer when uploading new code, you may end up damaging your Arduino board in a way that it will always be stuck in the boot phase. The bootloader will try to start, but the timer will keep resetting the board, never allowing it to properly start. To prevent issues like this, make sure to always use threshold intervals of 2 seconds or more.</p>
</blockquote>
<p>Another good description by Electronic Wings, <a href="https://www.electronicwings.com/arduino/watchdog-in-arduino">here</a>.</p>
<h3>Powerdown Sleep</h3>
<p>Nice post from Tony D, <a href="https://learn.adafruit.com/low-power-wifi-datalogging/power-down-sleep">here</a>.</p>
<h3>ArduBadge system for Arduino libraries</h3>
<p>Check out some of the libraries <a href="https://www.ardu-badge.com/">here</a>.</p>
<h3>Overview of system architecture</h3>
<ul>
<li>Remote</li>
<li>Gateway</li>
<li>Server</li>
</ul>
<h3>Remote access to Pis</h3>
<ul>
<li>TeamViewer</li>
<li>RealVNC</li>
<li>UV4L.  Discussion <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=177028#p1128706">here</a>.  RPI videoconference setup <a href="https://www.linux-projects.org/download/rpi-videoconference-os-image/">here</a>.</li>
</ul>
<p>Indeed, this looks like cool software -- browser-based.  Check it <a href="https://www.linux-projects.org/uv4l/tutorials/rpi-webapp-screen-audio-keyboard-sharing/">here</a>.</p>
<p>Ah, a better, RPi-specific set of options is <a href="https://raspberrytips.com/remote-desktop-raspberry-pi/">here</a>.</p>
<p>Jim Spark's guide to port forwarding / SSH with Pis  <a href="https://medium.com/@jimip6c12/raspberry-pi-dummy-tutorial-on-port-forwarding-and-ssh-to-pi-remotely-d4fbc2ed3bdf">here</a>.</p>
<p>He says it's very dangerous to do; and that cloud proxy is better. His guide <a href="https://medium.com/@jimip6c12/raspberry-pi-tutorial-on-the-most-secure-way-to-connect-to-your-pi-cloud-proxy-server-11867ddaac95">here</a>.</p>
<p>pre-burning an image on the pi from remote.it, <a href="https://remote.it/blog/how-to-use-a-raspberry-pi-to-remotely-access-your-office-network/">here</a>.</p>
<h4>Copy-paste in RealVNC</h4>
<p>Descriptive link is <a href="https://help.realvnc.com/hc/en-us/articles/360002253738-Copying-and-Pasting-Text">here</a>.</p>
<h3>Remote Access via hyperssh</h3>
<p>Diff of dwblair's hyperssh and mafintosh's versions, <a href="https://github.com/mafintosh/hyperssh/compare/master...dwblair:master">here</a>.</p>
<hr>
<p>2020 NOV 23</p>
<p>REV_A of the 'greenhouse' system uses the following code:</p>
<ul>
<li>remote: featherm0_am2315_lora_sleep</li>
<li>gateway: heltec_wifi_lora_bayou_farmos</li>
</ul>
<p>Going to try a watchdog timer on the feather ...</p>
<p>Implemented very basic watchdog <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/REV_A/remote/feather_firmware/featherm0_am2315_lora_watchdog">here</a>.</p>
<p><img src="/img/valedalama/watchdog_attempt.png" alt=""></p>
<p>Data <a href="http://159.65.226.222:3000/drives/3a28c09fa93ccf15513a055984148b02b0709f545c12013aaf25252f73626f62">here</a>.</p>
<hr>
<p>2020-11-26 20:33:48</p>
<h3>Design notes</h3>
<p>Interesting Things Network post on a BME280 outdoor LoRa node, <a href="https://www.thethingsnetwork.org/forum/t/lora-bme280-environmental-node-with-webbased-backend/9264">here</a>.</p>
<p>Relies on a really low power LoRa node design based on an Atmel 328p -- elegant! -- <a href="https://www.thethingsnetwork.org/forum/t/full-arduino-mini-lorawan-below-1ua-sleep-mode/8059">here</a></p>
<p>Nice post on OLED sleep current, <a href="https://bitbanksoftware.blogspot.com/2019/06/how-much-current-do-oled-displays-use.html">here</a>.  Looks like the 128x65 display I favor uses around 25 uA when asleep.</p>
<p>A nice general review of OLEDs and various libraries and use-cases, <a href="https://bengoncalves.wordpress.com/2015/10/01/oled-display-and-arduino-with-power-save-mode/">here</a>.  Includes code for putting the OLED to sleep.</p>
<hr>
<h2>INTERIM TODO</h2>
<ul>
<li>Make a mill-able PCB design in Eagle CAD for Lucio to mill [X]</li>
<li>Make a manfuacture-able PCB design in KiCAD to send to that company in Germany</li>
<li>Review: contact of company in Germany</li>
<li>test timer chip with Heltec ESP32</li>
<li>figure out how to load code remotely to Feather and to ESP32 via Pi</li>
<li>set up data repository online</li>
<li>display sensor data on a map</li>
</ul>
<p>Need designs for:</p>
<ul>
<li>the remote node (Feather + sensors)</li>
<li>the gateway node (Heltec ESP32 + LoRa + timer chip + BME280)</li>
</ul>
<hr>
<p>2020-11-29 04:42:55</p>
<h1><a name="update_nov29"></a> Update NOV 29 2020</h1>
<p><strong>Current situation.</strong>  Adding the watchdog timer seems to have made the remote node more robust; it has been operating non-stop for several days now, plugged into the RAK Pi. We'd like to move to installing the device into the greenhouse.  Are there any things we ought to do first to improve the likelihood of success there?</p>
<p>There are two things we might consider doing immediately:</p>
<ol>
<li><strong>Reduce remote node power consumption.</strong> The remote node is currently broadcasting every 10 seconds or so, and sleeping in between.  This is far more data than is useful, and will unnecessarily drain the battery.  We should change this to an interval of about 10 minutes or so.</li>
<li><strong>Add remote node battery measurement</strong>.  It would be helpful to add remote battery level measurement to the remote node, so we can better assess the solar charging statistics.  Note: doing so would require re-programming the gateway, as well, to accommodate the additional parameter.</li>
</ol>
<p><strong>Discussion</strong>.  (1) Above (increasing the sleep time between measurements / broadcasts) is an quick fix, which can be accomplished with the Feather plugged into the RAK, and the process has been done before, and recently.  The process for (2) should be straightforward, but hasn't been done before via the RAK.  It could require some fiddling, iterating, back-and-forth, and risks 'breaking' the system until the Arduino IDE is used; and we currently don't have an on-site way of using the Arduino IDE to reprogram the ESP32 (ran into security issues installing ESP32 on Walt's computer).</p>
<p><strong>Recommendation</strong>.  In following Lucio's philosophy of making minimal changes in-place to a system that is mostly working, my recommendatoin at this point would be: let's do (1) above (increase the sleep time), and wait on (2) (adding battery level). While it would be nice to measure battery level, adding the feature increases the risk that we'll have a somewhat 'bricked' system for a bit, and it seems that there's a fairly high chance of success if we can sleep the node for 10 minutes (and higher still if we can sleep longer, as we'd be even less likely to run the battery down).  In the meantime, I can work on workflow / testing for (2).</p>
<p><strong>Proposed next steps</strong>.</p>
<ul>
<li>On 30 NOV or so, I will test a procedure for accomplishing (1) above -- increasing the remote node sleep time -- locally here in the US, attempting to increase the sleep time on the remote node to approx. 10 minutes.</li>
<li>If the code works, we can upload it to the remote node (via the RAK). This will require putting the remote node / Feather in 'bootloader' mode -- i.e. a 'double tap' on the RESET button, resulting in a pulsing red LED.  I will attempt to upload the new code remotely. We can then test this overnight, making sure that the remote node sends data every 10 minutes.</li>
<li>If that works, we can then move the remote node to the greenhouse.</li>
</ul>
<p>Meanwhile, I will test locally the procedure for accomplishing (2) above -- adding battery level monitoring to the remote node.</p>
<hr>
<p>2020-11-30 08:57:54</p>
<h3>Watchdog Sleep</h3>
<p>Use Moteino M0 sleep code as a reference, <a href="https://lowpowerlab.com/guide/moteino/moteinom0/">here</a>.</p>
<p>Test feed <a href="http://159.65.226.222:3000/api/drives/0b15fcbcc3a7332e3bb061a7739398ffb2322f7feb9556bcc63e1879f0750ad7/csv">here</a></p>
<p>Alright, looking for every 5 min, after 1606774953 ...</p>
<p>Checking:</p>
<ul>
<li>initial: 1606774953 -- Monday, November 30, 2020 5:22:33 PM</li>
<li>next: 1606775266 -- Monday, November 30, 2020 5:27:46 PM</li>
</ul>
<p>Works!  When get home will try for 10 minute intervals, and test the power consumption ...</p>
<hr>
<p>2020-12-01 07:36:47</p>
<p>Update on code ...</p>
<p>timestamp difference:</p>
<ul>
<li>initial: 1606821668 -- Tuesday, December 1, 2020 6:21:08 AM</li>
<li>final: 1606822287 -- Tuesday, December 1, 2020 6:31:27 AM</li>
</ul>
<p>10 minute intervals!</p>
<p>Working code is part of &quot;REV_A&quot; greenhouse suite, <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/REV_A/remote/feather_firmware/30_NOV/featherm0_am2315_lora_watchdog_sleep">here</a>.</p>
<p>Also have improved REV_A gateway code that displays wifi status (sort of), <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/REV_A/gateway/heltec_wifi_lora_bayou_farmos_monitorwifi">here</a>.</p>
<hr>
<p>2020-12-01 13:37:55</p>
<p>Note -- hadn't fully implemented the watchdog timer in previous REV_A version; and now we send a sensor reading on startup, which is easier for debugging -- latest version (ready for testing) <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/REV_A/remote/feather_firmware/30_NOV/featherm0_am2315_lora_watchdog_sleep_countup">here</a></p>
<hr>
<p>2020-12-15 08:45:07</p>
<p><img src="/img/valedalama/connected.png" alt=""></p>
<p>Next steps:</p>
<ul>
<li>status of Feather code w/ watchdog and sleep?</li>
<li>possible to reprogram the gateway remotely?  test locally first ...</li>
<li>reconfigure the default Bayou graphing view so that appropriate for 10 min intervals, in anticipation of switching to 10 min from 10 sec intervals</li>
<li>download and save historical CSV data as backup beforehand</li>
</ul>
<p>Note: device is called walt-rak ... can connect via VNC viewer in Downloads ...</p>
<hr>
<p>2020-12-15 12:25:29</p>
<h3>Programming heltec from command line</h3>
<p>Guide <a href="https://medium.com/jungletronics/esp-idf-programming-guide-wifi-lora-32-v2-53f89e12c96e">here</a></p>
<p>Code is <a href="https://github.com/edgecollective/vale-gateway/tree/main/rev_c/heltec_wifi_lora_bayou_testdata_vale/bin">here</a></p>
<p><img src="/img/valedalama/remote_1.png" alt=""></p>
<p><img src="/img/valedalama/remote_2.png" alt=""></p>
<hr>
<p>2020-12-17 09:45:17</p>
<p>looks like the p2p2-farm server code requires that hop&gt;=1 in 'get-drives-data.js'</p>
<p>this is now in 'fixhop' branch</p>
<p>remote code sleeps at 0.15 mA</p>
<p>latest remote node code is <a href="https://github.com/edgecollective/vale-gateway/tree/main/rev_c/remote_node/featherm0_am2315_lora_watchdog_sleep_countup">here</a> -- sleeps at 0.15mA, uses watchdog timer.</p>
<p>latest gateway code is <a href="https://github.com/edgecollective/vale-gateway/tree/main/rev_c/heltec_wifi_lora_bayou_farmos">here</a>.</p>
<p>next steps:</p>
<ul>
<li>generate binary file for heltec using local wifi, test.</li>
<li>generate binary file for heltec using vale wifi. load remotely.</li>
<li>generate binary file for feather.  load remotely.</li>
</ul>
<p>first: testing that code works at 10 min interval.</p>
<p>command to load onto feather was: ./bossac -p /dev/ttyACM0 -e -w -v -R ./remote_watch_sleep_10min.ino.bin</p>
<p>bayou feed is located <a href="http://159.65.226.222:3000/drives/b02f7797b045956e79c019f889dfb080cadbfda6b468a9505835a82aadd5762c">here</a></p>
<hr>
<p>2020-12-17 15:23:43</p>
<p><img src="/img/valedalama/greenhouse_v_0.2.png" alt=""></p>
<hr>
<p>2020-12-23 08:17:40</p>
<p>Test of the battery level over a few days ...</p>
<p><img src="/img/valedalama/sunny_days.png" alt=""></p>
<hr>
<p>2021-01-01 17:48:29</p>
<p>Battery level seems to be holding steady!</p>
<p>Feed <a href="http://159.65.226.222:3000/drives/b02f7797b045956e79c019f889dfb080cadbfda6b468a9505835a82aadd5762c">here</a>:</p>
<p><img src="/img/valedalama/batt_jan2021.png" alt=""></p>
<hr>
<p>2021-01-08 08:59:07</p>
<p>Batt level continues to hold ... feed <a href="http://159.65.226.222:3000/drives/b02f7797b045956e79c019f889dfb080cadbfda6b468a9505835a82aadd5762c">here</a></p>
<p><img src="/img/valedalama/vale_batt_jan8.png" alt=""></p>
<hr>
<p>2021-01-21 21:06:53</p>
<p>Still going strong! feed <a href="http://159.65.226.222:3000/drives/b02f7797b045956e79c019f889dfb080cadbfda6b468a9505835a82aadd5762c">http://159.65.226.222:3000/drives/b02f7797b045956e79c019f889dfb080cadbfda6b468a9505835a82aadd5762c</a></p>
<p><img src="/img/valedalama/longrunning.png" alt=""></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><hr>
<h2>Hyperssh</h2>
<p>The following is all based on the excellent <a href="https://github.com/mafintosh/hyperssh">hyperssh</a> NodeJs package by @mafintosh.</p>
<h3>Installing hyperssh on Ubuntu 18.04</h3>
<ol>
<li>First install openssh-server if not present:</li>
</ol>
<blockquote>
<p><code>sudo apt-get install openssh-server</code></p>
</blockquote>
<ol start="2">
<li>Grab the hyperssh repo:</li>
</ol>
<blockquote>
<p><code>git clone https://github.com/mafintosh/hyperssh.git</code></p>
</blockquote>
<ol start="3">
<li>Enter the hyperssh directory; then install it:</li>
</ol>
<blockquote>
<p><code>cd hyperssh</code></p>
</blockquote>
<blockquote>
<p><code>npm install</code></p>
</blockquote>
<ol start="4">
<li>Create symbolic links for nicer command-line usage:</li>
</ol>
<blockquote>
<p><code>npm link</code></p>
</blockquote>
<h3>Using hyperssh</h3>
<p>(Copied from the <a href="https://github.com/mafintosh/hyperssh">Hyperssh README</a>)</p>
<p>On a server or some laptop with ssh-server running run</p>
<pre><code class="language-sh">hyperssh-server
</code></pre>
<p>This will print out the ssh fingerprint and start announcing the server
on the Hyperswarm network under this fingerprint.</p>
<p>To connect to the server on another computer simply pass in the fingerprint
and the user you want to connect as to hyperssh</p>
<pre><code class="language-sh">hyperssh ssh-ed25519 AAAA.... maf
</code></pre>
<hr>
<h2>Misc. Hyper resources &amp; tools</h2>
<p><a href="https://github.com/noffle/hypergit">Hyper-git</a></p>
<p><a href="https://github.com/joehand/hypersshuttle">hyper sshuttle</a></p>
<p><a href="https://github.com/mafintosh/hyperssh">hyper ssh</a></p>
<p><a href="https://github.com/noffle/airpipe">airpipe</a></p>
<p><a href="https://blog.hypercore-protocol.org/posts/hyperspace/">Hyperspace</a></p>
<p><a href="https://twitter.com/feross/status/1305612758667259904?s=20">Talk about Hyperbee</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>TODO</h2>
<ul>
<li>use python feedgen script to print out list of podcasts locally, and descriptions, to test the code.</li>
</ul>
<h2>Misc notes</h2>
<p><a href="https://github.com/yaml/pyyaml">yaml generator in python</a></p>
<p><a href="http://zetcode.com/python/yaml/">pyyaml tutorial</a></p>
<p><a href="https://github.com/lkiesow/python-feedgen">python feedgen</a></p>
<p><a href="https://feedgen.kiesow.be/api.html">python feedgen documentation</a></p>
<p><a href="https://www.programcreek.com/python/example/113191/feedgen.feed.FeedGenerator">python feedgen examples</a></p>
<p><a href="https://feedgen.kiesow.be/ext/api.ext.podcast.html">python feedgen podcast module</a></p>
<p><a href="https://podgen.readthedocs.io/en/latest/usage_guide/example.html">podgen</a></p>
<p>List of itunes podcast categories <a href="https://www.podcastinsights.com/itunes-podcast-categories/">here</a></p>
<h2>Work Log</h2>
<hr>
<p>18 OCT 2020</p>
<p>add episodes to the 'episodes' folder in YAML format</p>
<p>use './gen_podcast_feed.sh' to generate the feed, which is called 'podcast.xml'</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Misc notes</h2>
<ul>
<li>Ned's <a href="https://github.com/nedhorning/terrapinServer">terrapinServer</a> code for a NodeJS + MongoDB server</li>
<li>EC's <a href="https://github.com/edgecollective/terrapinServer">fork</a> of that code</li>
<li><a href="https://github.com/nedhorning/TerrapinTracker/blob/master/Software/ServerAndDatabase/SetupFreeInternetServerAndDatabaseForTrackerData.md">Instructions</a> for installation</li>
</ul>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h2>Misc notes</h2>
<h3>HID micro code</h3>
<p>Very easy example for keyboard and mouse that works with a Feather M0, no special libraries needed, <a href="https://www.arduino.cc/en/Tutorial/BuiltInExamples/KeyboardAndMouseControl">here</a>.</p>
<h3>HTTP POST requests in browser</h3>
<p>HTTP POST in javascript guide <a href="https://www.freecodecamp.org/news/here-is-the-most-popular-ways-to-make-an-http-request-in-javascript-954ce8c95aaa/">here</a>.</p>
<p>Another nice tutorial <a href="https://www.kirupa.com/html5/making_http_requests_js.htm">here</a></p>
<p>A tutorial on fetch in particular is <a href="https://stackabuse.com/using-fetch-to-send-http-requests-in-javascript/">here</a></p>
<h2>Browser listening to keyboard presses</h2>
<p>jquery approach <a href="https://stackoverflow.com/questions/7600892/respond-to-key-press-javascript">here</a></p>
<p>more elaborate description <a href="https://www.cryer.co.uk/resources/javascript/script20_respond_to_keypress.htm">here</a></p>
<p>cross-browser support <a href="https://medium.com/@uistephen/keyboardevent-key-for-cross-browser-key-press-check-61dbad0a067a">here</a></p>
<h2>Android listening to keyboard presses</h2>
<p>Suggestion of using Accessibility Services, <a href="https://stackoverflow.com/questions/2986337/is-it-possible-to-create-an-android-service-that-listens-for-hardware-key-presse">here</a></p>
<h2>Work Log</h2>
<hr>
<p>18 OCT 2020</p>
<p>Working example <a href="https://github.com/edgecollective/micro-hid">here</a> -- presses the 'u' key on a button press.</p>
<p>Working example for multiple buttons <a href="https://github.com/edgecollective/micro-hid/tree/main/key_multi">here</a>.  Video demo <a href="https://www.youtube.com/watch?v=x7i3M5QsfW0">here</a>.  Or click below:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/x7i3M5QsfW0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>Repo is <a href="https://gitlab.com/dwblair/p2p-farm-server">here</a>.</p>
<p>A useful associted 'PUT' script is <a href="https://gist.github.com/dwblair/4cfbcc993fafcd4d984058ae730ee342">here</a></p>
<h2>ESP32 --&gt; Server</h2>
<p>Adding headers to esp32 explanation <a href="https://techtutorialsx.com/2018/01/03/esp32-arduino-basic-authentication/">here</a></p>
<p>Making a PUT request <a href="https://techtutorialsx.com/2019/01/07/esp32-arduino-http-put-request/">here</a>.</p>
<p>Using ArduinoJSON with HTTPClient <a href="https://arduinojson.org/v6/how-to/use-arduinojson-with-httpclient/">here</a>.</p>
<p>Creating nested json objects in ArduinoJSON <a href="https://arduinojson.org/v5/faq/how-to-create-complex-nested-objects/">here</a>.</p>
<h2>Work Log</h2>
<hr>
<p>21 OCT 2020</p>
<p>Fixed sqlite3 missing module.</p>
<p>Got an ESP32 to post data via JSON, <a href="https://github.com/edgecollective/esp32-p2p-farm/tree/main/test_put_json">here</a>.</p>
<hr>
<p>23 OCT 2020</p>
<p>Trying to use <a href="https://github.com/fastify/fastify-basic-auth">this fastify basic auth module</a> as part of the codebase.</p>
<p>... implemented!</p>
<hr>
<p>24 OCT 2020</p>
<p>Some next steps:</p>
<ul>
<li>Make a video explanation of the idea.</li>
<li>Work out the storage math, and the economics of storage space.</li>
<li>This might provide a motivation for using the hyper protocol!</li>
<li>Put demo code on the site for using Python, and ESP32, CircuitPy, curl to upload data.</li>
<li>Put it at EC subdomain, or something separate.</li>
<li>Add CSV export</li>
<li>Add JSON export (already there mostly)</li>
<li>Add simple graphing</li>
<li>Add simple metrics (size of file, timespan of datafile, num datapoints)</li>
<li>Add human-readable timestamp (at least e.g. in CSV export)</li>
</ul>
<hr>
<p>25 OCT 2020</p>
<p>Making a python PUT script.</p>
<p>Reference on python requests <a href="https://requests.readthedocs.io/en/master/user/authentication/">here</a>.</p>
<p>Setting the authorization header in curl <a href="https://stackoverflow.com/questions/3044315/how-to-set-the-authorization-header-using-curl">here</a>.</p>
<p>Issue: when using basic auth in current basicAuth branch, it is putting the username password authentication method on top of <em>every</em> request -- need to do it just for the home page.</p>
<p>Guide to using basic auth <a href="https://github.com/fastify/fastify-basic-auth">here</a>.</p>
<p>Combining fastify static with fastify basic auth <a href="https://github.com/fastify/help/issues/190">here</a>.</p>
<p>Using multiple authentication options with fastify <a href="https://github.com/fastify/fastify-auth#usage">here</a></p>
<p>addhook onresponse by route <a href="https://github.com/fastify/fastify/issues/1828">here</a></p>
<p>fastify and mongodb <a href="https://www.fastify.io/docs/v3.4.x/Getting-Started/">here</a></p>
<p>Might just need to find a way to serve up web page from directly in fastify, using basicAuthFix branch</p>
<p>Nice <a href="https://www.fastify.io/docs/v3.4.x/Getting-Started/">getting started with fastify</a> document.</p>
<p>Currently the action is in 'main.js' ...</p>
<p>Looks like there is a way to addHook to specific routes <a href="https://github.com/fastify/fastify/blob/master/docs/Hooks.md#onroute">here</a></p>
<p>latest idea:  keep basicAuth branch as-is, but use multiple authentication methods in 'PUT' script</p>
<p>'ctrl shift i' will insert timestamp in VS Code given installation of an extension <a href="https://stackoverflow.com/questions/38780057/how-to-insert-current-date-time-in-vscode#:~:text=To%20insert%20current%20date%20and,Insert%20DateTime%20then%20press%20Enter%20.&amp;text=By%20default%20you%20don't%20have%20to%20set%20anything.">here</a></p>
<p>Adding multiple authorization headers via postman <a href="https://stackoverflow.com/questions/29282578/multiple-http-authorization-headers">here</a></p>
<p>Combining multiple authorizations via curl <a href="https://stackoverflow.com/questions/22229996/basic-http-and-bearer-token-authentication">here</a></p>
<p>Setting multiple headers in curl -- useful! -- <a href="https://www.shellhacks.com/curl-add-header-multiple-headers-authorization/">here</a></p>
<p>issues:</p>
<ol>
<li>can't use multiple authorization schemes, in particular not if one of them is Basic Auth</li>
<li>not sure how to combine basic auth with fastify-static</li>
</ol>
<p>interesting angle mentioned in <a href="https://stackoverflow.com/questions/64201513/transform-response-of-fastify-static-served-files">&quot;Transform response of fastify-static served files&quot;</a>, which led to fastify <a href="https://github.com/fastify/point-of-view">point-of-view templates idea</a>.</p>
<p>Ah -- I think I've got it working with the basicAuth branch, now!</p>
<hr>
<p>2020-11-29 08:51:40</p>
<p>Adding authentication to NodeJS, <a href="https://www.youtube.com/watch?v=Ud5xKCYQTjM">here</a></p>
<p>Using Auth0 and Fastify <a href="https://medium.com/better-programming/how-to-add-authentication-to-your-fastify-rest-api-using-auth0-cddc7eacc90">here</a> -- ah, blocked --</p>
<p>But there's a repo, <a href="https://github.com/nearform/fastify-auth0-verify">here</a>.</p>
<hr>
<p>2020-11-29 16:43:16</p>
<p><a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">Jupyter dashboard</a> via voila -- <a href="https://blog.jupyter.org/a-gallery-of-voil%C3%A0-examples-a2ce7ef99130">gallery of examples</a></p>
<p>gesis notebooks, <a href="https://notebooks.gesis.org/">here</a></p>
<p>guide to voila, <a href="https://analyticsindiamag.com/complete-guide-to-voila-to-turn-a-jupyter-notebook-into-a-standalone-web-application/">here</a></p>
<p>Dashboarding options in Jupyter discussed <a href="https://medium.com/informatics-lab/jupyter-dashboarding-some-thoughts-on-voila-panel-and-dash-b84df9c9482f">here</a></p>
<p>User authentication with nodejs and passport <a href="https://www.freecodecamp.org/news/learn-how-to-handle-authentication-with-node-using-passport-js-4a56ed18e81e/">here</a></p>
<p>Rolling your own authentication, <a href="https://developer.okta.com/blog/2019/10/03/painless-node-authentication">here</a>.</p>
<p>React and Auth0 ...</p>
<ul>
<li><a href="https://www.smashingmagazine.com/2020/11/authenticating-react-apps-auth0/">Third party guide here</a>
and</li>
<li><a href="https://auth0.com/blog/complete-guide-to-react-user-authentication/">Auth0 guide here</a></li>
</ul>
<hr>
<p>2020-12-05 14:21:37</p>
<h2>Node + Express + Postgresql</h2>
<p><a href="https://blog.logrocket.com/getting-started-with-postgres-in-your-react-app/">react + node + express + postgresql</a> -- short tutorial</p>
<p><a href="https://bezkoder.com/react-node-express-postgresql/">react + node + express + postgresql</a> -- thorough tutorial</p>
<p><a href="https://expressjs.com/en/guide/database-integration.html#postgresql">express + postgresql</a> -- from node guide</p>
<p><a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">Creating a web application in your home with a Raspberry Pi, Express and PostgreSQL</a> -- this looks like a great place to begin!</p>
<p><a href="https://medium.com/@timtamimi/getting-started-with-authentication-in-node-js-with-passport-and-postgresql-2219664b568c">Getting started with authentication in Node.js with Passport and PostgresQL</a></p>
<p><a href="https://sequelize.org/">Sequelize</a> -- JSON that creates a database table</p>
<p><a href="https://stackoverflow.com/questions/43436755/best-way-to-save-data-that-keeps-coming-every-1-second-to-postgres-using-node-js">suggestion to use multi-row inserts to save time</a></p>
<p><a href="https://mherman.org/blog/designing-a-restful-api-with-node-and-postgres/">designing a restful api with node and postgres</a></p>
<p><a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">ahhh -- part of a great series that seems to do all the things!  including graphing!</a> -- the series is <a href="https://rike.dev/2019/02/11/smart-home-setup-to-track-indoor-temperatures-and-humidity-with-sensors-raspberry-pi-mqtt-node-js-vue-js-and-chart-js">here</a></p>
<p><a href="https://www.mathworks.com/help/thingspeak/choose-between-rest-and-mqtt.html#:~:text=REST%20is%20a%20representational%20state,can%20be%20secured%20with%20SSL.">using mqtt vs REST</a></p>
<hr>
<p>2020-12-05 20:47:42</p>
<p>following tutorial <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a>, putting in Documents/able</p>
<blockquote>
<p>sudo apt-get install postgresql</p>
</blockquote>
<p>psuser
psps</p>
<blockquote>
<p>sensor2=# INSERT INTO users (username, password) VALUES ('user1', 'bubbles');</p>
</blockquote>
<blockquote>
<p>INSERT INTO sensors (name) values ('NodeMCU  ESP32');</p>
</blockquote>
<hr>
<p>2020-12-15 08:53:18</p>
<p><a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">Building a simple API with Nodejs, Expressjs, PostgreSQL DB, and JWT - 3</a></p>
<p><a href="https://blog.logrocket.com/setting-up-a-restful-api-with-node-js-and-postgresql-d96d6fc892d8/">node + postgresql -- nice tutorial</a></p>
<p><a href="https://itnext.io/building-restful-api-with-node-js-express-js-and-postgresql-the-right-way-b2e718ad1c66">node + postgresql + jwt</a></p>
<hr>
<p>2020-12-15 15:12:26</p>
<p>Begin here:</p>
<ul>
<li><a href="https://bezkoder.com/node-express-sequelize-postgresql/">CRUD</a></li>
</ul>
<p>then add security here:</p>
<ul>
<li><a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">adding jwt</a></li>
</ul>
<p>Update: actually, begin with second tutorial ...</p>
<p>Installing postgresql on ubuntu <a href="https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart">here</a></p>
<p>React + node + express + mongo w/ login page <a href="https://bezkoder.com/react-node-mongodb-auth/">here</a></p>
<hr>
<p>2020-12-15 15:53:43</p>
<p>Okay, here's the real deal:</p>
<p><a href="https://bezkoder.com/node-express-sequelize-postgresql/">Node.js Express &amp; PostgreSQL: CRUD Rest APIs example with Sequelize</a></p>
<p>Prior exapmel:</p>
<p>node, express, postgresql using sequelize <a href="https://medium.com/codingtown/node-express-and-postgresql-using-sequelize-in-ubuntu-18-04-3-lts-bc8d2cde3796">here</a></p>
<p>Wow, really simple example <a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">here</a></p>
<p>postgres and ubuntu tutorial <a href="https://itsfoss.com/install-postgresql-ubuntu/">here</a></p>
<hr>
<p>2020-12-15 17:12:48</p>
<p>nodejs express mongodb jwt <a href="https://www.npmjs.com/package/node-express-mongodb-jwt-rest-api-skeleton">here</a></p>
<hr>
<p>2020-12-16 11:26:24</p>
<p>as another approach w/ node + postgres, trying out <a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">this tutorial</a></p>
<p>Nice intro tutorial on nodejs and postgres <a href="https://stackabuse.com/using-postgresql-with-nodejs-and-node-postgres/">here</a></p>
<p>try out the github code <a href="https://github.com/jkasun/sa-node-postgres">here</a></p>
<p>worked.</p>
<p>New homework!  This is the thing to try:</p>
<p>&quot;creating a web application in your home using nodes, rpi, express, postgresql&quot; -- <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<p>NOTE:  'createdb -0 username dbname' should have -O instead of -0</p>
<p>Associated github repo is <a href="https://github.com/RhettTrickett/habitat">here</a></p>
<p>Grand. And then can add users / JWT with something like <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">this post</a></p>
<p>The first post for that series is <a href="https://www.codementor.io/@olawalealadeusi896/building-simple-api-with-es6-krn8xx3k6">here</a></p>
<p>Full code for the latter is <a href="https://github.com/olawalejarvis/reflection_app_server">here</a></p>
<p>And perhaps this shows how to combine the above with a front end -- <a href="https://bezkoder.com/react-express-authentication-jwt/">here</a></p>
<h3>Good example!</h3>
<p>The following pairing of backend and frontend seems to work as a baseline structure. Running both, they even find one another on the proper ports.</p>
<h4>Backend w/ node + express + postgresql + JWT</h4>
<p>Tutorial <a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">here</a> with associated code on github <a href="https://github.com/bezkoder/node-js-jwt-authentication-postgresql">here</a></p>
<h4>Frontend</h4>
<p>React front end <a href="https://bezkoder.com/react-jwt-auth/">here</a>, with github repo <a href="https://github.com/bezkoder/react-jwt-auth">here</a></p>
<h2>Node + Express + Postgres + Sequelize</h2>
<p>Tutorial <a href="https://www.robinwieruch.de/postgres-express-setup-tutorial">here</a>.  Nice explanation.</p>
<p>Another nice tutorial <a href="https://www.djamware.com/post/5b56a6cc80aca707dd4f65a9/nodejs-expressjs-sequelizejs-and-postgresql-restful-api">here</a>, with associated code on github <a href="https://github.com/didinj/node-express-postgresql-sequelize.git">here</a></p>
<p>Ahhhh, really nice tutorial on using sequelize, <a href="https://blog.echobind.com/a-guide-for-restful-apis-with-node-sequelize-postgres-63636d026d5d">here</a></p>
<hr>
<p>2020-12-16 13:31:56</p>
<p>using quasar, vue, and chartjs <a href="https://rike.dev/2019/02/11/display-smart-home-data-in-a-quasar-vue-js-and-chart-js-powered-web-application">here</a></p>
<hr>
<h2>Key links</h2>
<p>https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize#toc-sequelize-setup</p>
<p>https://bezkoder.com/node-js-jwt-authentication-postgresql/</p>
<p>https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-and-postgresql-db-masuu56t7</p>
<hr>
<p>2020-12-17 08:04:23</p>
<p>arg for postgresql for iot <a href="https://blog.timescale.com/blog/choose-postgresql-for-iot-19688efc60ca/">here</a></p>
<hr>
<h3>(HICCUP IN NOTES FLOW)</h3>
<hr>
<p>2020-12-15 17:31:58</p>
<p><a href="https://www.digitaljunky.io/make-your-own-data-platform-for-the-internet-of-things-using-node-js-and-express-js/">make your own iot data platform</a></p>
<p>mern stack <a href="https://www.digitalocean.com/community/tutorials/getting-started-with-the-mern-stack">here</a></p>
<p>mean stack jwt <a href="https://www.youtube.com/watch?v=T8qepiTbJi4">here</a></p>
<p>MERN full stack <a href="https://github.com/praveenscience/JWT-MERN-FullStack">here</a></p>
<p>ooooooh this is good MERN! <a href="https://github.com/praveenscience/JWT-MERN-FullStack">here</a></p>
<p>another good example <a href="https://github.com/vishalnagda1/mern-jwt-auth">here</a></p>
<p>this worked!</p>
<p>https://github.com/vishalnagda1/mern-jwt-auth</p>
<p>broader tutorial on MERN <a href="https://codingthesmartway.com/the-mern-stack-tutorial-building-a-react-crud-application-from-start-to-finish-part-1/">here</a></p>
<p>MERN CRUD app tutorial <a href="https://github.com/SinghDigamber/react-mernstack-crud">here</a></p>
<p>this looks like a nice example, using postgres -- <a href="https://github.com/adrach/starter-postgres-express-react">here</a></p>
<hr>
<p>MERN:</p>
<p>okay so this tutorial lets you create student records and view them -- <a href="https://github.com/SinghDigamber/react-mernstack-crud">here</a></p>
<p>whereas <a href="https://github.com/vishalnagda1/mern-jwt-auth">this tutorial</a> does user login stuff.</p>
<hr>
<p>2020-12-15 20:59:54</p>
<p>this pair of server (node + mongo + jwt) + client (angular) worked:</p>
<ul>
<li>server <a href="https://jasonwatmore.com/post/2020/06/17/nodejs-mongodb-api-jwt-authentication-with-refresh-tokens">tutorial</a> and <a href="https://github.com/cornflourblue/node-mongo-jwt-refresh-tokens-api">code</a></li>
<li>client <a href="https://github.com/cornflourblue/angular-9-jwt-refresh-tokens">tutorial</a> and <a href="https://github.com/cornflourblue/angular-9-jwt-refresh-tokens">code</a></li>
</ul>
<p>reading about fastify <a href="https://medium.com/@tarusharora/how-to-build-a-node-js-api-with-fastify-mongodb-docker-and-postman-f1ffab912ece">here</a></p>
<hr>
<p>2020-12-16 09:25:10</p>
<p>this might be my starting place -- node express postgresql ubuntu <a href="https://medium.com/codingtown/node-express-and-postgresql-using-sequelize-in-ubuntu-18-04-3-lts-bc8d2cde3796">here</a></p>
<p>also see post <a href="https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize">here</a></p>
<p>doing this in ~/Documents/postgres-express-react-node-tutorial</p>
<p>notes on postgres and user auth <a href="https://stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist">here</a></p>
<p>used this technique to change postgres password to 'i8buddha':
linked <a href="https://serverfault.com/questions/110154/whats-the-default-superuser-username-password-for-postgres-after-a-new-install">here</a></p>
<p>sequelize import is not a function' -- https://stackoverflow.com/questions/62917111/sequelize-import-is-not-a-function</p>
<p>associated github repo is <a href="https://github.com/waiyaki/postgres-express-node-tutorial">here</a></p>
<hr>
<p>2020-12-16 10:16:16</p>
<p>In the end, a nice codebase for postgres express and node is <a href="https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize#toc-sequelize-setup">here</a>.  Note that this blog post is based on an earlier blog post by Michael Herman, <a href="https://mherman.org/blog/node-postgres-sequelize/">here</a>.</p>
<p>with the github repo <a href="https://github.com/waiyaki/postgres-express-node-tutorial">here</a></p>
<p>used this technique to change postgres password to 'i8buddha':
linked <a href="https://serverfault.com/questions/110154/whats-the-default-superuser-username-password-for-postgres-after-a-new-install">here</a></p>
<p>which needed to be changed in server/config/config.json as per:</p>
<p>{
&quot;development&quot;: {
&quot;username&quot;: &quot;postgres&quot;,
&quot;password&quot;: &quot;i8buddha&quot;,
&quot;database&quot;: &quot;todos-dev&quot;,
&quot;host&quot;: &quot;127.0.0.1&quot;,
&quot;port&quot;: 5432,
&quot;dialect&quot;: &quot;postgres&quot;
},
&quot;test&quot;: {
&quot;username&quot;: &quot;postgres&quot;,
&quot;password&quot;: &quot;i8buddha&quot;,
&quot;database&quot;: &quot;todos-test&quot;,
&quot;host&quot;: &quot;127.0.0.1&quot;,
&quot;port&quot;: 5432,
&quot;dialect&quot;: &quot;postgres&quot;
}
}</p>
<p>this was the only change needed in the github repo above.</p>
<p>clone, then install with npm install, and run with npm run start:dev</p>
<p>result: working todo api w/ sequelize.</p>
<hr>
<p>2020-12-16 11:26:24</p>
<p>as another approach w/ node + postgres, trying out <a href="https://rike.dev/2019/04/20/setup-postgresql-database-and-api-for-node-js">this tutorial</a></p>
<p>Nice intro tutorial on nodejs and postgres <a href="https://stackabuse.com/using-postgresql-with-nodejs-and-node-postgres/">here</a></p>
<p>try out the github code <a href="https://github.com/jkasun/sa-node-postgres">here</a></p>
<p>worked.</p>
<p>New homework!  This is the thing to try:</p>
<p>&quot;creating a web application in your home using nodes, rpi, express, postgresql&quot; -- <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<p>NOTE:  'createdb -0 username dbname' should have -O instead of -0</p>
<p>Associated github repo is <a href="https://github.com/RhettTrickett/habitat">here</a></p>
<p>Grand. And then can add users / JWT with something like <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">this post</a></p>
<p>The first post for that series is <a href="https://www.codementor.io/@olawalealadeusi896/building-simple-api-with-es6-krn8xx3k6">here</a></p>
<p>Full code for the latter is <a href="https://github.com/olawalejarvis/reflection_app_server">here</a></p>
<p>And perhaps this shows how to combine the above with a front end -- <a href="https://bezkoder.com/react-express-authentication-jwt/">here</a></p>
<h3>Good example!</h3>
<p>The following pairing of backend and frontend seems to work as a baseline structure. Running both, they even find one another on the proper ports.</p>
<h4>Backend w/ node + express + postgresql + JWT</h4>
<p>Tutorial <a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">here</a> with associated code on github <a href="https://github.com/bezkoder/node-js-jwt-authentication-postgresql">here</a></p>
<h4>Frontend</h4>
<p>React front end <a href="https://bezkoder.com/react-jwt-auth/">here</a>, with github repo <a href="https://github.com/bezkoder/react-jwt-auth">here</a></p>
<h2>Node + Express + Postgres + Sequelize</h2>
<p>Tutorial <a href="https://www.robinwieruch.de/postgres-express-setup-tutorial">here</a>.  Nice explanation.</p>
<p>Another nice tutorial <a href="https://www.djamware.com/post/5b56a6cc80aca707dd4f65a9/nodejs-expressjs-sequelizejs-and-postgresql-restful-api">here</a>, with associated code on github <a href="https://github.com/didinj/node-express-postgresql-sequelize.git">here</a></p>
<p>Ahhhh, really nice tutorial on using sequelize, <a href="https://blog.echobind.com/a-guide-for-restful-apis-with-node-sequelize-postgres-63636d026d5d">here</a></p>
<hr>
<p>2020-12-16 13:02:19</p>
<p>ingesting real time data w/ nodejs and timescale db <a href="https://stephanefrechette.dev/posts/ingest-real-time-streaming-data-for-time-series-analysis/">here</a></p>
<p>rike in berlin <a href="https://dev.to/frankanka">here</a></p>
<p>getting a csv download from nodejs <a href="https://dev.to/frankanka/get-a-csv-download-out-of-postgresql-or-lowdb-database-on-node-js-45k2">here</a></p>
<p>rike -- project -- maybe she'd help with corona -- <a href="https://rike.dev/">here</a></p>
<hr>
<p>multiple users and reflections <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-postgresql-db-and-jwt-3-mke10c5c5">here</a></p>
<p>this is a meaty post <a href="https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-and-postgresql-db-masuu56t7">here</a></p>
<h2>Key links</h2>
<p>https://scotch.io/tutorials/getting-started-with-node-express-and-postgres-using-sequelize#toc-sequelize-setup</p>
<p>https://bezkoder.com/node-js-jwt-authentication-postgresql/</p>
<p>https://www.codementor.io/@olawalealadeusi896/building-a-simple-api-with-nodejs-expressjs-and-postgresql-db-masuu56t7</p>
<p>this adds content to the node + express + postgres + sequelize <a href="https://bezkoder.com/node-express-sequelize-postgresql/">here</a> w/ associated github repo <a href="https://github.com/bezkoder/node-express-sequelize-postgresql">here</a></p>
<p>follow this first!<br>
and see if you can make it appropriate for sensors ...</p>
<p>and maybe if you can do a front end for it ...
looks like they do have a front end in React example at the end <a href="https://bezkoder.com/react-node-express-postgresql/">here</a> -- w/ associated github repo <a href="https://github.com/bezkoder/react-crud-web-api">here</a></p>
<p>NOTE: have changed default port to something other than 8080, should go back to that ...</p>
<p>so, plan of attack:</p>
<ol>
<li>return to that <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">.bio tutorial</a> on sensors, and see how they set up the tables.  use that as an inspiration for how to create the postgresql table structure.</li>
<li>figure out best next thing to implement above; 'todo' or 'tutorials' examples; with or without jwt</li>
<li>add jwt + users using the other tutorial.</li>
</ol>
<p>postgres tutorial <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04">here</a></p>
<pre><code>sudo -i -u postgres
</code></pre>
<p>psql</p>
<p>\q</p>
<hr>
<p>2020-12-16 21:08:14</p>
<p>next steps:</p>
<ul>
<li>try to 'sequelize' the .bio example above, in order to understand how sequelize works ...</li>
<li>send sensor data to it</li>
<li>build it out like the 'tutorials' codebase that was associated with a react frontend</li>
<li>find a way to add JWT</li>
</ul>
<p>latest running code experimented with was <a href="node-js-jwt-authentication-postgresql">here</a>.</p>
<p>going to experiment with the '.bio' code asap.</p>
<p><a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">.bio tutorial</a></p>
<p>creating new tables</p>
<p>CREATE TABLE users (
user_id SERIAL PRIMARY KEY,
username VARCHAR(50),
password VARCHAR(255),
is_admin BOOLEAN DEFAULT FALSE
);</p>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
private_key VARCHAR(255)
);</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
celcius FLOAT,
humidity FLOAT,
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);</p>
<p>INSERT INTO users (username, password) VALUES ('bob', 'jones');</p>
<p>INSERT INTO feeds (name) values ('NodeMCU  ESP32');</p>
<p>checking string status <a href="https://stackoverflow.com/questions/60117067/javascript-regex-how-to-check-if-a-string-only-contains-letters-numbers-dash">here</a></p>
<hr>
<p>2020-12-17 20:03:39</p>
<p>newfeed branch is <a href="https://github.com/edgecollective/habitat/pull/new/newfeed">here</a></p>
<p>going to try for csv next using tutorial <a href="https://dev.to/frankanka/get-a-csv-download-out-of-postgresql-or-lowdb-database-on-node-js-45k2">here</a></p>
<p>another tutorial on exporting csv w/ node and express <a href="https://kb.objectrocket.com/postgresql/postgresql-export-csv-with-node-959">here</a></p>
<p>nice bezcoder tutorial <a href="https://bezkoder.com/node-js-export-postgresql-csv-file/">here</a></p>
<hr>
<p>2020-12-17 22:09:41</p>
<p>'heltec' is the latest branch.  accepts data from a heltec; includes firmware.</p>
<p><img src="/img/alt_server/feed_data.png" alt=""></p>
<p>Server code is <a href="https://github.com/edgecollective/habitat/tree/heltec">here</a>; firmware is in 'firmware' directory.</p>
<hr>
<p>2020-12-18 16:23:00</p>
<p>ah, interesting code snippet:</p>
<p>// https://github.com/auth0/express-jwt
// Secure &quot;protected&quot; endpoints with JWT middleware
app.use('/protected', jwtMiddleware({
secret: SECRET_TOKEN, // Use the same token that we used to sign the JWT above
// Let's allow our clients to provide the token in a variety of ways
getToken: function (req) {
if (req.headers.authorization &amp;&amp; req.headers.authorization.split(' ')[0] === 'Bearer') { // Authorization: Bearer g1jipjgi1ifjioj
// Handle token presented as a Bearer token in the Authorization header
return req.headers.authorization.split(' ')[1];
} else if (req.query &amp;&amp; req.query.token) {
// Handle token presented as URI param
return req.query.token;
} else if (req.cookies &amp;&amp; req.cookies.token) {
// Handle token presented as a cookie parameter
return req.cookies.token;
}
// If we return null, we couldn't find a token.
// In this case, the JWT middleware will return a 401 (unauthorized) to the client for this request
return null;
}
}));</p>
<p>// A simple protected route for demo purposes
app.get('/protected/data', function (req, res) {
console.log(req.user); // =&gt; { _id: &lt;S</p>
<hr>
<p>2020-12-18 16:26:03</p>
<p><a href="https://www.toptal.com/nodejs/secure-rest-api-in-nodejs">Secure Rest api in nodejs</a></p>
<p><a href="https://stormpath.com/blog/express-sample-api-key-management">using OAuth</a></p>
<p><a href="https://github.com/arkerone/api-key-auth#readme">node api key</a></p>
<p>api keys <a href="https://dev.to/nagarjun/best-practices-to-generate-and-store-api-keys-using-nodejs-534d">here</a></p>
<p>nice tutorial on development of the stack <a href="https://www.robinwieruch.de/node-express-server-rest-api">here</a></p>
<p>very nice tutorial on postgres + express dev <a href="https://www.robinwieruch.de/postgres-express-setup-tutorial/">here</a></p>
<p>basic passport api key <a href="http://www.passportjs.org/packages/passport-headerapikey/">here</a></p>
<p>passport and nestjs integration <a href="https://medium.com/@Dee_Mayoor/apikey-authentication-for-nestjs-using-passport-js-6db467fc31f7">here</a></p>
<p>this looks like a good strategy <a href="https://blog.risingstack.com/node-hero-node-js-authentication-passport-js/">here</a></p>
<p>nice strategy for token authentication and whatnot <a href="https://gist.github.com/laurenfazah/f9343ae8577999d301334fc68179b485">here</a></p>
<p>--</p>
<p>bezcode node + postgresql + express + react <a href="https://bezkoder.com/node-js-jwt-authentication-postgresql/">here</a></p>
<hr>
<p>2020-12-19 11:35:42</p>
<p>inserting html form data into postgresql using nodejs <a href="https://stackoverflow.com/questions/63618597/insert-html-form-data-into-heroku-postgresql-database-using-node-js">here</a></p>
<hr>
<p>2021-01-08 15:34:05</p>
<p>capturing form data with nodejs and express <a href="https://stackoverflow.com/questions/15568851/node-js-how-to-send-data-from-html-to-express">here</a></p>
<p>working with forms in express <a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/forms">here</a></p>
<h2>Forms example #1</h2>
<p>even better version, with working code, <a href="https://www.sitepoint.com/forms-file-uploads-security-node-express/">here</a></p>
<p>github repo <a href="https://github.com/sitepoint-editors/node-forms">here</a></p>
<hr>
<p>2021-01-08 15:57:43</p>
<p>This is the code to use and modify for habitat, <a href="https://github.com/dwblair/node-forms/tree/finished">here</a>, when trying to get forms up and running.</p>
<p>Next step is to get habitat up and running -- the 'heltec' code -- which will likely require reconnecting / reconfiguring the postgres database ...</p>
<hr>
<p>2021-01-08 19:32:35</p>
<h2>Forms exmaple with SQLITE3</h2>
<p><img src="/img/alt-server/adding_a_feed.png" alt=""></p>
<p><a href="https://medium.com/swlh/read-html-form-data-using-get-and-post-method-in-node-js-8d2c7880adbf">Read HTML Form Data Using GET and POST Method in Node.js</a></p>
<p>forking their example <a href="https://github.com/dwblair/crudApp_htmlForm">here</a></p>
<p>issue with sqlite3 -- covered <a href="https://github.com/jansmolders86/mediacenterjs/issues/191">here</a></p>
<p>seems that <a href="https://github.com/jansmolders86/mediacenterjs/issues/191#issuecomment-202340822">this approach</a> worked, i.e.:</p>
<blockquote>
<p>npm install -g node-pre-gyp
npm install sqlite3 --save-dev</p>
</blockquote>
<hr>
<p>2021-01-09 16:40:05</p>
<p>Capturing which button was pressed in form submit <a href="https://stackoverflow.com/questions/2066162/how-can-i-get-the-button-that-caused-the-submit-from-the-form-submit-event">here</a></p>
<p>Got basic forms working in the 'form' branch:</p>
<p><a href="https://github.com/edgecollective/habitat/tree/form">https://github.com/edgecollective/habitat/tree/form</a></p>
<p>Going to try templates next. Also:</p>
<p>understandin gnodejs express templating engines</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/nodejs-express-template-engines">digitalocean</a></li>
</ul>
<hr>
<p>2021-01-09 17:44:55</p>
<p>Got basic templating working: <a href="https://github.com/edgecollective/habitat/tree/template">https://github.com/edgecollective/habitat/tree/template</a></p>
<p>TODOS:</p>
<ul>
<li>need to extract and show 'feed ID' (via POSTGRESQL commands) to user when creating new feed (currently only show name and private key)</li>
<li>might want option of generating a hash for the feed id, rather than a simple incremented integer</li>
<li>need to handle case where the requested feed ID doesn't exist (will require looking up in database)</li>
<li>render a landing page for a new data feed that explains private key, allows for downloading the key id and private key, shows an example CURL, and links to online arduino examples.</li>
</ul>
<p>Going to need to figure out how to create a new table, and new fields.  Follow tutorial by Trickett (habitat creator) <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<hr>
<p>2021-01-10 10:57:12</p>
<p>setting up postgresql server ... creating tables ...</p>
<ul>
<li>install postgresql <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04">here</a></li>
</ul>
<p>then follow instructions <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<blockquote>
<p>sudo -i -u postgres
psql</p>
</blockquote>
<p>can exit via \q</p>
<p>CREATE TABLE users (
user_id SERIAL PRIMARY KEY,
username VARCHAR(50),
password VARCHAR(255),
is_admin BOOLEAN DEFAULT FALSE
);</p>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255)
);</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,<br>
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);</p>
<p>INSERT INTO users (username, password) VALUES ('bob', 'jones');</p>
<p>INSERT INTO feeds (name) values ('NodeMCU  ESP32');</p>
<p>pcat999</p>
<p>how to handle: relation does not exist -- <a href="https://stackoverflow.com/questions/19941922/error-relation-does-not-exist">here</a></p>
<hr>
<p>2021-01-10 12:09:36</p>
<p>update: relation didn't exist b/c hadn't created the tables in the proper database.</p>
<p>PORT=3000
DB_NAME=hab1
DB_USER=postgres
DB_PASSWORD=pcat999
DB_HOST=localhost
DB_PORT=5432</p>
<hr>
<p>2021-01-10 12:30:59</p>
<p>Created a 'feed creation' landing page in the 'createfeed-landing' branch of habitat on github.com/edgecollective</p>
<hr>
<p>2021-01-10 12:48:01</p>
<p>using serial primary keys postgresql <a href="https://www.postgresqltutorial.com/postgresql-serial/">here</a></p>
<p>postgresql random primary key <a href="https://stackoverflow.com/questions/20890129/postgresql-random-primary-key">here</a></p>
<p>unique identifier in your postgresql database <a href="https://itnext.io/how-to-have-unique-identifier-in-your-postgresql-database-using-primary-key-and-foreign-key-9d2ddd4efce2">here</a></p>
<p>advice here is not to use the public key as the unique identifier -- <a href="https://dba.stackexchange.com/questions/94203/random-unguessable-primary-key-which-preserves-correct-order">here</a></p>
<hr>
<p>2021-01-11 11:06:05</p>
<p>error handling in express <a href="https://expressjs.com/en/guide/error-h">here</a></p>
<p>TODO: refactor things based on the suggestions in that post.</p>
<p>in particular:</p>
<pre><code>app.get('/user/:id', async function (req, res, next) {
  var user = await getUserById(req.params.id)
  res.send(user)
})
</code></pre>
<hr>
<p>2021-01-11 11:16:08</p>
<p>notes on api keys:</p>
<p>nice article <a href="https://stoplight.io/blog/api-keys-best-practices-to-authenticate-apis/">here</a></p>
<p>carto's policy <a href="https://carto.com/developers/auth-api/guides/how-to-send-API-Keys/">here</a></p>
<p>maybe should now have authorization key in the header.  should just be a matter of checking on the &quot;POST&quot; ... getting a header.  can implement it after this round.</p>
<hr>
<p>2021-01-11 11:25:41</p>
<p>changing name of table in postgres</p>
<pre><code>ALTER TABLE table_name 
RENAME COLUMN column_name TO new_column_name;
</code></pre>
<p>tests:</p>
<ul>
<li>case of incoming JSON matter? (likely yes) -- YES</li>
<li>case of postgres request matter? (likely no)</li>
<li>what if we don't send all the params?</li>
</ul>
<hr>
<p>2021-01-11 12:23:53</p>
<p>writing an async function <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">here</a></p>
<p>guide to async programming <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await">here</a></p>
<hr>
<p>2021-01-11 12:32:41</p>
<p>'use-pubkey' is the latest branch.</p>
<p>using 'async await' in express <a href="https://zellwk.com/blog/async-await-express/">here</a></p>
<p>and: definition of 'async / await' <a href="https://zellwk.com/blog/async-await">here</a></p>
<p>w/ postgresql <a href="https://stackoverflow.com/questions/53910835/using-async-await-with-node-postgres">here</a></p>
<p>started to use promises ...</p>
<p>even better now would be to create a 'getFeedPrivateKey() function and use that in postNewMeasurement()</p>
<hr>
<p>2021-01-11 17:13:28</p>
<p>have now started some 'async' code in branch 'async'. that's the latest working branch.</p>
<p>TODO:  the 'new feed' api should return JSON; the page we land on after creating a new feed in the form should leverage that api.</p>
<hr>
<p>2021-01-11 17:25:43</p>
<p>beginner's guide to pug <a href="https://www.sitepoint.com/a-beginners-guide-to-pug/">here</a></p>
<p>cami -- simon's kid</p>
<hr>
<p>2021-01-12 19:02:12</p>
<p>instructions for setting up postgres for habitat on digitalocean</p>
<p>install postgres</p>
<pre><code>sudo apt update
sudo apt install postgresql postgresql-contrib
</code></pre>
<blockquote>
<p>sudo -i -u postgres
createdb bay1
psql
\c bay1</p>
</blockquote>
<p>then:</p>
<p>CREATE TABLE users (
user_id SERIAL PRIMARY KEY,
username VARCHAR(50),
password VARCHAR(255),
is_admin BOOLEAN DEFAULT FALSE
);</p>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255)
);</p>
<p>CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,<br>
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
);</p>
<p>check that all is well:</p>
<blockquote>
<p>\dt</p>
</blockquote>
<p>change the user password:</p>
<blockquote>
<p>ALTER USER postgres WITH PASSWORD 'pcat999'</p>
</blockquote>
<blockquote>
<p>\q
exit</p>
</blockquote>
<p>see better guide <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">here</a></p>
<p>need to make sure .env file is proper:</p>
<p>PORT=3000
DB_NAME=hab1
DB_USER=postgres
DB_PASSWORD=pcat999
DB_HOST=localhost
DB_PORT=5432</p>
<p>key guide <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04">here</a>
for deploying nodejs server on digitalocean.</p>
<p>has section for adding additional apps on other ports!</p>
<p>setting up nginx on digitalocean guide <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04">here</a></p>
<p>how to set up a firewall on ubuntu <a href="https://www.digitalocean.com/community/tutorials/how-to-setup-a-firewall-with-ufw-on-an-ubuntu-and-debian-cloud-server">here</a></p>
<hr>
<p>2021-01-13 08:05:11</p>
<p>Its creation was motivated by recent work (e.g. by <a href="https://www.medrxiv.org/content/10.1101/2020.06.15.20132027v2">Jimenez et al.</a>) indicating that monitoring indoor CO2 levels can (in some contexts) help to assess the risk of airborne SARS-CoV-2 transmission.</p>
<hr>
<p>2021-01-13 11:59:26</p>
<p>html to jade thing <a href="https://html2jade.org/">here</a></p>
<hr>
<p>2021-01-13 19:20:23</p>
<p>Interesting way to do a drop-down menu via Pug, here:</p>
<p>div(class=&quot;choices&quot;)
h2
p I'm voting for:
select(class=&quot;form-control&quot;)
option 1
option 2
option 3
option 4
option 5</p>
<hr>
<p>2021-01-14 08:49:52</p>
<p>good example of chart setup here: <a href="view-source:https://www.chartjs.org/samples/latest/charts/line/basic.html">view-source:https://www.chartjs.org/samples/latest/charts/line/basic.html</a></p>
<p>Reference for p2p-farm-server chartjs setup <a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/fixhop/public/js/drive.js">here</a></p>
<p>perhaps-useful chartjs formatting <a href="https://embed.plnkr.co/JOI1fpgWIS0lvTeLUxUp/">here</a></p>
<hr>
<p>2021-01-21 11:20:38</p>
<p>Structure for a basic todo list app here: <a href="https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c">https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c</a></p>
<p>Associated code on github here: <a href="https://github.com/chisom5/nodejs-todoList">https://github.com/chisom5/nodejs-todoList</a></p>
<p>Idea:</p>
<ul>
<li>Make a similar system to Bayou</li>
<li>Each 'map' has an associated image file, a list of feeds, feed locations</li>
<li>So everything is indexed by the map, instead of the feed.  The map gets a 'mapkey' and a 'writekey'</li>
<li>Once you have a mapkey, you can add new feeds to the map, and change the map's metadata</li>
</ul>
<p>Idea: add nodemon for auto restart of bayou while developing</p>
<p>Using React-like library 'Riot' here: <a href="https://hub.packtpub.com/simple-todo-list-web-application-nodejs-express-and-riot/">https://hub.packtpub.com/simple-todo-list-web-application-nodejs-express-and-riot/</a>, with associated code here: <a href="https://github.com/revington/riot-express-todo-list">https://github.com/revington/riot-express-todo-list}</a></p>
<p>Drawing a grid on a canvas here <a href="https://codereview.stackexchange.com/questions/114702/drawing-a-grid-on-canvas">https://codereview.stackexchange.com/questions/114702/drawing-a-grid-on-canvas</a></p>
<p>postgres tutorial again here: <a href="https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372">https://able.bio/rhett/creating-a-web-application-in-your-home-with-a-raspberry-pi-express-and-postgresql--3c90a372</a></p>
<hr>
<p>2021-01-21 11:38:40</p>
<p>Simpler todo app approach here -- these are the elements I think I need -- <a href="https://medium.com/@atingenkay/creating-a-todo-app-with-node-js-express-8fa51f39b16f">https://medium.com/@atingenkay/creating-a-todo-app-with-node-js-express-8fa51f39b16f</a></p>
<p>And on github: <a href="https://github.com/missating/nodejs-todo">https://github.com/missating/nodejs-todo</a></p>
<p>Okay -- TODO: redo that last repo, using pug.
Then create feedmaps -- the equiv of bayou but by pulling in new feeds from various sources.  depending on the type of feed, can have various functionality.  so, add a 'feed type' variable -- e.g. bayou-co2 is one such type.</p>
<hr>
<p>2021-01-21 12:10:58</p>
<p>Iteration in pug here: <a href="https://pugjs.org/language/iteration.html">https://pugjs.org/language/iteration.html</a></p>
<hr>
<p>2021-01-21 12:42:26</p>
<p>feed-map can now display a simple list of feeds here: <a href="https://github.com/edgecollective/feed-map/commit/4d3a522ba01f0bae15721fe0420100dcf76fd1a8">https://github.com/edgecollective/feed-map/commit/4d3a522ba01f0bae15721fe0420100dcf76fd1a8</a></p>
<p><img src="/img/alt-server/feemap1.png" alt=""></p>
<hr>
<p>2021-01-21 17:22:56</p>
<p>Creating dynamic ides in a loop with pug here <a href="https://www.dev-tips-and-tricks.com/create-dynamic-ids-in-a-loop-with-pug-jade">https://www.dev-tips-and-tricks.com/create-dynamic-ids-in-a-loop-with-pug-jade</a></p>
<p>Update: this commit shows the basic functionality!</p>
<p><a href="https://github.com/edgecollective/feed-map/commit/765a9eec9b101e0e507075ec3b0e6aae8b9fec3b">https://github.com/edgecollective/feed-map/commit/765a9eec9b101e0e507075ec3b0e6aae8b9fec3b</a></p>
<p><img src="/img/alt-server/feedmap1.png" alt=""></p>
<p>Added nicer formatting:</p>
<p><img src="/img/alt-server/feedmap2.png" alt=""></p>
<p>Associated git commit is here: <a href="https://github.com/edgecollective/feed-map/commit/6f449c02024013035f1d42cd264505fb0066018e">https://github.com/edgecollective/feed-map/commit/6f449c02024013035f1d42cd264505fb0066018e</a></p>
<hr>
<p>2021-01-21 18:28:59</p>
<p>Nice reference for doing the map, via p2p-server code, here:</p>
<p><a href="https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html">https://gitlab.com/dwblair/p2p-farm-server/-/blob/mappin/public/console.html</a></p>
<hr>
<p>2021-01-21 18:39:13</p>
<p>Got image map working!  at this commit -- <a href="https://github.com/edgecollective/feed-map/commit/72e90916c5bf5b21d748a5e4e54451f93a25c654">https://github.com/edgecollective/feed-map/commit/72e90916c5bf5b21d748a5e4e54451f93a25c654</a></p>
<hr>
<p>2021-01-21 18:46:53</p>
<p>Got markers working! commit -- <a href="https://github.com/edgecollective/feed-map/commit/2e4281fc405246c231ce817b35ee4f99f7d9b80c">https://github.com/edgecollective/feed-map/commit/2e4281fc405246c231ce817b35ee4f99f7d9b80c</a></p>
<hr>
<p>2021-01-21 19:01:20</p>
<p>More formatting tweaks -- <a href="https://github.com/edgecollective/feed-map/commit/2b81f2f1154ddf1e6ffa11d2d5cd1b8ecb0260ce">https://github.com/edgecollective/feed-map/commit/2b81f2f1154ddf1e6ffa11d2d5cd1b8ecb0260ce</a></p>
<p><img src="/img/alt-server/feedmap3.png" alt=""></p>
<hr>
<p>2021-01-22 11:16:31</p>
<p>Created a 'checkbox' functionality, and also have charts graphed separately, in this commit and branch: <a href="https://github.com/edgecollective/feed-map/commit/e75252d43b287c398a6e82fa02e1599dfe307711">https://github.com/edgecollective/feed-map/commit/e75252d43b287c398a6e82fa02e1599dfe307711</a></p>
<p><img src="/img/alt-server/exploded.png" alt=""></p>
<hr>
<p>2021-01-22 14:14:58</p>
<p>Note: this is the nodejs-todo app I built feedmap upon, which has a nice 'delete note' functionality: <a href="https://github.com/missating/nodejs-todo">https://github.com/missating/nodejs-todo</a></p>
<p>This code might be useful re: deleting items in postgres: <a href="https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c">https://codeburst.io/creating-a-todo-app-with-node-js-express-and-postgresql-database-6dbf80c3fe9c</a></p>
<p>Here's a nice guide on using knex -- <a href="https://medium.com/@tobie.tsuzuki/getting-started-with-node-js-express-and-knex-5640f595df98">https://medium.com/@tobie.tsuzuki/getting-started-with-node-js-express-and-knex-5640f595df98</a></p>
<p>Interesting post on sequelize vs knex vs objection.js here: <a href="https://stackoverflow.com/questions/56028287/how-is-node-js-knex-similar-different-to-sequelize">https://stackoverflow.com/questions/56028287/how-is-node-js-knex-similar-different-to-sequelize</a></p>
<p>And an interesting link here: <a href="https://www.jakso.me/blog/objection-to-orm-hatred">https://www.jakso.me/blog/objection-to-orm-hatred</a> -- looks like objection.js might be a great idea.</p>
<hr>
<p>2021-01-22 14:31:57</p>
<p>Overlay line on chart.js <a href="https://stackoverflow.com/questions/28076525/overlay-line-on-chart-js-graph">https://stackoverflow.com/questions/28076525/overlay-line-on-chart-js-graph</a></p>
<hr>
<p>2021-01-22 14:43:27</p>
<p>Good example of chartjs datasets: <a href="https://tobiasahlin.com/blog/chartjs-charts-to-get-you-started/#2-line-chart">https://tobiasahlin.com/blog/chartjs-charts-to-get-you-started/#2-line-chart</a></p>
<hr>
<p>2021-01-22 18:34:46</p>
<p>Now plotting multiple co2 plots!  at this commit: <a href="https://github.com/edgecollective/feed-map/commit/91adae48079a21fcf9fcc286ccd85a7ac2a68e91">https://github.com/edgecollective/feed-map/commit/91adae48079a21fcf9fcc286ccd85a7ac2a68e91</a></p>
<p><img src="/img/alt-server/feedmap4.png" alt=""></p>
<hr>
<p>2021-01-22 18:42:23</p>
<p>Hosting via google drive here: <a href="https://stackoverflow.com/questions/10311092/displaying-files-e-g-images-stored-in-google-drive-on-a-website">https://stackoverflow.com/questions/10311092/displaying-files-e-g-images-stored-in-google-drive-on-a-website</a></p>
<hr>
<p>2021-01-22 18:56:25</p>
<p>Add asylum map:</p>
<p><img src="/img/alt-server/feedmap_asylum.png" alt=""></p>
<p>git commit: <a href="https://github.com/edgecollective/feed-map/commit/fce79dc266a8ee5696a7da75c2a7177722128f80">https://github.com/edgecollective/feed-map/commit/fce79dc266a8ee5696a7da75c2a7177722128f80</a></p>
<hr>
<p>2021-01-23 10:15:25</p>
<p>Revisiting my own documentation / repo for a minimal node + sqlite endpoint here <a href="https://github.com/edgecollective/nodejs-sqlite-endpoint">https://github.com/edgecollective/nodejs-sqlite-endpoint</a></p>
<hr>
<p>2021-01-23 15:38:16</p>
<p>Good tutorial for sqlite3: <a href="https://www.sqlitetutorial.net/sqlite-nodejs/query/">https://www.sqlitetutorial.net/sqlite-nodejs/query/</a></p>
<hr>
<p>2021-01-23 15:52:07</p>
<p>Using sqlite3 with async await here: <a href="https://www.scriptol.com/sql/sqlite-async-await.php">https://www.scriptol.com/sql/sqlite-async-await.php</a></p>
<hr>
<p>2021-01-23 16:12:29</p>
<p>Switching back to postgres:</p>
<p>Installing postgres:</p>
<blockquote>
<p>sudo apt update
sudo apt install postgresql postgresql-contrib</p>
</blockquote>
<p>Then:</p>
<blockquote>
<p>sudo -i -u postgres
createdb feedmap1;
psql feedmap1</p>
</blockquote>
<p>then:</p>
<p>CREATE TABLE feedmaps(
feedmap_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255),
map_url VARCHAR(255)
);</p>
<p>CREATE TABLE feeds(
id SERIAL PRIMARY KEY,
feedmap_id INT,
feed_base_url VARCHAR(255),
feed_public_key VARCHAR(255),
added TIMESTAMP DEFAULT NOW(),
CONSTRAINT feedmap
FOREIGN KEY(feedmap_id)
REFERENCES feedmaps(feedmap_id)
);</p>
<hr>
<p>2021-01-23 22:14:02</p>
<p>New branch -- postgres -- mimics features of Bayou-CO2.</p>
<p>Basic working setup here: <a href="https://github.com/edgecollective/feed-map/commit/6dd02a33311bcdbaed57a3bdf54b0070a342d6a1">https://github.com/edgecollective/feed-map/commit/6dd02a33311bcdbaed57a3bdf54b0070a342d6a1</a></p>
<p><img src="/img/alt-server/feedmap_manage.png" alt=""></p>
<p>Notes:</p>
<ul>
<li>Can do similar forms to 'create' and 'manage' a feedmap; to 'manage', need to enter pubkey and privkey -- can follow format of bayou-CO2 ...</li>
</ul>
<p>Flow:</p>
<ul>
<li>Create a feedmap</li>
<li>Then, you get sent to the 'manage' page.</li>
<li>You can also get to the 'manage' page by entering a pubkey and privkey for a feed.</li>
<li>Perhaps there is a 'manage' button on the feed landing page, which then prompts for a privatekey, then takes you to the 'manage' page.</li>
<li>Would be nice to be able to change the map, and modify the feeds; but at first, okay if it's 'throwaway' and you need to start over ...</li>
</ul>
<hr>
<p>2021-01-26 14:53:50</p>
<p>Adding x,y coord display over image, here: <a href="https://stackoverflow.com/questions/7414984/how-could-i-display-x-y-coordinates-on-image-in-real-time-to-the-user-when-the">https://stackoverflow.com/questions/7414984/how-could-i-display-x-y-coordinates-on-image-in-real-time-to-the-user-when-the</a></p>
<hr>
<p>2021-01-26 20:59:05</p>
<p>Getting close w/ feedmaps! <a href="https://gitlab.com/p-v-o-s/co2/feedmap/-/commit/15b5d91c469c17b3fbbd03ba5ab6b6eaf0b70869">https://gitlab.com/p-v-o-s/co2/feedmap/-/commit/15b5d91c469c17b3fbbd03ba5ab6b6eaf0b70869</a></p>
<p><img src="/img/alt-server/manage_feeds.png" alt=""></p>
<p>The issue now is that we need to add &quot;shortname&quot; and &quot;coords&quot; to each feed listed in the feedmap database.<br>
Need to modify the database.</p>
<p>Also: need to remove &quot;name&quot; from the bayou-co2. Perhaps just use the first few chars as the &quot;name&quot;.</p>
<hr>
<p>2021-01-27 11:14:20</p>
<p><img src="/img/alt-server/manage_feeds_c.png" alt=""></p>
<hr>
<p>2021-01-27 19:55:39</p>
<p>Feedmap hacking:
<a href="http://192.168.1.163:4006/feedmap/manage/7a66feb586010296bb03fc01967a89ac7b1f9b41388db6ff/1f79e0a2d7159495e9be3cb545c83911147035130a2b9fba">http://192.168.1.163:4006/feedmap/manage/7a66feb586010296bb03fc01967a89ac7b1f9b41388db6ff/1f79e0a2d7159495e9be3cb545c83911147035130a2b9fba</a></p>
<hr>
<p>2021-01-29 22:14:01</p>
<h1>Setting up postgres on the Pi</h1>
<h2>Installing</h2>
<blockquote>
<p>sudo apt update
sudo apt install postgresql postgresql-contrib</p>
</blockquote>
<h2>Creating DB</h2>
<blockquote>
<p>sudo -i -u postgres
postgres@raspberrypi:~$ createdb hab1
postgres@raspberrypi:~$ psql hab1</p>
</blockquote>
<p>CREATE TABLE feeds(
feed_id SERIAL PRIMARY KEY,
name VARCHAR(255),
public_key VARCHAR(255),
private_key VARCHAR(255)
;</p>
<p>CREATE TABLE
CREATE TABLE measurements(
id SERIAL PRIMARY KEY,
feed_id INT,
co2 FLOAT,
tempC FLOAT,
humidity FLOAT,
mic FLOAT,
auxPressure FLOAT,
auxTempC FLOAT,
aux001 FLOAT,
aux002 FLOAT,<br>
created TIMESTAMP DEFAULT NOW(),
CONSTRAINT feed
FOREIGN KEY(feed_id)
REFERENCES feeds(feed_id)
;</p>
<p>(exit psql and postgres with &quot;exit&quot; )</p>
<h2>Changing password</h2>
<blockquote>
<p>sudo -i -u postgres
psql
postgres=# ALTER USER postgres WITH PASSWORD 'pcat999'</p>
</blockquote>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>(((Status: DRAFT)))</p>
<hr>
<h2>Overview</h2>
<p>Here we're going to be describing how to set up a basic 'Greenhouse Monitoring' system, which consists of three main parts:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/greenhouse_stack.png"> <img src="/img/valedalama/greenhouse_stack.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Overview of the flow of data in the greenhouse monitoring 'stack'.</td>
</tr>
</tbody>
</table>
<ol>
<li><strong>Remote Node</strong> -- consisting of a microcontroller + sensor, that captures a signal (e.g. temperature) and relays this data via low-power radio to a wifi gateway</li>
<li><strong>Gateway</strong> -- which relays this incoming sensor data to a server</li>
<li><strong>Server</strong> -- a server which receives data from the gateway and stores it in a database.</li>
</ol>
<hr>
<h2>Table of Contents</h2>
<ol>
<li><a href="#server">Setting up the <strong>Server</strong></a></li>
<li><a href="#arduino">Setting up the <strong>Arduino IDE</strong></a></li>
<li><a href="#micro">Setting up the <strong>Remote Node</strong></a></li>
<li><a href="#gateway">Setting up the <strong>Gateway</strong></a></li>
</ol>
<hr>
<h2><a name="server"></a> 1. Server setup</h2>
<p><img src="/img/valedalama/stack_server.png" alt="figA2"></p>
<p>We will be covering two different server options:</p>
<ul>
<li><strong>FarmOS</strong> (an open source farm data management system); and</li>
<li><strong>Bayou</strong> (an open source sensor data cooperative).</li>
</ul>
<h3>FarmOS</h3>
<p>You can watch a short video (~ 3 min) on setting up a FarmOS sensor feed <a href="https://youtu.be/arGErKKODrU">here</a>.</p>
<p>The process will generate a public key + private key pair, and indicate a URL to which you can post sensor data via JSON (See &quot;Sensor Configuration&quot;: &quot;Developer Information&quot;).  The URL format looks like this:</p>
<pre><code>https://edgecollective.farmos.net/farm/sensor/listener/[public key]?private_key=[private key]
</code></pre>
<p>For example, a typical URL with the keys actually inserted looks like this:</p>
<pre><code>https://edgecollective.farmos.net/farm/sensor/listener/0ce692a8fd8474137839535dd7997a28?private_key=ba0c7dbfd4321b3abaa7851457dc12ef
</code></pre>
<p>Find this URL (with the keys inserted) for your sensor feed, and take note of it (keep the relevant FarmOS browser tab open, or copy-paste this URL into a text file.) It will be used in the  <a href="#gateway">Gateway Setup</a> section below.</p>
<h3>Bayou</h3>
<p>Another option is to use the <a href="http://159.65.226.222:3000/">Bayou cooperative sensor data platform</a>. This donation-based data service allows users to set up free sensor data feeds. Email collaborate at edgecollective dot io to request a password.</p>
<p>You can watch a short video on setting up a <a href="http://159.65.226.222:3000/">Bayou</a> sensor feed <a href="https://youtu.be/EKZA-AtDYO0">here</a>.</p>
<p>The basic steps are:</p>
<ol>
<li>Visit <a href="http://159.65.226.222:3000/">Bayou</a>.  There may be a 'username' and 'password' required to access the site -- contact collaborate@edgecollective.io to request a login!</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/bayou.png"> <img src="/img/valedalama/bayou_landing.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">The Bayou main site.</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>To create a new data feed, enter new values for your feed in the 'name' and 'description' fields, and click Create.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/bayou_create.png"> <img src="/img/valedalama/bayou_create.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Create a new data feed on Bayou by entering a 'name' and 'description' for the feed, and then pressing the 'Create' button.</td>
</tr>
</tbody>
</table>
<ol start="3">
<li>This will generate a <strong>public key</strong> and a <strong>private key</strong>.</li>
</ol>
<blockquote>
<p><strong>IMPORTANT:  Take note of these keys!</strong> Copy them to a separate text file for safekeeping -- you will use them in your gateway configuration file in the <a href="#gateway">Gateway Setup</a> step below.</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/bayou_keys_highlight.png"> <img src="/img/valedalama/bayou_keys_highlight.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">After clicking 'create', you'll be shown a Public Key and Private Key.  Take note of these!</td>
</tr>
</tbody>
</table>
<ol start="4">
<li>To view a feed you've created, enter the <strong>public key</strong> into the 'View a data feed!' section, in the 'key' field, and click View.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/bayou_view.png"> <img src="/img/valedalama/bayou_view.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">To view a feed you've created, enter the <strong>public key</strong> into the 'View a data feed!' section, in the 'key' field, and click View.</td>
</tr>
</tbody>
</table>
<hr>
<h2><a name="arduino"></a> 2. Setting up the Arduino IDE</h2>
<p>In order to load firmware onto the Remote Node and the Gateway, we'll need to set up the Arduino IDE to program the Feather M0 (for the Remote node, which uses a Feather M0 LoRa), and an ESP32-based device (for the Gateway, which uses an ESP32-based Heltec device).</p>
<p>(You can download the Arduino IDE for your operating system <a href="">here</a>.)</p>
<p>We can configure the Arduino IDE to talk to these boards using the instructions below.</p>
<p>In the Arduino IDE, go to <strong>File: Preferences</strong> menu.  You will see an &quot;Additional Boards Manager URLs&quot; dialog box:</p>
<p><img src="/img/valedalama/preferences.png" alt="figA2"></p>
<p>Enter the following URLS into this dialog box (note, this contains two URLs separated by a comma):</p>
<pre><code>https://adafruit.github.io/arduino-board-index/package_adafruit_index.json, https://adafruit.github.io/arduino-board-index/package_adafruit_index.json
</code></pre>
<p>After entering them, it might look something like this:</p>
<p><img src="/img/valedalama/pref_comma.png" alt="figA2"></p>
<p>Hit &quot;OK&quot;.</p>
<p>Now go to &quot;Tools: Board: Boards Manager&quot; menu.</p>
<p>(Note that the following installation process can take several minutes for each board setup.)</p>
<p>You need to install functionality for:</p>
<ul>
<li>The Arduino SAMD board definitions (search, and click 'Install'):</li>
</ul>
<p><img src="/img/valedalama/arduino_samd.png" alt="figA2"></p>
<ul>
<li>the Adafruit SAMD board definitions (search, and click 'Install'):</li>
</ul>
<p><img src="/img/valedalama/adafruit_samd.png" alt="figA2"></p>
<ul>
<li>and the ESP32 board definitions (search, and click 'Install'):</li>
</ul>
<p><img src="/img/valedalama/esp32.png" alt="figA2"></p>
<hr>
<h2><a name="micro"></a> 3. Remote Node setup</h2>
<p><img src="/img/valedalama/stack_node.png" alt="figA2"></p>
<p>In our example setup for this guide, the Remote node consists of:</p>
<ul>
<li><strong>Sensor</strong>: an AM2315 Temperature and Humidity Sensor</li>
<li><strong>Microcontroller</strong>: a Feather M0 LoRa</li>
<li><strong>Additional Hardware</strong>: a PVOS Greenhouse Motherboard Version 4 or Version 5.</li>
</ul>
<h3>Configuring the Arduino IDE to program Feather M0 LoRa</h3>
<ul>
<li>
<p><strong>Board selection</strong>. From the Arduino IDE Tools menu, select: &quot;Tools:Board:Adafruit SAMD:Adafruit Feather M0&quot;</p>
</li>
<li>
<p><strong>Port selection</strong>. From the Arduino IDE Tools: Port menu, select the port to which your Feather M0 is connected via USB.</p>
</li>
</ul>
<h3>Assembling the Remote Node</h3>
<p>The Remote Node requires the following hardware:</p>
<ul>
<li>a <a href="https://www.adafruit.com/product/3178">Feather M0 LoRa</a> (link allows purchase via Adafruit, Digikey, or etc.):</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/feather_m0.jpg"> <img src="/img/valedalama/feather_m0.jpg" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">a <a href="https://www.adafruit.com/product/3178">Feather M0 LoRa</a>, for sale by Adafruit</td>
</tr>
</tbody>
</table>
<p><em><strong>NOTE</strong></em>: you'll need to choose a Feather M0 LoRa radio band (433 MHz or 868/915 Mhz) that matches the frequency of your LoRa-WiFi gateway.</p>
<ul>
<li>an <a href="https://www.adafruit.com/product/1293">AM2315 Temp + Humidity sensor</a> (purchase via Adafruit, Digikey, or etc.):</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/am2315.jpg"> <img src="/img/valedalama/am2315.jpg" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">an <a href="https://www.adafruit.com/product/1293">AM2315 Temp + Humidity sensor</a>, for sale by Adafruit</td>
</tr>
</tbody>
</table>
<ul>
<li>and a PVOS 'Lama' Board, <a href="">version 4</a> or <a href="">version 5</a></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/pvos_oshpark_v5.png"> <img src="/img/valedalama/pvos_oshpark_v5.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A <a href="https://oshpark.com/shared_projects/vQ5JTv0Z">PVOS 'Lama' Board Ver 5</a>, available via OSHPARK.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/3d_render.png"> <img src="/img/valedalama/3d_render.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A <a href="https://oshpark.com/shared_projects/vQ5JTv0Z">PVOS 'Lama' Board Ver 5</a> rendered with headers soldered (but not yet the screw terminals).</td>
</tr>
</tbody>
</table>
<p>A can be purchased directly from <a href="(https://oshpark.com/shared_projects/vQ5JTv0Z)">OSHPARK</a> or by sending the [design files] to PCB manufacturers like JLCPCB, etc.</p>
<p><em><strong>NOTE</strong></em>: some simple hand-soldering (beginner level) and wire stripping is required.</p>
<h3>Connecting the sensor</h3>
<p>The <a href="https://www.adafruit.com/product/1293">AM2315</a> is an i2c sensor -- which means that it has the following wires:</p>
<ul>
<li>VCC / 3.3V  (Red)</li>
<li>GND (Black)</li>
<li>SCL (White)</li>
<li>SDA (Yellow)</li>
</ul>
<p>These wires should connect to the relevant screw terminal inputs on the &quot;Version 4 Motherboard&quot;, as depicted here:</p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/remote_v4_board.png"> <img src="/img/valedalama/remote_v4_board.png" alt="fig2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Remote board, version 4.</td>
</tr>
</tbody>
</table>
<p>The Feather M0 LoRa should be plugged into the relevant headers on the mothboard, as well.</p>
<p>Note that all resistors (4.7K or 10K) should also be soldered to the board.</p>
<h3>Sensor Test</h3>
<p>Code for testing the AM2315 with the Feather is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/remote/feather_firmware/featherm0_am2315">here</a>.</p>
<p><img src="/img/valedalama/featherm0_am2315.png" alt=""></p>
<h3>Radio Setup</h3>
<p>Code for measuring the AM2315 and sending it via LoRa is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/remote/feather_firmware/featherm0_am2315_lora">here</a>.</p>
<p>Note: you'll need to modify the code to match the radio frequency you're using:</p>
<p><img src="/img/valedalama/featherm0_am2315_radio_freq.png" alt=""></p>
<p>Code for adding sleep functionality is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/remote/feather_firmware/featherm0_am2315_lora_sleep">here</a>.</p>
<hr>
<h2><a name="gateway"></a> 4. Gateway setup</h2>
<p><img src="/img/valedalama/stack_gateway.png" alt="figA2"></p>
<p>The gateway we'll be using is a <a href="https://heltec.org/project/wifi-lora-32/">'Heltec Wifi-LoRa 32 v2'</a>, it is available widely online, including <a href="https://www.amazon.com/MakerFocus-Development-Bluetooth-0-96inch-Display/dp/B076MSLFC9/ref=asc_df_B076MSLFC9/?tag=hyprod-20&amp;linkCode=df0&amp;hvadid=312824707815&amp;hvpos=&amp;hvnetw=g&amp;hvrand=4477519221563307865&amp;hvpone=&amp;hvptwo=&amp;hvqmt=&amp;hvdev=c&amp;hvdvcmdl=&amp;hvlocint=&amp;hvlocphy=9002000&amp;hvtargid=pla-570414542843&amp;psc=1">here</a>. No soldering is required.</p>
<h3>Configuring the Arduino IDE to program Heltec ESP32-LoRa V2</h3>
<p>After the initial setup process described above for configuring the Arduino IDE to work with the Heltec and Feather device, you can easily select the proper Port and Board settings in the Arduino IDE as follows:</p>
<ul>
<li>
<p><strong>Board selection</strong>. From the Arduino IDE Tools menu, select: &quot;Tools:Board:ESP 32 Arduino:Heltec Wifi LoRa (V2)&quot;</p>
</li>
<li>
<p><strong>Port selection</strong>. From the Arduino IDE Tools: Port menu, select the port to which your Heltec is connected via USB.</p>
</li>
</ul>
<h3>Uploading Gateway Firmware</h3>
<p>Sample code for your esp32-lora gateway is <a href="https://github.com/edgecollective/valedalama/tree/master/greenhouse/gateway/heltec_wifi_lora_bayou_farmos">here</a>.  You should download this folder and open it up in the ArduinoIDE.</p>
<p>First, set up the configuration file, <code>configuration.h</code>, which is located in your gateway arduino code folder.  If you open the folder in the Arduino IDE,  configuration.h should open automatically in a separate tab. Click on that tab in order to edit your credentials.</p>
<p><img src="/img/valedalama/heltec_credentials.png" alt=""></p>
<p>The <code>configuration.h</code> file has the following fields:</p>
<pre><code>const char *SSID = &quot;(YOUR WIFI SSID)&quot;;
const char *WiFiPassword = &quot;(YOUR WIFI PASSWORD)&quot;;
const char* bayou_url = &quot;(YOUR BAYOU URL)&quot;;
const char* bayou_privkey = &quot;(YOUR BAYOU PRIVATE KEY)&quot;;
const char* farmOS_url = &quot;(YOUR FARMOS URL)&quot;;
</code></pre>
<h4>Setting up wifi</h4>
<p>In the credentials.h file, you'll see a place to enter your wifi credentials.  For example, if your wifi's name were 'Nancy' and your password were 'Drew1234', you'd edit the configurations.h file to look like the following:</p>
<pre><code>const char *SSID = &quot;Nancy&quot;;
const char *WiFiPassword = &quot;Drew1234&quot;;
const char* bayou_url = &quot;(YOUR BAYOU URL)&quot;;
const char* bayou_privkey = &quot;(YOUR BAYOU PRIVATE KEY)&quot;;
const char* farmOS_url = &quot;(YOUR FARMOS URL)&quot;;
</code></pre>
<h4>Setting up Bayou credentials</h4>
<p>If you're posting to Bayou, you'll want to use the Bayou publickey and private you created above, and enter them into the configuration.h file.</p>
<p>For examle, if your Bayou public key / private key pair (generated in the server setup above) were:</p>
<pre><code>public key: 1a142aee9702045f3049325318f14fab10d24ce3e0c8a387d092759c0594ba53
private key: db84537367d8e9026e93b97cfef3adc11781d90abb56f24d96ee12e7ce899344
</code></pre>
<p>Then your 'bayou_url' is formed by pre-pending <code>http://157.230.188.100:3000/api/drives/</code> to your public key, and your bayou_privkey is simply your private key.</p>
<p>In our example, you'd modify the <code>configuration.h</code> file to look like this:</p>
<pre><code>const char *SSID = &quot;(YOUR WIFI SSID)&quot;;
const char *WiFiPassword = &quot;(YOUR WIFI PASSWORD)&quot;;
const char* bayou_url = &quot;http://157.230.188.100:3000/api/drives/1a142aee9702045f3049325318f14fab10d24ce3e0c8a387d092759c0594ba53&quot;;
const char* bayou_privkey = &quot;db84537367d8e9026e93b97cfef3adc11781d90abb56f24d96ee12e7ce899344&quot;;
const char* farmOS_url = &quot;(YOUR FARMOS URL)&quot;;
</code></pre>
<p>(Note, you don't need to modify the FarmOS parameters in configuration.h if you're not posting to FarmOS.)</p>
<p><strong>NOTE</strong>:  you must rename &quot;sample_configuration.h&quot; to &quot;configuration.h&quot;!</p>
<h4>Setting the LoRa frequency</h4>
<p>Next, you'll need to modify the LoRa radio frequency to match your setup:</p>
<p><img src="/img/valedalama/heltec_wifi_lora_gateway_freq.png" alt=""></p>
<p>NOTE:  As of this writing, the code only works with <em>either</em> Bayou <em>or</em> FarmOS.  You may need to comment the relevant other upload section accordingly.</p>
<p>Finally, click on the 'upload' button.</p>
<p>You should expect to see your device connecting to your wifi, then receiving data from the Feather and posting it to Bayou / FarmOS.</p>
<h3>Example data</h3>
<p>Example of Bayou server data <a href="http://159.65.226.222:3000/drives/1a142aee9702045f3049325318f14fab10d24ce3e0c8a387d092759c0594ba5e">here</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><hr>
<p>2020 Nov 09</p>
<h2>Youtube tutorial by Techiesms</h2>
<p>Nice <a href="https://www.youtube.com/watch?v=mySnfyyL4i4">tutorial</a> using ESP32 and 4.2 &quot; e-ink display</p>
<p>Associated library, GxEPD is <a href="https://github.com/ZinggJM/GxEPD">here</a></p>
<p>Link for project code in the tutorial is <a href="https://github.com/techiesms/E-paper-module-using-ESP32">here</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/valedalama/heltec_pinout.png"> <img src="/img/valedalama/heltec_pinout.png" alt="figA2"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Heltec Wifi LoRa v2 pinout.</td>
</tr>
</tbody>
</table>
<p>Instructions for Adafruit MicroSD are <a href="https://www.adafruit.com/product/254">here</a>.</p>
<p>Formatting a microSD tutorial <a href="https://ragnyll.gitlab.io/2018/05/22/format-a-sd-card-to-fat-32linux.html">here</a></p>
<p>Convert to byte array code <a href="https://www.briandorey.com/post/bitmap-byte-converter-for-e-ink-display">here</a></p>
<p>converting input images to proper grayscale <a href="https://github.com/sqfmi/badgy/tree/master/examples/grayscale">here</a></p>
<p>this conversion pipeline looks great -- <a href="https://stackoverflow.com/questions/35797988/converting-images-to-indexed-2-bit-grayscale-bmp">here</a></p>
<p>which is explained along with other code <a href="https://github.com/yy502/ePaperDisplay">here</a></p>
<h2>Working code, SD card to itsym0 4.2 in e-ink</h2>
<p>Code on github is <a href="https://github.com/edgecollective/eink-map/tree/main/GxEPD_SD_itsym0">here</a></p>
<h2>Converting images</h2>
<p>Great little tutorial <a href="https://steve.fi/hardware/d1-epaper/">here</a></p>
<pre><code>convert Lenna.png -monochrome lenna-1.png
</code></pre>
<pre><code>convert lenna.png -monochrome -resize 200x320\! lenna4.bmp

</code></pre>
<h3>Compass</h3>
<p>Good quality compass offered <a href="https://www.amazon.com/gp/product/B07CK8B3R3/ref=ox_sc_saved_title_1?smid=A2LLNHIZM5ZWNT&amp;psc=1">here</a></p>
<h3>Map tiles</h3>
<p>Typical map tile size is 256x265 -- reference <a href="https://wiki.openstreetmap.org/wiki/Tiles#:~:text=Graphical%20Map%20Tiles,-Map%20tiles%20are&amp;text=512%C3%97512%20pixel%20seems,and%20also%20several%20zoom%20levels.">here</a></p>
<p>Guide to creating your own tiles <a href="https://wiki.openstreetmap.org/wiki/Creating_your_own_tiles">here</a></p>
<p>Browsing local tiles guide <a href="https://wiki.openstreetmap.org/wiki/OpenLayers_Local_Tiles_Example">here</a> &lt;---- this seems like a great guide to dive into.</p>
<p>More basic guide to OSM tiles <a href="https://wiki.openstreetmap.org/wiki/Tiles">here</a>.</p>
<h3>PCB Antennas for GPS</h3>
<p>Guide <a href="https://resources.altium.com/p/gps-antennas-in-your-pcb-design-you-won-t-get-lost-again">here</a></p>
<p>Design considerations for UBlox <a href="GNSS-Antennas_AppNote_UBX-15030289.pdf">here</a></p>
<table>
<thead>
<tr>
<th style="text-align:center"><a href="/img/eink/chip_antenna_vs_patch.png"><img src="/img/eink/chip_antenna_vs_patch.png" alt=""></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fig 9 from the UBlox <a href="GNSS-Antennas_AppNote_UBX-15030289.pdf">App Note</a> mentioned above.</td>
</tr>
</tbody>
</table>
<h3>Offline maps</h3>
<p>Nice discussion and review <a href="https://meshtastic.discourse.group/t/offline-maps-on-meshtastic/137/20">here</a></p>
<h3>Open Map Tiles</h3>
<p>Main project description is <a href="https://openmaptiles.com/">here</a>.</p>
<p>Open map tiles project update is <a href="https://www.maptiler.com/news/2020/05/the-future-of-openmaptiles-project/">here</a></p>
<p>OMT is compatible with Stamen's Toner -- post <a href="https://www.maptiler.com/news/2020/04/long-live-toner/">here</a>.</p>
<h3>Grayscale / B&amp;W image</h3>
<p>Thread discussion <a href="https://www.imagemagick.org/discourse-server/viewtopic.php?t=21264">here</a>.</p>
<p>Doing it without dithering:</p>
<pre><code>convert bone.png -colorspace gray -threshold 80% -type bilevel -resize 200x320\! bone4.bmp
</code></pre>
<h2>Caltopo</h2>
<p><a href="https://caltopo.com/">Caltopo</a></p>
<h2>E-Ink setup</h2>
<p>Link to waveshare guide for 4.2 in e-ink <a href="https://www.waveshare.com/wiki/4.2inch_e-Paper_Module">here</a></p>
<p>Datasheet is <a href="https://www.waveshare.com/w/upload/6/6a/4.2inch-e-paper-specification.pdf">here</a>.</p>
<h2>ESP32 Low-power modes</h2>
<p>There's a nice description <a href="https://lastminuteengineers.com/esp32-sleep-modes-power-consumption/">here</a>.</p>
<p>Tutorial on using ESP32 deep sleep <a href="https://lastminuteengineers.com/esp32-deep-sleep-wakeup-sources/">here</a>.</p>
<p>In particular, wakeup from external pin <a href="https://lastminuteengineers.com/esp32-deep-sleep-wakeup-sources/#ext0-external-wakeup-source">here</a>.</p>
<h2>Low-power ESP32:</h2>
<ul>
<li>
<p>TinyPic project is <a href="https://www.tinypico.com/">here</a>, on sale at Amazon <a href="https://www.amazon.com/gp/product/B07ZZKZDGQ/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">here</a></p>
</li>
<li>
<p>E-Pulse project is [here](https://thingpulse.com/product/epulse-low-power-esp32-development-board/#:~:text=ePulse%2C%20the%20low%20power%20ESP32,and%2035uA%20(at%2012V).</p>
</li>
</ul>
<h3>Eink experiments</h3>
<p><img src="/img/eink/map_proto.jpg" alt=""></p>
<h3>Inspiring projects</h3>
<p>Arduino APRS project, <a href="http://9w2svt.blogspot.com/2014/12/aprs-arduino-with-map-display.html">here</a>.</p>
<p><strong>Key project</strong>. Marinus, and APRS display project, <a href="http://hamradioprojects.com/authors/wa5znu/+marinus/">here</a>. Great set of links, here!</p>
<p>Online code to generate OSM tiles for download is <a href="http://hamradioprojects.com/authors/wa5znu/+marinus/osm/">here</a>.</p>
<p>Ham Radio for Arduino and Picaxe book --- <a href="http://www.arrl.org/shop/Ham-Radio-for-Arduino-and-PICAXE/">Description</a>, <a href="https://www.amazon.com/Ham-Radio-Arduino-Picaxe-Arrl/dp/087259324X">Amazon</a>.</p>
<p>Source code for generating tiles from OSM is <a href="http://hamradioprojects.com/authors/wa5znu/+marinus/code/">here</a></p>
<p>Grid square locator on above site is broken; perhaps <a href="https://www.k2dsl.com/2008/08/27/finding-grid-square-locators/">this</a> works?</p>
<p>Grid square locator <a href="http://www.arrl.org/grid-squares">here</a>.</p>
<p>Computing lat / lon <a href="https://stevemorse.org/jcal/latlon.php">here</a>.</p>
<p>Conant road lat / lon: 42.41158	-71.2983</p>
<p>Grid square utility <a href="http://www.levinecentral.com/ham/grid_square.php">here</a> works, but doesn't give 10 character grid squares ...</p>
<p>Another tool is <a href="https://dxcluster.ha8tks.hu/hamgeocoding/">here</a>, which generates a nice overlay ... &lt;-- this is the tool to use!</p>
<p>So, the combined tools are:</p>
<ul>
<li>identifying your grid square in ham radio, <a href="https://dxcluster.ha8tks.hu/hamgeocoding/">here</a>.</li>
<li>using a python script to grab the tiles, <a href="http://hamradioprojects.com/authors/wa5znu/+marinus/osm/">here</a> -- seems to be broken.</li>
</ul>
<p>Example grid square:</p>
<p>FN42IK44LP</p>
<h3>Grid Squares</h3>
<p>Generator <a href="https://dxcluster.ha8tks.hu/hamgeocoding/">here</a>.  Uses a nice open source <a href="https://nominatim.org/">geocoding app</a> that works with OSM.  The author, <a href="https://twitter.com/ha8tks?lang=en">ha8tks</a>, has a <a href="https://github.com/ha8tks/Leaflet.Maidenhead">repo on github</a> that applies the GridSquare layout in Leaflet.</p>
<p><img src="/img/eink/gridquare.png" alt=""></p>
<p><img src="/img/eink/weston.png" alt=""></p>
<p>Reference on gridsquares <a href="https://www.amsat.org/amsat-new/tools/grids.php">here</a></p>
<p>Ham radio chat on grid squares <a href="https://www.youtube.com/watch?v=3w2SPj5Hs5Q">here</a>.</p>
<p>General term for this is the <a href="https://en.wikipedia.org/wiki/Maidenhead_Locator_System">Maidenhead Gridsquare System</a>.</p>
<p>(Alternative:  the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">World Geodetic System</a>)</p>
<p>Nice <a href="https://www.hamradio.in/circuits/grid_locator_system.php">explanation</a> of the grid locator system.</p>
<p>Nice <a href="http://www.jonit.com/fieldlist/maidenhead.htm">historical background</a> on the system.</p>
<p>Really nice <a href="https://www.youtube.com/watch?v=rlkUAHGw_Sg">video explanation</a> of grid squares.</p>
<h3>OSM Tiles</h3>
<p>Guide to tiles <a href="https://wiki.openstreetmap.org/wiki/Tiles">here</a>.</p>
<p>Tutorial on how to use OSM tiles in an application, <a href="https://switch2osm.org/using-tiles/">here</a>.</p>
<p>Leaflet providers <a href="http://leaflet-extras.github.io/leaflet-providers/preview/">here</a> &lt;-- really useful survey of free tile providers.</p>
<p>Good list of <a href="https://wiki.openstreetmap.org/wiki/Hiking_Maps">hiking maps</a></p>
<hr>
<p>2020-11-25 10:50:31</p>
<p>Would be nice to include the GridSquare system in an offline map.  Easily switch between a device and a paper printout.</p>
<p>How would one overlap on a 'regular' map? Might be neat to try to do via features.  Would need same project I suppose.</p>
<p>Note that there's a TTGO EINK+ESP32 module <a href="https://www.amazon.com/WEMS-ESP32-EPaper-Module-Speakers/dp/B07B9V1K7H">here</a>.</p>
<p>E-ink calendar display project <a href="https://github.com/martinberlin/eink-calendar">here</a> for ESP32.</p>
<h3>Quick tally of hardware costs</h3>
<p>If custom board:</p>
<ul>
<li>pcb: $10</li>
<li>display: $30</li>
<li>gps: $5</li>
<li>micro+passives: $5</li>
<li>misc: $5</li>
<li><strong>total</strong>: $55</li>
</ul>
<p>can sell for 4X to support project, or around $200?</p>
<p>If DIY kit:</p>
<ul>
<li>pcb: $10</li>
<li>display: $30</li>
<li>microcontroller: $20</li>
<li>SD card: $5</li>
<li>GPS: $5</li>
</ul>
<p>Can sell the PCB + SD card + GPS + screen as a kit for (10+30+5+5)*4 = $200 ... hmm. Maybe if also sell a case ...</p>
<h3>GPS</h3>
<p>Sparkfun <a href="https://www.arduino.cc/reference/en/libraries/sparkfun-ublox-arduino-library/">ublox library</a>.</p>
<p>Various Sparkfun <a href="https://www.sparkfun.com/categories/tags/u-blox">ublox products</a>.</p>
<p>I think the cheap chip vis a vis ublox is the NEO-6M. That's on the meshtastic, and that's what I'm using via Amazon. E.g. <a href="https://www.amazon.com/DIYmall-AeroQuad-Antenna-Arduino-Aircraft/dp/B01H5FNA4K/ref=sr_1_7?dchild=1&amp;keywords=GPS+U-blox+NEO-6M+Module&amp;qid=1606324327&amp;refinements=p_76%3A2661625011&amp;rps=1&amp;sr=8-7">here</a>.</p>
<p>This is the 'NEO-6M' item I've been using, <a href="https://www.amazon.com/DIYmall-AeroQuad-Antenna-Arduino-Aircraft/dp/B01H5FNA4K/ref=pd_lpo_147_t_0/138-2479136-9655161?_encoding=UTF8&amp;pd_rd_i=B01H5FNA4K&amp;pd_rd_r=4c20784f-c1a2-486c-b9dc-aa87c28e8ace&amp;pd_rd_w=oiq9h&amp;pd_rd_wg=sPeQk&amp;pf_rd_p=7b36d496-f366-4631-94d3-61b87b52511b&amp;pf_rd_r=TE8WSNWNZTAYDY5AT2RK&amp;psc=1&amp;refRID=TE8WSNWNZTAYDY5AT2RK">here</a>.</p>
<h3>Designing a PCB for the waveshare</h3>
<p>Module description is <a href="https://www.waveshare.com/4.2inch-e-paper-module.htm">here</a>.</p>
<p>Dimensions of module are thus:</p>
<p><img src="/img/eink/4.2inch-e-Paper-Module-size.jpg" alt=""></p>
<p><a href="https://www.sparkfun.com/products/10063">5-way tactile switch</a></p>
<p>Sparfkun <a href="https://www.sparkfun.com/products/9426">thumb slide joystick</a>.</p>
<p>Two-axis analog thumb joystick <a href="https://www.adafruit.com/product/3103?gclid=CjwKCAiAnvj9BRA4EiwAuUMDf3G_fkelMEeerVZsKheGOKmEEHHC8dTNP6ZO3IY1C-4tmHcKU-vbJBoC7bUQAvD_BwE">from adafruit</a>.</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><hr>
<p>2020 NOV 16</p>
<p>NRF52 + LoRa wing setup --</p>
<ul>
<li>B / 11 -- RST</li>
<li>D / 30 -- CS</li>
<li>E / 27 -- IRQ</li>
</ul>
<p>NRF52 Feather:</p>
<p><a href="/img/co2/nrf52_pinout.jpg"><img src="/img/co2/nrf52_pinout.jpg" alt=""></a></p>
<p>LoRa Featherwing:</p>
<p><a href="/img/bluetooth/lora_featherwing.jpg"><img src="/img/bluetooth/lora_featherwing.jpg" alt=""></a></p>
<hr>
<p>24 NOV 2020</p>
<h2>Web App + ESP32 Bluetooth configuration</h2>
<p>By <a href="https://github.com/pswoodworth">Parker</a>!</p>
<p><a href="https://github.com/pswoodworth/esp32-ble-interface">ESP32 Code</a></p>
<p><a href="https://github.com/pswoodworth/ble-micro-web-interface">Web app</a></p>
<hr>
<p>2020-11-26 14:57:25</p>
<p>Experimenting with <a href="https://github.com/edgecollective/esp32-ble-interface">Parker's Arduino BLE code</a> ...</p>
<p>Compiles nicely for Heltec Wifi LoRa 32 v2!  But interesting that for ESP32 Feather, we get:</p>
<p><img src="/img/bluetooth/adafruit_feather_32_error.png" alt=""></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p><a href="https://www.analog.com/media/en/technical-documentation/data-sheets/3536fa.pdf">LTC3536 datasheet</a></p>
<p>Article on buck-bost converters, <a href="https://www.ept.ca/features/selecting-the-right-buck-boost-converter-for-wide-vin-rails-2/">here</a>.</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><hr>
<p>2020-11-26 14:37:30</p>
<h3>Misc notes</h3>
<p><a href="http://windcompressor.com/">windcompressor.com</a></p>
<p><a href="http://ucsustainability.blogspot.com/2009/01/amish-wind-problems.html?m=1">&quot;Amish Wind Problems&quot;</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>Nice discussion on envirodiy <a href="https://www.envirodiy.org/ultrasonic-water-depth-sensor/">here</a> of a Maxtobox-based design.</p>
<p>Another nice post on environdiy on evaluating their performance, <a href="https://www.envirodiy.org/evaluation-water-level-monitoring-maxbotix-ultrasonic-sensors/">here</a>.</p>
<ul>
<li>A question I have, here:  they consider the Onset logger to be the 'reference' ... but oughtn't we also to evalue <em>its</em> values?  I like the idea of conductive screws as an 'absolute' external check on either sensor (though maybe that measurement mode is more complex than I realize).</li>
</ul>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><h3>Misc Notes</h3>
<p><a href="https://www.youtube.com/watch?v=ZuNOD3XWp4A">Defcon 21 - All Your RFz Are Belong to Me - Hacking the Wireless World with Software Defined Radio</a></p>
<p><a href="https://www.youtube.com/watch?v=xQVm-YTKR9s">Andreas Spiess -- SDR -- how does it work?</a></p>
<p><a href="https://www.adafruit.com/product/1497">Adafruit product page for RTL2832</a></p>
<p>[Radio hacking -- cars, hardware, more -- based on RTL2832](Radio Hacking: Cars, Hardware, and more! - Samy Kamkar - AppSec California 2016)</p>
<p>2020-12-24 06:39:49</p>
<p>practical tips and tricks w/ the radio <a href="https://gqrx.dk/doc/practical-tricks-and-tips">here</a></p>
<p>radio faxes <a href="https://www.weather.gov/marine/marshlatest">here</a></p>
<p><img src="/img/radio/PLAZ01.tiff" alt=""></p>
<p>national weatherfax service <a href="https://www.weather.gov/marine/radiofax_charts">here</a></p>
<p>weatherfax <a href="https://www.weather.gov/marine/marsh">here</a></p>
<hr>
<p>2021-01-05 21:01:32</p>
<p>from Dave S.:</p>
<p>here's a nice podcast called Foundations of Amateur Radio that consists of 5 min episodes.  Focused on getting started in the hobby and dealing with very practical topics and knowledge.  https://podcasts.vk6flab.com/podcasts/foundations</p>
<p>Very interesting is this project to develop a small Arduino-based SDR transceiver for HF modes (voice, digital, etc) here.:
https://groups.io/g/ucx</p>
<p>Here's a schematic: https://raw.githubusercontent.com/threeme3/QCX-SSB/master/ucx.png</p>
<p>from Mat L:</p>
<p>Check this stellar ham device. Its setup for low power and handling sensor inputs. http://picoaprs.de/index_en.html</p>
<hr>
<p>2021-01-14 09:32:38</p>
<p>SDR in a raspberry pi image <a href="https://hackaday.com/2019/12/20/all-your-sdr-software-in-a-handy-raspberry-pi-image/">here</a></p>
<p>RPi SDR scanner via adafruit <a href="https://learn.adafruit.com/freq-show-raspberry-pi-rtl-sdr-scanner">here</a></p>
<p>Raspberry Pi websdr <a href="https://github.com/reynico/raspberry-websdr">here</a></p>
<hr>
<p>2021-01-19 20:35:50</p>
<p>Cheap ham antenna here: <a href="https://hackaday.com/2021/01/19/the-50-ham-a-cheap-antenna-for-the-hf-bands/">https://hackaday.com/2021/01/19/the-50-ham-a-cheap-antenna-for-the-hf-bands/</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><hr>
<p>2020-12-24 05:27:02</p>
<p>amplifier breakout board <a href="https://learn.sparkfun.com/tutorials/load-cell-amplifier-hx711-breakout-hookup-guide/all">here</a></p>
<p>sparkfun <a href="https://learn.sparkfun.com/tutorials/openscale-applications-and-hookup-guide">openscale</a></p>
<p>esp32 websocket client <a href="https://randomnerdtutorials.com/esp32-websocket-server-arduino/">here</a></p>
<p>arduino websockets library for esp <a href="https://github.com/gilmaimon/ArduinoWebsockets">here</a></p>
<p><a href="https://randomnerdtutorials.com/esp32-esp8266-plot-chart-web-server/">this</a> is a great tutorial on plotting live data in charts using an esp32!</p>
<p>&quot;I also had the same problem, then i have changed in the menu: Tools / Flash size / assigned 2M for SPIFFS (otherwise set to zero).
Now it Works…&quot;</p>
<hr>
<p>2020-12-24 05:32:57</p>
<p>following tutorial <a href="https://randomnerdtutorials.com/esp32-esp8266-plot-chart-web-server/">here</a></p>
<p>file uploader for esp32 <a href="https://github.com/me-no-dev/arduino-esp32fs-plugin/releases/">here</a></p>
<p>needed libraries:</p>
<ul>
<li>asyncwebserver <a href="https://github.com/me-no-dev/ESPAsyncWebServer">here</a></li>
<li>asynctcp <a href="https://github.com/me-no-dev/AsyncTCP">here</a></li>
</ul>
<p>initial working github code is <a href="https://github.com/edgecollective/esp32-scale/tree/main/firmware/esp32_scale">here</a></p>
<p><img src="/img/scale/initial_test.png" alt=""></p>
<p><img src="/img/scale/load_one.png" alt=""></p>
<p>updated code is <a href="https://github.com/edgecollective/esp32-scale/tree/main/firmware/esp32_scale_solo">here</a></p>
<p>replacing a div content <a href="https://stackoverflow.com/questions/121817/how-do-i-replace-text-inside-a-div-element">here</a></p>
<p>an updated version of the above tutorial <a href="https://arduinodiy.wordpress.com/2019/08/05/esp8266-plot-sensor-readings-in-real-time-charts-on-a-web-server/">here</a></p>
<hr>
<p>2020-12-24 06:30:41</p>
<p>dashboard for esp32 <a href="https://github.com/ayushsharma82/ESP-DASH">here</a></p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><hr>
<p>2021-01-19 12:28:28</p>
<p>First pass at board:</p>
<p><img src="/img/flood/tideboard.png" alt=""></p>
<p>Design files here: <a href="https://github.com/edgecollective/tide-board">https://github.com/edgecollective/tide-board</a></p>
<p>1/4 watt -- 10 mm or 0.4 inches</p>
<hr>
<p>2021-01-24 09:16:27</p>
<p>Dave S. in Belfast's successful test of the Maxbotix Ultrasonice + Heltec Wifi Lora 32 v2 -- <a href="https://youtu.be/KpKlBCJnksk">video</a></p>
<p><img src="/img/flood/heltec_maxbotix.png" alt=""></p>
<hr>
<p>2021-01-24 09:24:36</p>
<p>Possible RTCZero support on the IBM4? <a href="https://github.com/arduino-libraries/RTCZero/pull/66">https://github.com/arduino-libraries/RTCZero/pull/66</a>.</p>
<p>Issue prior: because the IBM4 is a 'crystal-less' design (I think the IBM0, too? But not the Feather version of these boards?) there was some additional code that needed to be written ... but looks like the above pull request purports to fix it ... worth trying!</p>
</p>
      </div>
    </div>
  </div>

  <div class="post">
    <div class="project-contents">
      <div class="text">
        <h3>Note </h3>
        <p><p>Named after the <a href="https://en.wikipedia.org/wiki/Passagassawakeag_River">Passagassawakeag_River</a> in Maine.</p>
<hr>
<h2>Misc Index</h2>
<h3>- <a href="#kicad1">Notes on Kicad Part I</a></h3>
<hr>
<p>2021-01-26 09:17:35</p>
<p>Collection of repositories on gitlab here: <a href="https://gitlab.com/edgecollective/pbot">https://gitlab.com/edgecollective/pbot</a></p>
<h2>Philosophizing</h2>
<p>Increasing the level of one's technological sovereignty by developing the capacity to 'self-provision' one's own infrastructure is hard to assess in terms of absolute levels of sovereignty.  One might solder a circuit oneself -- but not be able to produce the circuit board itself (or the solder, or the resistor, or the microchip ...).  {TODO: link to Stallman's essay on hardware here.}</p>
<p>There is an ongoing process of assessing which among the diverse crop of emerging technologies -- many of them produced through industrial processes that might never be possible in a 'DIY' context ... might be useful ... and how they might be encapsulated to make them easier to use, and design with, at the 'local' level.</p>
<p>This project demonstrates some of these issues.  The SAMD21 and SAMD51 are powerful, useful chips; they are small enough, even if their most accessible packages, that they are difficult to solder onto a board design (at least, without a lot of trial and error, practice, and a good assembly setup).</p>
<p>However, the typical applications in which they might be used -- sensing, control, etc -- involve connecting the devices via only a few wires to external devices -- many of which are themselves relatively easy to solder / assemble.</p>
<p>The ItsyBitsy design by Adafruit -- similar to their Feather, or the Arduino Pro Mini, the Teensy, and even the Arduino UNO -- takes the most complex, flexible, central, and difficult to solder part of an overall project design -- the microcontroller -- and 'encapsulates' it in a form that makes it far easier for folks to design around.</p>
<p>We base our 'PBot' design off the ItsyBitsy ...</p>
<hr>
<p>2021-01-26 10:47:19</p>
<p>Designing the device in KiCAD: <a href="https://gitlab.com/edgecollective/pbot/pbot-hardware">https://gitlab.com/edgecollective/pbot/pbot-hardware</a></p>
<h2>Itsy Bitsy M4</h2>
<p><a href="https://www.adafruit.com/product/3800">IBM4 on Adafruit</a></p>
<p><img src="/img/pbot/itsybitsy.jpg" alt=""></p>
<p><img src="/img/pbot/itsybitsy_back.jpg" alt=""></p>
<h2>RFM95 Breakout</h2>
<p><a href="https://www.adafruit.com/product/3072">RFM95 Breakout on Adafruit</a></p>
<p><img src="/img/pbot/rfm95_breakout.jpg" alt=""></p>
<h2>First Pass at Schematic and Layout</h2>
<p><img src="/img/pbot/base_schematic.png" alt=""></p>
<p><img src="/img/pbot/pbot_board.png" alt=""></p>
<p><img src="/img/pbot/pbot_3d.png" alt=""></p>
<h2><a name="kicad1"></a>KiCAD notes: Assigning footprints and updating pcb</h2>
<p><img src="/img/pbot/update_pcb_from_schematic.png" alt=""></p>
<p>After laying out symbols in the schematic editor, the next steps are:</p>
<h3>1. Assign PCB footprints.</h3>
<p>In the <em>schematic editor</em>, select the &quot;Assign PCB Footprints&quot; button.  It'll bring up a dialog that allows you to assign footprints to the symbols you've got in the schematic editor.</p>
<p><img src="/img/pbot/assign_footprints.png" alt=""></p>
<h3>2. Update PCB from schematic.</h3>
<p>In the <em>pcb layout editor</em>, select the &quot;Update PCB From Schematic&quot; button.  It'll import any recent (saved) changes to the schematic.  You might need to fiddle with the dialog settings in order to have it do the proper thing.</p>
<p><img src="/img/pbot/update_pcb_from_schematic.png" alt=""></p>
</p>
      </div>
    </div>
  </div>

</div>
-->

  </body>
</html>
